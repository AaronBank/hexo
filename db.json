{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/diaspora/source/css/diaspora.css","path":"css/diaspora.css","modified":0,"renderable":1},{"_id":"themes/diaspora/source/img/logo.png","path":"img/logo.png","modified":0,"renderable":1},{"_id":"themes/diaspora/source/js/diaspora.js","path":"js/diaspora.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/js/plugin.js","path":"js/plugin.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/photoswipe-ui-default.js","path":"photoswipe/photoswipe-ui-default.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/photoswipe.css","path":"photoswipe/photoswipe.css","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/photoswipe-ui-default.min.js","path":"photoswipe/photoswipe-ui-default.min.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/photoswipe.min.js","path":"photoswipe/photoswipe.min.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/img/welcome-cover.jpg","path":"img/welcome-cover.jpg","modified":0,"renderable":1},{"_id":"themes/diaspora/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/photoswipe.js","path":"photoswipe/photoswipe.js","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/default-skin/default-skin.css","path":"photoswipe/default-skin/default-skin.css","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/default-skin/default-skin.svg","path":"photoswipe/default-skin/default-skin.svg","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/default-skin/default-skin.png","path":"photoswipe/default-skin/default-skin.png","modified":0,"renderable":1},{"_id":"themes/diaspora/source/photoswipe/default-skin/preloader.gif","path":"photoswipe/default-skin/preloader.gif","modified":0,"renderable":1},{"_id":"themes/diaspora/source/img/cover.jpg","path":"img/cover.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"4f181ea2ff1d1217efaaa80ad4104c2dc4b8b416","modified":1564374721904},{"_id":"themes/diaspora/LICENSE","hash":"63175a16773044bed84e1778009a54ad03dd5520","modified":1561470637579},{"_id":"themes/diaspora/README.md","hash":"9037ddf0e76bf214544fd2d7e15b5116717aebdf","modified":1564485473021},{"_id":"themes/diaspora/.DS_Store","hash":"cf92b70354ac9ffa4a77d515e0147f4b3f803e54","modified":1564480344251},{"_id":"themes/diaspora/_config.yml","hash":"78a49bac8290d4e2d155afe8fcf1931f1e085b8c","modified":1564503641160},{"_id":"source/_posts/Ubuntu 创建快捷启动.md","hash":"833d1f3a772142001b06b0efdd99d24d28d1242f","modified":1564471740688},{"_id":"source/_posts/Git多帐号配置-管理多个SSH.md","hash":"0a8f84d2f04c1e6c35475f20f475c7710ca74e5b","modified":1564470505544},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1564375154730},{"_id":"source/_posts/js中的深拷贝与浅拷贝.md","hash":"18d54ab5e571cec5ab119019cbe197ebbe6f58b1","modified":1564633703606},{"_id":"source/_posts/javascript类型检测汇总.md","hash":"8b4361c3a9c9e5d11f1e2bfd3c058582d6d20e59","modified":1564628680453},{"_id":"source/_posts/react-native-因图片打包太大问题.md","hash":"481dc4aedfb685e9c62507a188bed9fdaa78b349","modified":1564478830555},{"_id":"source/_posts/Git-2-0-更改-push-default.md","hash":"5f584fec42009a5867b72b8191c87a26fed1c557","modified":1564578540655},{"_id":"source/_posts/react-native-生成二维码.md","hash":"19a7ea3702f3dd11e239f0e25c31376394853555","modified":1564486622801},{"_id":"source/_posts/react-native-获取设备imei.md","hash":"51590f27b9ab4ffde6f2fa4656b303e1dde2725c","modified":1564493812533},{"_id":"source/_posts/vue-cli2-配置Dll打包.md","hash":"82c10679d10bb7e70277370bf2277c72a5f00821","modified":1564717923654},{"_id":"source/_posts/react-native中fetch发送https或http相关问题总结.md","hash":"7aa0256ccf50a3e6422a1f1be43f030951c0a599","modified":1564503022985},{"_id":"source/_posts/react-native-配置启动图（闪屏图）支持ios和android.md","hash":"ca113b8e4bfeab85240d6b1c9ccd7d9b69e206cf","modified":1564496590349},{"_id":"source/_posts/react-常用项目配置.md","hash":"20d39054583f394278256b007142a301a639867e","modified":1564642284689},{"_id":"source/_posts/vue调试神器vue-devtools安装.md","hash":"6b839a76afe335b0871620093f1f38f807e03daa","modified":1564404005755},{"_id":"source/tags/index.md","hash":"df069bd40008a04e9ee24ea7650d5026a69d1717","modified":1562960257118},{"_id":"source/_posts/面向对象从ES3到ES6-的继承方法总结以及对比.md","hash":"a691be95fbe597ea6c9ea158e4e374cbc581e197","modified":1564474695715},{"_id":"source/categories/index.md","hash":"8b7256603a81e4163a38b3ed3f86345620a4bc6c","modified":1564375046664},{"_id":"themes/diaspora/languages/fr.yml","hash":"84ab164b37c6abf625473e9a0c18f6f815dd5fd9","modified":1561470637580},{"_id":"themes/diaspora/languages/it.yml","hash":"6ae71000ed039f56572143ffe90da17b95d1a66f","modified":1561470637580},{"_id":"themes/diaspora/languages/default.yml","hash":"1b2b75ca9ff3bfeddb596239889b584cdfcecc32","modified":1561470637580},{"_id":"themes/diaspora/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1561470637580},{"_id":"themes/diaspora/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1561470637580},{"_id":"themes/diaspora/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1561470637580},{"_id":"themes/diaspora/languages/zh-CN.yml","hash":"ccbba6315760755926f5abfe1b98c225a6650581","modified":1561470637581},{"_id":"themes/diaspora/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1561470637581},{"_id":"themes/diaspora/layout/archive.ejs","hash":"e50d2e66e8a66789d6a8ef456979aa05143224ce","modified":1561470637585},{"_id":"themes/diaspora/layout/index.ejs","hash":"7ccb03f40fada2cd74c00554e5b6718508545d71","modified":1561470637585},{"_id":"themes/diaspora/layout/category.ejs","hash":"920114db892fe39fab097c4f65d8ffc9b2a76b69","modified":1561470637585},{"_id":"themes/diaspora/layout/layout.ejs","hash":"bbead31ed8f81cb75b22d6c220793c9ed4ff3e66","modified":1561470637585},{"_id":"themes/diaspora/scripts/page_title.js","hash":"35dbc39e4edd53b20f5433dc0d1708024049186d","modified":1561470637586},{"_id":"themes/diaspora/layout/page.ejs","hash":"c311e177fc5eea6954e313374e73bd690814c91a","modified":1561470637586},{"_id":"themes/diaspora/layout/tag.ejs","hash":"920114db892fe39fab097c4f65d8ffc9b2a76b69","modified":1561470637586},{"_id":"themes/diaspora/layout/post.ejs","hash":"e585d8b4680c52dccfc40ffa6b2c5df515bf20d2","modified":1561470637586},{"_id":"themes/diaspora/source/.DS_Store","hash":"6eb13211c50a3ab8ea56febb65ac07b4973c1577","modified":1564480344250},{"_id":"themes/diaspora/layout/_partial/categories.ejs","hash":"02cf5a962644da311e52fa441d2b300b0c9286a5","modified":1561470637581},{"_id":"themes/diaspora/layout/_partial/google-analytics.ejs","hash":"4806289a1c3de19a1cc4e6242c82cdd429c3bfe8","modified":1561470637581},{"_id":"themes/diaspora/layout/_partial/head.ejs","hash":"af13f26ebecc228ff8893cf458959aec9ba328d0","modified":1561470637582},{"_id":"themes/diaspora/layout/_partial/list.ejs","hash":"8e03499580aa81ec0b4c8316347b4e3839849007","modified":1561470637582},{"_id":"themes/diaspora/layout/_partial/menu.ejs","hash":"e2f1c6944b269760456575fb7fed713fa04a1761","modified":1561470637582},{"_id":"themes/diaspora/layout/_partial/pagination.ejs","hash":"23bf862b3b8a3cd831850504d9b5a24d21b005e7","modified":1561470637582},{"_id":"themes/diaspora/layout/_partial/photoswipe.ejs","hash":"d1d36cf0a2c03ff3c2acbc208fe11cd0afd8b7bd","modified":1561470637582},{"_id":"themes/diaspora/layout/_partial/scripts.ejs","hash":"041a2e405157447b20b5d339596f35a2ec89808c","modified":1561470637584},{"_id":"themes/diaspora/layout/_partial/screen.ejs","hash":"33b014bf5c9bbe12e73231a6a30b1737c99da894","modified":1564472536144},{"_id":"themes/diaspora/layout/_partial/tags.ejs","hash":"16cfcf585417ec279c12d8cfbcf6383bf7f2a8c6","modified":1561470637584},{"_id":"themes/diaspora/source/css/diaspora.css","hash":"4506bdd137aa71d64ac5f3e5a329f17acea88966","modified":1562421642804},{"_id":"themes/diaspora/source/img/.DS_Store","hash":"17ff80e16e78966bddc6f15557a1e15fba5382a3","modified":1564480338127},{"_id":"themes/diaspora/source/img/logo.png","hash":"80cb1e53f3b858c059a0f26d77ac5ee5cbd1044e","modified":1562418812477},{"_id":"themes/diaspora/source/js/diaspora.js","hash":"559740e9f119855dcd4b94435c8bc532ba7caeb3","modified":1561470637591},{"_id":"themes/diaspora/source/js/plugin.js","hash":"0ac6bf36a9a11ca6fad0af1f20e5705bc326abf4","modified":1561470637592},{"_id":"themes/diaspora/source/photoswipe/photoswipe-ui-default.js","hash":"c844cca2f9a9969a810a0fb534063e008424c936","modified":1561470637594},{"_id":"themes/diaspora/source/photoswipe/photoswipe.css","hash":"a31fa495095783ef5a84ba4dba0bd6f7de3b07ea","modified":1561470637594},{"_id":"themes/diaspora/source/photoswipe/photoswipe-ui-default.min.js","hash":"d80b713ca1bab90f27a8af7d8e43563f0fe81860","modified":1561470637594},{"_id":"themes/diaspora/source/photoswipe/photoswipe.min.js","hash":"791703278e7c576b08b67f18404bae9eb8cebfaf","modified":1561470637595},{"_id":"themes/diaspora/source/img/welcome-cover.jpg","hash":"81e9751d3387556b36869113c812f881ca4767bf","modified":1561471822654},{"_id":"themes/diaspora/source/js/jquery.min.js","hash":"3f1b0e9e54af1af2db2c8a639530448723462151","modified":1561470637592},{"_id":"themes/diaspora/source/photoswipe/photoswipe.js","hash":"30967789eb2a3e1da9927e71f4f3c5339ebed39a","modified":1561470637595},{"_id":"themes/diaspora/layout/_partial/post/article.ejs","hash":"b2dbaf24cc2fa05be414b97ec5f0315328a8d84c","modified":1561470637583},{"_id":"themes/diaspora/layout/_partial/post/date.ejs","hash":"6f2d1aa9562df343b797d25705f1945323c465fb","modified":1561470637583},{"_id":"themes/diaspora/layout/_partial/post/gitalk.ejs","hash":"7b684b561eca872b8e18e270c07f459ea3634676","modified":1561470637583},{"_id":"themes/diaspora/layout/_partial/post/header.ejs","hash":"5e10a5e619a52fa229228bc4ceb22e54149f0df5","modified":1564485735334},{"_id":"themes/diaspora/layout/_partial/post/item.ejs","hash":"b7a75aa667765b5c3a16b3b9a71ed38ea0a128a4","modified":1561470637584},{"_id":"themes/diaspora/layout/_partial/post/tag.ejs","hash":"c2b4ce7e1d7eed59f4c333915cd431f008f898e3","modified":1561470637584},{"_id":"themes/diaspora/layout/_partial/post/title.ejs","hash":"33f2a96f17fb1efa354c92aef906d96984abd9ab","modified":1561470637584},{"_id":"themes/diaspora/source/photoswipe/default-skin/default-skin.css","hash":"5763bd1a8015774f37215359bfcb5edd65d198a6","modified":1561470637593},{"_id":"themes/diaspora/source/photoswipe/default-skin/default-skin.svg","hash":"2ac727c9e092331d35cce95af209ccfac6d4c7c7","modified":1561470637593},{"_id":"themes/diaspora/source/photoswipe/default-skin/default-skin.png","hash":"ed95a8e40a2c3478c5915376acb8e5f33677f24d","modified":1561470637593},{"_id":"themes/diaspora/source/photoswipe/default-skin/preloader.gif","hash":"6342367c93c82da1b9c620e97c84a389cc43d96d","modified":1561470637593},{"_id":"themes/diaspora/source/img/cover.jpg","hash":"962f0272162c036ca2eeef9f9632ec95fcd8af53","modified":1561471861456},{"_id":"public/tags/index.html","hash":"430c5093963d06c215492b4461be865fa1b59b7a","modified":1564717935662},{"_id":"public/categories/index.html","hash":"714d0e051a99966dc09a89a00857d73a0948deed","modified":1564717935662},{"_id":"public/2019/07/30/react-native-生成二维码/index.html","hash":"44fbdb997ef8c98fc82f19cd546f457fc1df49db","modified":1564717935699},{"_id":"public/2019/07/30/react-native-因图片打包太大问题/index.html","hash":"9e52980e974d5f6b9d2e220613cce27b5d8e978a","modified":1564717935700},{"_id":"public/2019/07/29/Ubuntu 创建快捷启动/index.html","hash":"896b7c0c24d31efc05cb17f3fb9b1aff10d719e6","modified":1564717935702},{"_id":"public/2019/07/29/Git多帐号配置-管理多个SSH/index.html","hash":"0bc991e6a1a5e8ce5e27fcc23366ccf6b9203624","modified":1564717935702},{"_id":"public/2019/07/29/vue调试神器vue-devtools安装/index.html","hash":"afc9aa072906b4f1415dccb2e364d9dcbd0733f7","modified":1564717935702},{"_id":"public/archives/index.html","hash":"206785704355ebfd441936991928b53f138cbfc0","modified":1564717935702},{"_id":"public/archives/2019/index.html","hash":"e940d82bbbc5cdb153cb3f91c3103c4fa91f676a","modified":1564717935702},{"_id":"public/archives/2019/07/index.html","hash":"f428a6c87e16279f1e1b315acd1bd66e1098bbc5","modified":1564717935702},{"_id":"public/categories/系统平台/index.html","hash":"23a6c6fff57bf8ae7f59e5c5f313e43e32f69574","modified":1564717935702},{"_id":"public/categories/版本管理/index.html","hash":"763d3ecadfabb4ab2b9a1274ca7af77ae902d7b3","modified":1564717935702},{"_id":"public/categories/前端/index.html","hash":"609bde9051e90b38ba7070d940fa64649c2ee67b","modified":1564717935702},{"_id":"public/categories/实用工具/index.html","hash":"86c2ec5d6bebff0e28790e23118e28230a134b95","modified":1564717935703},{"_id":"public/index.html","hash":"98960a607b43dc615667c8842ea25c9890c46b12","modified":1564717935703},{"_id":"public/tags/ubuntu/index.html","hash":"501d442e299c2e41325f3f472fd554732d17bb61","modified":1564717935703},{"_id":"public/tags/Git/index.html","hash":"32421d458026bbbaabe3856773c3cfe88fbe1569","modified":1564717935703},{"_id":"public/tags/Javascript/index.html","hash":"372c0f9cc81fd7aad032c17770b618021cca005a","modified":1564717935703},{"_id":"public/tags/ReactNative/index.html","hash":"0a0cb6251a4bfc96a4dc77da8efafcddcf9b982f","modified":1564717935703},{"_id":"public/tags/Vue/index.html","hash":"168248fca5856a59d6807ed405ee04304c6dee5f","modified":1564717935703},{"_id":"public/2019/07/30/javascript类型检测汇总/index.html","hash":"5bee5bb777f101df11121436ba4e72e880a65f6f","modified":1564717935703},{"_id":"public/2019/07/30/react-native中fetch发送https或http相关问题总结/index.html","hash":"d928080c691ce387b7b9459052d449996dc7d826","modified":1564717935703},{"_id":"public/2019/07/30/react-native-配置启动图（闪屏图）支持ios和android/index.html","hash":"9b337f9a59aa50da6ccbfde8c2b866010184256e","modified":1564717935703},{"_id":"public/2019/07/30/react-native-获取设备imei/index.html","hash":"21e6459046002481343a740cb02650c9baa2697c","modified":1564717935704},{"_id":"public/2019/07/29/面向对象从ES3到ES6-的继承方法总结以及对比/index.html","hash":"db5384a622e1d3b707db1fb64ae95b0db00ac25c","modified":1564717935704},{"_id":"public/2019/07/31/Git-2-0-更改-push-default/index.html","hash":"e1e39e4c28589e4505b606e54da7588648225460","modified":1564717935706},{"_id":"public/archives/page/2/index.html","hash":"e4d40a3be4f87f9a128562d8395bedcf0ddf1a3d","modified":1564717935706},{"_id":"public/archives/2019/page/2/index.html","hash":"630d57273d8a7f2e0ff4389bedc8cdff7b31426d","modified":1564717935706},{"_id":"public/archives/2019/07/page/2/index.html","hash":"621a81a7bbb92e6be1f6c879ae9796b9a90595c1","modified":1564717935706},{"_id":"public/archives/2019/08/index.html","hash":"5aa69018386594160b2ba23ee717cb35dca87f63","modified":1564717935706},{"_id":"public/categories/工程化/index.html","hash":"2c981fe79699205dfc51904a9b9e0db8f6aa27d6","modified":1564717935706},{"_id":"public/page/2/index.html","hash":"02ee67a8557611f665b304cf661ef29707a451ec","modified":1564717935707},{"_id":"public/tags/React/index.html","hash":"d6c4884b38835375d96a7e23901aa280f9462775","modified":1564717935707},{"_id":"public/2019/08/01/vue-cli2-配置Dll打包/index.html","hash":"45363430e72d4702e7fb48cc935202181ab55fc8","modified":1564717935707},{"_id":"public/2019/07/31/react-常用项目配置/index.html","hash":"5c21ba8a3d34501f3c503adf306a2628432b1d7d","modified":1564717935707},{"_id":"public/2019/07/31/js中的深拷贝与浅拷贝/index.html","hash":"4f92b68cb1cf0dad3bffd19f577ed82133e614c2","modified":1564717935707}],"Category":[{"name":"系统平台","_id":"cjysbhubo0004qbt5cvec31c5"},{"name":"版本管理","_id":"cjysbhubu0009qbt50j4fgstk"},{"name":"前端","_id":"cjysbhubz000fqbt5q12u0u9y"},{"name":"工程化","_id":"cjysbhucd0011qbt5ma4a5duh"},{"name":"实用工具","_id":"cjysbhucf0017qbt5p1j1oyy9"}],"Data":[],"Page":[{"title":"标签","date":"2019-07-12T19:36:46.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2019-07-13 03:36:46\ntype: tags\n---\n","updated":"2019-07-12T19:37:37.118Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjysbhubj0001qbt5sc64ebvm","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","date":"2019-07-12T19:36:55.000Z","type":"categories","_content":"\n","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2019-07-13 03:36:55\ntype: categories\n---\n\n","updated":"2019-07-29T04:37:26.664Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjysbhubm0003qbt5v0zne5mw","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"layout":"ubuntu","title":"Ubuntu 创建快捷启动","date":"2019-07-29T12:41:47.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/072847.png","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/124421.png) \n\n**以开发工具IDEA编辑器为例，顺便介绍一下如何在Ubuntu 中如何安装和配置快捷启动（因为每次都需要终端中打开很麻烦 (⁎⁍̴̛ᴗ⁍̴̛⁎)）**\n\n\n\n### IDEA安装\n\n1. 下载linux版本包\n  \n\t点击前往下载：[https://www.jetbrains.com/idea/download/#section=linux](https://www.jetbrains.com/idea/download/#section=linux)\n  \n2. cd 进入IDEA文件的目录位置(我的是下载在Downloads文件夹下)\n\n\t```\n\tcd ~/Downloads/\n\t```\n\t\n3. 减压并移动到/opt文件夹下\n\n\t```\n\tsudo tar -zxvf ideaIU-2018.1.4-no-jdk.tar.gz -C /opt\n\t```\n\t\n4. 启动\n\t\n\t```\n\tcd /opt/ideaIU-2018.1.4-no-jdk/bin/`\n\t\n\t./idea.sh\t\n\t```\n\n- **至此我想你已经看到了启动向导界面了  和往常一样使用就可以了**\n\n- **然而你会发现每次打开都需要执行`./idea.sh`这条命令才能打开，是不是很悲剧😫😫😫，下面说一下如何去配置快捷启动**\n\n\n\n### 配置快捷启动\n\n\n\n1. 首先你需要`/usr/share/`这个文件夹下\n\n    ```\n    cd /usr/share/\n    ```\n\n2. 创建一个后缀名为`desktop`的文件（名字你随意,我就叫他idea）\n\n\t```\n\tsudo gedit idea.desktop\n\t```\n\t\n3. 为文件添加内容\n\n\t\t```desktop\n\t[Desktop Entry]\n\tName = Idea\n\tExec = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.sh\n\tIcon = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.png\n\tTerminal = false\n\tType = Application\n\tCategories = Developer;\n\t```\n\n🍎🍎现在可以每次都双击图标就可以启动啦🍎🍎","source":"_posts/Ubuntu 创建快捷启动.md","raw":"---\nlayout: ubuntu\ntitle: Ubuntu 创建快捷启动\ndate: 2019-07-29 20:41:47\ntags: ubuntu\ncategories: 系统平台\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/072847.png\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/124421.png) \n\n**以开发工具IDEA编辑器为例，顺便介绍一下如何在Ubuntu 中如何安装和配置快捷启动（因为每次都需要终端中打开很麻烦 (⁎⁍̴̛ᴗ⁍̴̛⁎)）**\n\n\n\n### IDEA安装\n\n1. 下载linux版本包\n  \n\t点击前往下载：[https://www.jetbrains.com/idea/download/#section=linux](https://www.jetbrains.com/idea/download/#section=linux)\n  \n2. cd 进入IDEA文件的目录位置(我的是下载在Downloads文件夹下)\n\n\t```\n\tcd ~/Downloads/\n\t```\n\t\n3. 减压并移动到/opt文件夹下\n\n\t```\n\tsudo tar -zxvf ideaIU-2018.1.4-no-jdk.tar.gz -C /opt\n\t```\n\t\n4. 启动\n\t\n\t```\n\tcd /opt/ideaIU-2018.1.4-no-jdk/bin/`\n\t\n\t./idea.sh\t\n\t```\n\n- **至此我想你已经看到了启动向导界面了  和往常一样使用就可以了**\n\n- **然而你会发现每次打开都需要执行`./idea.sh`这条命令才能打开，是不是很悲剧😫😫😫，下面说一下如何去配置快捷启动**\n\n\n\n### 配置快捷启动\n\n\n\n1. 首先你需要`/usr/share/`这个文件夹下\n\n    ```\n    cd /usr/share/\n    ```\n\n2. 创建一个后缀名为`desktop`的文件（名字你随意,我就叫他idea）\n\n\t```\n\tsudo gedit idea.desktop\n\t```\n\t\n3. 为文件添加内容\n\n\t\t```desktop\n\t[Desktop Entry]\n\tName = Idea\n\tExec = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.sh\n\tIcon = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.png\n\tTerminal = false\n\tType = Application\n\tCategories = Developer;\n\t```\n\n🍎🍎现在可以每次都双击图标就可以启动啦🍎🍎","slug":"Ubuntu 创建快捷启动","published":1,"updated":"2019-07-30T07:29:00.688Z","comments":1,"photos":[],"link":"","_id":"cjysbhubf0000qbt5rus5120x","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/124421.png\" alt> </p>\n<p><strong>以开发工具IDEA编辑器为例，顺便介绍一下如何在Ubuntu 中如何安装和配置快捷启动（因为每次都需要终端中打开很麻烦 (⁎⁍̴̛ᴗ⁍̴̛⁎)）</strong></p>\n<h3 id=\"IDEA安装\"><a href=\"#IDEA安装\" class=\"headerlink\" title=\"IDEA安装\"></a>IDEA安装</h3><ol>\n<li><p>下载linux版本包</p>\n<p> 点击前往下载：<a href=\"https://www.jetbrains.com/idea/download/#section=linux\" target=\"_blank\" rel=\"noopener\">https://www.jetbrains.com/idea/download/#section=linux</a></p>\n</li>\n<li><p>cd 进入IDEA文件的目录位置(我的是下载在Downloads文件夹下)</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/Downloads/</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>减压并移动到/opt文件夹下</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tar -zxvf ideaIU-2018.1.4-no-jdk.tar.gz -C /opt</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"4\">\n<li><p>启动</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /opt/ideaIU-2018.1.4-no-jdk/bin/`</span><br><span class=\"line\"></span><br><span class=\"line\">./idea.sh</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<ul>\n<li><p><strong>至此我想你已经看到了启动向导界面了  和往常一样使用就可以了</strong></p>\n</li>\n<li><p><strong>然而你会发现每次打开都需要执行<code>./idea.sh</code>这条命令才能打开，是不是很悲剧😫😫😫，下面说一下如何去配置快捷启动</strong></p>\n</li>\n</ul>\n<h3 id=\"配置快捷启动\"><a href=\"#配置快捷启动\" class=\"headerlink\" title=\"配置快捷启动\"></a>配置快捷启动</h3><ol>\n<li><p>首先你需要<code>/usr/share/</code>这个文件夹下</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/share/</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建一个后缀名为<code>desktop</code>的文件（名字你随意,我就叫他idea）</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gedit idea.desktop</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>为文件添加内容</p>\n<pre><code><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Desktop Entry]</span><br><span class=\"line\">Name = Idea</span><br><span class=\"line\">Exec = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.sh</span><br><span class=\"line\">Icon = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.png</span><br><span class=\"line\">Terminal = false</span><br><span class=\"line\">Type = Application</span><br><span class=\"line\">Categories = Developer;</span><br></pre></td></tr></table></figure></code></pre></li>\n</ol>\n<p>🍎🍎现在可以每次都双击图标就可以启动啦🍎🍎</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/124421.png\" alt> </p>\n<p><strong>以开发工具IDEA编辑器为例，顺便介绍一下如何在Ubuntu 中如何安装和配置快捷启动（因为每次都需要终端中打开很麻烦 (⁎⁍̴̛ᴗ⁍̴̛⁎)）</strong></p>\n<h3 id=\"IDEA安装\"><a href=\"#IDEA安装\" class=\"headerlink\" title=\"IDEA安装\"></a>IDEA安装</h3><ol>\n<li><p>下载linux版本包</p>\n<p> 点击前往下载：<a href=\"https://www.jetbrains.com/idea/download/#section=linux\" target=\"_blank\" rel=\"noopener\">https://www.jetbrains.com/idea/download/#section=linux</a></p>\n</li>\n<li><p>cd 进入IDEA文件的目录位置(我的是下载在Downloads文件夹下)</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/Downloads/</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>减压并移动到/opt文件夹下</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tar -zxvf ideaIU-2018.1.4-no-jdk.tar.gz -C /opt</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"4\">\n<li><p>启动</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /opt/ideaIU-2018.1.4-no-jdk/bin/`</span><br><span class=\"line\"></span><br><span class=\"line\">./idea.sh</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<ul>\n<li><p><strong>至此我想你已经看到了启动向导界面了  和往常一样使用就可以了</strong></p>\n</li>\n<li><p><strong>然而你会发现每次打开都需要执行<code>./idea.sh</code>这条命令才能打开，是不是很悲剧😫😫😫，下面说一下如何去配置快捷启动</strong></p>\n</li>\n</ul>\n<h3 id=\"配置快捷启动\"><a href=\"#配置快捷启动\" class=\"headerlink\" title=\"配置快捷启动\"></a>配置快捷启动</h3><ol>\n<li><p>首先你需要<code>/usr/share/</code>这个文件夹下</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/share/</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建一个后缀名为<code>desktop</code>的文件（名字你随意,我就叫他idea）</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gedit idea.desktop</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"3\">\n<li><p>为文件添加内容</p>\n<pre><code><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Desktop Entry]</span><br><span class=\"line\">Name = Idea</span><br><span class=\"line\">Exec = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.sh</span><br><span class=\"line\">Icon = /opt/ideaIU-2018.1.4-no-jdk/bin/idea.png</span><br><span class=\"line\">Terminal = false</span><br><span class=\"line\">Type = Application</span><br><span class=\"line\">Categories = Developer;</span><br></pre></td></tr></table></figure></code></pre></li>\n</ol>\n<p>🍎🍎现在可以每次都双击图标就可以启动啦🍎🍎</p>\n"},{"title":"Git多帐号配置,管理多个SSH","date":"2019-07-29T10:09:58.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/070816.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/070816.jpg)\n\n当我们存在多个`git`账号的时候,比如公司用`Gitlib`或者`Gerrit`等等,而日常自己做的一些东西则会托管到`Github`上面。这些`git`账号的邮箱如果使用的是不同的话，就会存在生成一个`git`的`key`的时候会覆盖另外其他的的key 的问题，下面说一下怎么处理😸\n\n### 查看自己现有的SSH-Key\n\n```python\ncd ~/.ssh\nls\n\nid_rsa\nid_rsa.pub\nknown_hosts\n```\n\n如果你已经创建过git账号那你可能和我一样会看到只有一个`SSH-Key`,\n\n这个`SSH-Key`是我在公司`Gerrit`(你也可以理解为`Gitlib`一样的东西)所使用的`SSH-Key`。\n\n由于公司所用邮箱于`Gitlib`上邮箱不一致,如果重复生成新的`SSH-Key`只会吧之前的公司的`SSH-Key`覆盖掉,这样并不是我们所想看到的结果。\n\n废话说完了，就开始说说怎么解决这个问题:\n\n### 生成新的的SSH-Key\n\n```python\nssh-keygen -t rsa -C \"你的邮箱\"\n```\n\n\n\n第一个内容输入`ompany_id_rsa`(名字随便起，自己能区分的开就行)，余下的一路回车即可\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101105.png)\n\n到这里,你公司的`SSH-Key`就完成了，查看一下`.ssh`文件夹会多出你新添加`SSH-Key`\n\n```python\ncd ~/.ssh\nls\n\nid_rsa\nid_rsa.pub\nompany_id_rsa\nompany_id_rsa.pub\nknown_hosts\n```\n\n可以看到目前我们拥有两个不同的SSH-Key，到此为止已经完成一半了，现在还需要关键一步，接着往下看...\n\n### 添加config配置文件\n\n`config`文件作用是给`HOST`单独配置各自的`SSH-Key`，看下具体配置\n\n```python\n# 配置GitHub的SSH-Key\nHost github.com\n    HostName github.com\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/id_rsa\n    \n# 配置公司的SSH-Key\nHost gerrit.com\n    HostName gerrit.com\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/ompany_id_rsa\n```\n\n保存后配置`**_id_rsa.pub`公钥,以`GitHub`为例：\n\n1. 打开`GitHub`选择右上角头像下拉框选择`Settings`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101107.png)\n\n2. 找到`SSH and GPG keys`选项，点击`New SSH key`按钮添加公钥。\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101108.png)\n\n3. 公钥即为`～/.ssh/**_id_rsa.pub`文件中的内容，我这里使用的是`GitHub`的`id_rsa.pub`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101109.png)\n好了，没有之后了。祝你在技术的道路上越走越远🤣🤣🤣\n\n","source":"_posts/Git多帐号配置-管理多个SSH.md","raw":"---\ntitle: 'Git多帐号配置,管理多个SSH'\ndate: 2019-07-29 18:09:58\ntags: Git\ncategories: 版本管理\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/070816.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/070816.jpg)\n\n当我们存在多个`git`账号的时候,比如公司用`Gitlib`或者`Gerrit`等等,而日常自己做的一些东西则会托管到`Github`上面。这些`git`账号的邮箱如果使用的是不同的话，就会存在生成一个`git`的`key`的时候会覆盖另外其他的的key 的问题，下面说一下怎么处理😸\n\n### 查看自己现有的SSH-Key\n\n```python\ncd ~/.ssh\nls\n\nid_rsa\nid_rsa.pub\nknown_hosts\n```\n\n如果你已经创建过git账号那你可能和我一样会看到只有一个`SSH-Key`,\n\n这个`SSH-Key`是我在公司`Gerrit`(你也可以理解为`Gitlib`一样的东西)所使用的`SSH-Key`。\n\n由于公司所用邮箱于`Gitlib`上邮箱不一致,如果重复生成新的`SSH-Key`只会吧之前的公司的`SSH-Key`覆盖掉,这样并不是我们所想看到的结果。\n\n废话说完了，就开始说说怎么解决这个问题:\n\n### 生成新的的SSH-Key\n\n```python\nssh-keygen -t rsa -C \"你的邮箱\"\n```\n\n\n\n第一个内容输入`ompany_id_rsa`(名字随便起，自己能区分的开就行)，余下的一路回车即可\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101105.png)\n\n到这里,你公司的`SSH-Key`就完成了，查看一下`.ssh`文件夹会多出你新添加`SSH-Key`\n\n```python\ncd ~/.ssh\nls\n\nid_rsa\nid_rsa.pub\nompany_id_rsa\nompany_id_rsa.pub\nknown_hosts\n```\n\n可以看到目前我们拥有两个不同的SSH-Key，到此为止已经完成一半了，现在还需要关键一步，接着往下看...\n\n### 添加config配置文件\n\n`config`文件作用是给`HOST`单独配置各自的`SSH-Key`，看下具体配置\n\n```python\n# 配置GitHub的SSH-Key\nHost github.com\n    HostName github.com\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/id_rsa\n    \n# 配置公司的SSH-Key\nHost gerrit.com\n    HostName gerrit.com\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/ompany_id_rsa\n```\n\n保存后配置`**_id_rsa.pub`公钥,以`GitHub`为例：\n\n1. 打开`GitHub`选择右上角头像下拉框选择`Settings`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101107.png)\n\n2. 找到`SSH and GPG keys`选项，点击`New SSH key`按钮添加公钥。\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101108.png)\n\n3. 公钥即为`～/.ssh/**_id_rsa.pub`文件中的内容，我这里使用的是`GitHub`的`id_rsa.pub`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101109.png)\n好了，没有之后了。祝你在技术的道路上越走越远🤣🤣🤣\n\n","slug":"Git多帐号配置-管理多个SSH","published":1,"updated":"2019-07-30T07:08:25.544Z","_id":"cjysbhubk0002qbt5wkz00hvp","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/070816.jpg\" alt></p>\n<p>当我们存在多个<code>git</code>账号的时候,比如公司用<code>Gitlib</code>或者<code>Gerrit</code>等等,而日常自己做的一些东西则会托管到<code>Github</code>上面。这些<code>git</code>账号的邮箱如果使用的是不同的话，就会存在生成一个<code>git</code>的<code>key</code>的时候会覆盖另外其他的的key 的问题，下面说一下怎么处理😸</p>\n<h3 id=\"查看自己现有的SSH-Key\"><a href=\"#查看自己现有的SSH-Key\" class=\"headerlink\" title=\"查看自己现有的SSH-Key\"></a>查看自己现有的SSH-Key</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/.ssh</span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\">id_rsa</span><br><span class=\"line\">id_rsa.pub</span><br><span class=\"line\">known_hosts</span><br></pre></td></tr></table></figure>\n\n<p>如果你已经创建过git账号那你可能和我一样会看到只有一个<code>SSH-Key</code>,</p>\n<p>这个<code>SSH-Key</code>是我在公司<code>Gerrit</code>(你也可以理解为<code>Gitlib</code>一样的东西)所使用的<code>SSH-Key</code>。</p>\n<p>由于公司所用邮箱于<code>Gitlib</code>上邮箱不一致,如果重复生成新的<code>SSH-Key</code>只会吧之前的公司的<code>SSH-Key</code>覆盖掉,这样并不是我们所想看到的结果。</p>\n<p>废话说完了，就开始说说怎么解决这个问题:</p>\n<h3 id=\"生成新的的SSH-Key\"><a href=\"#生成新的的SSH-Key\" class=\"headerlink\" title=\"生成新的的SSH-Key\"></a>生成新的的SSH-Key</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"你的邮箱\"</span></span><br></pre></td></tr></table></figure>\n\n<p>第一个内容输入<code>ompany_id_rsa</code>(名字随便起，自己能区分的开就行)，余下的一路回车即可</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101105.png\" alt></p>\n<p>到这里,你公司的<code>SSH-Key</code>就完成了，查看一下<code>.ssh</code>文件夹会多出你新添加<code>SSH-Key</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/.ssh</span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\">id_rsa</span><br><span class=\"line\">id_rsa.pub</span><br><span class=\"line\">ompany_id_rsa</span><br><span class=\"line\">ompany_id_rsa.pub</span><br><span class=\"line\">known_hosts</span><br></pre></td></tr></table></figure>\n\n<p>可以看到目前我们拥有两个不同的SSH-Key，到此为止已经完成一半了，现在还需要关键一步，接着往下看…</p>\n<h3 id=\"添加config配置文件\"><a href=\"#添加config配置文件\" class=\"headerlink\" title=\"添加config配置文件\"></a>添加config配置文件</h3><p><code>config</code>文件作用是给<code>HOST</code>单独配置各自的<code>SSH-Key</code>，看下具体配置</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置GitHub的SSH-Key</span></span><br><span class=\"line\">Host github.com</span><br><span class=\"line\">    HostName github.com</span><br><span class=\"line\">    PreferredAuthentications publickey</span><br><span class=\"line\">    IdentityFile ~/.ssh/id_rsa</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 配置公司的SSH-Key</span></span><br><span class=\"line\">Host gerrit.com</span><br><span class=\"line\">    HostName gerrit.com</span><br><span class=\"line\">    PreferredAuthentications publickey</span><br><span class=\"line\">    IdentityFile ~/.ssh/ompany_id_rsa</span><br></pre></td></tr></table></figure>\n\n<p>保存后配置<code>**_id_rsa.pub</code>公钥,以<code>GitHub</code>为例：</p>\n<ol>\n<li>打开<code>GitHub</code>选择右上角头像下拉框选择<code>Settings</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101107.png\" alt></p>\n<ol start=\"2\">\n<li>找到<code>SSH and GPG keys</code>选项，点击<code>New SSH key</code>按钮添加公钥。</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101108.png\" alt></p>\n<ol start=\"3\">\n<li>公钥即为<code>～/.ssh/**_id_rsa.pub</code>文件中的内容，我这里使用的是<code>GitHub</code>的<code>id_rsa.pub</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101109.png\" alt><br>好了，没有之后了。祝你在技术的道路上越走越远🤣🤣🤣</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/070816.jpg\" alt></p>\n<p>当我们存在多个<code>git</code>账号的时候,比如公司用<code>Gitlib</code>或者<code>Gerrit</code>等等,而日常自己做的一些东西则会托管到<code>Github</code>上面。这些<code>git</code>账号的邮箱如果使用的是不同的话，就会存在生成一个<code>git</code>的<code>key</code>的时候会覆盖另外其他的的key 的问题，下面说一下怎么处理😸</p>\n<h3 id=\"查看自己现有的SSH-Key\"><a href=\"#查看自己现有的SSH-Key\" class=\"headerlink\" title=\"查看自己现有的SSH-Key\"></a>查看自己现有的SSH-Key</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/.ssh</span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\">id_rsa</span><br><span class=\"line\">id_rsa.pub</span><br><span class=\"line\">known_hosts</span><br></pre></td></tr></table></figure>\n\n<p>如果你已经创建过git账号那你可能和我一样会看到只有一个<code>SSH-Key</code>,</p>\n<p>这个<code>SSH-Key</code>是我在公司<code>Gerrit</code>(你也可以理解为<code>Gitlib</code>一样的东西)所使用的<code>SSH-Key</code>。</p>\n<p>由于公司所用邮箱于<code>Gitlib</code>上邮箱不一致,如果重复生成新的<code>SSH-Key</code>只会吧之前的公司的<code>SSH-Key</code>覆盖掉,这样并不是我们所想看到的结果。</p>\n<p>废话说完了，就开始说说怎么解决这个问题:</p>\n<h3 id=\"生成新的的SSH-Key\"><a href=\"#生成新的的SSH-Key\" class=\"headerlink\" title=\"生成新的的SSH-Key\"></a>生成新的的SSH-Key</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"你的邮箱\"</span></span><br></pre></td></tr></table></figure>\n\n<p>第一个内容输入<code>ompany_id_rsa</code>(名字随便起，自己能区分的开就行)，余下的一路回车即可</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101105.png\" alt></p>\n<p>到这里,你公司的<code>SSH-Key</code>就完成了，查看一下<code>.ssh</code>文件夹会多出你新添加<code>SSH-Key</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/.ssh</span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\">id_rsa</span><br><span class=\"line\">id_rsa.pub</span><br><span class=\"line\">ompany_id_rsa</span><br><span class=\"line\">ompany_id_rsa.pub</span><br><span class=\"line\">known_hosts</span><br></pre></td></tr></table></figure>\n\n<p>可以看到目前我们拥有两个不同的SSH-Key，到此为止已经完成一半了，现在还需要关键一步，接着往下看…</p>\n<h3 id=\"添加config配置文件\"><a href=\"#添加config配置文件\" class=\"headerlink\" title=\"添加config配置文件\"></a>添加config配置文件</h3><p><code>config</code>文件作用是给<code>HOST</code>单独配置各自的<code>SSH-Key</code>，看下具体配置</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置GitHub的SSH-Key</span></span><br><span class=\"line\">Host github.com</span><br><span class=\"line\">    HostName github.com</span><br><span class=\"line\">    PreferredAuthentications publickey</span><br><span class=\"line\">    IdentityFile ~/.ssh/id_rsa</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 配置公司的SSH-Key</span></span><br><span class=\"line\">Host gerrit.com</span><br><span class=\"line\">    HostName gerrit.com</span><br><span class=\"line\">    PreferredAuthentications publickey</span><br><span class=\"line\">    IdentityFile ~/.ssh/ompany_id_rsa</span><br></pre></td></tr></table></figure>\n\n<p>保存后配置<code>**_id_rsa.pub</code>公钥,以<code>GitHub</code>为例：</p>\n<ol>\n<li>打开<code>GitHub</code>选择右上角头像下拉框选择<code>Settings</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101107.png\" alt></p>\n<ol start=\"2\">\n<li>找到<code>SSH and GPG keys</code>选项，点击<code>New SSH key</code>按钮添加公钥。</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101108.png\" alt></p>\n<ol start=\"3\">\n<li>公钥即为<code>～/.ssh/**_id_rsa.pub</code>文件中的内容，我这里使用的是<code>GitHub</code>的<code>id_rsa.pub</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/101109.png\" alt><br>好了，没有之后了。祝你在技术的道路上越走越远🤣🤣🤣</p>\n"},{"title":"js中的深拷贝与浅拷贝","date":"2019-07-31T05:43:49.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032418.jpg","_content":"\n![未标题-1](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032418.jpg)\n\n\n\njs 数据类型可分为两大类`基本数据类型`和`引用数据类型`。我们都知道`引用类型`的值是存放在`堆`里面的。\n\n如果现在我们有一个对象A他的值想赋值给B，像这样：\n\n```javascript\nlet A = {\n    age: 24,\n    name: '漫步者',\n    detailed: {\n        introduce: 'Do one thing at a time, and do well.  '\n    }\n}\n\nlet B = A\n\nB.name = 'Aaron'\n\nconsole.log(B.name) //=> 'Aaron'\nconsole.log(A.name) //=> 'Aaron'\n```\n\n\n\n分别打印`A`和`B`结果，由于`A`的类型是`引用数据类型`，所以导致`B`和`A`指向同一个内存地址，所以你操作了`B`那么`A`也会跟随着改变。\n\n但是问题来了我们并不想因为操作了`B`使得`A`也受到波及，怎么办。。。\n\n\n\n对于基本类型，拷贝过程就是对值的复制，这个过程会开辟出一个新的内存空间，将值复制到新的内存空间。而对于引用类型来书，浅拷贝过程就是对指针的复制，这个过程并没有开辟新的堆内存空间，只是将指向该内存的地址进行了复制。然而对引用类型的拷贝会出现一个问题，那就是修改其中一个对象的属性，则另一个对象的属性也会改变。产生了问题那必然有相对解决的方法， 就这样深拷贝就开始入场了，深拷贝会开辟新的栈，两个对象对应两个不同的地址，这样一来，改一个对象的属性，也不会改变另一个对象的属性。\n\n下面我们用代码看一下浅拷贝于深拷贝是如何实现的 :\n\n\n\n### 浅拷贝实现方式\n\n#### 1. for in\n\n```javascript\nlet A = {\n    age: 24,\n    name: '漫步者',\n    detailed: {\n        introduce: 'Do one thing at a time, and do well.  '\n    }\n}\n\nconst extend = (initialObj) => {\n    let result = {}\n\n    for (let key in initialObj) result[key] = initialObj[key]\n    \n    return result\n}\n\nlet B = extend(A)\n\nB.name = 'Aaron'\nconsole.log(B) //=> 'Aaron'\nconsole.log(A) //=> '漫步者'\n```\n\n\n\n#### 2. Object.assign()\n\n```javascript\nlet B = Object.assign({}, A)\n\nB.name = 'Aaron'\n\nconsole.log(B) //=> 'Aaron'\nconsole.log(A) //=> '漫步者'\n```\n\n\n\n### 对象的深拷贝\n\n如果我们把上面的`A`改成`obj`那浅拷贝就有心无力了 :\n\n```javascript\nlet obj = {\n    nNum : 1,\n    oAar : [1,2,3,4]\n};\n```\n\n\n\n我们不妨可以再用上面的方法试一下\n\n```javascript\nlet newObj = extend(obj);\n\nnewObj === obj   //=> false\nnewObj.oAar === obj.oAar //=> true\n```\n\n\n\n从上面的结果显示我们可以看出，`newObj.oAar`与`obj.oAar`指针所指的是同一个位置,那我们如何改正这个问题呢？\n\n其实也很容易,我们将`obj.oAar`再看待为一个新的对象,对其再进行一次浅拷贝不就可以了吗？？不说了,上代码\n\n```javascript\nfunction deepCopy (args) {\n    let result = {};\n\n    for (let item in args) {\n        if (typeof args[item] === 'object' && args[item] !== null) {\n            result[item] = deepCopy(args[item]);\n        } else {\n            result[item] = args[item];\n        };\n    };\n    return result;\n};\n\nresult(obj);\n```\n\n\n\n我们来验证一下\n\n```javascript\nlet newObj = deepCopy(obj);\n\nnewObj === obj  //=> false\nnewObj.oAar === obj.oAar  //=> false\n```\n\n\n\n结果也显示我们实现了,ok\n\n但是有没有其他的方式呢,比如说更简洁一些的,也是有的:\n\n我们可以使用jQuery的`$.extend(true, {}, obj)`,同样也可以实现,是不是觉得眼熟。前面我们说浅拷贝的时候也说过这个方法,但是多了一个为true的参数,`$.extend()`方法,第一个参数默认为false,当设置它为true时则会开启深拷贝模式。\n\n\n\n想想还有没有什么其他的方式=￣ω￣=?\n\n其实还有一个捷径可走\n\n还是上面举的那个obj,我们对它再进行一次尝试\n\n```javascript\nlet obj = {\n    nNum: 1,\n    oAar: [1, 2, 3, 4]\n};\n\nfunction deepCopy (args) {\n    let result = {};\n\n    try {\n        result = JSON.parse(JSON.stringify(args));\n    } catch(error){\n        return args\n    }\n    \n    return result;\n}\n\nlet newObj = deepCopy(obj);\n\nnewObj === obj //=> false\nnewObj.oAar === obj.oAar //=> false\n```\n\n\n\nヾ(｡｀Д´｡) 什么鬼,这样也行? 那还前面说那么多废话,直接上这个方法岂不是爽歪歪？\n\n但是这里不得不说明一点,投机取巧往往能达到看似相同的结果,但是还是存在一些隐性的问题的\n\n就如上面这种方式和递归的方法相比是有弊端的,比如它会抛弃对象的`constructor`。也就是深拷贝之后，不管这个对象原来的构造函数是什么，在深拷贝之后都会变成`Object`。\n\n这种方法能正确处理的对象只有 `Number、String、Boolean、Array` ，扁平对象，即那些能够被` json` 直接表示的数据结构。RegExp对象是无法通过这种方式深拷贝。\n\n最后再说一种方法,可以使用`Object.create()`方法达到深拷贝的效果\n\n```javascript\nfunction deepCopy (args) {\n    let result = {};\n\n    for (let item in args) {\n        if (typeof args[item] === 'object' && args[item] !== null) {\n            result[item] = args[item].constructor === Array ? [] : Object.create(prop);\n        } else {\n            result[item] = args[item];\n        };\n    };\n\n    return result;\n}\n\nlet newObj = deepCopy(obj);\n\nnewObj === obj //=> false\nnewObj.oAar === obj.oAar //=> false\n```\n\n\n\n好了，更多的第三方库的方法我们就不一一列举了，原理更重要嘛，对吧。\n\n最后我们来总结一下：\n\n\n\n浅拷贝我们说了3种方法 ：\n\n* 通过`for...in`循环来实现\n\n* 通过`Object.assign()`方法来实现\n\n* 通过`jQuery`中的`$.extend()`方法来实现\n\n\n\n深拷贝我们同样说了四种方法 :\n\n* 通过递归的手法实现\n\n* 通过`jQuery`中的`$.extend()`添加`true`参数方法来实现\n\n* 通过`JSON`序列化反序列化来实现\n\n* 用过`Object.create()`方法来实现\n\n\n\n**除了这几种如果各位还想到了其他什么好的方法欢迎下方留言ヾ(￣▽￣)**","source":"_posts/js中的深拷贝与浅拷贝.md","raw":"---\ntitle: js中的深拷贝与浅拷贝\ndate: 2019-07-31 13:43:49\ntags: Javascript\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032418.jpg\n---\n\n![未标题-1](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032418.jpg)\n\n\n\njs 数据类型可分为两大类`基本数据类型`和`引用数据类型`。我们都知道`引用类型`的值是存放在`堆`里面的。\n\n如果现在我们有一个对象A他的值想赋值给B，像这样：\n\n```javascript\nlet A = {\n    age: 24,\n    name: '漫步者',\n    detailed: {\n        introduce: 'Do one thing at a time, and do well.  '\n    }\n}\n\nlet B = A\n\nB.name = 'Aaron'\n\nconsole.log(B.name) //=> 'Aaron'\nconsole.log(A.name) //=> 'Aaron'\n```\n\n\n\n分别打印`A`和`B`结果，由于`A`的类型是`引用数据类型`，所以导致`B`和`A`指向同一个内存地址，所以你操作了`B`那么`A`也会跟随着改变。\n\n但是问题来了我们并不想因为操作了`B`使得`A`也受到波及，怎么办。。。\n\n\n\n对于基本类型，拷贝过程就是对值的复制，这个过程会开辟出一个新的内存空间，将值复制到新的内存空间。而对于引用类型来书，浅拷贝过程就是对指针的复制，这个过程并没有开辟新的堆内存空间，只是将指向该内存的地址进行了复制。然而对引用类型的拷贝会出现一个问题，那就是修改其中一个对象的属性，则另一个对象的属性也会改变。产生了问题那必然有相对解决的方法， 就这样深拷贝就开始入场了，深拷贝会开辟新的栈，两个对象对应两个不同的地址，这样一来，改一个对象的属性，也不会改变另一个对象的属性。\n\n下面我们用代码看一下浅拷贝于深拷贝是如何实现的 :\n\n\n\n### 浅拷贝实现方式\n\n#### 1. for in\n\n```javascript\nlet A = {\n    age: 24,\n    name: '漫步者',\n    detailed: {\n        introduce: 'Do one thing at a time, and do well.  '\n    }\n}\n\nconst extend = (initialObj) => {\n    let result = {}\n\n    for (let key in initialObj) result[key] = initialObj[key]\n    \n    return result\n}\n\nlet B = extend(A)\n\nB.name = 'Aaron'\nconsole.log(B) //=> 'Aaron'\nconsole.log(A) //=> '漫步者'\n```\n\n\n\n#### 2. Object.assign()\n\n```javascript\nlet B = Object.assign({}, A)\n\nB.name = 'Aaron'\n\nconsole.log(B) //=> 'Aaron'\nconsole.log(A) //=> '漫步者'\n```\n\n\n\n### 对象的深拷贝\n\n如果我们把上面的`A`改成`obj`那浅拷贝就有心无力了 :\n\n```javascript\nlet obj = {\n    nNum : 1,\n    oAar : [1,2,3,4]\n};\n```\n\n\n\n我们不妨可以再用上面的方法试一下\n\n```javascript\nlet newObj = extend(obj);\n\nnewObj === obj   //=> false\nnewObj.oAar === obj.oAar //=> true\n```\n\n\n\n从上面的结果显示我们可以看出，`newObj.oAar`与`obj.oAar`指针所指的是同一个位置,那我们如何改正这个问题呢？\n\n其实也很容易,我们将`obj.oAar`再看待为一个新的对象,对其再进行一次浅拷贝不就可以了吗？？不说了,上代码\n\n```javascript\nfunction deepCopy (args) {\n    let result = {};\n\n    for (let item in args) {\n        if (typeof args[item] === 'object' && args[item] !== null) {\n            result[item] = deepCopy(args[item]);\n        } else {\n            result[item] = args[item];\n        };\n    };\n    return result;\n};\n\nresult(obj);\n```\n\n\n\n我们来验证一下\n\n```javascript\nlet newObj = deepCopy(obj);\n\nnewObj === obj  //=> false\nnewObj.oAar === obj.oAar  //=> false\n```\n\n\n\n结果也显示我们实现了,ok\n\n但是有没有其他的方式呢,比如说更简洁一些的,也是有的:\n\n我们可以使用jQuery的`$.extend(true, {}, obj)`,同样也可以实现,是不是觉得眼熟。前面我们说浅拷贝的时候也说过这个方法,但是多了一个为true的参数,`$.extend()`方法,第一个参数默认为false,当设置它为true时则会开启深拷贝模式。\n\n\n\n想想还有没有什么其他的方式=￣ω￣=?\n\n其实还有一个捷径可走\n\n还是上面举的那个obj,我们对它再进行一次尝试\n\n```javascript\nlet obj = {\n    nNum: 1,\n    oAar: [1, 2, 3, 4]\n};\n\nfunction deepCopy (args) {\n    let result = {};\n\n    try {\n        result = JSON.parse(JSON.stringify(args));\n    } catch(error){\n        return args\n    }\n    \n    return result;\n}\n\nlet newObj = deepCopy(obj);\n\nnewObj === obj //=> false\nnewObj.oAar === obj.oAar //=> false\n```\n\n\n\nヾ(｡｀Д´｡) 什么鬼,这样也行? 那还前面说那么多废话,直接上这个方法岂不是爽歪歪？\n\n但是这里不得不说明一点,投机取巧往往能达到看似相同的结果,但是还是存在一些隐性的问题的\n\n就如上面这种方式和递归的方法相比是有弊端的,比如它会抛弃对象的`constructor`。也就是深拷贝之后，不管这个对象原来的构造函数是什么，在深拷贝之后都会变成`Object`。\n\n这种方法能正确处理的对象只有 `Number、String、Boolean、Array` ，扁平对象，即那些能够被` json` 直接表示的数据结构。RegExp对象是无法通过这种方式深拷贝。\n\n最后再说一种方法,可以使用`Object.create()`方法达到深拷贝的效果\n\n```javascript\nfunction deepCopy (args) {\n    let result = {};\n\n    for (let item in args) {\n        if (typeof args[item] === 'object' && args[item] !== null) {\n            result[item] = args[item].constructor === Array ? [] : Object.create(prop);\n        } else {\n            result[item] = args[item];\n        };\n    };\n\n    return result;\n}\n\nlet newObj = deepCopy(obj);\n\nnewObj === obj //=> false\nnewObj.oAar === obj.oAar //=> false\n```\n\n\n\n好了，更多的第三方库的方法我们就不一一列举了，原理更重要嘛，对吧。\n\n最后我们来总结一下：\n\n\n\n浅拷贝我们说了3种方法 ：\n\n* 通过`for...in`循环来实现\n\n* 通过`Object.assign()`方法来实现\n\n* 通过`jQuery`中的`$.extend()`方法来实现\n\n\n\n深拷贝我们同样说了四种方法 :\n\n* 通过递归的手法实现\n\n* 通过`jQuery`中的`$.extend()`添加`true`参数方法来实现\n\n* 通过`JSON`序列化反序列化来实现\n\n* 用过`Object.create()`方法来实现\n\n\n\n**除了这几种如果各位还想到了其他什么好的方法欢迎下方留言ヾ(￣▽￣)**","slug":"js中的深拷贝与浅拷贝","published":1,"updated":"2019-08-01T04:28:23.606Z","_id":"cjysbhubq0006qbt5sspmyzji","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032418.jpg\" alt=\"未标题-1\"></p>\n<p>js 数据类型可分为两大类<code>基本数据类型</code>和<code>引用数据类型</code>。我们都知道<code>引用类型</code>的值是存放在<code>堆</code>里面的。</p>\n<p>如果现在我们有一个对象A他的值想赋值给B，像这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> A = &#123;</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    name: <span class=\"string\">'漫步者'</span>,</span><br><span class=\"line\">    detailed: &#123;</span><br><span class=\"line\">        introduce: <span class=\"string\">'Do one thing at a time, and do well.  '</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> B = A</span><br><span class=\"line\"></span><br><span class=\"line\">B.name = <span class=\"string\">'Aaron'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B.name) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A.name) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br></pre></td></tr></table></figure>\n\n<p>分别打印<code>A</code>和<code>B</code>结果，由于<code>A</code>的类型是<code>引用数据类型</code>，所以导致<code>B</code>和<code>A</code>指向同一个内存地址，所以你操作了<code>B</code>那么<code>A</code>也会跟随着改变。</p>\n<p>但是问题来了我们并不想因为操作了<code>B</code>使得<code>A</code>也受到波及，怎么办。。。</p>\n<p>对于基本类型，拷贝过程就是对值的复制，这个过程会开辟出一个新的内存空间，将值复制到新的内存空间。而对于引用类型来书，浅拷贝过程就是对指针的复制，这个过程并没有开辟新的堆内存空间，只是将指向该内存的地址进行了复制。然而对引用类型的拷贝会出现一个问题，那就是修改其中一个对象的属性，则另一个对象的属性也会改变。产生了问题那必然有相对解决的方法， 就这样深拷贝就开始入场了，深拷贝会开辟新的栈，两个对象对应两个不同的地址，这样一来，改一个对象的属性，也不会改变另一个对象的属性。</p>\n<p>下面我们用代码看一下浅拷贝于深拷贝是如何实现的 :</p>\n<h3 id=\"浅拷贝实现方式\"><a href=\"#浅拷贝实现方式\" class=\"headerlink\" title=\"浅拷贝实现方式\"></a>浅拷贝实现方式</h3><h4 id=\"1-for-in\"><a href=\"#1-for-in\" class=\"headerlink\" title=\"1. for in\"></a>1. for in</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> A = &#123;</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    name: <span class=\"string\">'漫步者'</span>,</span><br><span class=\"line\">    detailed: &#123;</span><br><span class=\"line\">        introduce: <span class=\"string\">'Do one thing at a time, and do well.  '</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> extend = <span class=\"function\">(<span class=\"params\">initialObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> initialObj) result[key] = initialObj[key]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> B = extend(A)</span><br><span class=\"line\"></span><br><span class=\"line\">B.name = <span class=\"string\">'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A) <span class=\"comment\">//=&gt; '漫步者'</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-Object-assign\"><a href=\"#2-Object-assign\" class=\"headerlink\" title=\"2. Object.assign()\"></a>2. Object.assign()</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> B = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, A)</span><br><span class=\"line\"></span><br><span class=\"line\">B.name = <span class=\"string\">'Aaron'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A) <span class=\"comment\">//=&gt; '漫步者'</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象的深拷贝\"><a href=\"#对象的深拷贝\" class=\"headerlink\" title=\"对象的深拷贝\"></a>对象的深拷贝</h3><p>如果我们把上面的<code>A</code>改成<code>obj</code>那浅拷贝就有心无力了 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">    nNum : <span class=\"number\">1</span>,</span><br><span class=\"line\">    oAar : [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>我们不妨可以再用上面的方法试一下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newObj = extend(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj   <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar <span class=\"comment\">//=&gt; true</span></span><br></pre></td></tr></table></figure>\n\n<p>从上面的结果显示我们可以看出，<code>newObj.oAar</code>与<code>obj.oAar</code>指针所指的是同一个位置,那我们如何改正这个问题呢？</p>\n<p>其实也很容易,我们将<code>obj.oAar</code>再看待为一个新的对象,对其再进行一次浅拷贝不就可以了吗？？不说了,上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepCopy</span> (<span class=\"params\">args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> args[item] === <span class=\"string\">'object'</span> &amp;&amp; args[item] !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            result[item] = deepCopy(args[item]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result[item] = args[item];</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">result(obj);</span><br></pre></td></tr></table></figure>\n\n<p>我们来验证一下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newObj = deepCopy(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj  <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar  <span class=\"comment\">//=&gt; false</span></span><br></pre></td></tr></table></figure>\n\n<p>结果也显示我们实现了,ok</p>\n<p>但是有没有其他的方式呢,比如说更简洁一些的,也是有的:</p>\n<p>我们可以使用jQuery的<code>$.extend(true, {}, obj)</code>,同样也可以实现,是不是觉得眼熟。前面我们说浅拷贝的时候也说过这个方法,但是多了一个为true的参数,<code>$.extend()</code>方法,第一个参数默认为false,当设置它为true时则会开启深拷贝模式。</p>\n<p>想想还有没有什么其他的方式=￣ω￣=?</p>\n<p>其实还有一个捷径可走</p>\n<p>还是上面举的那个obj,我们对它再进行一次尝试</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">    nNum: <span class=\"number\">1</span>,</span><br><span class=\"line\">    oAar: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepCopy</span> (<span class=\"params\">args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        result = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringify(args));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span>(error)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> args</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = deepCopy(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar <span class=\"comment\">//=&gt; false</span></span><br></pre></td></tr></table></figure>\n\n<p>ヾ(｡｀Д´｡) 什么鬼,这样也行? 那还前面说那么多废话,直接上这个方法岂不是爽歪歪？</p>\n<p>但是这里不得不说明一点,投机取巧往往能达到看似相同的结果,但是还是存在一些隐性的问题的</p>\n<p>就如上面这种方式和递归的方法相比是有弊端的,比如它会抛弃对象的<code>constructor</code>。也就是深拷贝之后，不管这个对象原来的构造函数是什么，在深拷贝之后都会变成<code>Object</code>。</p>\n<p>这种方法能正确处理的对象只有 <code>Number、String、Boolean、Array</code> ，扁平对象，即那些能够被<code>json</code> 直接表示的数据结构。RegExp对象是无法通过这种方式深拷贝。</p>\n<p>最后再说一种方法,可以使用<code>Object.create()</code>方法达到深拷贝的效果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepCopy</span> (<span class=\"params\">args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> args[item] === <span class=\"string\">'object'</span> &amp;&amp; args[item] !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            result[item] = args[item].constructor === <span class=\"built_in\">Array</span> ? [] : <span class=\"built_in\">Object</span>.create(prop);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result[item] = args[item];</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = deepCopy(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar <span class=\"comment\">//=&gt; false</span></span><br></pre></td></tr></table></figure>\n\n<p>好了，更多的第三方库的方法我们就不一一列举了，原理更重要嘛，对吧。</p>\n<p>最后我们来总结一下：</p>\n<p>浅拷贝我们说了3种方法 ：</p>\n<ul>\n<li><p>通过<code>for...in</code>循环来实现</p>\n</li>\n<li><p>通过<code>Object.assign()</code>方法来实现</p>\n</li>\n<li><p>通过<code>jQuery</code>中的<code>$.extend()</code>方法来实现</p>\n</li>\n</ul>\n<p>深拷贝我们同样说了四种方法 :</p>\n<ul>\n<li><p>通过递归的手法实现</p>\n</li>\n<li><p>通过<code>jQuery</code>中的<code>$.extend()</code>添加<code>true</code>参数方法来实现</p>\n</li>\n<li><p>通过<code>JSON</code>序列化反序列化来实现</p>\n</li>\n<li><p>用过<code>Object.create()</code>方法来实现</p>\n</li>\n</ul>\n<p><strong>除了这几种如果各位还想到了其他什么好的方法欢迎下方留言ヾ(￣▽￣)</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032418.jpg\" alt=\"未标题-1\"></p>\n<p>js 数据类型可分为两大类<code>基本数据类型</code>和<code>引用数据类型</code>。我们都知道<code>引用类型</code>的值是存放在<code>堆</code>里面的。</p>\n<p>如果现在我们有一个对象A他的值想赋值给B，像这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> A = &#123;</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    name: <span class=\"string\">'漫步者'</span>,</span><br><span class=\"line\">    detailed: &#123;</span><br><span class=\"line\">        introduce: <span class=\"string\">'Do one thing at a time, and do well.  '</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> B = A</span><br><span class=\"line\"></span><br><span class=\"line\">B.name = <span class=\"string\">'Aaron'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B.name) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A.name) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br></pre></td></tr></table></figure>\n\n<p>分别打印<code>A</code>和<code>B</code>结果，由于<code>A</code>的类型是<code>引用数据类型</code>，所以导致<code>B</code>和<code>A</code>指向同一个内存地址，所以你操作了<code>B</code>那么<code>A</code>也会跟随着改变。</p>\n<p>但是问题来了我们并不想因为操作了<code>B</code>使得<code>A</code>也受到波及，怎么办。。。</p>\n<p>对于基本类型，拷贝过程就是对值的复制，这个过程会开辟出一个新的内存空间，将值复制到新的内存空间。而对于引用类型来书，浅拷贝过程就是对指针的复制，这个过程并没有开辟新的堆内存空间，只是将指向该内存的地址进行了复制。然而对引用类型的拷贝会出现一个问题，那就是修改其中一个对象的属性，则另一个对象的属性也会改变。产生了问题那必然有相对解决的方法， 就这样深拷贝就开始入场了，深拷贝会开辟新的栈，两个对象对应两个不同的地址，这样一来，改一个对象的属性，也不会改变另一个对象的属性。</p>\n<p>下面我们用代码看一下浅拷贝于深拷贝是如何实现的 :</p>\n<h3 id=\"浅拷贝实现方式\"><a href=\"#浅拷贝实现方式\" class=\"headerlink\" title=\"浅拷贝实现方式\"></a>浅拷贝实现方式</h3><h4 id=\"1-for-in\"><a href=\"#1-for-in\" class=\"headerlink\" title=\"1. for in\"></a>1. for in</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> A = &#123;</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    name: <span class=\"string\">'漫步者'</span>,</span><br><span class=\"line\">    detailed: &#123;</span><br><span class=\"line\">        introduce: <span class=\"string\">'Do one thing at a time, and do well.  '</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> extend = <span class=\"function\">(<span class=\"params\">initialObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> initialObj) result[key] = initialObj[key]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> B = extend(A)</span><br><span class=\"line\"></span><br><span class=\"line\">B.name = <span class=\"string\">'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A) <span class=\"comment\">//=&gt; '漫步者'</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-Object-assign\"><a href=\"#2-Object-assign\" class=\"headerlink\" title=\"2. Object.assign()\"></a>2. Object.assign()</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> B = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, A)</span><br><span class=\"line\"></span><br><span class=\"line\">B.name = <span class=\"string\">'Aaron'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B) <span class=\"comment\">//=&gt; 'Aaron'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A) <span class=\"comment\">//=&gt; '漫步者'</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象的深拷贝\"><a href=\"#对象的深拷贝\" class=\"headerlink\" title=\"对象的深拷贝\"></a>对象的深拷贝</h3><p>如果我们把上面的<code>A</code>改成<code>obj</code>那浅拷贝就有心无力了 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">    nNum : <span class=\"number\">1</span>,</span><br><span class=\"line\">    oAar : [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>我们不妨可以再用上面的方法试一下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newObj = extend(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj   <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar <span class=\"comment\">//=&gt; true</span></span><br></pre></td></tr></table></figure>\n\n<p>从上面的结果显示我们可以看出，<code>newObj.oAar</code>与<code>obj.oAar</code>指针所指的是同一个位置,那我们如何改正这个问题呢？</p>\n<p>其实也很容易,我们将<code>obj.oAar</code>再看待为一个新的对象,对其再进行一次浅拷贝不就可以了吗？？不说了,上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepCopy</span> (<span class=\"params\">args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> args[item] === <span class=\"string\">'object'</span> &amp;&amp; args[item] !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            result[item] = deepCopy(args[item]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result[item] = args[item];</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">result(obj);</span><br></pre></td></tr></table></figure>\n\n<p>我们来验证一下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newObj = deepCopy(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj  <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar  <span class=\"comment\">//=&gt; false</span></span><br></pre></td></tr></table></figure>\n\n<p>结果也显示我们实现了,ok</p>\n<p>但是有没有其他的方式呢,比如说更简洁一些的,也是有的:</p>\n<p>我们可以使用jQuery的<code>$.extend(true, {}, obj)</code>,同样也可以实现,是不是觉得眼熟。前面我们说浅拷贝的时候也说过这个方法,但是多了一个为true的参数,<code>$.extend()</code>方法,第一个参数默认为false,当设置它为true时则会开启深拷贝模式。</p>\n<p>想想还有没有什么其他的方式=￣ω￣=?</p>\n<p>其实还有一个捷径可走</p>\n<p>还是上面举的那个obj,我们对它再进行一次尝试</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">    nNum: <span class=\"number\">1</span>,</span><br><span class=\"line\">    oAar: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepCopy</span> (<span class=\"params\">args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        result = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringify(args));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span>(error)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> args</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = deepCopy(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar <span class=\"comment\">//=&gt; false</span></span><br></pre></td></tr></table></figure>\n\n<p>ヾ(｡｀Д´｡) 什么鬼,这样也行? 那还前面说那么多废话,直接上这个方法岂不是爽歪歪？</p>\n<p>但是这里不得不说明一点,投机取巧往往能达到看似相同的结果,但是还是存在一些隐性的问题的</p>\n<p>就如上面这种方式和递归的方法相比是有弊端的,比如它会抛弃对象的<code>constructor</code>。也就是深拷贝之后，不管这个对象原来的构造函数是什么，在深拷贝之后都会变成<code>Object</code>。</p>\n<p>这种方法能正确处理的对象只有 <code>Number、String、Boolean、Array</code> ，扁平对象，即那些能够被<code>json</code> 直接表示的数据结构。RegExp对象是无法通过这种方式深拷贝。</p>\n<p>最后再说一种方法,可以使用<code>Object.create()</code>方法达到深拷贝的效果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepCopy</span> (<span class=\"params\">args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> args[item] === <span class=\"string\">'object'</span> &amp;&amp; args[item] !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            result[item] = args[item].constructor === <span class=\"built_in\">Array</span> ? [] : <span class=\"built_in\">Object</span>.create(prop);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result[item] = args[item];</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = deepCopy(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">newObj === obj <span class=\"comment\">//=&gt; false</span></span><br><span class=\"line\">newObj.oAar === obj.oAar <span class=\"comment\">//=&gt; false</span></span><br></pre></td></tr></table></figure>\n\n<p>好了，更多的第三方库的方法我们就不一一列举了，原理更重要嘛，对吧。</p>\n<p>最后我们来总结一下：</p>\n<p>浅拷贝我们说了3种方法 ：</p>\n<ul>\n<li><p>通过<code>for...in</code>循环来实现</p>\n</li>\n<li><p>通过<code>Object.assign()</code>方法来实现</p>\n</li>\n<li><p>通过<code>jQuery</code>中的<code>$.extend()</code>方法来实现</p>\n</li>\n</ul>\n<p>深拷贝我们同样说了四种方法 :</p>\n<ul>\n<li><p>通过递归的手法实现</p>\n</li>\n<li><p>通过<code>jQuery</code>中的<code>$.extend()</code>添加<code>true</code>参数方法来实现</p>\n</li>\n<li><p>通过<code>JSON</code>序列化反序列化来实现</p>\n</li>\n<li><p>用过<code>Object.create()</code>方法来实现</p>\n</li>\n</ul>\n<p><strong>除了这几种如果各位还想到了其他什么好的方法欢迎下方留言ヾ(￣▽￣)</strong></p>\n"},{"title":"javascript类型检测汇总","date":"2019-07-30T08:37:39.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/060055.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/060055.jpg)\n\n\n\n汇总一些简单的易懂的东西出来分享一下，今天说下关于`Javascript`中的类型检测的问题。\n\n\n\n### Javascript中的数据类型\n\n说到类型检测前我们首先需要确定`Javascript`中一共有多少种数据类型。\n\n\n\n* `Javascript`不支持任何自定义类型的机制，而所有的值最终都将是6大类型之一。由于javascript数据类型具有动态性，因此的确没有再定义其他数据类型的必要。\n\n* `Javascript`数据类型总的分为两大类:基本数据类型(**`5`种**),一种引用数据类型,共 **`6`种**,如下:\n\n\n\n1. 基本数据类型\n\n- `Undefined` 类型\n\n-  `Null` 类型\n\n- `Boolean` 类型\n\n-  `Number` 类型\n\n-  `String` 类型\n\n\n\n2. 引用数据类型\n\n\n\n#### 常用检测类型方法\n\n检测数据类型的方法有:`typeof`、`instanceof`、 `constructor`、 `prototype`。当然还有很多关于第三那方库的API方法我们就不一一列举了。\n\n\n\n#### 利用typeof进行类型检测\n\n首先我们使用`typeof`来将我们常用的这几种类型分别测试一下看看返回的是什么\n\n```javascript\ntypeof undefined  \n\n//=> \"undefined\"\n\n\ntypeof null\n\n//=> \"object\"\n\n\ntypeof true\n\n//=> \"boolean\"\n\n\ntypeof 123\n\n//=> \"number\"\n\n\ntypeof 'aaa'\n\n//=> \"string\"\n\n\ntypeof {a : 1}\n\n//=> \"object\"\n```\n\n\n\n下图是我们在`chrome`开发者工具中打印的结果，做一下对比\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022814.png)\n\n\n\n首先我们看到了第一个问题那就是`null`和引用类型同时都检测到是`\"object\"`这种类型,其实`null不是一个空引用`(有很多人认为null就是一个空引用)，而是一个原始值。\n\n\n\n啰嗦一下: 其实这是一个js原生的`bug`，早在ES6版本的提案中就有人曾提到应该修复这个bug,但是被驳回了,原因是历史遗留的代码太多,喜欢的可以去看一下: [参考地址](https://link.zhihu.com/?target=http%3A//wiki.ecmascript.org/doku.php%3Fid%3Dharmony%253atypeof_null)。\n\n\n\n当然了，即使是bug那我们也得避免，其实方法很简单也很多，下面举一个简单的例子:\n\n```javascript\nlet a = {a : 1};\n\nif(typeof a === 'object') {\n   a !== null ? 'object' : 'null';\n}\n```\n\n\n\n如果待检测的类型是数组、时间或者正则类型呢？我们同样只能拿到`object`。所以 `typeof`用于判断基本数据类型没有问题，但是判断引用数据类型时，就心有余而力不足了。\n\n既然这样那我们就去试试第二种方法，接着往下看\n\n\n\n#### 利用instanceof进行类型检测\n\n我们用`instanceof`判断一下上面遗留下来的那几个问题`[1,2,3] ,new Date(), new RegExp(\\^\\W+$\\)`，分别是Date，数组，正则:\n\n```javascript\n[1,2,3] instanceof Array\n\n//=> true\n\n\nnew Date() instanceof Date\n\n//=> true\n\n\nnew RegExp('\\W+') instanceof RegExp\n\n//=> true\n```\n\n\n\n看到这要是觉得事情仿佛都解决了，那你就高兴的太早了😏\n\n\n\n如果我们需要判断一个未知的变量是什么类型用`instanceof`怎么实现？\n\n\n\n```javascript\n// 假设unknown是一个未知的变量，类型为数组\nvar unknown = [1,2,3]\n\n// 我们只能通过繁琐的对比最后才能准确的定位到这是个Array\nif(unknown  instanceof Array) {\n  alert('Array');\n}else if(unknown  instanceof Date) {\n  alert('Date');\n}....\n```\n\n\n\n上面的代码看着就头疼，总的来说`instanceof`只适用于校验变量是否是某一种类型，对于校验未知类型的变量并不是很适用。\n\n你可能会问那就没有其他的方法了吗？往下看\n\n\n\n#### 利用constructor进行类型检测\n\n上面我们留下了`instanceof`对未知类型检验的问题，感觉`instanceof`不够灵活，那我们接着说另一种方法\n\n\n\n```javascript\n[1,2,3].constructor\n\n//=> ƒ Array() { [native code] }\n\n\n[1,2,3].constructor === Array\n\n//=> true\n\n\n(new Date()).constructor\n\n//=> ƒ Date() { [native code] }\n\n\n(new Date()).constructor === Date\n\n//=> true\n```\n\n\n\n通过`constructor`方法我们能对未知的类型进行鉴定，然而有时候结果总是出人意料的，假设是这种情况呢？\n\n\n\n```javascript\nfunction Fun(){};\nFun.prototype = new Array(); \n\nlet fun = new Fun();\n\nfun.constructor === Fun\n\n//=> false;\n\nfun.constructor === Array\n\n//=> true;\n```\n\n看一下在控制台输出的结果：\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813.png)\n\n看来利用`constructor`去做类型检测还是有点缺陷，当出现被修改时，`constructor`得到的结果就是错误的。\n\n\n\n\n\n#### Object.prototype.toString\n\njavascript中`Object`有个`toString`方法，该方法返回一个表示该对象的字符串，但是很多对象(如:Array等)都重写了`toString`方法，所以需要以`call`或`apply`的形式来配合使用才最安全,不说了看栗子:\n\n\n\n```javascript\nObject.prototype.toString.call(null);\n\n//=> \"[object Null]\"\n\n\nObject.prototype.toString.call(undefined);\n\n//=> \"[object Undefined]\"\n\n\nObject.prototype.toString.call('aaa');\n\n//=> \"[object String]\"\n\n\nObject.prototype.toString.call(123);\n\n//=> \"[object Number]\"\n\n\nObject.prototype.toString.call(true);\n//=> \"[object Boolean]\"\n\n\nObject.prototype.toString.call([1,2,3]);\n\n//=> \"[object Array]\"\n\n\nObject.prototype.toString.call({a : 1});\n\n//=> \"[object Object]\"\n\n\nObject.prototype.toString.call(new Date());\n\n//=> \"[object Date]\"\n\n\nObject.prototype.toString.call(function(){});\n\n//=> \"[object Function]\"\n```\n\n我们将`chrome`控制台输出的截图抬上来看看\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813-1.png)\n\n上面的例子很容易说明`Object.prototype.toString.call()`是一个不错的基本数据类型和引用数据类型的一个方式。其实像`jQuery`中`$.type()`也是配合这种方式去实现的,最后我们将其源码拿过来瞅两眼\n\n\n\n```javascript\njQuery.each(\n  'Boolean Number String Function Array Date RegExp Object Error Symbol'.split(\n    ''\n  ),\n  function(i, name) {\n    class2type['[object ' + name + ']'] = name.toLowerCase()\n  }\n)\n\nfunction toType(obj) {\n  if (obj == null) {\n    return obj + ''\n  }\n\n  // Support: Android <=2.3 only (functionish RegExp)\n  return typeof obj === 'object' || typeof obj === 'function'\n    ? class2type[toString.call(obj)] || 'object'\n    : typeof obj\n}\n```\n\n\n\n最后总结一下了：\n\n* `typeof` 用来判断基本类型,而在引用类型方面显得无力。\n\n* `instanceof` 用来判断引用类型的具体类型,但不够灵活。\n\n* `constructor` 用来判断实例的构造函数,但容易被伪造。\n\n* `Object.prototype.toString` 用来获取对象的描述字符串。\n\n\n\n博客最近在搬迁，多多关照。**有什么问题或者建议大家可以通过留言或者邮箱的方式告诉我。**","source":"_posts/javascript类型检测汇总.md","raw":"---\ntitle: javascript类型检测汇总\ndate: 2019-07-30 16:37:39\ntags: Javascript\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/060055.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/060055.jpg)\n\n\n\n汇总一些简单的易懂的东西出来分享一下，今天说下关于`Javascript`中的类型检测的问题。\n\n\n\n### Javascript中的数据类型\n\n说到类型检测前我们首先需要确定`Javascript`中一共有多少种数据类型。\n\n\n\n* `Javascript`不支持任何自定义类型的机制，而所有的值最终都将是6大类型之一。由于javascript数据类型具有动态性，因此的确没有再定义其他数据类型的必要。\n\n* `Javascript`数据类型总的分为两大类:基本数据类型(**`5`种**),一种引用数据类型,共 **`6`种**,如下:\n\n\n\n1. 基本数据类型\n\n- `Undefined` 类型\n\n-  `Null` 类型\n\n- `Boolean` 类型\n\n-  `Number` 类型\n\n-  `String` 类型\n\n\n\n2. 引用数据类型\n\n\n\n#### 常用检测类型方法\n\n检测数据类型的方法有:`typeof`、`instanceof`、 `constructor`、 `prototype`。当然还有很多关于第三那方库的API方法我们就不一一列举了。\n\n\n\n#### 利用typeof进行类型检测\n\n首先我们使用`typeof`来将我们常用的这几种类型分别测试一下看看返回的是什么\n\n```javascript\ntypeof undefined  \n\n//=> \"undefined\"\n\n\ntypeof null\n\n//=> \"object\"\n\n\ntypeof true\n\n//=> \"boolean\"\n\n\ntypeof 123\n\n//=> \"number\"\n\n\ntypeof 'aaa'\n\n//=> \"string\"\n\n\ntypeof {a : 1}\n\n//=> \"object\"\n```\n\n\n\n下图是我们在`chrome`开发者工具中打印的结果，做一下对比\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022814.png)\n\n\n\n首先我们看到了第一个问题那就是`null`和引用类型同时都检测到是`\"object\"`这种类型,其实`null不是一个空引用`(有很多人认为null就是一个空引用)，而是一个原始值。\n\n\n\n啰嗦一下: 其实这是一个js原生的`bug`，早在ES6版本的提案中就有人曾提到应该修复这个bug,但是被驳回了,原因是历史遗留的代码太多,喜欢的可以去看一下: [参考地址](https://link.zhihu.com/?target=http%3A//wiki.ecmascript.org/doku.php%3Fid%3Dharmony%253atypeof_null)。\n\n\n\n当然了，即使是bug那我们也得避免，其实方法很简单也很多，下面举一个简单的例子:\n\n```javascript\nlet a = {a : 1};\n\nif(typeof a === 'object') {\n   a !== null ? 'object' : 'null';\n}\n```\n\n\n\n如果待检测的类型是数组、时间或者正则类型呢？我们同样只能拿到`object`。所以 `typeof`用于判断基本数据类型没有问题，但是判断引用数据类型时，就心有余而力不足了。\n\n既然这样那我们就去试试第二种方法，接着往下看\n\n\n\n#### 利用instanceof进行类型检测\n\n我们用`instanceof`判断一下上面遗留下来的那几个问题`[1,2,3] ,new Date(), new RegExp(\\^\\W+$\\)`，分别是Date，数组，正则:\n\n```javascript\n[1,2,3] instanceof Array\n\n//=> true\n\n\nnew Date() instanceof Date\n\n//=> true\n\n\nnew RegExp('\\W+') instanceof RegExp\n\n//=> true\n```\n\n\n\n看到这要是觉得事情仿佛都解决了，那你就高兴的太早了😏\n\n\n\n如果我们需要判断一个未知的变量是什么类型用`instanceof`怎么实现？\n\n\n\n```javascript\n// 假设unknown是一个未知的变量，类型为数组\nvar unknown = [1,2,3]\n\n// 我们只能通过繁琐的对比最后才能准确的定位到这是个Array\nif(unknown  instanceof Array) {\n  alert('Array');\n}else if(unknown  instanceof Date) {\n  alert('Date');\n}....\n```\n\n\n\n上面的代码看着就头疼，总的来说`instanceof`只适用于校验变量是否是某一种类型，对于校验未知类型的变量并不是很适用。\n\n你可能会问那就没有其他的方法了吗？往下看\n\n\n\n#### 利用constructor进行类型检测\n\n上面我们留下了`instanceof`对未知类型检验的问题，感觉`instanceof`不够灵活，那我们接着说另一种方法\n\n\n\n```javascript\n[1,2,3].constructor\n\n//=> ƒ Array() { [native code] }\n\n\n[1,2,3].constructor === Array\n\n//=> true\n\n\n(new Date()).constructor\n\n//=> ƒ Date() { [native code] }\n\n\n(new Date()).constructor === Date\n\n//=> true\n```\n\n\n\n通过`constructor`方法我们能对未知的类型进行鉴定，然而有时候结果总是出人意料的，假设是这种情况呢？\n\n\n\n```javascript\nfunction Fun(){};\nFun.prototype = new Array(); \n\nlet fun = new Fun();\n\nfun.constructor === Fun\n\n//=> false;\n\nfun.constructor === Array\n\n//=> true;\n```\n\n看一下在控制台输出的结果：\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813.png)\n\n看来利用`constructor`去做类型检测还是有点缺陷，当出现被修改时，`constructor`得到的结果就是错误的。\n\n\n\n\n\n#### Object.prototype.toString\n\njavascript中`Object`有个`toString`方法，该方法返回一个表示该对象的字符串，但是很多对象(如:Array等)都重写了`toString`方法，所以需要以`call`或`apply`的形式来配合使用才最安全,不说了看栗子:\n\n\n\n```javascript\nObject.prototype.toString.call(null);\n\n//=> \"[object Null]\"\n\n\nObject.prototype.toString.call(undefined);\n\n//=> \"[object Undefined]\"\n\n\nObject.prototype.toString.call('aaa');\n\n//=> \"[object String]\"\n\n\nObject.prototype.toString.call(123);\n\n//=> \"[object Number]\"\n\n\nObject.prototype.toString.call(true);\n//=> \"[object Boolean]\"\n\n\nObject.prototype.toString.call([1,2,3]);\n\n//=> \"[object Array]\"\n\n\nObject.prototype.toString.call({a : 1});\n\n//=> \"[object Object]\"\n\n\nObject.prototype.toString.call(new Date());\n\n//=> \"[object Date]\"\n\n\nObject.prototype.toString.call(function(){});\n\n//=> \"[object Function]\"\n```\n\n我们将`chrome`控制台输出的截图抬上来看看\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813-1.png)\n\n上面的例子很容易说明`Object.prototype.toString.call()`是一个不错的基本数据类型和引用数据类型的一个方式。其实像`jQuery`中`$.type()`也是配合这种方式去实现的,最后我们将其源码拿过来瞅两眼\n\n\n\n```javascript\njQuery.each(\n  'Boolean Number String Function Array Date RegExp Object Error Symbol'.split(\n    ''\n  ),\n  function(i, name) {\n    class2type['[object ' + name + ']'] = name.toLowerCase()\n  }\n)\n\nfunction toType(obj) {\n  if (obj == null) {\n    return obj + ''\n  }\n\n  // Support: Android <=2.3 only (functionish RegExp)\n  return typeof obj === 'object' || typeof obj === 'function'\n    ? class2type[toString.call(obj)] || 'object'\n    : typeof obj\n}\n```\n\n\n\n最后总结一下了：\n\n* `typeof` 用来判断基本类型,而在引用类型方面显得无力。\n\n* `instanceof` 用来判断引用类型的具体类型,但不够灵活。\n\n* `constructor` 用来判断实例的构造函数,但容易被伪造。\n\n* `Object.prototype.toString` 用来获取对象的描述字符串。\n\n\n\n博客最近在搬迁，多多关照。**有什么问题或者建议大家可以通过留言或者邮箱的方式告诉我。**","slug":"javascript类型检测汇总","published":1,"updated":"2019-08-01T03:04:40.453Z","_id":"cjysbhubr0007qbt5tp75otdv","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/060055.jpg\" alt></p>\n<p>汇总一些简单的易懂的东西出来分享一下，今天说下关于<code>Javascript</code>中的类型检测的问题。</p>\n<h3 id=\"Javascript中的数据类型\"><a href=\"#Javascript中的数据类型\" class=\"headerlink\" title=\"Javascript中的数据类型\"></a>Javascript中的数据类型</h3><p>说到类型检测前我们首先需要确定<code>Javascript</code>中一共有多少种数据类型。</p>\n<ul>\n<li><p><code>Javascript</code>不支持任何自定义类型的机制，而所有的值最终都将是6大类型之一。由于javascript数据类型具有动态性，因此的确没有再定义其他数据类型的必要。</p>\n</li>\n<li><p><code>Javascript</code>数据类型总的分为两大类:基本数据类型(<strong><code>5</code>种</strong>),一种引用数据类型,共 <strong><code>6</code>种</strong>,如下:</p>\n</li>\n</ul>\n<ol>\n<li>基本数据类型</li>\n</ol>\n<ul>\n<li><p><code>Undefined</code> 类型</p>\n</li>\n<li><p><code>Null</code> 类型</p>\n</li>\n<li><p><code>Boolean</code> 类型</p>\n</li>\n<li><p><code>Number</code> 类型</p>\n</li>\n<li><p><code>String</code> 类型</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li>引用数据类型</li>\n</ol>\n<h4 id=\"常用检测类型方法\"><a href=\"#常用检测类型方法\" class=\"headerlink\" title=\"常用检测类型方法\"></a>常用检测类型方法</h4><p>检测数据类型的方法有:<code>typeof</code>、<code>instanceof</code>、 <code>constructor</code>、 <code>prototype</code>。当然还有很多关于第三那方库的API方法我们就不一一列举了。</p>\n<h4 id=\"利用typeof进行类型检测\"><a href=\"#利用typeof进行类型检测\" class=\"headerlink\" title=\"利用typeof进行类型检测\"></a>利用typeof进行类型检测</h4><p>首先我们使用<code>typeof</code>来将我们常用的这几种类型分别测试一下看看返回的是什么</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"undefined\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"object\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"boolean\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">123</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"number\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"string\">'aaa'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"string\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123;<span class=\"attr\">a</span> : <span class=\"number\">1</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"object\"</span></span><br></pre></td></tr></table></figure>\n\n<p>下图是我们在<code>chrome</code>开发者工具中打印的结果，做一下对比</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022814.png\" alt></p>\n<p>首先我们看到了第一个问题那就是<code>null</code>和引用类型同时都检测到是<code>&quot;object&quot;</code>这种类型,其实<code>null不是一个空引用</code>(有很多人认为null就是一个空引用)，而是一个原始值。</p>\n<p>啰嗦一下: 其实这是一个js原生的<code>bug</code>，早在ES6版本的提案中就有人曾提到应该修复这个bug,但是被驳回了,原因是历史遗留的代码太多,喜欢的可以去看一下: <a href=\"https://link.zhihu.com/?target=http%3A//wiki.ecmascript.org/doku.php%3Fid%3Dharmony%253atypeof_null\" target=\"_blank\" rel=\"noopener\">参考地址</a>。</p>\n<p>当然了，即使是bug那我们也得避免，其实方法很简单也很多，下面举一个简单的例子:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;<span class=\"attr\">a</span> : <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> a === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">   a !== <span class=\"literal\">null</span> ? <span class=\"string\">'object'</span> : <span class=\"string\">'null'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果待检测的类型是数组、时间或者正则类型呢？我们同样只能拿到<code>object</code>。所以 <code>typeof</code>用于判断基本数据类型没有问题，但是判断引用数据类型时，就心有余而力不足了。</p>\n<p>既然这样那我们就去试试第二种方法，接着往下看</p>\n<h4 id=\"利用instanceof进行类型检测\"><a href=\"#利用instanceof进行类型检测\" class=\"headerlink\" title=\"利用instanceof进行类型检测\"></a>利用instanceof进行类型检测</h4><p>我们用<code>instanceof</code>判断一下上面遗留下来的那几个问题<code>[1,2,3] ,new Date(), new RegExp(\\^\\W+$\\)</code>，分别是Date，数组，正则:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>] <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">'\\W+'</span>) <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br></pre></td></tr></table></figure>\n\n<p>看到这要是觉得事情仿佛都解决了，那你就高兴的太早了😏</p>\n<p>如果我们需要判断一个未知的变量是什么类型用<code>instanceof</code>怎么实现？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 假设unknown是一个未知的变量，类型为数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> unknown = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 我们只能通过繁琐的对比最后才能准确的定位到这是个Array</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(unknown  <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span>) &#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'Array'</span>);</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(unknown  <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) &#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'Date'</span>);</span><br><span class=\"line\">&#125;....</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码看着就头疼，总的来说<code>instanceof</code>只适用于校验变量是否是某一种类型，对于校验未知类型的变量并不是很适用。</p>\n<p>你可能会问那就没有其他的方法了吗？往下看</p>\n<h4 id=\"利用constructor进行类型检测\"><a href=\"#利用constructor进行类型检测\" class=\"headerlink\" title=\"利用constructor进行类型检测\"></a>利用constructor进行类型检测</h4><p>上面我们留下了<code>instanceof</code>对未知类型检验的问题，感觉<code>instanceof</code>不够灵活，那我们接着说另一种方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].constructor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; ƒ Array() &#123; [native code] &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].constructor === <span class=\"built_in\">Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).constructor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; ƒ Date() &#123; [native code] &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).constructor === <span class=\"built_in\">Date</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br></pre></td></tr></table></figure>\n\n<p>通过<code>constructor</code>方法我们能对未知的类型进行鉴定，然而有时候结果总是出人意料的，假设是这种情况呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Fun</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\">Fun.prototype = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun = <span class=\"keyword\">new</span> Fun();</span><br><span class=\"line\"></span><br><span class=\"line\">fun.constructor === Fun</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; false;</span></span><br><span class=\"line\"></span><br><span class=\"line\">fun.constructor === <span class=\"built_in\">Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true;</span></span><br></pre></td></tr></table></figure>\n\n<p>看一下在控制台输出的结果：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813.png\" alt></p>\n<p>看来利用<code>constructor</code>去做类型检测还是有点缺陷，当出现被修改时，<code>constructor</code>得到的结果就是错误的。</p>\n<h4 id=\"Object-prototype-toString\"><a href=\"#Object-prototype-toString\" class=\"headerlink\" title=\"Object.prototype.toString\"></a>Object.prototype.toString</h4><p>javascript中<code>Object</code>有个<code>toString</code>方法，该方法返回一个表示该对象的字符串，但是很多对象(如:Array等)都重写了<code>toString</code>方法，所以需要以<code>call</code>或<code>apply</code>的形式来配合使用才最安全,不说了看栗子:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Null]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Undefined]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"string\">'aaa'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object String]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"number\">123</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Number]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Boolean]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Array]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(&#123;<span class=\"attr\">a</span> : <span class=\"number\">1</span>&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Object]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Date]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Function]\"</span></span><br></pre></td></tr></table></figure>\n\n<p>我们将<code>chrome</code>控制台输出的截图抬上来看看</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813-1.png\" alt></p>\n<p>上面的例子很容易说明<code>Object.prototype.toString.call()</code>是一个不错的基本数据类型和引用数据类型的一个方式。其实像<code>jQuery</code>中<code>$.type()</code>也是配合这种方式去实现的,最后我们将其源码拿过来瞅两眼</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery.each(</span><br><span class=\"line\">  <span class=\"string\">'Boolean Number String Function Array Date RegExp Object Error Symbol'</span>.split(</span><br><span class=\"line\">    <span class=\"string\">''</span></span><br><span class=\"line\">  ),</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, name</span>) </span>&#123;</span><br><span class=\"line\">    class2type[<span class=\"string\">'[object '</span> + name + <span class=\"string\">']'</span>] = name.toLowerCase()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toType</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj + <span class=\"string\">''</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Support: Android &lt;=2.3 only (functionish RegExp)</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> obj === <span class=\"string\">'object'</span> || <span class=\"keyword\">typeof</span> obj === <span class=\"string\">'function'</span></span><br><span class=\"line\">    ? class2type[toString.call(obj)] || <span class=\"string\">'object'</span></span><br><span class=\"line\">    : <span class=\"keyword\">typeof</span> obj</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后总结一下了：</p>\n<ul>\n<li><p><code>typeof</code> 用来判断基本类型,而在引用类型方面显得无力。</p>\n</li>\n<li><p><code>instanceof</code> 用来判断引用类型的具体类型,但不够灵活。</p>\n</li>\n<li><p><code>constructor</code> 用来判断实例的构造函数,但容易被伪造。</p>\n</li>\n<li><p><code>Object.prototype.toString</code> 用来获取对象的描述字符串。</p>\n</li>\n</ul>\n<p>博客最近在搬迁，多多关照。<strong>有什么问题或者建议大家可以通过留言或者邮箱的方式告诉我。</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/060055.jpg\" alt></p>\n<p>汇总一些简单的易懂的东西出来分享一下，今天说下关于<code>Javascript</code>中的类型检测的问题。</p>\n<h3 id=\"Javascript中的数据类型\"><a href=\"#Javascript中的数据类型\" class=\"headerlink\" title=\"Javascript中的数据类型\"></a>Javascript中的数据类型</h3><p>说到类型检测前我们首先需要确定<code>Javascript</code>中一共有多少种数据类型。</p>\n<ul>\n<li><p><code>Javascript</code>不支持任何自定义类型的机制，而所有的值最终都将是6大类型之一。由于javascript数据类型具有动态性，因此的确没有再定义其他数据类型的必要。</p>\n</li>\n<li><p><code>Javascript</code>数据类型总的分为两大类:基本数据类型(<strong><code>5</code>种</strong>),一种引用数据类型,共 <strong><code>6</code>种</strong>,如下:</p>\n</li>\n</ul>\n<ol>\n<li>基本数据类型</li>\n</ol>\n<ul>\n<li><p><code>Undefined</code> 类型</p>\n</li>\n<li><p><code>Null</code> 类型</p>\n</li>\n<li><p><code>Boolean</code> 类型</p>\n</li>\n<li><p><code>Number</code> 类型</p>\n</li>\n<li><p><code>String</code> 类型</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li>引用数据类型</li>\n</ol>\n<h4 id=\"常用检测类型方法\"><a href=\"#常用检测类型方法\" class=\"headerlink\" title=\"常用检测类型方法\"></a>常用检测类型方法</h4><p>检测数据类型的方法有:<code>typeof</code>、<code>instanceof</code>、 <code>constructor</code>、 <code>prototype</code>。当然还有很多关于第三那方库的API方法我们就不一一列举了。</p>\n<h4 id=\"利用typeof进行类型检测\"><a href=\"#利用typeof进行类型检测\" class=\"headerlink\" title=\"利用typeof进行类型检测\"></a>利用typeof进行类型检测</h4><p>首先我们使用<code>typeof</code>来将我们常用的这几种类型分别测试一下看看返回的是什么</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"undefined\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"object\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"boolean\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">123</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"number\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"string\">'aaa'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"string\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123;<span class=\"attr\">a</span> : <span class=\"number\">1</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"object\"</span></span><br></pre></td></tr></table></figure>\n\n<p>下图是我们在<code>chrome</code>开发者工具中打印的结果，做一下对比</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022814.png\" alt></p>\n<p>首先我们看到了第一个问题那就是<code>null</code>和引用类型同时都检测到是<code>&quot;object&quot;</code>这种类型,其实<code>null不是一个空引用</code>(有很多人认为null就是一个空引用)，而是一个原始值。</p>\n<p>啰嗦一下: 其实这是一个js原生的<code>bug</code>，早在ES6版本的提案中就有人曾提到应该修复这个bug,但是被驳回了,原因是历史遗留的代码太多,喜欢的可以去看一下: <a href=\"https://link.zhihu.com/?target=http%3A//wiki.ecmascript.org/doku.php%3Fid%3Dharmony%253atypeof_null\" target=\"_blank\" rel=\"noopener\">参考地址</a>。</p>\n<p>当然了，即使是bug那我们也得避免，其实方法很简单也很多，下面举一个简单的例子:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;<span class=\"attr\">a</span> : <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> a === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">   a !== <span class=\"literal\">null</span> ? <span class=\"string\">'object'</span> : <span class=\"string\">'null'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果待检测的类型是数组、时间或者正则类型呢？我们同样只能拿到<code>object</code>。所以 <code>typeof</code>用于判断基本数据类型没有问题，但是判断引用数据类型时，就心有余而力不足了。</p>\n<p>既然这样那我们就去试试第二种方法，接着往下看</p>\n<h4 id=\"利用instanceof进行类型检测\"><a href=\"#利用instanceof进行类型检测\" class=\"headerlink\" title=\"利用instanceof进行类型检测\"></a>利用instanceof进行类型检测</h4><p>我们用<code>instanceof</code>判断一下上面遗留下来的那几个问题<code>[1,2,3] ,new Date(), new RegExp(\\^\\W+$\\)</code>，分别是Date，数组，正则:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>] <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">'\\W+'</span>) <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br></pre></td></tr></table></figure>\n\n<p>看到这要是觉得事情仿佛都解决了，那你就高兴的太早了😏</p>\n<p>如果我们需要判断一个未知的变量是什么类型用<code>instanceof</code>怎么实现？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 假设unknown是一个未知的变量，类型为数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> unknown = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 我们只能通过繁琐的对比最后才能准确的定位到这是个Array</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(unknown  <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span>) &#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'Array'</span>);</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(unknown  <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) &#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'Date'</span>);</span><br><span class=\"line\">&#125;....</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码看着就头疼，总的来说<code>instanceof</code>只适用于校验变量是否是某一种类型，对于校验未知类型的变量并不是很适用。</p>\n<p>你可能会问那就没有其他的方法了吗？往下看</p>\n<h4 id=\"利用constructor进行类型检测\"><a href=\"#利用constructor进行类型检测\" class=\"headerlink\" title=\"利用constructor进行类型检测\"></a>利用constructor进行类型检测</h4><p>上面我们留下了<code>instanceof</code>对未知类型检验的问题，感觉<code>instanceof</code>不够灵活，那我们接着说另一种方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].constructor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; ƒ Array() &#123; [native code] &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].constructor === <span class=\"built_in\">Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).constructor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; ƒ Date() &#123; [native code] &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).constructor === <span class=\"built_in\">Date</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true</span></span><br></pre></td></tr></table></figure>\n\n<p>通过<code>constructor</code>方法我们能对未知的类型进行鉴定，然而有时候结果总是出人意料的，假设是这种情况呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Fun</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\">Fun.prototype = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun = <span class=\"keyword\">new</span> Fun();</span><br><span class=\"line\"></span><br><span class=\"line\">fun.constructor === Fun</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; false;</span></span><br><span class=\"line\"></span><br><span class=\"line\">fun.constructor === <span class=\"built_in\">Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; true;</span></span><br></pre></td></tr></table></figure>\n\n<p>看一下在控制台输出的结果：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813.png\" alt></p>\n<p>看来利用<code>constructor</code>去做类型检测还是有点缺陷，当出现被修改时，<code>constructor</code>得到的结果就是错误的。</p>\n<h4 id=\"Object-prototype-toString\"><a href=\"#Object-prototype-toString\" class=\"headerlink\" title=\"Object.prototype.toString\"></a>Object.prototype.toString</h4><p>javascript中<code>Object</code>有个<code>toString</code>方法，该方法返回一个表示该对象的字符串，但是很多对象(如:Array等)都重写了<code>toString</code>方法，所以需要以<code>call</code>或<code>apply</code>的形式来配合使用才最安全,不说了看栗子:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Null]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Undefined]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"string\">'aaa'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object String]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"number\">123</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Number]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Boolean]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Array]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(&#123;<span class=\"attr\">a</span> : <span class=\"number\">1</span>&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Object]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Date]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//=&gt; \"[object Function]\"</span></span><br></pre></td></tr></table></figure>\n\n<p>我们将<code>chrome</code>控制台输出的截图抬上来看看</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/022813-1.png\" alt></p>\n<p>上面的例子很容易说明<code>Object.prototype.toString.call()</code>是一个不错的基本数据类型和引用数据类型的一个方式。其实像<code>jQuery</code>中<code>$.type()</code>也是配合这种方式去实现的,最后我们将其源码拿过来瞅两眼</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery.each(</span><br><span class=\"line\">  <span class=\"string\">'Boolean Number String Function Array Date RegExp Object Error Symbol'</span>.split(</span><br><span class=\"line\">    <span class=\"string\">''</span></span><br><span class=\"line\">  ),</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, name</span>) </span>&#123;</span><br><span class=\"line\">    class2type[<span class=\"string\">'[object '</span> + name + <span class=\"string\">']'</span>] = name.toLowerCase()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toType</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj + <span class=\"string\">''</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Support: Android &lt;=2.3 only (functionish RegExp)</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> obj === <span class=\"string\">'object'</span> || <span class=\"keyword\">typeof</span> obj === <span class=\"string\">'function'</span></span><br><span class=\"line\">    ? class2type[toString.call(obj)] || <span class=\"string\">'object'</span></span><br><span class=\"line\">    : <span class=\"keyword\">typeof</span> obj</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后总结一下了：</p>\n<ul>\n<li><p><code>typeof</code> 用来判断基本类型,而在引用类型方面显得无力。</p>\n</li>\n<li><p><code>instanceof</code> 用来判断引用类型的具体类型,但不够灵活。</p>\n</li>\n<li><p><code>constructor</code> 用来判断实例的构造函数,但容易被伪造。</p>\n</li>\n<li><p><code>Object.prototype.toString</code> 用来获取对象的描述字符串。</p>\n</li>\n</ul>\n<p>博客最近在搬迁，多多关照。<strong>有什么问题或者建议大家可以通过留言或者邮箱的方式告诉我。</strong></p>\n"},{"title":"react-native 因图片打包太大问题","date":"2019-07-30T07:59:51.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085345.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085345.jpg) \n\n\n\n如果RN项目中碰到`生产包太大`的问题。我之前采用的是未处理过的png图片，所以打包后一个应用`android`下达到了**`44M`**，而`ios`已经达到了将近**`60M`**，这很明显是有问题（除非你的应用足够庞大那么这么大事正常的😆）。\n\n遇到这种问题首先想到的就是将包进行减压查看。发现问题就出现在图片`png`太多。思索后决定将应用的图片转成了`webp`的格式，折腾之后，重新打包`android`下**`减少将近26M`**，`ios`下**`减少将近38M`**。我使用的是[react-native-webp-support](https://github.com/TGPSKI/react-native-webp-support)第三方库去解决（`ios`端需要永到这个，安卓直接配置即可），因此将配置webp的方案记录下来，以供大家参考。\n\n\n\n### 当前环境\n\n*   OS: macOS High Sierra 10.13.5\n*   Node: 8.11.3\n*   Yarn: 1.7.0\n*   npm: 5.6.0\n*   Watchman: 4.9.0\n*   Xcode: Xcode 9.4.1\n*   react: 16.3.1 => 16.3.1\n*   react-native: 0.55.4 => 0.55.4\n*   react-native-splash-screen: 3.1.0 => 3.1.0\n\n\n\n### 兼容性\n\n- `android`平台下只需要修改配置`{project}/android/app/build.gradle`文件即可，不需要第三方模块支持\n- `ios`下需要引入`react-native-webp-support`进行配置\n\n\n\n### Android配置\n\n- 修改`{project}/android/app/`目录下的`build.gradle`文件\n\n\n```java\n...\n\ndependencies {\n\n  ...\n\n  compile 'com.facebook.fresco:webpsupport:0.11.0'\n\n  compile 'com.facebook.fresco:animated-webp:0.11.0'\n\n}\n\n...\n\n```\n\n- 配置如下图\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080132.png)\n\n\n\n### Ios配置\n\n`Ios`下比较麻烦，需要引入这个第三方库[react-native-webp-support](https://github.com/TGPSKI/react-native-webp-support)\n\n#### 安装第三方库\n\n```shell\n  npm install TGPSKI/react-native-webp-support -S \n\n  # or with yarn \n\n  yarn add TGPSKI/react-native-webp-support\n\n```\n\n\n\n#### Xcode中进行配置\n\n1. 用Xcode打开项目, 找到`Frameworks`目录，右键选择 `Add Files to [your project's name]`\n\n2. 添加`{project}/node_modules/react-native-webp-support/`下的`WebP.framework`和`WebPDemux.framework`目录\n\n3. 或者直接拖动到`Frameworks`下也行，这里我们假装自己很懂的方式使用添加的方法去添加\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/083449.png) \n\n4. 将`$(SRCROOT)/../node_modules/react-native-webp-support`分别添加到`Build Settings`下的`Framework Search Paths`和`Header Search Paths`选项中\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080138.png) \n\n5. 在Xcode中, 找到`Libraries`目录，右键选择 `Add Files to [your project's name]`添加`ReactNativeWebp.xcodeproj`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080142.png) \n\n6. 找到`$(SRCROOT)/node_modules/react-native-webp-support`添加到`Libraries`中\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080145.png) \n\n7. 将`$(SRCROOT)/node_modules/react-native-webp-support/ReactNativeWebp.xcodeproj/Products/`下的`libReactNatveWebp.a`文件拖到`Build Phases`中的`Link Binary with Libraries`选项中\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080150.png) \n\n\n\n### 使用\n\n使用就比较简单了，将你现在用的png转化为webp的格式，文件引入直接使用`.webp`为后缀的文件即可\n\n关于转化`webp`方法可是使用[智图工具进行转化](https://zhitu.isux.us/index.php/preview/download)\n\n\n\n**如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)**","source":"_posts/react-native-因图片打包太大问题.md","raw":"---\ntitle: react-native 因图片打包太大问题\ndate: 2019-07-30 15:59:51\ntags: ReactNative\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085345.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085345.jpg) \n\n\n\n如果RN项目中碰到`生产包太大`的问题。我之前采用的是未处理过的png图片，所以打包后一个应用`android`下达到了**`44M`**，而`ios`已经达到了将近**`60M`**，这很明显是有问题（除非你的应用足够庞大那么这么大事正常的😆）。\n\n遇到这种问题首先想到的就是将包进行减压查看。发现问题就出现在图片`png`太多。思索后决定将应用的图片转成了`webp`的格式，折腾之后，重新打包`android`下**`减少将近26M`**，`ios`下**`减少将近38M`**。我使用的是[react-native-webp-support](https://github.com/TGPSKI/react-native-webp-support)第三方库去解决（`ios`端需要永到这个，安卓直接配置即可），因此将配置webp的方案记录下来，以供大家参考。\n\n\n\n### 当前环境\n\n*   OS: macOS High Sierra 10.13.5\n*   Node: 8.11.3\n*   Yarn: 1.7.0\n*   npm: 5.6.0\n*   Watchman: 4.9.0\n*   Xcode: Xcode 9.4.1\n*   react: 16.3.1 => 16.3.1\n*   react-native: 0.55.4 => 0.55.4\n*   react-native-splash-screen: 3.1.0 => 3.1.0\n\n\n\n### 兼容性\n\n- `android`平台下只需要修改配置`{project}/android/app/build.gradle`文件即可，不需要第三方模块支持\n- `ios`下需要引入`react-native-webp-support`进行配置\n\n\n\n### Android配置\n\n- 修改`{project}/android/app/`目录下的`build.gradle`文件\n\n\n```java\n...\n\ndependencies {\n\n  ...\n\n  compile 'com.facebook.fresco:webpsupport:0.11.0'\n\n  compile 'com.facebook.fresco:animated-webp:0.11.0'\n\n}\n\n...\n\n```\n\n- 配置如下图\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080132.png)\n\n\n\n### Ios配置\n\n`Ios`下比较麻烦，需要引入这个第三方库[react-native-webp-support](https://github.com/TGPSKI/react-native-webp-support)\n\n#### 安装第三方库\n\n```shell\n  npm install TGPSKI/react-native-webp-support -S \n\n  # or with yarn \n\n  yarn add TGPSKI/react-native-webp-support\n\n```\n\n\n\n#### Xcode中进行配置\n\n1. 用Xcode打开项目, 找到`Frameworks`目录，右键选择 `Add Files to [your project's name]`\n\n2. 添加`{project}/node_modules/react-native-webp-support/`下的`WebP.framework`和`WebPDemux.framework`目录\n\n3. 或者直接拖动到`Frameworks`下也行，这里我们假装自己很懂的方式使用添加的方法去添加\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/083449.png) \n\n4. 将`$(SRCROOT)/../node_modules/react-native-webp-support`分别添加到`Build Settings`下的`Framework Search Paths`和`Header Search Paths`选项中\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080138.png) \n\n5. 在Xcode中, 找到`Libraries`目录，右键选择 `Add Files to [your project's name]`添加`ReactNativeWebp.xcodeproj`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080142.png) \n\n6. 找到`$(SRCROOT)/node_modules/react-native-webp-support`添加到`Libraries`中\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080145.png) \n\n7. 将`$(SRCROOT)/node_modules/react-native-webp-support/ReactNativeWebp.xcodeproj/Products/`下的`libReactNatveWebp.a`文件拖到`Build Phases`中的`Link Binary with Libraries`选项中\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080150.png) \n\n\n\n### 使用\n\n使用就比较简单了，将你现在用的png转化为webp的格式，文件引入直接使用`.webp`为后缀的文件即可\n\n关于转化`webp`方法可是使用[智图工具进行转化](https://zhitu.isux.us/index.php/preview/download)\n\n\n\n**如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)**","slug":"react-native-因图片打包太大问题","published":1,"updated":"2019-07-30T09:27:10.555Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjysbhubt0008qbt51bgc9ids","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085345.jpg\" alt> </p>\n<p>如果RN项目中碰到<code>生产包太大</code>的问题。我之前采用的是未处理过的png图片，所以打包后一个应用<code>android</code>下达到了<strong><code>44M</code></strong>，而<code>ios</code>已经达到了将近<strong><code>60M</code></strong>，这很明显是有问题（除非你的应用足够庞大那么这么大事正常的😆）。</p>\n<p>遇到这种问题首先想到的就是将包进行减压查看。发现问题就出现在图片<code>png</code>太多。思索后决定将应用的图片转成了<code>webp</code>的格式，折腾之后，重新打包<code>android</code>下<strong><code>减少将近26M</code></strong>，<code>ios</code>下<strong><code>减少将近38M</code></strong>。我使用的是<a href=\"https://github.com/TGPSKI/react-native-webp-support\" target=\"_blank\" rel=\"noopener\">react-native-webp-support</a>第三方库去解决（<code>ios</code>端需要永到这个，安卓直接配置即可），因此将配置webp的方案记录下来，以供大家参考。</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-splash-screen: 3.1.0 =&gt; 3.1.0</li>\n</ul>\n<h3 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h3><ul>\n<li><code>android</code>平台下只需要修改配置<code>{project}/android/app/build.gradle</code>文件即可，不需要第三方模块支持</li>\n<li><code>ios</code>下需要引入<code>react-native-webp-support</code>进行配置</li>\n</ul>\n<h3 id=\"Android配置\"><a href=\"#Android配置\" class=\"headerlink\" title=\"Android配置\"></a>Android配置</h3><ul>\n<li>修改<code>{project}/android/app/</code>目录下的<code>build.gradle</code>文件</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">  compile <span class=\"string\">'com.facebook.fresco:webpsupport:0.11.0'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  compile <span class=\"string\">'com.facebook.fresco:animated-webp:0.11.0'</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置如下图</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080132.png\" alt></p>\n<h3 id=\"Ios配置\"><a href=\"#Ios配置\" class=\"headerlink\" title=\"Ios配置\"></a>Ios配置</h3><p><code>Ios</code>下比较麻烦，需要引入这个第三方库<a href=\"https://github.com/TGPSKI/react-native-webp-support\" target=\"_blank\" rel=\"noopener\">react-native-webp-support</a></p>\n<h4 id=\"安装第三方库\"><a href=\"#安装第三方库\" class=\"headerlink\" title=\"安装第三方库\"></a>安装第三方库</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install TGPSKI/react-native-webp-support -S </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> or with yarn </span><br><span class=\"line\"></span><br><span class=\"line\">yarn add TGPSKI/react-native-webp-support</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Xcode中进行配置\"><a href=\"#Xcode中进行配置\" class=\"headerlink\" title=\"Xcode中进行配置\"></a>Xcode中进行配置</h4><ol>\n<li><p>用Xcode打开项目, 找到<code>Frameworks</code>目录，右键选择 <code>Add Files to [your project&#39;s name]</code></p>\n</li>\n<li><p>添加<code>{project}/node_modules/react-native-webp-support/</code>下的<code>WebP.framework</code>和<code>WebPDemux.framework</code>目录</p>\n</li>\n<li><p>或者直接拖动到<code>Frameworks</code>下也行，这里我们假装自己很懂的方式使用添加的方法去添加</p>\n</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/083449.png\" alt> </p>\n<ol start=\"4\">\n<li>将<code>$(SRCROOT)/../node_modules/react-native-webp-support</code>分别添加到<code>Build Settings</code>下的<code>Framework Search Paths</code>和<code>Header Search Paths</code>选项中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080138.png\" alt> </p>\n<ol start=\"5\">\n<li>在Xcode中, 找到<code>Libraries</code>目录，右键选择 <code>Add Files to [your project&#39;s name]</code>添加<code>ReactNativeWebp.xcodeproj</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080142.png\" alt> </p>\n<ol start=\"6\">\n<li>找到<code>$(SRCROOT)/node_modules/react-native-webp-support</code>添加到<code>Libraries</code>中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080145.png\" alt> </p>\n<ol start=\"7\">\n<li>将<code>$(SRCROOT)/node_modules/react-native-webp-support/ReactNativeWebp.xcodeproj/Products/</code>下的<code>libReactNatveWebp.a</code>文件拖到<code>Build Phases</code>中的<code>Link Binary with Libraries</code>选项中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080150.png\" alt> </p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>使用就比较简单了，将你现在用的png转化为webp的格式，文件引入直接使用<code>.webp</code>为后缀的文件即可</p>\n<p>关于转化<code>webp</code>方法可是使用<a href=\"https://zhitu.isux.us/index.php/preview/download\" target=\"_blank\" rel=\"noopener\">智图工具进行转化</a></p>\n<p><strong>如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085345.jpg\" alt> </p>\n<p>如果RN项目中碰到<code>生产包太大</code>的问题。我之前采用的是未处理过的png图片，所以打包后一个应用<code>android</code>下达到了<strong><code>44M</code></strong>，而<code>ios</code>已经达到了将近<strong><code>60M</code></strong>，这很明显是有问题（除非你的应用足够庞大那么这么大事正常的😆）。</p>\n<p>遇到这种问题首先想到的就是将包进行减压查看。发现问题就出现在图片<code>png</code>太多。思索后决定将应用的图片转成了<code>webp</code>的格式，折腾之后，重新打包<code>android</code>下<strong><code>减少将近26M</code></strong>，<code>ios</code>下<strong><code>减少将近38M</code></strong>。我使用的是<a href=\"https://github.com/TGPSKI/react-native-webp-support\" target=\"_blank\" rel=\"noopener\">react-native-webp-support</a>第三方库去解决（<code>ios</code>端需要永到这个，安卓直接配置即可），因此将配置webp的方案记录下来，以供大家参考。</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-splash-screen: 3.1.0 =&gt; 3.1.0</li>\n</ul>\n<h3 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h3><ul>\n<li><code>android</code>平台下只需要修改配置<code>{project}/android/app/build.gradle</code>文件即可，不需要第三方模块支持</li>\n<li><code>ios</code>下需要引入<code>react-native-webp-support</code>进行配置</li>\n</ul>\n<h3 id=\"Android配置\"><a href=\"#Android配置\" class=\"headerlink\" title=\"Android配置\"></a>Android配置</h3><ul>\n<li>修改<code>{project}/android/app/</code>目录下的<code>build.gradle</code>文件</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">  compile <span class=\"string\">'com.facebook.fresco:webpsupport:0.11.0'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  compile <span class=\"string\">'com.facebook.fresco:animated-webp:0.11.0'</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置如下图</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080132.png\" alt></p>\n<h3 id=\"Ios配置\"><a href=\"#Ios配置\" class=\"headerlink\" title=\"Ios配置\"></a>Ios配置</h3><p><code>Ios</code>下比较麻烦，需要引入这个第三方库<a href=\"https://github.com/TGPSKI/react-native-webp-support\" target=\"_blank\" rel=\"noopener\">react-native-webp-support</a></p>\n<h4 id=\"安装第三方库\"><a href=\"#安装第三方库\" class=\"headerlink\" title=\"安装第三方库\"></a>安装第三方库</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install TGPSKI/react-native-webp-support -S </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> or with yarn </span><br><span class=\"line\"></span><br><span class=\"line\">yarn add TGPSKI/react-native-webp-support</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Xcode中进行配置\"><a href=\"#Xcode中进行配置\" class=\"headerlink\" title=\"Xcode中进行配置\"></a>Xcode中进行配置</h4><ol>\n<li><p>用Xcode打开项目, 找到<code>Frameworks</code>目录，右键选择 <code>Add Files to [your project&#39;s name]</code></p>\n</li>\n<li><p>添加<code>{project}/node_modules/react-native-webp-support/</code>下的<code>WebP.framework</code>和<code>WebPDemux.framework</code>目录</p>\n</li>\n<li><p>或者直接拖动到<code>Frameworks</code>下也行，这里我们假装自己很懂的方式使用添加的方法去添加</p>\n</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/083449.png\" alt> </p>\n<ol start=\"4\">\n<li>将<code>$(SRCROOT)/../node_modules/react-native-webp-support</code>分别添加到<code>Build Settings</code>下的<code>Framework Search Paths</code>和<code>Header Search Paths</code>选项中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080138.png\" alt> </p>\n<ol start=\"5\">\n<li>在Xcode中, 找到<code>Libraries</code>目录，右键选择 <code>Add Files to [your project&#39;s name]</code>添加<code>ReactNativeWebp.xcodeproj</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080142.png\" alt> </p>\n<ol start=\"6\">\n<li>找到<code>$(SRCROOT)/node_modules/react-native-webp-support</code>添加到<code>Libraries</code>中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080145.png\" alt> </p>\n<ol start=\"7\">\n<li>将<code>$(SRCROOT)/node_modules/react-native-webp-support/ReactNativeWebp.xcodeproj/Products/</code>下的<code>libReactNatveWebp.a</code>文件拖到<code>Build Phases</code>中的<code>Link Binary with Libraries</code>选项中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/080150.png\" alt> </p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>使用就比较简单了，将你现在用的png转化为webp的格式，文件引入直接使用<code>.webp</code>为后缀的文件即可</p>\n<p>关于转化<code>webp</code>方法可是使用<a href=\"https://zhitu.isux.us/index.php/preview/download\" target=\"_blank\" rel=\"noopener\">智图工具进行转化</a></p>\n<p><strong>如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)</strong></p>\n"},{"title":"Git 2.0 更改 push default","date":"2019-07-31T05:43:30.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064701.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064701.jpg)\n\n\n\n### 问题处理\n\n`git`更新后,项目`push`时如果提示这样的信息:\n\n`warning: push.default尚未设置` ，是因为它的默认值在 Git 2.0 已从 'matching'\n变更为 'simple'。若要不再显示本信息并保持传统习惯，进行如下设置：\n\n ```shell\ngit config --global push.default matching\n ```\n\n\n\n若要不再显示本信息并从现在开始采用新的使用习惯，设置：\n\n```shell\ngit config --global push.default simple\n```\n\n\n\n当 `push.default` 设置为 `matching` 后，`git` 将推送和远程同名的所有本地分支。\n\n从 Git 2.0 开始，Git 默认采用更为保守的 `simple` 模式，只推送当前分支到远程关联的同名分支，即 `git push` 推送当前分支。\n\n参见 `git help config` 并查找 `push.default` 以获取更多信息。\n（`simple` 模式由 Git 1.7.11 版本引入。如果您有时要使用老版本的 Git，为保持兼容，请用 `current` 代替 `simple`。\n\n\n\n### Matching\n\n`matching` 参数是 `Git 1.x` 的默认行为，其意是如果你执行 `git push` 但没有指定分支，它将 `push` 所有你本地的分支到远程仓库中对应匹配的分支。\n\n\n\n### Simple\n\n而 `Git 2.x `默认的是 `simple`，意味着执行 `git push` 没有指定分支时，只有当前分支会被 `push` 到你使用 `git pull` 获取的代码。\n\n\n\n### 修改默认设置\n\n从上述消息提示中的解释，我们可以修改全局配置，使之不会每次 push 的时候都进行提示。对于 `matching` 输入如下命令即可：\n\n```shell\ngit config --global push.default matching\n```\n\n而对于 `simple` ，请输入：\n\n```shell\ngit config --global push.default simple\n```\n\n\n\n**参考地址：**[https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple](https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple)\n\n","source":"_posts/Git-2-0-更改-push-default.md","raw":"---\ntitle: Git 2.0 更改 push default\ndate: 2019-07-31 13:43:30\ntags: Git\ncategories: 版本管理\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064701.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064701.jpg)\n\n\n\n### 问题处理\n\n`git`更新后,项目`push`时如果提示这样的信息:\n\n`warning: push.default尚未设置` ，是因为它的默认值在 Git 2.0 已从 'matching'\n变更为 'simple'。若要不再显示本信息并保持传统习惯，进行如下设置：\n\n ```shell\ngit config --global push.default matching\n ```\n\n\n\n若要不再显示本信息并从现在开始采用新的使用习惯，设置：\n\n```shell\ngit config --global push.default simple\n```\n\n\n\n当 `push.default` 设置为 `matching` 后，`git` 将推送和远程同名的所有本地分支。\n\n从 Git 2.0 开始，Git 默认采用更为保守的 `simple` 模式，只推送当前分支到远程关联的同名分支，即 `git push` 推送当前分支。\n\n参见 `git help config` 并查找 `push.default` 以获取更多信息。\n（`simple` 模式由 Git 1.7.11 版本引入。如果您有时要使用老版本的 Git，为保持兼容，请用 `current` 代替 `simple`。\n\n\n\n### Matching\n\n`matching` 参数是 `Git 1.x` 的默认行为，其意是如果你执行 `git push` 但没有指定分支，它将 `push` 所有你本地的分支到远程仓库中对应匹配的分支。\n\n\n\n### Simple\n\n而 `Git 2.x `默认的是 `simple`，意味着执行 `git push` 没有指定分支时，只有当前分支会被 `push` 到你使用 `git pull` 获取的代码。\n\n\n\n### 修改默认设置\n\n从上述消息提示中的解释，我们可以修改全局配置，使之不会每次 push 的时候都进行提示。对于 `matching` 输入如下命令即可：\n\n```shell\ngit config --global push.default matching\n```\n\n而对于 `simple` ，请输入：\n\n```shell\ngit config --global push.default simple\n```\n\n\n\n**参考地址：**[https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple](https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple)\n\n","slug":"Git-2-0-更改-push-default","published":1,"updated":"2019-07-31T13:09:00.655Z","_id":"cjysbhubv000cqbt5dyzzy1om","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064701.jpg\" alt></p>\n<h3 id=\"问题处理\"><a href=\"#问题处理\" class=\"headerlink\" title=\"问题处理\"></a>问题处理</h3><p><code>git</code>更新后,项目<code>push</code>时如果提示这样的信息:</p>\n<p><code>warning: push.default尚未设置</code> ，是因为它的默认值在 Git 2.0 已从 ‘matching’<br>变更为 ‘simple’。若要不再显示本信息并保持传统习惯，进行如下设置：</p>\n <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default matching</span><br></pre></td></tr></table></figure>\n\n<p>若要不再显示本信息并从现在开始采用新的使用习惯，设置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default simple</span><br></pre></td></tr></table></figure>\n\n<p>当 <code>push.default</code> 设置为 <code>matching</code> 后，<code>git</code> 将推送和远程同名的所有本地分支。</p>\n<p>从 Git 2.0 开始，Git 默认采用更为保守的 <code>simple</code> 模式，只推送当前分支到远程关联的同名分支，即 <code>git push</code> 推送当前分支。</p>\n<p>参见 <code>git help config</code> 并查找 <code>push.default</code> 以获取更多信息。<br>（<code>simple</code> 模式由 Git 1.7.11 版本引入。如果您有时要使用老版本的 Git，为保持兼容，请用 <code>current</code> 代替 <code>simple</code>。</p>\n<h3 id=\"Matching\"><a href=\"#Matching\" class=\"headerlink\" title=\"Matching\"></a>Matching</h3><p><code>matching</code> 参数是 <code>Git 1.x</code> 的默认行为，其意是如果你执行 <code>git push</code> 但没有指定分支，它将 <code>push</code> 所有你本地的分支到远程仓库中对应匹配的分支。</p>\n<h3 id=\"Simple\"><a href=\"#Simple\" class=\"headerlink\" title=\"Simple\"></a>Simple</h3><p>而 <code>Git 2.x</code>默认的是 <code>simple</code>，意味着执行 <code>git push</code> 没有指定分支时，只有当前分支会被 <code>push</code> 到你使用 <code>git pull</code> 获取的代码。</p>\n<h3 id=\"修改默认设置\"><a href=\"#修改默认设置\" class=\"headerlink\" title=\"修改默认设置\"></a>修改默认设置</h3><p>从上述消息提示中的解释，我们可以修改全局配置，使之不会每次 push 的时候都进行提示。对于 <code>matching</code> 输入如下命令即可：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default matching</span><br></pre></td></tr></table></figure>\n\n<p>而对于 <code>simple</code> ，请输入：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default simple</span><br></pre></td></tr></table></figure>\n\n<p><strong>参考地址：</strong><a href=\"https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple\" target=\"_blank\" rel=\"noopener\">https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064701.jpg\" alt></p>\n<h3 id=\"问题处理\"><a href=\"#问题处理\" class=\"headerlink\" title=\"问题处理\"></a>问题处理</h3><p><code>git</code>更新后,项目<code>push</code>时如果提示这样的信息:</p>\n<p><code>warning: push.default尚未设置</code> ，是因为它的默认值在 Git 2.0 已从 ‘matching’<br>变更为 ‘simple’。若要不再显示本信息并保持传统习惯，进行如下设置：</p>\n <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default matching</span><br></pre></td></tr></table></figure>\n\n<p>若要不再显示本信息并从现在开始采用新的使用习惯，设置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default simple</span><br></pre></td></tr></table></figure>\n\n<p>当 <code>push.default</code> 设置为 <code>matching</code> 后，<code>git</code> 将推送和远程同名的所有本地分支。</p>\n<p>从 Git 2.0 开始，Git 默认采用更为保守的 <code>simple</code> 模式，只推送当前分支到远程关联的同名分支，即 <code>git push</code> 推送当前分支。</p>\n<p>参见 <code>git help config</code> 并查找 <code>push.default</code> 以获取更多信息。<br>（<code>simple</code> 模式由 Git 1.7.11 版本引入。如果您有时要使用老版本的 Git，为保持兼容，请用 <code>current</code> 代替 <code>simple</code>。</p>\n<h3 id=\"Matching\"><a href=\"#Matching\" class=\"headerlink\" title=\"Matching\"></a>Matching</h3><p><code>matching</code> 参数是 <code>Git 1.x</code> 的默认行为，其意是如果你执行 <code>git push</code> 但没有指定分支，它将 <code>push</code> 所有你本地的分支到远程仓库中对应匹配的分支。</p>\n<h3 id=\"Simple\"><a href=\"#Simple\" class=\"headerlink\" title=\"Simple\"></a>Simple</h3><p>而 <code>Git 2.x</code>默认的是 <code>simple</code>，意味着执行 <code>git push</code> 没有指定分支时，只有当前分支会被 <code>push</code> 到你使用 <code>git pull</code> 获取的代码。</p>\n<h3 id=\"修改默认设置\"><a href=\"#修改默认设置\" class=\"headerlink\" title=\"修改默认设置\"></a>修改默认设置</h3><p>从上述消息提示中的解释，我们可以修改全局配置，使之不会每次 push 的时候都进行提示。对于 <code>matching</code> 输入如下命令即可：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default matching</span><br></pre></td></tr></table></figure>\n\n<p>而对于 <code>simple</code> ，请输入：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global push.default simple</span><br></pre></td></tr></table></figure>\n\n<p><strong>参考地址：</strong><a href=\"https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple\" target=\"_blank\" rel=\"noopener\">https://www.oschina.net/news/45585/git-2-x-change-push-default-to-simple</a></p>\n"},{"title":"vue-cli2 配置Dll打包","date":"2019-08-01T06:47:39.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg)\n\n\n\n`vue-cli`在项目打包时，对于依赖的第三方库，比如`vue、vuex、vue-router...`等这些不会修改的依赖，我们希望这些依赖单独进行打。这样做的好处是每次更改我本地代码的文件的时候，`webpack`只需要打包我项目本身的文件代码，而不会再去编译第三方库，打包速度会有质的提升。并且也有利于对这些非业务相关代码在客户端缓存的利用。\n\n因此为了实现这个问题，`DllPlugin` 和 `DllReferencePlugin`插件也就诞生了😬。\n\n不多哔哔，还是说说怎么用吧 (♥ω♥)~♪ \n\n### 项目分析\n\n本文只阐述关于`vue-cli 2.x`版本，`3.x`对一些第三方库有相对路径引入，如果你依旧想使用`DLL`去切分包可以尝试一下[vue-cli-plugin-dll](https://github.com/fingerpan/vue-cli-plugin-dll)这个工具。好了说下我们当前项目目录：\n\n![image-20190801162922915](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/082923.png)\n\n\n\n这是一个标准的`cli 2`创建的工程，下面我做个打包分析（因为我这个项目是真实项目可能比较大）。\n\n#### 添加analyzer\n\n修改package.json\n\n```json\n{\n  \"name\": \"DLL例子\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"start\": \"npm run dev\",\n    \"dev\": \"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\",\n    \"build\": \"cross-env NODE_ENV=production node build/build.js\",\n    \"analyzer\": \"npm run build --report\" //=> here\n  }\n  ...\n}\n```\n\n执行打包分析命令\n\n```\nyarn analyzer\n# or\nnpm run analyzer\n```\n\n打完包会自动打开一个窗口，就可以看到打包后每一块包含着什么，占比多少。下面看一下我打包后的分析图\n\n![image-20190801164951855](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/084952.png)\n\n可以看出`vendor.js`打包后原始大小达到`2.17MB`，而这个包你每次迭代发布时后面的`chunkhash`都会变化。意味着客户端的缓存就没了，当再次打开我们的网站时这个`vendor.js`又会重新加载。\n\n说到这我们可以看下这个`vendor.js`到底包含了什么，为什么会这么大？\n\n![image-20190801165511594](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085512.png)\n\n放大后我觉得不需要多解释了，`element-ui`、`vue`、`core`、`router`等等。。。\n\n下面我们利用`DLL`对他们单独进行打包：\n\n\n\n### 配置DLL\n\n#### 在配置中添加dll版块\n\n修改`/config/index.js`\n\n```javascript\nmodule.exports = {\n    dev: {\n        ...\n    },\n    dll: {\n        entry: {\n            'vueVendor': [\n                'babel-polyfill',\n                'vue/dist/vue.esm.js',\n                'vue-router',\n                'vuex',\n                'axios'\n            ],\n            vendor: [\n                '@dal/element-ui',\n                'nprogress',\n                'viewerjs',\n                'v-viewer',\n                'vuex-persistedstate',\n                'qs'\n            ]\n        },\n        outputPath: 'cdn'\n    },\n    build: {\n    \t...\n    }\n}\n\n```\n\n解释一下：\n\n- 首先对于我，我觉得有一部分第三方库是很久都不会变的，所以我将他们打包到`vueVendor`\n- 对于一些可能发生变化的（这里的`element-ui`采用的事内部源，所以变化可能也很大）将他们打包到`vendor`，当然这两个名字你可以随便起，但是多文件有个坑最后说。\n- `outputPath`用作我们将来`DLL`包打包到哪里，我这里起名叫`cdn`\n- 把配置写在这里是为了后续方便维护\n\n\n\n#### 创建Dll打包配置文件\n\n在`build`文件夹下添加名为`webpack.dll.conf.js`的文件，内容为：\n\n```javascript\nconst webpack = require('webpack')\nconst path = require('path')\nconst config = require('../config/index')\n\nmodule.exports = {\n    entry: config.dll.entry, // 配置打包入口\n    output: {\n        path: path.join(__dirname, '..', config.dll.outputPath), // 配置打包输出目录\n        filename: '[name].[chunkhash].dll.js', // chunkhash是为了日后清理缓存\n        library: '[name]_library'\n    },\n    plugins: [\n        new webpack.DllPlugin({\n            path: path.join(__dirname, './[name]-manifest.json'),\n            name: '[name]_library',\n            context: __dirname // 这里的上下文要和我们后面用的DllReferencePlugin的上下文一致。 \n        }),\n        new webpack.optimize.UglifyJsPlugin({ // 丑化Js\n            compress: {\n              warnings: false,\n              drop_console:true,\n              drop_debugger:true\n            },\n            output:{\n              comments: false,\n            },\n            sourceMap: false\n        })\n    ]\n}\n\n```\n\n\n\n#### 创建DLL打包脚本\n\n```javascript\nconst webpack = require('webpack')\nconst path = require('path')\nconst ora = require('ora') // 一个执行动画，为了美观没啥\nconst rm = require('rimraf')\nconst chalk = require('chalk')\nconst config = require('../config/index')\nconst dllConfig = require('./webpack.dll.conf')\n\nconst spinner = ora('Start pre-operation...')\nspinner.start()\n\nrm(path.join(__dirname, '..', config.dll.outputPath), err => { // 打包前清空cdn文件夹\n    if (err) throw err\n    webpack(dllConfig, (err, stats) => { // 执行打包\n        spinner.stop()\n        if (err) throw err\n        process.stdout.write(stats.toString({ // 一些日志\n            colors: true,\n            modules: false,\n            children: false,\n            chunks: false,\n            chunkModules: false\n        }) + '\\n\\n')\n\n        if (stats.hasErrors()) { // 如果失败输出错误日志并退出进程\n            console.log(chalk.red('  Build failed with errors.\\n'))\n            process.exit(1)\n        }\n\n        console.log(chalk.cyan('  Build complete.\\n'))\n        console.log(chalk.yellow(' Project decomposition is successful, enter startup status ...'))\n    })\n})\n\n```\n\n到目前为止我们就能为这些第三方库做打包了`DLL`（dll打包和项目打包是分开的）\n\n\n\n#### 配置脚本，开始打包\n\n我们修改`package.json`中的`scripts`添加一条`DLL`打包的命令：\n\n```json\n{\n  \"name\": \"DLL例子\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"start\": \"npm run dev\",\n    \"dev\": \"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\",\n    \"build\": \"cross-env NODE_ENV=production node build/build.js\",\n    \"analyzer\": \"npm run build --report\",\n    \"dll\": \"node build/dll.js\" //=> here\n  },\n  ...\n}\n```\n\n完后执行打包命令：\n\n```shell\nyarn dll\n# or\nnpm run dll\n```\n\n不出意外的话你的根目录会出现一个叫做`cdn`的文件夹（或者是你自己配置的文件夹名），同时`build`文件夹下也会多出两个`***-manifest.json`文件。上图看一下\n\n![image-20190802111926063](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/031926.png)\n\n打包后的文件目录：\n\n![image-20190802112708091](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032708.png)\n\n\n\n好了，接下来我们只要告诉`webpack`遇到这些公共包的时候不进行打包，这也就是`***-manifest.json`文件的作用，下一步我们要配置`webpack.dev.conf.js`以及`webpack.prod.conf.js`文件\n\n\n\n#### 修改开发打包配置\n\n再此之前我们需要安装一个`webpack`插件，作用就是自动帮我们把`Dll`这块静态`js`文件自动引入到项目中。\n\n我们这里用到的是[add-asset-html-webpack-plugin](https://github.com/SimenB/add-asset-html-webpack-plugin)\n\n打开`/build/webpack.dev.conf.js`文件\n\n```javascript\nconst utils = require('./utils')\nconst webpack = require('webpack')\nconst config = require('../config')\nconst merge = require('webpack-merge')\nconst path = require('path')\nconst baseWebpackConfig = require('./webpack.base.conf')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\nconst FriendlyErrorsPlugin = require('friendly-errors-webpack-plugin')\nconst portfinder = require('portfinder')\n\n// 引入插件\nconst AddAssetHtmlPlugin = require('add-asset-html-webpack-plugin')\n\nconst devWebpackConfig = merge(baseWebpackConfig, {\n    devServer: {\n        ...\n    },\n    plugins: [\n        ...\n        new HtmlWebpackPlugin({\n            filename: 'index.html',\n            template: 'index.html',\n            inject: true\n        }),\n        // 在HtmlWebpackPlugin后面进行添加\n        // 因为我们是多个dll文件，所以需要处理一下\n        ...Object.keys(config.dll.entry).map(name => {\n            return new webpack.DllReferencePlugin({\n                context: __dirname,\n                manifest: require(`./${name}-manifest.json`),\n            })\n        }),\n        // 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中\n        new AddAssetHtmlPlugin([{\n            // 指定dll存放位置\n            filepath: path.resolve(__dirname, '..', `${config.dll.outputPath}/*.dll.js`),\n            // 引入后并将dll文件自动移动到dist文件夹下\n            outputPath: utils.assetsPath(config.dll.outputPath),\n            // 指定引入静态路径前缀\n            publicPath: path.posix.join(config.dev.assetsPublicPath, config.dev.assetsSubDirectory, config.dll.outputPath),\n            includeSourcemap: false\n        }])\n    ]\n})\n```\n\n好了，自此我们开发环境下就配置完成了。截下来我们说一下生产环境的打包修改：\n\n\n\n#### 修改生产打包配置\n\n```javascript\nconst path = require('path')\nconst utils = require('./utils')\nconst webpack = require('webpack')\nconst config = require('../config')\nconst merge = require('webpack-merge')\nconst baseWebpackConfig = require('./webpack.base.conf')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\nconst ExtractTextPlugin = require('extract-text-webpack-plugin')\nconst OptimizeCSSPlugin = require('optimize-css-assets-webpack-plugin')\nconst UglifyJsPlugin = require('uglifyjs-webpack-plugin')\n\n// 引入插件\nconst AddAssetHtmlPlugin = require('add-asset-html-webpack-plugin')\n\nconst webpackConfig = merge(baseWebpackConfig, {\n    plugins: [\n        ...\n        new HtmlWebpackPlugin({\n            ...\n        }),\n        // 在HtmlWebpackPlugin后面进行添加\n        // 因为我们是多个dll文件，所以需要处理一下\n        ...Object.keys(config.dll.entry).map(name => {\n            return new webpack.DllReferencePlugin({\n                context: __dirname,\n                manifest: require(`./${name}-manifest.json`),\n            })\n        }),\n        // 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中\n        new AddAssetHtmlPlugin([{\n            // 指定dll存放位置\n            filepath: path.resolve(__dirname, '..', `${config.dll.outputPath}/*.dll.js`),\n            // 引入后并将dll文件自动移动到dist文件夹下\n            outputPath: utils.assetsPath(config.dll.outputPath),\n            // 指定引入静态路径前缀(这里我们使用了cdn服务器)\n            publicPath: `${config.build.assetsPublicPath}${config.build.assetsSubDirectory}/${config.dll.outputPath}`,\n            includeSourcemap: false\n        }]),\n        ...\n    ]\n})\n\nmodule.exports = webpackConfig\n```\n\n到此为止，我们用`DLL`进行打包分割已经做完了，下面我们可以看下效果。\n\n\n\n#### 再次进行打包分析\n\n```\nyarn analyzer\n# or\nnpm run analyzer\n```\n\n通过`DLL`包拆分后我们的`vendor.js`仅剩不到`80kb`\n\n![image-20190801191405068](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111405.png)\n\n\n\n我们单独放大这块进行查看：\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111511.png)\n\n\n\n到目前为止我们的的包已经完美的分割开了，最后再查看下打包后的目录：\n\n![image-20190802112222035](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032222.png)\n\n可以看到`cdn`这个目录已经自动迁移到`/dist`目录下了，那这是怎么做到的呢？其实这个是`AddAssetHtmlPlugin`帮我们做了，也就是这句起作用了\n\n![image-20190802105002776](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/025003.png)\n\n追后我们看下最终生成的`html`模板文件是什么样的：\n\n![image-20190802112503021](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032503.png)\n\n\n\n最后说明一个**容易忽略**的点：`DLL`多入口生成没有问题，但`AddAssetHtmlPlugin`引入你文件的顺序是按你打包后文件夹文件的倒叙方式引入的。当然只有在你打包的是多文件才会有这种问题。好了，接下来我们再把使用中其他细节问题拿出来聊一下\n\n\n\n### 检测`cdn`目录完整\n\n如果我们后期变动了`DLL`包中的任何一个，进行了重新`Dll`打包，那么可想而知`cdn`文件夹下的两个文件的`chunkhash`会变化，那么上传到仓库后，别的同事合并你的代码如果不注意可能`cdn`会存在新旧两个版本的文件，这样会导致项目存在风险。所以我们需要做一个工具，打包之前提前检测`cdn`目录下文件是否符合预期，如不符合我们应该前置进行`DLL`打包。同理我们还可以对`build`文件夹下的`***-manifest.json`映射文件进行简单的查验，不通过同样进行前置打包处理，下面我们看下具体如何实现。\n\n\n\n首先我们再`build`下创建名为`detection.js`的文件，内容如下：\n\n```javascript\nconst fs = require(\"fs\")\nconst path = require('path')\nconst chalk = require('chalk')\nconst process = require('child_process')\nconst config = require('../config/index')\n\n// 构建dll\nconst execScript = () => {\n    try {\n        console.log(chalk.yellow(' DLL incomplete will be repackaged...'))\n        process.execSync('npm run dll')\n    } catch (error) {\n        console.log(chalk.red('  Build failed with errors.\\n'))\n        process.exit(1)\n    }\n}\n\nmodule.exports = () => {\n    console.log(chalk.blue(' Check DLL package integrity...'));\n    // 获取dll配置入口配置对象\n    const dlls = Object.keys(config.dll.entry)\n    // 获取dll入口文件个数\n    const dllLength = dlls.length\n\n    try {\n        // 读取cdn目录文件\n        const files = fs.readdirSync(path.join(__dirname, '..', 'cdn'))\n        // 读取当前目录文件\n        const manifests = fs.readdirSync(__dirname)\n        // 判断manifest映射文件是否存在\n        const isManifests = manifests.filter(manifest => /.json$/.test(manifest)).every(manifest => dlls.some(dll => `${dll}-manifest.json` === manifest))\n\n        // 如映射文件或文件数量不符则重新构建dll包\n        if (isManifests && files.length === dllLength) {\n            console.log(chalk.green(' Congratulations DLL package available'))\n        } else {\n            execScript()\n        }\n    } catch (error) {\n        execScript()\n    }\n}\n\n```\n\n\n\n完后我们在`build/webpack.base.conf.js`文件中引入并执行他：\n\n```javascript\nconst path = require('path')\nconst utils = require('./utils')\nconst config = require('../config')\nconst vueLoaderConfig = require('./vue-loader.conf')\n// 引入我们编写的脚本\nconst detection = require('./detection')\n\n// 检测dll包可用性\ndetection()\n\nfunction resolve (dir) {\n    ...\n}\n\nconst createLintingRule = () => ({\n    ...\n})\n\nmodule.exports = {\n    ...\n}\n\n```\n\n\n\n完后我们吧`cdn`下的文件删除一个\n\n![image-20190802114406691](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034407.png)\n\n执行打包命令，查看是否会重新生成我们的静态文件：\n\n```\nyarn build\n# or\nnpm run build\n```\n\n![image-20190802114735617](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034736.png)\n\n可以看到，我们的检测脚本正常执行了 ，并且自动进行了`DLL`打包的过程，最后我们再查看下`dist`目录和`cdn`目录的情况：\n\n![image-20190802114922878](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034923.png)\n\n\n\n好了，有什么问题记得的留言😂😂😂","source":"_posts/vue-cli2-配置Dll打包.md","raw":"---\ntitle: vue-cli2 配置Dll打包\ndate: 2019-08-01 14:47:39\ntags: Vue\ncategories: 工程化\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg)\n\n\n\n`vue-cli`在项目打包时，对于依赖的第三方库，比如`vue、vuex、vue-router...`等这些不会修改的依赖，我们希望这些依赖单独进行打。这样做的好处是每次更改我本地代码的文件的时候，`webpack`只需要打包我项目本身的文件代码，而不会再去编译第三方库，打包速度会有质的提升。并且也有利于对这些非业务相关代码在客户端缓存的利用。\n\n因此为了实现这个问题，`DllPlugin` 和 `DllReferencePlugin`插件也就诞生了😬。\n\n不多哔哔，还是说说怎么用吧 (♥ω♥)~♪ \n\n### 项目分析\n\n本文只阐述关于`vue-cli 2.x`版本，`3.x`对一些第三方库有相对路径引入，如果你依旧想使用`DLL`去切分包可以尝试一下[vue-cli-plugin-dll](https://github.com/fingerpan/vue-cli-plugin-dll)这个工具。好了说下我们当前项目目录：\n\n![image-20190801162922915](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/082923.png)\n\n\n\n这是一个标准的`cli 2`创建的工程，下面我做个打包分析（因为我这个项目是真实项目可能比较大）。\n\n#### 添加analyzer\n\n修改package.json\n\n```json\n{\n  \"name\": \"DLL例子\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"start\": \"npm run dev\",\n    \"dev\": \"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\",\n    \"build\": \"cross-env NODE_ENV=production node build/build.js\",\n    \"analyzer\": \"npm run build --report\" //=> here\n  }\n  ...\n}\n```\n\n执行打包分析命令\n\n```\nyarn analyzer\n# or\nnpm run analyzer\n```\n\n打完包会自动打开一个窗口，就可以看到打包后每一块包含着什么，占比多少。下面看一下我打包后的分析图\n\n![image-20190801164951855](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/084952.png)\n\n可以看出`vendor.js`打包后原始大小达到`2.17MB`，而这个包你每次迭代发布时后面的`chunkhash`都会变化。意味着客户端的缓存就没了，当再次打开我们的网站时这个`vendor.js`又会重新加载。\n\n说到这我们可以看下这个`vendor.js`到底包含了什么，为什么会这么大？\n\n![image-20190801165511594](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085512.png)\n\n放大后我觉得不需要多解释了，`element-ui`、`vue`、`core`、`router`等等。。。\n\n下面我们利用`DLL`对他们单独进行打包：\n\n\n\n### 配置DLL\n\n#### 在配置中添加dll版块\n\n修改`/config/index.js`\n\n```javascript\nmodule.exports = {\n    dev: {\n        ...\n    },\n    dll: {\n        entry: {\n            'vueVendor': [\n                'babel-polyfill',\n                'vue/dist/vue.esm.js',\n                'vue-router',\n                'vuex',\n                'axios'\n            ],\n            vendor: [\n                '@dal/element-ui',\n                'nprogress',\n                'viewerjs',\n                'v-viewer',\n                'vuex-persistedstate',\n                'qs'\n            ]\n        },\n        outputPath: 'cdn'\n    },\n    build: {\n    \t...\n    }\n}\n\n```\n\n解释一下：\n\n- 首先对于我，我觉得有一部分第三方库是很久都不会变的，所以我将他们打包到`vueVendor`\n- 对于一些可能发生变化的（这里的`element-ui`采用的事内部源，所以变化可能也很大）将他们打包到`vendor`，当然这两个名字你可以随便起，但是多文件有个坑最后说。\n- `outputPath`用作我们将来`DLL`包打包到哪里，我这里起名叫`cdn`\n- 把配置写在这里是为了后续方便维护\n\n\n\n#### 创建Dll打包配置文件\n\n在`build`文件夹下添加名为`webpack.dll.conf.js`的文件，内容为：\n\n```javascript\nconst webpack = require('webpack')\nconst path = require('path')\nconst config = require('../config/index')\n\nmodule.exports = {\n    entry: config.dll.entry, // 配置打包入口\n    output: {\n        path: path.join(__dirname, '..', config.dll.outputPath), // 配置打包输出目录\n        filename: '[name].[chunkhash].dll.js', // chunkhash是为了日后清理缓存\n        library: '[name]_library'\n    },\n    plugins: [\n        new webpack.DllPlugin({\n            path: path.join(__dirname, './[name]-manifest.json'),\n            name: '[name]_library',\n            context: __dirname // 这里的上下文要和我们后面用的DllReferencePlugin的上下文一致。 \n        }),\n        new webpack.optimize.UglifyJsPlugin({ // 丑化Js\n            compress: {\n              warnings: false,\n              drop_console:true,\n              drop_debugger:true\n            },\n            output:{\n              comments: false,\n            },\n            sourceMap: false\n        })\n    ]\n}\n\n```\n\n\n\n#### 创建DLL打包脚本\n\n```javascript\nconst webpack = require('webpack')\nconst path = require('path')\nconst ora = require('ora') // 一个执行动画，为了美观没啥\nconst rm = require('rimraf')\nconst chalk = require('chalk')\nconst config = require('../config/index')\nconst dllConfig = require('./webpack.dll.conf')\n\nconst spinner = ora('Start pre-operation...')\nspinner.start()\n\nrm(path.join(__dirname, '..', config.dll.outputPath), err => { // 打包前清空cdn文件夹\n    if (err) throw err\n    webpack(dllConfig, (err, stats) => { // 执行打包\n        spinner.stop()\n        if (err) throw err\n        process.stdout.write(stats.toString({ // 一些日志\n            colors: true,\n            modules: false,\n            children: false,\n            chunks: false,\n            chunkModules: false\n        }) + '\\n\\n')\n\n        if (stats.hasErrors()) { // 如果失败输出错误日志并退出进程\n            console.log(chalk.red('  Build failed with errors.\\n'))\n            process.exit(1)\n        }\n\n        console.log(chalk.cyan('  Build complete.\\n'))\n        console.log(chalk.yellow(' Project decomposition is successful, enter startup status ...'))\n    })\n})\n\n```\n\n到目前为止我们就能为这些第三方库做打包了`DLL`（dll打包和项目打包是分开的）\n\n\n\n#### 配置脚本，开始打包\n\n我们修改`package.json`中的`scripts`添加一条`DLL`打包的命令：\n\n```json\n{\n  \"name\": \"DLL例子\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"start\": \"npm run dev\",\n    \"dev\": \"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\",\n    \"build\": \"cross-env NODE_ENV=production node build/build.js\",\n    \"analyzer\": \"npm run build --report\",\n    \"dll\": \"node build/dll.js\" //=> here\n  },\n  ...\n}\n```\n\n完后执行打包命令：\n\n```shell\nyarn dll\n# or\nnpm run dll\n```\n\n不出意外的话你的根目录会出现一个叫做`cdn`的文件夹（或者是你自己配置的文件夹名），同时`build`文件夹下也会多出两个`***-manifest.json`文件。上图看一下\n\n![image-20190802111926063](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/031926.png)\n\n打包后的文件目录：\n\n![image-20190802112708091](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032708.png)\n\n\n\n好了，接下来我们只要告诉`webpack`遇到这些公共包的时候不进行打包，这也就是`***-manifest.json`文件的作用，下一步我们要配置`webpack.dev.conf.js`以及`webpack.prod.conf.js`文件\n\n\n\n#### 修改开发打包配置\n\n再此之前我们需要安装一个`webpack`插件，作用就是自动帮我们把`Dll`这块静态`js`文件自动引入到项目中。\n\n我们这里用到的是[add-asset-html-webpack-plugin](https://github.com/SimenB/add-asset-html-webpack-plugin)\n\n打开`/build/webpack.dev.conf.js`文件\n\n```javascript\nconst utils = require('./utils')\nconst webpack = require('webpack')\nconst config = require('../config')\nconst merge = require('webpack-merge')\nconst path = require('path')\nconst baseWebpackConfig = require('./webpack.base.conf')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\nconst FriendlyErrorsPlugin = require('friendly-errors-webpack-plugin')\nconst portfinder = require('portfinder')\n\n// 引入插件\nconst AddAssetHtmlPlugin = require('add-asset-html-webpack-plugin')\n\nconst devWebpackConfig = merge(baseWebpackConfig, {\n    devServer: {\n        ...\n    },\n    plugins: [\n        ...\n        new HtmlWebpackPlugin({\n            filename: 'index.html',\n            template: 'index.html',\n            inject: true\n        }),\n        // 在HtmlWebpackPlugin后面进行添加\n        // 因为我们是多个dll文件，所以需要处理一下\n        ...Object.keys(config.dll.entry).map(name => {\n            return new webpack.DllReferencePlugin({\n                context: __dirname,\n                manifest: require(`./${name}-manifest.json`),\n            })\n        }),\n        // 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中\n        new AddAssetHtmlPlugin([{\n            // 指定dll存放位置\n            filepath: path.resolve(__dirname, '..', `${config.dll.outputPath}/*.dll.js`),\n            // 引入后并将dll文件自动移动到dist文件夹下\n            outputPath: utils.assetsPath(config.dll.outputPath),\n            // 指定引入静态路径前缀\n            publicPath: path.posix.join(config.dev.assetsPublicPath, config.dev.assetsSubDirectory, config.dll.outputPath),\n            includeSourcemap: false\n        }])\n    ]\n})\n```\n\n好了，自此我们开发环境下就配置完成了。截下来我们说一下生产环境的打包修改：\n\n\n\n#### 修改生产打包配置\n\n```javascript\nconst path = require('path')\nconst utils = require('./utils')\nconst webpack = require('webpack')\nconst config = require('../config')\nconst merge = require('webpack-merge')\nconst baseWebpackConfig = require('./webpack.base.conf')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\nconst ExtractTextPlugin = require('extract-text-webpack-plugin')\nconst OptimizeCSSPlugin = require('optimize-css-assets-webpack-plugin')\nconst UglifyJsPlugin = require('uglifyjs-webpack-plugin')\n\n// 引入插件\nconst AddAssetHtmlPlugin = require('add-asset-html-webpack-plugin')\n\nconst webpackConfig = merge(baseWebpackConfig, {\n    plugins: [\n        ...\n        new HtmlWebpackPlugin({\n            ...\n        }),\n        // 在HtmlWebpackPlugin后面进行添加\n        // 因为我们是多个dll文件，所以需要处理一下\n        ...Object.keys(config.dll.entry).map(name => {\n            return new webpack.DllReferencePlugin({\n                context: __dirname,\n                manifest: require(`./${name}-manifest.json`),\n            })\n        }),\n        // 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中\n        new AddAssetHtmlPlugin([{\n            // 指定dll存放位置\n            filepath: path.resolve(__dirname, '..', `${config.dll.outputPath}/*.dll.js`),\n            // 引入后并将dll文件自动移动到dist文件夹下\n            outputPath: utils.assetsPath(config.dll.outputPath),\n            // 指定引入静态路径前缀(这里我们使用了cdn服务器)\n            publicPath: `${config.build.assetsPublicPath}${config.build.assetsSubDirectory}/${config.dll.outputPath}`,\n            includeSourcemap: false\n        }]),\n        ...\n    ]\n})\n\nmodule.exports = webpackConfig\n```\n\n到此为止，我们用`DLL`进行打包分割已经做完了，下面我们可以看下效果。\n\n\n\n#### 再次进行打包分析\n\n```\nyarn analyzer\n# or\nnpm run analyzer\n```\n\n通过`DLL`包拆分后我们的`vendor.js`仅剩不到`80kb`\n\n![image-20190801191405068](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111405.png)\n\n\n\n我们单独放大这块进行查看：\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111511.png)\n\n\n\n到目前为止我们的的包已经完美的分割开了，最后再查看下打包后的目录：\n\n![image-20190802112222035](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032222.png)\n\n可以看到`cdn`这个目录已经自动迁移到`/dist`目录下了，那这是怎么做到的呢？其实这个是`AddAssetHtmlPlugin`帮我们做了，也就是这句起作用了\n\n![image-20190802105002776](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/025003.png)\n\n追后我们看下最终生成的`html`模板文件是什么样的：\n\n![image-20190802112503021](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032503.png)\n\n\n\n最后说明一个**容易忽略**的点：`DLL`多入口生成没有问题，但`AddAssetHtmlPlugin`引入你文件的顺序是按你打包后文件夹文件的倒叙方式引入的。当然只有在你打包的是多文件才会有这种问题。好了，接下来我们再把使用中其他细节问题拿出来聊一下\n\n\n\n### 检测`cdn`目录完整\n\n如果我们后期变动了`DLL`包中的任何一个，进行了重新`Dll`打包，那么可想而知`cdn`文件夹下的两个文件的`chunkhash`会变化，那么上传到仓库后，别的同事合并你的代码如果不注意可能`cdn`会存在新旧两个版本的文件，这样会导致项目存在风险。所以我们需要做一个工具，打包之前提前检测`cdn`目录下文件是否符合预期，如不符合我们应该前置进行`DLL`打包。同理我们还可以对`build`文件夹下的`***-manifest.json`映射文件进行简单的查验，不通过同样进行前置打包处理，下面我们看下具体如何实现。\n\n\n\n首先我们再`build`下创建名为`detection.js`的文件，内容如下：\n\n```javascript\nconst fs = require(\"fs\")\nconst path = require('path')\nconst chalk = require('chalk')\nconst process = require('child_process')\nconst config = require('../config/index')\n\n// 构建dll\nconst execScript = () => {\n    try {\n        console.log(chalk.yellow(' DLL incomplete will be repackaged...'))\n        process.execSync('npm run dll')\n    } catch (error) {\n        console.log(chalk.red('  Build failed with errors.\\n'))\n        process.exit(1)\n    }\n}\n\nmodule.exports = () => {\n    console.log(chalk.blue(' Check DLL package integrity...'));\n    // 获取dll配置入口配置对象\n    const dlls = Object.keys(config.dll.entry)\n    // 获取dll入口文件个数\n    const dllLength = dlls.length\n\n    try {\n        // 读取cdn目录文件\n        const files = fs.readdirSync(path.join(__dirname, '..', 'cdn'))\n        // 读取当前目录文件\n        const manifests = fs.readdirSync(__dirname)\n        // 判断manifest映射文件是否存在\n        const isManifests = manifests.filter(manifest => /.json$/.test(manifest)).every(manifest => dlls.some(dll => `${dll}-manifest.json` === manifest))\n\n        // 如映射文件或文件数量不符则重新构建dll包\n        if (isManifests && files.length === dllLength) {\n            console.log(chalk.green(' Congratulations DLL package available'))\n        } else {\n            execScript()\n        }\n    } catch (error) {\n        execScript()\n    }\n}\n\n```\n\n\n\n完后我们在`build/webpack.base.conf.js`文件中引入并执行他：\n\n```javascript\nconst path = require('path')\nconst utils = require('./utils')\nconst config = require('../config')\nconst vueLoaderConfig = require('./vue-loader.conf')\n// 引入我们编写的脚本\nconst detection = require('./detection')\n\n// 检测dll包可用性\ndetection()\n\nfunction resolve (dir) {\n    ...\n}\n\nconst createLintingRule = () => ({\n    ...\n})\n\nmodule.exports = {\n    ...\n}\n\n```\n\n\n\n完后我们吧`cdn`下的文件删除一个\n\n![image-20190802114406691](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034407.png)\n\n执行打包命令，查看是否会重新生成我们的静态文件：\n\n```\nyarn build\n# or\nnpm run build\n```\n\n![image-20190802114735617](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034736.png)\n\n可以看到，我们的检测脚本正常执行了 ，并且自动进行了`DLL`打包的过程，最后我们再查看下`dist`目录和`cdn`目录的情况：\n\n![image-20190802114922878](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034923.png)\n\n\n\n好了，有什么问题记得的留言😂😂😂","slug":"vue-cli2-配置Dll打包","published":1,"updated":"2019-08-02T03:52:03.654Z","_id":"cjysbhubx000dqbt5ze407o7b","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg\" alt></p>\n<p><code>vue-cli</code>在项目打包时，对于依赖的第三方库，比如<code>vue、vuex、vue-router...</code>等这些不会修改的依赖，我们希望这些依赖单独进行打。这样做的好处是每次更改我本地代码的文件的时候，<code>webpack</code>只需要打包我项目本身的文件代码，而不会再去编译第三方库，打包速度会有质的提升。并且也有利于对这些非业务相关代码在客户端缓存的利用。</p>\n<p>因此为了实现这个问题，<code>DllPlugin</code> 和 <code>DllReferencePlugin</code>插件也就诞生了😬。</p>\n<p>不多哔哔，还是说说怎么用吧 (♥ω♥)~♪ </p>\n<h3 id=\"项目分析\"><a href=\"#项目分析\" class=\"headerlink\" title=\"项目分析\"></a>项目分析</h3><p>本文只阐述关于<code>vue-cli 2.x</code>版本，<code>3.x</code>对一些第三方库有相对路径引入，如果你依旧想使用<code>DLL</code>去切分包可以尝试一下<a href=\"https://github.com/fingerpan/vue-cli-plugin-dll\" target=\"_blank\" rel=\"noopener\">vue-cli-plugin-dll</a>这个工具。好了说下我们当前项目目录：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/082923.png\" alt=\"image-20190801162922915\"></p>\n<p>这是一个标准的<code>cli 2</code>创建的工程，下面我做个打包分析（因为我这个项目是真实项目可能比较大）。</p>\n<h4 id=\"添加analyzer\"><a href=\"#添加analyzer\" class=\"headerlink\" title=\"添加analyzer\"></a>添加analyzer</h4><p>修改package.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"DLL例子\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"npm run dev\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production node build/build.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"analyzer\"</span>: <span class=\"string\">\"npm run build --report\"</span> //=&gt; here</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>执行打包分析命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn analyzer</span><br><span class=\"line\"># or</span><br><span class=\"line\">npm run analyzer</span><br></pre></td></tr></table></figure>\n\n<p>打完包会自动打开一个窗口，就可以看到打包后每一块包含着什么，占比多少。下面看一下我打包后的分析图</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/084952.png\" alt=\"image-20190801164951855\"></p>\n<p>可以看出<code>vendor.js</code>打包后原始大小达到<code>2.17MB</code>，而这个包你每次迭代发布时后面的<code>chunkhash</code>都会变化。意味着客户端的缓存就没了，当再次打开我们的网站时这个<code>vendor.js</code>又会重新加载。</p>\n<p>说到这我们可以看下这个<code>vendor.js</code>到底包含了什么，为什么会这么大？</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085512.png\" alt=\"image-20190801165511594\"></p>\n<p>放大后我觉得不需要多解释了，<code>element-ui</code>、<code>vue</code>、<code>core</code>、<code>router</code>等等。。。</p>\n<p>下面我们利用<code>DLL</code>对他们单独进行打包：</p>\n<h3 id=\"配置DLL\"><a href=\"#配置DLL\" class=\"headerlink\" title=\"配置DLL\"></a>配置DLL</h3><h4 id=\"在配置中添加dll版块\"><a href=\"#在配置中添加dll版块\" class=\"headerlink\" title=\"在配置中添加dll版块\"></a>在配置中添加dll版块</h4><p>修改<code>/config/index.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    dev: &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dll: &#123;</span><br><span class=\"line\">        entry: &#123;</span><br><span class=\"line\">            <span class=\"string\">'vueVendor'</span>: [</span><br><span class=\"line\">                <span class=\"string\">'babel-polyfill'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vue/dist/vue.esm.js'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vue-router'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vuex'</span>,</span><br><span class=\"line\">                <span class=\"string\">'axios'</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            vendor: [</span><br><span class=\"line\">                <span class=\"string\">'@dal/element-ui'</span>,</span><br><span class=\"line\">                <span class=\"string\">'nprogress'</span>,</span><br><span class=\"line\">                <span class=\"string\">'viewerjs'</span>,</span><br><span class=\"line\">                <span class=\"string\">'v-viewer'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vuex-persistedstate'</span>,</span><br><span class=\"line\">                <span class=\"string\">'qs'</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        outputPath: <span class=\"string\">'cdn'</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    build: &#123;</span><br><span class=\"line\">    \t...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>解释一下：</p>\n<ul>\n<li>首先对于我，我觉得有一部分第三方库是很久都不会变的，所以我将他们打包到<code>vueVendor</code></li>\n<li>对于一些可能发生变化的（这里的<code>element-ui</code>采用的事内部源，所以变化可能也很大）将他们打包到<code>vendor</code>，当然这两个名字你可以随便起，但是多文件有个坑最后说。</li>\n<li><code>outputPath</code>用作我们将来<code>DLL</code>包打包到哪里，我这里起名叫<code>cdn</code></li>\n<li>把配置写在这里是为了后续方便维护</li>\n</ul>\n<h4 id=\"创建Dll打包配置文件\"><a href=\"#创建Dll打包配置文件\" class=\"headerlink\" title=\"创建Dll打包配置文件\"></a>创建Dll打包配置文件</h4><p>在<code>build</code>文件夹下添加名为<code>webpack.dll.conf.js</code>的文件，内容为：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config/index'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: config.dll.entry, <span class=\"comment\">// 配置打包入口</span></span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.join(__dirname, <span class=\"string\">'..'</span>, config.dll.outputPath), <span class=\"comment\">// 配置打包输出目录</span></span><br><span class=\"line\">        filename: <span class=\"string\">'[name].[chunkhash].dll.js'</span>, <span class=\"comment\">// chunkhash是为了日后清理缓存</span></span><br><span class=\"line\">        library: <span class=\"string\">'[name]_library'</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.DllPlugin(&#123;</span><br><span class=\"line\">            path: path.join(__dirname, <span class=\"string\">'./[name]-manifest.json'</span>),</span><br><span class=\"line\">            name: <span class=\"string\">'[name]_library'</span>,</span><br><span class=\"line\">            context: __dirname <span class=\"comment\">// 这里的上下文要和我们后面用的DllReferencePlugin的上下文一致。 </span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.optimize.UglifyJsPlugin(&#123; <span class=\"comment\">// 丑化Js</span></span><br><span class=\"line\">            compress: &#123;</span><br><span class=\"line\">              warnings: <span class=\"literal\">false</span>,</span><br><span class=\"line\">              drop_console:<span class=\"literal\">true</span>,</span><br><span class=\"line\">              drop_debugger:<span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            output:&#123;</span><br><span class=\"line\">              comments: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            sourceMap: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建DLL打包脚本\"><a href=\"#创建DLL打包脚本\" class=\"headerlink\" title=\"创建DLL打包脚本\"></a>创建DLL打包脚本</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">'ora'</span>) <span class=\"comment\">// 一个执行动画，为了美观没啥</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> rm = <span class=\"built_in\">require</span>(<span class=\"string\">'rimraf'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">'chalk'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config/index'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> dllConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.dll.conf'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">'Start pre-operation...'</span>)</span><br><span class=\"line\">spinner.start()</span><br><span class=\"line\"></span><br><span class=\"line\">rm(path.join(__dirname, <span class=\"string\">'..'</span>, config.dll.outputPath), err =&gt; &#123; <span class=\"comment\">// 打包前清空cdn文件夹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err</span><br><span class=\"line\">    webpack(dllConfig, (err, stats) =&gt; &#123; <span class=\"comment\">// 执行打包</span></span><br><span class=\"line\">        spinner.stop()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err</span><br><span class=\"line\">        process.stdout.write(stats.toString(&#123; <span class=\"comment\">// 一些日志</span></span><br><span class=\"line\">            colors: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            modules: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            children: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            chunks: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            chunkModules: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;) + <span class=\"string\">'\\n\\n'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stats.hasErrors()) &#123; <span class=\"comment\">// 如果失败输出错误日志并退出进程</span></span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(chalk.red(<span class=\"string\">'  Build failed with errors.\\n'</span>))</span><br><span class=\"line\">            process.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.cyan(<span class=\"string\">'  Build complete.\\n'</span>))</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.yellow(<span class=\"string\">' Project decomposition is successful, enter startup status ...'</span>))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>到目前为止我们就能为这些第三方库做打包了<code>DLL</code>（dll打包和项目打包是分开的）</p>\n<h4 id=\"配置脚本，开始打包\"><a href=\"#配置脚本，开始打包\" class=\"headerlink\" title=\"配置脚本，开始打包\"></a>配置脚本，开始打包</h4><p>我们修改<code>package.json</code>中的<code>scripts</code>添加一条<code>DLL</code>打包的命令：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"DLL例子\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"npm run dev\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production node build/build.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"analyzer\"</span>: <span class=\"string\">\"npm run build --report\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dll\"</span>: <span class=\"string\">\"node build/dll.js\"</span> //=&gt; here</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>完后执行打包命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn dll</span><br><span class=\"line\"><span class=\"meta\">#</span> or</span><br><span class=\"line\">npm run dll</span><br></pre></td></tr></table></figure>\n\n<p>不出意外的话你的根目录会出现一个叫做<code>cdn</code>的文件夹（或者是你自己配置的文件夹名），同时<code>build</code>文件夹下也会多出两个<code>***-manifest.json</code>文件。上图看一下</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/031926.png\" alt=\"image-20190802111926063\"></p>\n<p>打包后的文件目录：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032708.png\" alt=\"image-20190802112708091\"></p>\n<p>好了，接下来我们只要告诉<code>webpack</code>遇到这些公共包的时候不进行打包，这也就是<code>***-manifest.json</code>文件的作用，下一步我们要配置<code>webpack.dev.conf.js</code>以及<code>webpack.prod.conf.js</code>文件</p>\n<h4 id=\"修改开发打包配置\"><a href=\"#修改开发打包配置\" class=\"headerlink\" title=\"修改开发打包配置\"></a>修改开发打包配置</h4><p>再此之前我们需要安装一个<code>webpack</code>插件，作用就是自动帮我们把<code>Dll</code>这块静态<code>js</code>文件自动引入到项目中。</p>\n<p>我们这里用到的是<a href=\"https://github.com/SimenB/add-asset-html-webpack-plugin\" target=\"_blank\" rel=\"noopener\">add-asset-html-webpack-plugin</a></p>\n<p>打开<code>/build/webpack.dev.conf.js</code>文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'./utils'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> baseWebpackConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.base.conf'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> FriendlyErrorsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'friendly-errors-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> portfinder = <span class=\"built_in\">require</span>(<span class=\"string\">'portfinder'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引入插件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> AddAssetHtmlPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'add-asset-html-webpack-plugin'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">    devServer: &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">            template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">            inject: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 在HtmlWebpackPlugin后面进行添加</span></span><br><span class=\"line\">        <span class=\"comment\">// 因为我们是多个dll文件，所以需要处理一下</span></span><br><span class=\"line\">        ...Object.keys(config.dll.entry).map(<span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">                context: __dirname,</span><br><span class=\"line\">                manifest: <span class=\"built_in\">require</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;name&#125;</span>-manifest.json`</span>),</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> AddAssetHtmlPlugin([&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 指定dll存放位置</span></span><br><span class=\"line\">            filepath: path.resolve(__dirname, <span class=\"string\">'..'</span>, <span class=\"string\">`<span class=\"subst\">$&#123;config.dll.outputPath&#125;</span>/*.dll.js`</span>),</span><br><span class=\"line\">            <span class=\"comment\">// 引入后并将dll文件自动移动到dist文件夹下</span></span><br><span class=\"line\">            outputPath: utils.assetsPath(config.dll.outputPath),</span><br><span class=\"line\">            <span class=\"comment\">// 指定引入静态路径前缀</span></span><br><span class=\"line\">            publicPath: path.posix.join(config.dev.assetsPublicPath, config.dev.assetsSubDirectory, config.dll.outputPath),</span><br><span class=\"line\">            includeSourcemap: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;])</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>好了，自此我们开发环境下就配置完成了。截下来我们说一下生产环境的打包修改：</p>\n<h4 id=\"修改生产打包配置\"><a href=\"#修改生产打包配置\" class=\"headerlink\" title=\"修改生产打包配置\"></a>修改生产打包配置</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'./utils'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> baseWebpackConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.base.conf'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'extract-text-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCSSPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> UglifyJsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'uglifyjs-webpack-plugin'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引入插件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> AddAssetHtmlPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'add-asset-html-webpack-plugin'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 在HtmlWebpackPlugin后面进行添加</span></span><br><span class=\"line\">        <span class=\"comment\">// 因为我们是多个dll文件，所以需要处理一下</span></span><br><span class=\"line\">        ...Object.keys(config.dll.entry).map(<span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">                context: __dirname,</span><br><span class=\"line\">                manifest: <span class=\"built_in\">require</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;name&#125;</span>-manifest.json`</span>),</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> AddAssetHtmlPlugin([&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 指定dll存放位置</span></span><br><span class=\"line\">            filepath: path.resolve(__dirname, <span class=\"string\">'..'</span>, <span class=\"string\">`<span class=\"subst\">$&#123;config.dll.outputPath&#125;</span>/*.dll.js`</span>),</span><br><span class=\"line\">            <span class=\"comment\">// 引入后并将dll文件自动移动到dist文件夹下</span></span><br><span class=\"line\">            outputPath: utils.assetsPath(config.dll.outputPath),</span><br><span class=\"line\">            <span class=\"comment\">// 指定引入静态路径前缀(这里我们使用了cdn服务器)</span></span><br><span class=\"line\">            publicPath: <span class=\"string\">`<span class=\"subst\">$&#123;config.build.assetsPublicPath&#125;</span><span class=\"subst\">$&#123;config.build.assetsSubDirectory&#125;</span>/<span class=\"subst\">$&#123;config.dll.outputPath&#125;</span>`</span>,</span><br><span class=\"line\">            includeSourcemap: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;]),</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = webpackConfig</span><br></pre></td></tr></table></figure>\n\n<p>到此为止，我们用<code>DLL</code>进行打包分割已经做完了，下面我们可以看下效果。</p>\n<h4 id=\"再次进行打包分析\"><a href=\"#再次进行打包分析\" class=\"headerlink\" title=\"再次进行打包分析\"></a>再次进行打包分析</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn analyzer</span><br><span class=\"line\"># or</span><br><span class=\"line\">npm run analyzer</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>DLL</code>包拆分后我们的<code>vendor.js</code>仅剩不到<code>80kb</code></p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111405.png\" alt=\"image-20190801191405068\"></p>\n<p>我们单独放大这块进行查看：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111511.png\" alt></p>\n<p>到目前为止我们的的包已经完美的分割开了，最后再查看下打包后的目录：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032222.png\" alt=\"image-20190802112222035\"></p>\n<p>可以看到<code>cdn</code>这个目录已经自动迁移到<code>/dist</code>目录下了，那这是怎么做到的呢？其实这个是<code>AddAssetHtmlPlugin</code>帮我们做了，也就是这句起作用了</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/025003.png\" alt=\"image-20190802105002776\"></p>\n<p>追后我们看下最终生成的<code>html</code>模板文件是什么样的：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032503.png\" alt=\"image-20190802112503021\"></p>\n<p>最后说明一个<strong>容易忽略</strong>的点：<code>DLL</code>多入口生成没有问题，但<code>AddAssetHtmlPlugin</code>引入你文件的顺序是按你打包后文件夹文件的倒叙方式引入的。当然只有在你打包的是多文件才会有这种问题。好了，接下来我们再把使用中其他细节问题拿出来聊一下</p>\n<h3 id=\"检测cdn目录完整\"><a href=\"#检测cdn目录完整\" class=\"headerlink\" title=\"检测cdn目录完整\"></a>检测<code>cdn</code>目录完整</h3><p>如果我们后期变动了<code>DLL</code>包中的任何一个，进行了重新<code>Dll</code>打包，那么可想而知<code>cdn</code>文件夹下的两个文件的<code>chunkhash</code>会变化，那么上传到仓库后，别的同事合并你的代码如果不注意可能<code>cdn</code>会存在新旧两个版本的文件，这样会导致项目存在风险。所以我们需要做一个工具，打包之前提前检测<code>cdn</code>目录下文件是否符合预期，如不符合我们应该前置进行<code>DLL</code>打包。同理我们还可以对<code>build</code>文件夹下的<code>***-manifest.json</code>映射文件进行简单的查验，不通过同样进行前置打包处理，下面我们看下具体如何实现。</p>\n<p>首先我们再<code>build</code>下创建名为<code>detection.js</code>的文件，内容如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">'chalk'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> process = <span class=\"built_in\">require</span>(<span class=\"string\">'child_process'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config/index'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构建dll</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> execScript = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.yellow(<span class=\"string\">' DLL incomplete will be repackaged...'</span>))</span><br><span class=\"line\">        process.execSync(<span class=\"string\">'npm run dll'</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.red(<span class=\"string\">'  Build failed with errors.\\n'</span>))</span><br><span class=\"line\">        process.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(chalk.blue(<span class=\"string\">' Check DLL package integrity...'</span>));</span><br><span class=\"line\">    <span class=\"comment\">// 获取dll配置入口配置对象</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dlls = <span class=\"built_in\">Object</span>.keys(config.dll.entry)</span><br><span class=\"line\">    <span class=\"comment\">// 获取dll入口文件个数</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dllLength = dlls.length</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 读取cdn目录文件</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> files = fs.readdirSync(path.join(__dirname, <span class=\"string\">'..'</span>, <span class=\"string\">'cdn'</span>))</span><br><span class=\"line\">        <span class=\"comment\">// 读取当前目录文件</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> manifests = fs.readdirSync(__dirname)</span><br><span class=\"line\">        <span class=\"comment\">// 判断manifest映射文件是否存在</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> isManifests = manifests.filter(<span class=\"function\"><span class=\"params\">manifest</span> =&gt;</span> <span class=\"regexp\">/.json$/</span>.test(manifest)).every(<span class=\"function\"><span class=\"params\">manifest</span> =&gt;</span> dlls.some(<span class=\"function\"><span class=\"params\">dll</span> =&gt;</span> <span class=\"string\">`<span class=\"subst\">$&#123;dll&#125;</span>-manifest.json`</span> === manifest))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 如映射文件或文件数量不符则重新构建dll包</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isManifests &amp;&amp; files.length === dllLength) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">' Congratulations DLL package available'</span>))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            execScript()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        execScript()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>完后我们在<code>build/webpack.base.conf.js</code>文件中引入并执行他：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'./utils'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> vueLoaderConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./vue-loader.conf'</span>)</span><br><span class=\"line\"><span class=\"comment\">// 引入我们编写的脚本</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> detection = <span class=\"built_in\">require</span>(<span class=\"string\">'./detection'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 检测dll包可用性</span></span><br><span class=\"line\">detection()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span> (<span class=\"params\">dir</span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> createLintingRule = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>完后我们吧<code>cdn</code>下的文件删除一个</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034407.png\" alt=\"image-20190802114406691\"></p>\n<p>执行打包命令，查看是否会重新生成我们的静态文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn build</span><br><span class=\"line\"># or</span><br><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034736.png\" alt=\"image-20190802114735617\"></p>\n<p>可以看到，我们的检测脚本正常执行了 ，并且自动进行了<code>DLL</code>打包的过程，最后我们再查看下<code>dist</code>目录和<code>cdn</code>目录的情况：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034923.png\" alt=\"image-20190802114922878\"></p>\n<p>好了，有什么问题记得的留言😂😂😂</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg\" alt></p>\n<p><code>vue-cli</code>在项目打包时，对于依赖的第三方库，比如<code>vue、vuex、vue-router...</code>等这些不会修改的依赖，我们希望这些依赖单独进行打。这样做的好处是每次更改我本地代码的文件的时候，<code>webpack</code>只需要打包我项目本身的文件代码，而不会再去编译第三方库，打包速度会有质的提升。并且也有利于对这些非业务相关代码在客户端缓存的利用。</p>\n<p>因此为了实现这个问题，<code>DllPlugin</code> 和 <code>DllReferencePlugin</code>插件也就诞生了😬。</p>\n<p>不多哔哔，还是说说怎么用吧 (♥ω♥)~♪ </p>\n<h3 id=\"项目分析\"><a href=\"#项目分析\" class=\"headerlink\" title=\"项目分析\"></a>项目分析</h3><p>本文只阐述关于<code>vue-cli 2.x</code>版本，<code>3.x</code>对一些第三方库有相对路径引入，如果你依旧想使用<code>DLL</code>去切分包可以尝试一下<a href=\"https://github.com/fingerpan/vue-cli-plugin-dll\" target=\"_blank\" rel=\"noopener\">vue-cli-plugin-dll</a>这个工具。好了说下我们当前项目目录：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/082923.png\" alt=\"image-20190801162922915\"></p>\n<p>这是一个标准的<code>cli 2</code>创建的工程，下面我做个打包分析（因为我这个项目是真实项目可能比较大）。</p>\n<h4 id=\"添加analyzer\"><a href=\"#添加analyzer\" class=\"headerlink\" title=\"添加analyzer\"></a>添加analyzer</h4><p>修改package.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"DLL例子\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"npm run dev\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production node build/build.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"analyzer\"</span>: <span class=\"string\">\"npm run build --report\"</span> //=&gt; here</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>执行打包分析命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn analyzer</span><br><span class=\"line\"># or</span><br><span class=\"line\">npm run analyzer</span><br></pre></td></tr></table></figure>\n\n<p>打完包会自动打开一个窗口，就可以看到打包后每一块包含着什么，占比多少。下面看一下我打包后的分析图</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/084952.png\" alt=\"image-20190801164951855\"></p>\n<p>可以看出<code>vendor.js</code>打包后原始大小达到<code>2.17MB</code>，而这个包你每次迭代发布时后面的<code>chunkhash</code>都会变化。意味着客户端的缓存就没了，当再次打开我们的网站时这个<code>vendor.js</code>又会重新加载。</p>\n<p>说到这我们可以看下这个<code>vendor.js</code>到底包含了什么，为什么会这么大？</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085512.png\" alt=\"image-20190801165511594\"></p>\n<p>放大后我觉得不需要多解释了，<code>element-ui</code>、<code>vue</code>、<code>core</code>、<code>router</code>等等。。。</p>\n<p>下面我们利用<code>DLL</code>对他们单独进行打包：</p>\n<h3 id=\"配置DLL\"><a href=\"#配置DLL\" class=\"headerlink\" title=\"配置DLL\"></a>配置DLL</h3><h4 id=\"在配置中添加dll版块\"><a href=\"#在配置中添加dll版块\" class=\"headerlink\" title=\"在配置中添加dll版块\"></a>在配置中添加dll版块</h4><p>修改<code>/config/index.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    dev: &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dll: &#123;</span><br><span class=\"line\">        entry: &#123;</span><br><span class=\"line\">            <span class=\"string\">'vueVendor'</span>: [</span><br><span class=\"line\">                <span class=\"string\">'babel-polyfill'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vue/dist/vue.esm.js'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vue-router'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vuex'</span>,</span><br><span class=\"line\">                <span class=\"string\">'axios'</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            vendor: [</span><br><span class=\"line\">                <span class=\"string\">'@dal/element-ui'</span>,</span><br><span class=\"line\">                <span class=\"string\">'nprogress'</span>,</span><br><span class=\"line\">                <span class=\"string\">'viewerjs'</span>,</span><br><span class=\"line\">                <span class=\"string\">'v-viewer'</span>,</span><br><span class=\"line\">                <span class=\"string\">'vuex-persistedstate'</span>,</span><br><span class=\"line\">                <span class=\"string\">'qs'</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        outputPath: <span class=\"string\">'cdn'</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    build: &#123;</span><br><span class=\"line\">    \t...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>解释一下：</p>\n<ul>\n<li>首先对于我，我觉得有一部分第三方库是很久都不会变的，所以我将他们打包到<code>vueVendor</code></li>\n<li>对于一些可能发生变化的（这里的<code>element-ui</code>采用的事内部源，所以变化可能也很大）将他们打包到<code>vendor</code>，当然这两个名字你可以随便起，但是多文件有个坑最后说。</li>\n<li><code>outputPath</code>用作我们将来<code>DLL</code>包打包到哪里，我这里起名叫<code>cdn</code></li>\n<li>把配置写在这里是为了后续方便维护</li>\n</ul>\n<h4 id=\"创建Dll打包配置文件\"><a href=\"#创建Dll打包配置文件\" class=\"headerlink\" title=\"创建Dll打包配置文件\"></a>创建Dll打包配置文件</h4><p>在<code>build</code>文件夹下添加名为<code>webpack.dll.conf.js</code>的文件，内容为：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config/index'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: config.dll.entry, <span class=\"comment\">// 配置打包入口</span></span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.join(__dirname, <span class=\"string\">'..'</span>, config.dll.outputPath), <span class=\"comment\">// 配置打包输出目录</span></span><br><span class=\"line\">        filename: <span class=\"string\">'[name].[chunkhash].dll.js'</span>, <span class=\"comment\">// chunkhash是为了日后清理缓存</span></span><br><span class=\"line\">        library: <span class=\"string\">'[name]_library'</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.DllPlugin(&#123;</span><br><span class=\"line\">            path: path.join(__dirname, <span class=\"string\">'./[name]-manifest.json'</span>),</span><br><span class=\"line\">            name: <span class=\"string\">'[name]_library'</span>,</span><br><span class=\"line\">            context: __dirname <span class=\"comment\">// 这里的上下文要和我们后面用的DllReferencePlugin的上下文一致。 </span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.optimize.UglifyJsPlugin(&#123; <span class=\"comment\">// 丑化Js</span></span><br><span class=\"line\">            compress: &#123;</span><br><span class=\"line\">              warnings: <span class=\"literal\">false</span>,</span><br><span class=\"line\">              drop_console:<span class=\"literal\">true</span>,</span><br><span class=\"line\">              drop_debugger:<span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            output:&#123;</span><br><span class=\"line\">              comments: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            sourceMap: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建DLL打包脚本\"><a href=\"#创建DLL打包脚本\" class=\"headerlink\" title=\"创建DLL打包脚本\"></a>创建DLL打包脚本</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">'ora'</span>) <span class=\"comment\">// 一个执行动画，为了美观没啥</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> rm = <span class=\"built_in\">require</span>(<span class=\"string\">'rimraf'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">'chalk'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config/index'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> dllConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.dll.conf'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">'Start pre-operation...'</span>)</span><br><span class=\"line\">spinner.start()</span><br><span class=\"line\"></span><br><span class=\"line\">rm(path.join(__dirname, <span class=\"string\">'..'</span>, config.dll.outputPath), err =&gt; &#123; <span class=\"comment\">// 打包前清空cdn文件夹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err</span><br><span class=\"line\">    webpack(dllConfig, (err, stats) =&gt; &#123; <span class=\"comment\">// 执行打包</span></span><br><span class=\"line\">        spinner.stop()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err</span><br><span class=\"line\">        process.stdout.write(stats.toString(&#123; <span class=\"comment\">// 一些日志</span></span><br><span class=\"line\">            colors: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            modules: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            children: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            chunks: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            chunkModules: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;) + <span class=\"string\">'\\n\\n'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stats.hasErrors()) &#123; <span class=\"comment\">// 如果失败输出错误日志并退出进程</span></span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(chalk.red(<span class=\"string\">'  Build failed with errors.\\n'</span>))</span><br><span class=\"line\">            process.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.cyan(<span class=\"string\">'  Build complete.\\n'</span>))</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.yellow(<span class=\"string\">' Project decomposition is successful, enter startup status ...'</span>))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>到目前为止我们就能为这些第三方库做打包了<code>DLL</code>（dll打包和项目打包是分开的）</p>\n<h4 id=\"配置脚本，开始打包\"><a href=\"#配置脚本，开始打包\" class=\"headerlink\" title=\"配置脚本，开始打包\"></a>配置脚本，开始打包</h4><p>我们修改<code>package.json</code>中的<code>scripts</code>添加一条<code>DLL</code>打包的命令：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"DLL例子\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"npm run dev\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"cross-env NODE_ENV=production node build/build.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"analyzer\"</span>: <span class=\"string\">\"npm run build --report\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"dll\"</span>: <span class=\"string\">\"node build/dll.js\"</span> //=&gt; here</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>完后执行打包命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn dll</span><br><span class=\"line\"><span class=\"meta\">#</span> or</span><br><span class=\"line\">npm run dll</span><br></pre></td></tr></table></figure>\n\n<p>不出意外的话你的根目录会出现一个叫做<code>cdn</code>的文件夹（或者是你自己配置的文件夹名），同时<code>build</code>文件夹下也会多出两个<code>***-manifest.json</code>文件。上图看一下</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/031926.png\" alt=\"image-20190802111926063\"></p>\n<p>打包后的文件目录：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032708.png\" alt=\"image-20190802112708091\"></p>\n<p>好了，接下来我们只要告诉<code>webpack</code>遇到这些公共包的时候不进行打包，这也就是<code>***-manifest.json</code>文件的作用，下一步我们要配置<code>webpack.dev.conf.js</code>以及<code>webpack.prod.conf.js</code>文件</p>\n<h4 id=\"修改开发打包配置\"><a href=\"#修改开发打包配置\" class=\"headerlink\" title=\"修改开发打包配置\"></a>修改开发打包配置</h4><p>再此之前我们需要安装一个<code>webpack</code>插件，作用就是自动帮我们把<code>Dll</code>这块静态<code>js</code>文件自动引入到项目中。</p>\n<p>我们这里用到的是<a href=\"https://github.com/SimenB/add-asset-html-webpack-plugin\" target=\"_blank\" rel=\"noopener\">add-asset-html-webpack-plugin</a></p>\n<p>打开<code>/build/webpack.dev.conf.js</code>文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'./utils'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> baseWebpackConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.base.conf'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> FriendlyErrorsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'friendly-errors-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> portfinder = <span class=\"built_in\">require</span>(<span class=\"string\">'portfinder'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引入插件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> AddAssetHtmlPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'add-asset-html-webpack-plugin'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">    devServer: &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">            template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">            inject: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 在HtmlWebpackPlugin后面进行添加</span></span><br><span class=\"line\">        <span class=\"comment\">// 因为我们是多个dll文件，所以需要处理一下</span></span><br><span class=\"line\">        ...Object.keys(config.dll.entry).map(<span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">                context: __dirname,</span><br><span class=\"line\">                manifest: <span class=\"built_in\">require</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;name&#125;</span>-manifest.json`</span>),</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> AddAssetHtmlPlugin([&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 指定dll存放位置</span></span><br><span class=\"line\">            filepath: path.resolve(__dirname, <span class=\"string\">'..'</span>, <span class=\"string\">`<span class=\"subst\">$&#123;config.dll.outputPath&#125;</span>/*.dll.js`</span>),</span><br><span class=\"line\">            <span class=\"comment\">// 引入后并将dll文件自动移动到dist文件夹下</span></span><br><span class=\"line\">            outputPath: utils.assetsPath(config.dll.outputPath),</span><br><span class=\"line\">            <span class=\"comment\">// 指定引入静态路径前缀</span></span><br><span class=\"line\">            publicPath: path.posix.join(config.dev.assetsPublicPath, config.dev.assetsSubDirectory, config.dll.outputPath),</span><br><span class=\"line\">            includeSourcemap: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;])</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>好了，自此我们开发环境下就配置完成了。截下来我们说一下生产环境的打包修改：</p>\n<h4 id=\"修改生产打包配置\"><a href=\"#修改生产打包配置\" class=\"headerlink\" title=\"修改生产打包配置\"></a>修改生产打包配置</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'./utils'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> baseWebpackConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.base.conf'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'extract-text-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCSSPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> UglifyJsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'uglifyjs-webpack-plugin'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 引入插件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> AddAssetHtmlPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'add-asset-html-webpack-plugin'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 在HtmlWebpackPlugin后面进行添加</span></span><br><span class=\"line\">        <span class=\"comment\">// 因为我们是多个dll文件，所以需要处理一下</span></span><br><span class=\"line\">        ...Object.keys(config.dll.entry).map(<span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">                context: __dirname,</span><br><span class=\"line\">                manifest: <span class=\"built_in\">require</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;name&#125;</span>-manifest.json`</span>),</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"comment\">// 使用AddAssetHtmlPlugin插件将我们的dll文件自动引入到html模板中</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> AddAssetHtmlPlugin([&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 指定dll存放位置</span></span><br><span class=\"line\">            filepath: path.resolve(__dirname, <span class=\"string\">'..'</span>, <span class=\"string\">`<span class=\"subst\">$&#123;config.dll.outputPath&#125;</span>/*.dll.js`</span>),</span><br><span class=\"line\">            <span class=\"comment\">// 引入后并将dll文件自动移动到dist文件夹下</span></span><br><span class=\"line\">            outputPath: utils.assetsPath(config.dll.outputPath),</span><br><span class=\"line\">            <span class=\"comment\">// 指定引入静态路径前缀(这里我们使用了cdn服务器)</span></span><br><span class=\"line\">            publicPath: <span class=\"string\">`<span class=\"subst\">$&#123;config.build.assetsPublicPath&#125;</span><span class=\"subst\">$&#123;config.build.assetsSubDirectory&#125;</span>/<span class=\"subst\">$&#123;config.dll.outputPath&#125;</span>`</span>,</span><br><span class=\"line\">            includeSourcemap: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;]),</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = webpackConfig</span><br></pre></td></tr></table></figure>\n\n<p>到此为止，我们用<code>DLL</code>进行打包分割已经做完了，下面我们可以看下效果。</p>\n<h4 id=\"再次进行打包分析\"><a href=\"#再次进行打包分析\" class=\"headerlink\" title=\"再次进行打包分析\"></a>再次进行打包分析</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn analyzer</span><br><span class=\"line\"># or</span><br><span class=\"line\">npm run analyzer</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>DLL</code>包拆分后我们的<code>vendor.js</code>仅剩不到<code>80kb</code></p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111405.png\" alt=\"image-20190801191405068\"></p>\n<p>我们单独放大这块进行查看：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111511.png\" alt></p>\n<p>到目前为止我们的的包已经完美的分割开了，最后再查看下打包后的目录：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032222.png\" alt=\"image-20190802112222035\"></p>\n<p>可以看到<code>cdn</code>这个目录已经自动迁移到<code>/dist</code>目录下了，那这是怎么做到的呢？其实这个是<code>AddAssetHtmlPlugin</code>帮我们做了，也就是这句起作用了</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/025003.png\" alt=\"image-20190802105002776\"></p>\n<p>追后我们看下最终生成的<code>html</code>模板文件是什么样的：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032503.png\" alt=\"image-20190802112503021\"></p>\n<p>最后说明一个<strong>容易忽略</strong>的点：<code>DLL</code>多入口生成没有问题，但<code>AddAssetHtmlPlugin</code>引入你文件的顺序是按你打包后文件夹文件的倒叙方式引入的。当然只有在你打包的是多文件才会有这种问题。好了，接下来我们再把使用中其他细节问题拿出来聊一下</p>\n<h3 id=\"检测cdn目录完整\"><a href=\"#检测cdn目录完整\" class=\"headerlink\" title=\"检测cdn目录完整\"></a>检测<code>cdn</code>目录完整</h3><p>如果我们后期变动了<code>DLL</code>包中的任何一个，进行了重新<code>Dll</code>打包，那么可想而知<code>cdn</code>文件夹下的两个文件的<code>chunkhash</code>会变化，那么上传到仓库后，别的同事合并你的代码如果不注意可能<code>cdn</code>会存在新旧两个版本的文件，这样会导致项目存在风险。所以我们需要做一个工具，打包之前提前检测<code>cdn</code>目录下文件是否符合预期，如不符合我们应该前置进行<code>DLL</code>打包。同理我们还可以对<code>build</code>文件夹下的<code>***-manifest.json</code>映射文件进行简单的查验，不通过同样进行前置打包处理，下面我们看下具体如何实现。</p>\n<p>首先我们再<code>build</code>下创建名为<code>detection.js</code>的文件，内容如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">'chalk'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> process = <span class=\"built_in\">require</span>(<span class=\"string\">'child_process'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config/index'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 构建dll</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> execScript = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.yellow(<span class=\"string\">' DLL incomplete will be repackaged...'</span>))</span><br><span class=\"line\">        process.execSync(<span class=\"string\">'npm run dll'</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(chalk.red(<span class=\"string\">'  Build failed with errors.\\n'</span>))</span><br><span class=\"line\">        process.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(chalk.blue(<span class=\"string\">' Check DLL package integrity...'</span>));</span><br><span class=\"line\">    <span class=\"comment\">// 获取dll配置入口配置对象</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dlls = <span class=\"built_in\">Object</span>.keys(config.dll.entry)</span><br><span class=\"line\">    <span class=\"comment\">// 获取dll入口文件个数</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dllLength = dlls.length</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 读取cdn目录文件</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> files = fs.readdirSync(path.join(__dirname, <span class=\"string\">'..'</span>, <span class=\"string\">'cdn'</span>))</span><br><span class=\"line\">        <span class=\"comment\">// 读取当前目录文件</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> manifests = fs.readdirSync(__dirname)</span><br><span class=\"line\">        <span class=\"comment\">// 判断manifest映射文件是否存在</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> isManifests = manifests.filter(<span class=\"function\"><span class=\"params\">manifest</span> =&gt;</span> <span class=\"regexp\">/.json$/</span>.test(manifest)).every(<span class=\"function\"><span class=\"params\">manifest</span> =&gt;</span> dlls.some(<span class=\"function\"><span class=\"params\">dll</span> =&gt;</span> <span class=\"string\">`<span class=\"subst\">$&#123;dll&#125;</span>-manifest.json`</span> === manifest))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 如映射文件或文件数量不符则重新构建dll包</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isManifests &amp;&amp; files.length === dllLength) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">' Congratulations DLL package available'</span>))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            execScript()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        execScript()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>完后我们在<code>build/webpack.base.conf.js</code>文件中引入并执行他：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> utils = <span class=\"built_in\">require</span>(<span class=\"string\">'./utils'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(<span class=\"string\">'../config'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> vueLoaderConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./vue-loader.conf'</span>)</span><br><span class=\"line\"><span class=\"comment\">// 引入我们编写的脚本</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> detection = <span class=\"built_in\">require</span>(<span class=\"string\">'./detection'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 检测dll包可用性</span></span><br><span class=\"line\">detection()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span> (<span class=\"params\">dir</span>) </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> createLintingRule = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>完后我们吧<code>cdn</code>下的文件删除一个</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034407.png\" alt=\"image-20190802114406691\"></p>\n<p>执行打包命令，查看是否会重新生成我们的静态文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn build</span><br><span class=\"line\"># or</span><br><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034736.png\" alt=\"image-20190802114735617\"></p>\n<p>可以看到，我们的检测脚本正常执行了 ，并且自动进行了<code>DLL</code>打包的过程，最后我们再查看下<code>dist</code>目录和<code>cdn</code>目录的情况：</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034923.png\" alt=\"image-20190802114922878\"></p>\n<p>好了，有什么问题记得的留言😂😂😂</p>\n"},{"title":"react-native 生成二维码","date":"2019-07-30T08:36:31.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/093827.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/093827.jpg) \n\n\n\n对于二维码我们都并不陌生，`react-native`里面我推荐一个开源库[react-native-qrcode](https://github.com/cssivision/react-native-qrcode)去生成。当然，这里只简单的说一下功能的使用，源代码并不多，有兴趣的可以去看看。\n\n好了接下来我们就简单的看一下如何使用这个模块去实现生成二维码的功能:\n\n\n\n### 当前环境\n\n- OS: macOS High Sierra 10.13.5\n- Node: 8.11.3\n- Yarn: 1.7.0\n- npm: 5.6.0\n- Watchman: 4.9.0\n- Xcode: Xcode 9.4.1\n- react: 16.3.1 => 16.3.1\n- react-native: 0.55.4 => 0.55.4\n- react-native-qrcode: 0.2.6 => 0.2.6\n\n\n\n\n\n### 兼容性\n\n- 支持`ios`和`android`\n\n\n\n### 安装模块\n\n```shell\nyarn add react-native-splash-screen \n# or with yarn\nnpm install react-native-splash-screen -S\n```\n\n\n\n### 在项目中使用模块\n\n```javascript\nimport React, { Component } from 'react'\nimport { View, StyleSheet } from 'react-native'\nimport QRCode from 'react-native-qrcode'\n\nexport default class CreateQRCode extends Component{\n    render () {\n        return (\n            <View style={ styles.container }>\n                <QRCode\n                    value={ https://www.google.com }\n                    size={ 130 }\n                    bgColor=\"#000\"\n                    fgColor=\"#FFF\"\n                />\n            </View>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    container: {\n        width:  130,\n        height:  130\n    }\n})\n```\n\n\n\n### 示例结果\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/092753.png) \n\n## props参数说明\n\n\n| prop    | 类型               | 默认值                 |\n| ------- | ------------------ | ---------------------- |\n| value   | string             | https://www.google.com |\n| size    | number             | 128                    |\n| bgColor | string (CSS color) | \"#000\"                 |\n| fgColor | string (CSS color) | \"#FFF\"                 |\n\n\n\n**好了实现了，东西很简单，有兴趣的可以去读读源码。透露一下，内部是使用Canvas加WebView实现的，如果遇到什么小问题欢迎下方留言，Thanks♪(･ω･)ﾉ**\n\n","source":"_posts/react-native-生成二维码.md","raw":"---\ntitle: react-native 生成二维码\ndate: 2019-07-30 16:36:31\ntags: ReactNative\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/093827.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/093827.jpg) \n\n\n\n对于二维码我们都并不陌生，`react-native`里面我推荐一个开源库[react-native-qrcode](https://github.com/cssivision/react-native-qrcode)去生成。当然，这里只简单的说一下功能的使用，源代码并不多，有兴趣的可以去看看。\n\n好了接下来我们就简单的看一下如何使用这个模块去实现生成二维码的功能:\n\n\n\n### 当前环境\n\n- OS: macOS High Sierra 10.13.5\n- Node: 8.11.3\n- Yarn: 1.7.0\n- npm: 5.6.0\n- Watchman: 4.9.0\n- Xcode: Xcode 9.4.1\n- react: 16.3.1 => 16.3.1\n- react-native: 0.55.4 => 0.55.4\n- react-native-qrcode: 0.2.6 => 0.2.6\n\n\n\n\n\n### 兼容性\n\n- 支持`ios`和`android`\n\n\n\n### 安装模块\n\n```shell\nyarn add react-native-splash-screen \n# or with yarn\nnpm install react-native-splash-screen -S\n```\n\n\n\n### 在项目中使用模块\n\n```javascript\nimport React, { Component } from 'react'\nimport { View, StyleSheet } from 'react-native'\nimport QRCode from 'react-native-qrcode'\n\nexport default class CreateQRCode extends Component{\n    render () {\n        return (\n            <View style={ styles.container }>\n                <QRCode\n                    value={ https://www.google.com }\n                    size={ 130 }\n                    bgColor=\"#000\"\n                    fgColor=\"#FFF\"\n                />\n            </View>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    container: {\n        width:  130,\n        height:  130\n    }\n})\n```\n\n\n\n### 示例结果\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/092753.png) \n\n## props参数说明\n\n\n| prop    | 类型               | 默认值                 |\n| ------- | ------------------ | ---------------------- |\n| value   | string             | https://www.google.com |\n| size    | number             | 128                    |\n| bgColor | string (CSS color) | \"#000\"                 |\n| fgColor | string (CSS color) | \"#FFF\"                 |\n\n\n\n**好了实现了，东西很简单，有兴趣的可以去读读源码。透露一下，内部是使用Canvas加WebView实现的，如果遇到什么小问题欢迎下方留言，Thanks♪(･ω･)ﾉ**\n\n","slug":"react-native-生成二维码","published":1,"updated":"2019-07-30T11:37:02.801Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjysbhubz000iqbt5efukinnv","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/093827.jpg\" alt> </p>\n<p>对于二维码我们都并不陌生，<code>react-native</code>里面我推荐一个开源库<a href=\"https://github.com/cssivision/react-native-qrcode\" target=\"_blank\" rel=\"noopener\">react-native-qrcode</a>去生成。当然，这里只简单的说一下功能的使用，源代码并不多，有兴趣的可以去看看。</p>\n<p>好了接下来我们就简单的看一下如何使用这个模块去实现生成二维码的功能:</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-qrcode: 0.2.6 =&gt; 0.2.6</li>\n</ul>\n<h3 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h3><ul>\n<li>支持<code>ios</code>和<code>android</code></li>\n</ul>\n<h3 id=\"安装模块\"><a href=\"#安装模块\" class=\"headerlink\" title=\"安装模块\"></a>安装模块</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add react-native-splash-screen </span><br><span class=\"line\"><span class=\"meta\">#</span> or with yarn</span><br><span class=\"line\">npm install react-native-splash-screen -S</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在项目中使用模块\"><a href=\"#在项目中使用模块\" class=\"headerlink\" title=\"在项目中使用模块\"></a>在项目中使用模块</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; View, StyleSheet &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-native'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> QRCode <span class=\"keyword\">from</span> <span class=\"string\">'react-native-qrcode'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CreateQRCode</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span></span>&#123;</span><br><span class=\"line\">    render () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            &lt;View style=&#123; styles.container &#125;&gt;</span><br><span class=\"line\">                &lt;QRCode</span><br><span class=\"line\">                    value=&#123; <span class=\"attr\">https</span>:<span class=\"comment\">//www.google.com &#125;</span></span><br><span class=\"line\">                    size=&#123; <span class=\"number\">130</span> &#125;</span><br><span class=\"line\">                    bgColor=<span class=\"string\">\"#000\"</span></span><br><span class=\"line\">                    fgColor=<span class=\"string\">\"#FFF\"</span></span><br><span class=\"line\">                /&gt;</span><br><span class=\"line\">            &lt;<span class=\"regexp\">/View&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        )</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">const styles = StyleSheet.create(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    container: &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        width:  130,</span></span><br><span class=\"line\"><span class=\"regexp\">        height:  130</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"示例结果\"><a href=\"#示例结果\" class=\"headerlink\" title=\"示例结果\"></a>示例结果</h3><p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/092753.png\" alt> </p>\n<h2 id=\"props参数说明\"><a href=\"#props参数说明\" class=\"headerlink\" title=\"props参数说明\"></a>props参数说明</h2><table>\n<thead>\n<tr>\n<th>prop</th>\n<th>类型</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>value</td>\n<td>string</td>\n<td><a href=\"https://www.google.com\" target=\"_blank\" rel=\"noopener\">https://www.google.com</a></td>\n</tr>\n<tr>\n<td>size</td>\n<td>number</td>\n<td>128</td>\n</tr>\n<tr>\n<td>bgColor</td>\n<td>string (CSS color)</td>\n<td>“#000”</td>\n</tr>\n<tr>\n<td>fgColor</td>\n<td>string (CSS color)</td>\n<td>“#FFF”</td>\n</tr>\n</tbody></table>\n<p><strong>好了实现了，东西很简单，有兴趣的可以去读读源码。透露一下，内部是使用Canvas加WebView实现的，如果遇到什么小问题欢迎下方留言，Thanks♪(･ω･)ﾉ</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/093827.jpg\" alt> </p>\n<p>对于二维码我们都并不陌生，<code>react-native</code>里面我推荐一个开源库<a href=\"https://github.com/cssivision/react-native-qrcode\" target=\"_blank\" rel=\"noopener\">react-native-qrcode</a>去生成。当然，这里只简单的说一下功能的使用，源代码并不多，有兴趣的可以去看看。</p>\n<p>好了接下来我们就简单的看一下如何使用这个模块去实现生成二维码的功能:</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-qrcode: 0.2.6 =&gt; 0.2.6</li>\n</ul>\n<h3 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h3><ul>\n<li>支持<code>ios</code>和<code>android</code></li>\n</ul>\n<h3 id=\"安装模块\"><a href=\"#安装模块\" class=\"headerlink\" title=\"安装模块\"></a>安装模块</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add react-native-splash-screen </span><br><span class=\"line\"><span class=\"meta\">#</span> or with yarn</span><br><span class=\"line\">npm install react-native-splash-screen -S</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在项目中使用模块\"><a href=\"#在项目中使用模块\" class=\"headerlink\" title=\"在项目中使用模块\"></a>在项目中使用模块</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; View, StyleSheet &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-native'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> QRCode <span class=\"keyword\">from</span> <span class=\"string\">'react-native-qrcode'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CreateQRCode</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span></span>&#123;</span><br><span class=\"line\">    render () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            &lt;View style=&#123; styles.container &#125;&gt;</span><br><span class=\"line\">                &lt;QRCode</span><br><span class=\"line\">                    value=&#123; <span class=\"attr\">https</span>:<span class=\"comment\">//www.google.com &#125;</span></span><br><span class=\"line\">                    size=&#123; <span class=\"number\">130</span> &#125;</span><br><span class=\"line\">                    bgColor=<span class=\"string\">\"#000\"</span></span><br><span class=\"line\">                    fgColor=<span class=\"string\">\"#FFF\"</span></span><br><span class=\"line\">                /&gt;</span><br><span class=\"line\">            &lt;<span class=\"regexp\">/View&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        )</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">const styles = StyleSheet.create(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    container: &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        width:  130,</span></span><br><span class=\"line\"><span class=\"regexp\">        height:  130</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"示例结果\"><a href=\"#示例结果\" class=\"headerlink\" title=\"示例结果\"></a>示例结果</h3><p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/092753.png\" alt> </p>\n<h2 id=\"props参数说明\"><a href=\"#props参数说明\" class=\"headerlink\" title=\"props参数说明\"></a>props参数说明</h2><table>\n<thead>\n<tr>\n<th>prop</th>\n<th>类型</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>value</td>\n<td>string</td>\n<td><a href=\"https://www.google.com\" target=\"_blank\" rel=\"noopener\">https://www.google.com</a></td>\n</tr>\n<tr>\n<td>size</td>\n<td>number</td>\n<td>128</td>\n</tr>\n<tr>\n<td>bgColor</td>\n<td>string (CSS color)</td>\n<td>“#000”</td>\n</tr>\n<tr>\n<td>fgColor</td>\n<td>string (CSS color)</td>\n<td>“#FFF”</td>\n</tr>\n</tbody></table>\n<p><strong>好了实现了，东西很简单，有兴趣的可以去读读源码。透露一下，内部是使用Canvas加WebView实现的，如果遇到什么小问题欢迎下方留言，Thanks♪(･ω･)ﾉ</strong></p>\n"},{"title":"react-native 获取设备imei","date":"2019-07-30T08:36:49.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132622.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132622.jpg)\n\n\n\n项目开发中需要获取设备的`IMEI`，所以整理了一下写出这篇文档，项目使用的是[react-native-imei](https://github.com/SimenCodes/react-native-imei)。但需要注意的是，`Ios`做不了的😿\n\n\n\n### 当前环境\n\n- OS: macOS High Sierra 10.13.5\n- Node: 8.11.3\n- Yarn: 1.7.0\n- npm: 5.6.0\n- Watchman: 4.9.0\n- Xcode: Xcode 9.4.1\n- react: 16.3.1 => 16.3.1\n- react-native: 0.55.4 => 0.55.4\n- react-native-imei: 0.1.1 => 0.1.1\n\n\n\n### 前置说明\n\n- `IOS7`以后不能获取手机`IMEI`\n- `Android`个别情况下无法获得`IMEI`\n\n\n\n### 获取android设备IMEI\n\n#### 安装\n\n```shell\nnpm install react-native-imei --save\n# or with yarn\nyarn add react-native-imei\n```\n\n\n\n#### 自动配置\n\n```shell\nreact-native link react-native-imei\n```\n\n\n\n#### 手动配置\n\n1. 在项目路径`{project}/android/`下找到`settings.gradle`文件，添加一下内容\n\n```java\n...\n  \ninclude ':react-native-imei'\n\nproject(':react-native-imei').projectDir =  new  File(rootProject.projectDir, '../node_modules/react-native-imei/android')\n  \n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132707.png) \n\n\n\n2. 在项目路径`{project}/android/app/`下找到`build.gradle`文件，添加一下内容\n\n```java\n...\n\ndependencies {\n  \n    compile project(':react-native-imei')    //-> here\n    ...\n}\n\n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132713.png) \n\n\n\n3. 在项目路径`{project}/android/app/src/main/java/com/app/`下找到`MainApplication.java`文件，添加一下内容\n\n```java\n...\n  \npublic class MainApplication extends Application implements ReactApplication  {\n    private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {\n        ...\n\n        @Override\n        protected List<ReactPackage> getPackages()  {\n            return Arrays.<ReactPackage>asList(\n                new MainReactPackage(),\n                new IMEI() //-> here\n            );\n        }\n    }\n};\n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132721.png) \n\n\n\n### 在项目中使用\n\n1. 在项目中引入`react-native-imei`\n\n```javascript\nimport  IMEI  from  'react-native-imei'\n```\n\n2. 通过`IMEI.getImei()`方法获取当前设备IMEI\n\n```javascript\ncomponentDidMount () {\n    const imei = Platform.OS === 'android' ? IMEI.getImei() || 'android' : 'ios'\n    console.log(imei)\n}\n```\n\n3. 由于ios设备不支持IMEI所以我们直接写入`ios`字符串去辨别设备类型，当然你也可以定义其他的方式去做，都可以\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132726.png) \n\n\n\n**如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)**","source":"_posts/react-native-获取设备imei.md","raw":"---\ntitle: react-native 获取设备imei\ndate: 2019-07-30 16:36:49\ntags: ReactNative\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132622.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132622.jpg)\n\n\n\n项目开发中需要获取设备的`IMEI`，所以整理了一下写出这篇文档，项目使用的是[react-native-imei](https://github.com/SimenCodes/react-native-imei)。但需要注意的是，`Ios`做不了的😿\n\n\n\n### 当前环境\n\n- OS: macOS High Sierra 10.13.5\n- Node: 8.11.3\n- Yarn: 1.7.0\n- npm: 5.6.0\n- Watchman: 4.9.0\n- Xcode: Xcode 9.4.1\n- react: 16.3.1 => 16.3.1\n- react-native: 0.55.4 => 0.55.4\n- react-native-imei: 0.1.1 => 0.1.1\n\n\n\n### 前置说明\n\n- `IOS7`以后不能获取手机`IMEI`\n- `Android`个别情况下无法获得`IMEI`\n\n\n\n### 获取android设备IMEI\n\n#### 安装\n\n```shell\nnpm install react-native-imei --save\n# or with yarn\nyarn add react-native-imei\n```\n\n\n\n#### 自动配置\n\n```shell\nreact-native link react-native-imei\n```\n\n\n\n#### 手动配置\n\n1. 在项目路径`{project}/android/`下找到`settings.gradle`文件，添加一下内容\n\n```java\n...\n  \ninclude ':react-native-imei'\n\nproject(':react-native-imei').projectDir =  new  File(rootProject.projectDir, '../node_modules/react-native-imei/android')\n  \n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132707.png) \n\n\n\n2. 在项目路径`{project}/android/app/`下找到`build.gradle`文件，添加一下内容\n\n```java\n...\n\ndependencies {\n  \n    compile project(':react-native-imei')    //-> here\n    ...\n}\n\n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132713.png) \n\n\n\n3. 在项目路径`{project}/android/app/src/main/java/com/app/`下找到`MainApplication.java`文件，添加一下内容\n\n```java\n...\n  \npublic class MainApplication extends Application implements ReactApplication  {\n    private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {\n        ...\n\n        @Override\n        protected List<ReactPackage> getPackages()  {\n            return Arrays.<ReactPackage>asList(\n                new MainReactPackage(),\n                new IMEI() //-> here\n            );\n        }\n    }\n};\n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132721.png) \n\n\n\n### 在项目中使用\n\n1. 在项目中引入`react-native-imei`\n\n```javascript\nimport  IMEI  from  'react-native-imei'\n```\n\n2. 通过`IMEI.getImei()`方法获取当前设备IMEI\n\n```javascript\ncomponentDidMount () {\n    const imei = Platform.OS === 'android' ? IMEI.getImei() || 'android' : 'ios'\n    console.log(imei)\n}\n```\n\n3. 由于ios设备不支持IMEI所以我们直接写入`ios`字符串去辨别设备类型，当然你也可以定义其他的方式去做，都可以\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132726.png) \n\n\n\n**如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)**","slug":"react-native-获取设备imei","published":1,"updated":"2019-07-30T13:36:52.533Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjysbhuc3000kqbt5sskpmkdo","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132622.jpg\" alt></p>\n<p>项目开发中需要获取设备的<code>IMEI</code>，所以整理了一下写出这篇文档，项目使用的是<a href=\"https://github.com/SimenCodes/react-native-imei\" target=\"_blank\" rel=\"noopener\">react-native-imei</a>。但需要注意的是，<code>Ios</code>做不了的😿</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-imei: 0.1.1 =&gt; 0.1.1</li>\n</ul>\n<h3 id=\"前置说明\"><a href=\"#前置说明\" class=\"headerlink\" title=\"前置说明\"></a>前置说明</h3><ul>\n<li><code>IOS7</code>以后不能获取手机<code>IMEI</code></li>\n<li><code>Android</code>个别情况下无法获得<code>IMEI</code></li>\n</ul>\n<h3 id=\"获取android设备IMEI\"><a href=\"#获取android设备IMEI\" class=\"headerlink\" title=\"获取android设备IMEI\"></a>获取android设备IMEI</h3><h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install react-native-imei --save</span><br><span class=\"line\"><span class=\"meta\">#</span> or with yarn</span><br><span class=\"line\">yarn add react-native-imei</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自动配置\"><a href=\"#自动配置\" class=\"headerlink\" title=\"自动配置\"></a>自动配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">react-native link react-native-imei</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"手动配置\"><a href=\"#手动配置\" class=\"headerlink\" title=\"手动配置\"></a>手动配置</h4><ol>\n<li>在项目路径<code>{project}/android/</code>下找到<code>settings.gradle</code>文件，添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">include <span class=\"string\">':react-native-imei'</span></span><br><span class=\"line\"></span><br><span class=\"line\">project(<span class=\"string\">':react-native-imei'</span>).projectDir =  <span class=\"keyword\">new</span>  File(rootProject.projectDir, <span class=\"string\">'../node_modules/react-native-imei/android'</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132707.png\" alt> </p>\n<ol start=\"2\">\n<li>在项目路径<code>{project}/android/app/</code>下找到<code>build.gradle</code>文件，添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\">compile <span class=\"title\">project</span><span class=\"params\">(<span class=\"string\">':react-native-imei'</span>)</span>    <span class=\"comment\">//-&gt; here</span></span></span><br><span class=\"line\"><span class=\"function\">    ...</span></span><br><span class=\"line\"><span class=\"function\">&#125;</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">...</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132713.png\" alt> </p>\n<ol start=\"3\">\n<li>在项目路径<code>{project}/android/app/src/main/java/com/app/</code>下找到<code>MainApplication.java</code>文件，添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainApplication</span> <span class=\"keyword\">extends</span> <span class=\"title\">Application</span> <span class=\"keyword\">implements</span> <span class=\"title\">ReactApplication</span>  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReactNativeHost mReactNativeHost = <span class=\"keyword\">new</span> ReactNativeHost(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> List&lt;ReactPackage&gt; <span class=\"title\">getPackages</span><span class=\"params\">()</span>  </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> MainReactPackage(),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> IMEI() <span class=\"comment\">//-&gt; here</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132721.png\" alt> </p>\n<h3 id=\"在项目中使用\"><a href=\"#在项目中使用\" class=\"headerlink\" title=\"在项目中使用\"></a>在项目中使用</h3><ol>\n<li>在项目中引入<code>react-native-imei</code></li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span>  IMEI  <span class=\"keyword\">from</span>  <span class=\"string\">'react-native-imei'</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>通过<code>IMEI.getImei()</code>方法获取当前设备IMEI</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidMount () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imei = Platform.OS === <span class=\"string\">'android'</span> ? IMEI.getImei() || <span class=\"string\">'android'</span> : <span class=\"string\">'ios'</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(imei)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>由于ios设备不支持IMEI所以我们直接写入<code>ios</code>字符串去辨别设备类型，当然你也可以定义其他的方式去做，都可以</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132726.png\" alt> </p>\n<p><strong>如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132622.jpg\" alt></p>\n<p>项目开发中需要获取设备的<code>IMEI</code>，所以整理了一下写出这篇文档，项目使用的是<a href=\"https://github.com/SimenCodes/react-native-imei\" target=\"_blank\" rel=\"noopener\">react-native-imei</a>。但需要注意的是，<code>Ios</code>做不了的😿</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-imei: 0.1.1 =&gt; 0.1.1</li>\n</ul>\n<h3 id=\"前置说明\"><a href=\"#前置说明\" class=\"headerlink\" title=\"前置说明\"></a>前置说明</h3><ul>\n<li><code>IOS7</code>以后不能获取手机<code>IMEI</code></li>\n<li><code>Android</code>个别情况下无法获得<code>IMEI</code></li>\n</ul>\n<h3 id=\"获取android设备IMEI\"><a href=\"#获取android设备IMEI\" class=\"headerlink\" title=\"获取android设备IMEI\"></a>获取android设备IMEI</h3><h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install react-native-imei --save</span><br><span class=\"line\"><span class=\"meta\">#</span> or with yarn</span><br><span class=\"line\">yarn add react-native-imei</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自动配置\"><a href=\"#自动配置\" class=\"headerlink\" title=\"自动配置\"></a>自动配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">react-native link react-native-imei</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"手动配置\"><a href=\"#手动配置\" class=\"headerlink\" title=\"手动配置\"></a>手动配置</h4><ol>\n<li>在项目路径<code>{project}/android/</code>下找到<code>settings.gradle</code>文件，添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">include <span class=\"string\">':react-native-imei'</span></span><br><span class=\"line\"></span><br><span class=\"line\">project(<span class=\"string\">':react-native-imei'</span>).projectDir =  <span class=\"keyword\">new</span>  File(rootProject.projectDir, <span class=\"string\">'../node_modules/react-native-imei/android'</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132707.png\" alt> </p>\n<ol start=\"2\">\n<li>在项目路径<code>{project}/android/app/</code>下找到<code>build.gradle</code>文件，添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\">compile <span class=\"title\">project</span><span class=\"params\">(<span class=\"string\">':react-native-imei'</span>)</span>    <span class=\"comment\">//-&gt; here</span></span></span><br><span class=\"line\"><span class=\"function\">    ...</span></span><br><span class=\"line\"><span class=\"function\">&#125;</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">...</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132713.png\" alt> </p>\n<ol start=\"3\">\n<li>在项目路径<code>{project}/android/app/src/main/java/com/app/</code>下找到<code>MainApplication.java</code>文件，添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainApplication</span> <span class=\"keyword\">extends</span> <span class=\"title\">Application</span> <span class=\"keyword\">implements</span> <span class=\"title\">ReactApplication</span>  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReactNativeHost mReactNativeHost = <span class=\"keyword\">new</span> ReactNativeHost(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> List&lt;ReactPackage&gt; <span class=\"title\">getPackages</span><span class=\"params\">()</span>  </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> MainReactPackage(),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> IMEI() <span class=\"comment\">//-&gt; here</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132721.png\" alt> </p>\n<h3 id=\"在项目中使用\"><a href=\"#在项目中使用\" class=\"headerlink\" title=\"在项目中使用\"></a>在项目中使用</h3><ol>\n<li>在项目中引入<code>react-native-imei</code></li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span>  IMEI  <span class=\"keyword\">from</span>  <span class=\"string\">'react-native-imei'</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>通过<code>IMEI.getImei()</code>方法获取当前设备IMEI</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidMount () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imei = Platform.OS === <span class=\"string\">'android'</span> ? IMEI.getImei() || <span class=\"string\">'android'</span> : <span class=\"string\">'ios'</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(imei)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>由于ios设备不支持IMEI所以我们直接写入<code>ios</code>字符串去辨别设备类型，当然你也可以定义其他的方式去做，都可以</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/132726.png\" alt> </p>\n<p><strong>如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)</strong></p>\n"},{"title":"react-native 配置启动图（闪屏图）支持ios和android","date":"2019-07-30T08:37:05.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/120857.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/120857.jpg)\n\n\n\n配置启动图我使用的是第三方模块`react-native-splash-screen`,更加详细的请到 [github地址](https://github.com/crazycodeboy/react-native-splash-screen)进一步查看，我们这里提供基本的配置以及个别问题的解决方案\n\n\n\n### 当前环境\n\n*   OS: macOS High Sierra 10.13.5\n*   Node: 8.11.3\n*   Yarn: 1.7.0\n*   npm: 5.6.0\n*   Watchman: 4.9.0\n*   Xcode: Xcode 9.4.1\n*   react: 16.3.1 => 16.3.1\n*   react-native: 0.55.4 => 0.55.4\n*   react-native-splash-screen: 3.1.0 => 3.1.0\n\n\n\n### 安装第三方模块\n\n```shell\nyarn add react-native-splash-screen\n# or\nnpm install react-native-splash-screen -S\n```\n\n\n### 自动配置\n\n```\nreact-native link react-native-splash-screen\n# or\nrnpm link react-native-splash-screen\n```\n\n\n\n### 手动配置\n\n`如果自动配置不成功，则需要手动一步步配置，配置不难，其实也是很快捷方便的`\n\n#### Ios配置\n\n1. 用Xcode打开项目, 找到`Libraries`目录，右键选择 `Add Files to [your project's name]`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125749.png) \n\n2. 在`{project}/node_modules/react-native-splash-screen/ios`找到`SplashScreen.xcodeproj`文件，并添加\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125755.png) \n\n3. 在XCode中，选择你的项目， 选择`bilid Phases`并将`SplashScreen.xcodeproj/Products/libSplashScreen.a`文件添加到`Link Binary With Libraries`中,拖过去即可\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125758.png) \n\n4. 添加搜索路径：在项目 → Build Settings → Search Paths → Header Search Paths处添加一项为`$(SRCROOT)/../node_modules/react-native-splash-screen/ios`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125804.png) \n\n\n\n#### Android配置\n\n1. 在项目目录`{prject}/android/`下找到`settings.gradle`文件添加一下内容\n\n```java\n...\n\ninclude ':react-native-splash-screen'   \nproject(':react-native-splash-screen').projectDir = new File(rootProject.projectDir, '../node_modules/react-native-splash-screen/android')\n\n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125809.png) \n\n2. 在项目目录`{prject}/android/app/`下找到`build.gradle`文件添加`compile project(':react-native-splash-screen')`\n\n\n```java\n...\n  \ndependencies {\n    ...\n    compile project(':react-native-splash-screen')\n}\n\n...\n```\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125817.png) \n\n3. 找到项目目录`{project}/android/app/src/main/java/com/app/`下`MainApplication.java`文件，引入`import org.devio.rn.splashscreen.SplashScreenReactPackage;`并添加`new SplashScreenReactPackage()`\n\n\n```java\n...\n    \nimport org.devio.rn.splashscreen.SplashScreenReactPackage;\n\npublic class MainApplication extends Application implements ReactApplication {\n    private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {\n        ...\n        @Override\n        protected List<ReactPackage> getPackages() {\n            return Arrays.<ReactPackage>asList(\n                new SplashScreenReactPackage()  //here\n            );\n        }\n        ...\n    };\n}\n\n...\n```\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125823.png) \n\n\n\n### 启动图相关配置\n\n#### 配置Ios启动图\n\n1. 找到项目目录`{project}/ios/{project}/`下`AppDelegate.m`文件，引入`#import  \"SplashScreen.h\"`添加内容如下\n\n```c++\n...\n\n#import  \"SplashScreen.h\"    // here\n\n...\n\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions\n{\n    ...\n    [SplashScreen show];    // here\n    ...\n    return YES;\n}\n\n@end\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125830.png) \n\n2. 在XCode中, 点击`App/Images.xcassrts`通过`LaunchImage`添加启动图片\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125835.png) \n\n3. 在XCode中，选择你的项目， 选择`General`找到`App Icons and Launch Images`下的`Launch Images Sourc`选择你设置好的`LaunchImage`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125840.png) \n\n4. 如出现错误`# unknown receiver 'SplashScreen'; did you mean 'RNSplashScreen'`, 则改动源码以及`AppDelegate.m`文件如下\n\n5. 源码改动: 找到`{project}/node_modules/react-native-splash-screen/ios`文件夹下的`RNSplashScreen.m`文件，将其`[SplashScreen show];`修改为`[RNSplashScreen show];`,如下图\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125846.png) \n\n6. `AppDelegate.m`文件改动: 找到项目目录`{project}/ios/{project}/`下`AppDelegate.m`文件，将所有`SplashScreen`改为`RNSplashScreen`即可，如下图\n\n​\t\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/130203.png) \n\n\n\n7. 重启尝试是否有其他问题，修改源码地址可查看我的[Github](https://github.com/AaronBank/react-native-splash-screen)项目地址，更多问题请查看官方[issues](https://github.com/crazycodeboy/react-native-splash-screen/issues)\n\n\n\n#### 配置Android启动图\n\n1. 在项目目录`{prject}/android/app/src/main/res/`下创建`layout`文件夹\n\n2. 在`layout`文件夹下创建`launch_screen.xml`添加一下内容\n\n```XML\n<xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"@drawable/launch_screen\"\n>\n</LinearLayout>\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125849.png) \n\n3. 将你的启动图改名为`launch_screen.png`并添加到`{prject}/android/app/src/main/res/`文件夹下相应的`drawable`文件夹中（根据需求配置相应大小的文件夹）\n\n- `drawable-ldpi`\n- `drawable-mdpi`\n- `drawable-hdpi`\n- `drawable-xhdpi`\n- `drawable-xxhdpi`\n- `drawable-xxxhdpi`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125851.png) \n\n4. 在`{prject}/android/app/src/main/res/values/`文件夹下修改名为添加一个名为`primary_dark`的属性并设置其颜，添加内容如下\n\n```xml\n...\n<color name=\"primary_dark\">#000000</color>\n...\n```\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125857.png) \n\n5. 如果您希望启动屏幕透明，打开`{prject}/android/app/src/main/res/values/styles.xml`并添加`<item name=\"android:windowIsTranslucent\">trueitem>`到文件中\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125900.png) \n\n\n\n### 在项目中关闭启动图\n\n\n> 配置完毕之后重启你的app发现启动图已经展现出来了但是迟迟没有关闭\n> 我们需要在项目中进行控制，将他在合适的时候进行关闭，方法如下：\n\n1. 首先引入进行模块`import SplashScreen from 'react-native-splash-screen'`\n\n2. 使用`SplashScreen.hide()`方法将其关闭\n\n```javascript\nimport SplashScreen from 'react-native-splash-screen'\n\nexport default class App extends Component {\n    componentDidMount() {\n        // do stuff while splash screen is shown\n        // After having done stuff (such as async tasks) hide the splash screen\n        SplashScreen.hide();\n    }\n}\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125904.png) \n\n\n\n**如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)**","source":"_posts/react-native-配置启动图（闪屏图）支持ios和android.md","raw":"---\ntitle: react-native 配置启动图（闪屏图）支持ios和android\ndate: 2019-07-30 16:37:05\ntags: ReactNative\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/120857.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/120857.jpg)\n\n\n\n配置启动图我使用的是第三方模块`react-native-splash-screen`,更加详细的请到 [github地址](https://github.com/crazycodeboy/react-native-splash-screen)进一步查看，我们这里提供基本的配置以及个别问题的解决方案\n\n\n\n### 当前环境\n\n*   OS: macOS High Sierra 10.13.5\n*   Node: 8.11.3\n*   Yarn: 1.7.0\n*   npm: 5.6.0\n*   Watchman: 4.9.0\n*   Xcode: Xcode 9.4.1\n*   react: 16.3.1 => 16.3.1\n*   react-native: 0.55.4 => 0.55.4\n*   react-native-splash-screen: 3.1.0 => 3.1.0\n\n\n\n### 安装第三方模块\n\n```shell\nyarn add react-native-splash-screen\n# or\nnpm install react-native-splash-screen -S\n```\n\n\n### 自动配置\n\n```\nreact-native link react-native-splash-screen\n# or\nrnpm link react-native-splash-screen\n```\n\n\n\n### 手动配置\n\n`如果自动配置不成功，则需要手动一步步配置，配置不难，其实也是很快捷方便的`\n\n#### Ios配置\n\n1. 用Xcode打开项目, 找到`Libraries`目录，右键选择 `Add Files to [your project's name]`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125749.png) \n\n2. 在`{project}/node_modules/react-native-splash-screen/ios`找到`SplashScreen.xcodeproj`文件，并添加\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125755.png) \n\n3. 在XCode中，选择你的项目， 选择`bilid Phases`并将`SplashScreen.xcodeproj/Products/libSplashScreen.a`文件添加到`Link Binary With Libraries`中,拖过去即可\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125758.png) \n\n4. 添加搜索路径：在项目 → Build Settings → Search Paths → Header Search Paths处添加一项为`$(SRCROOT)/../node_modules/react-native-splash-screen/ios`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125804.png) \n\n\n\n#### Android配置\n\n1. 在项目目录`{prject}/android/`下找到`settings.gradle`文件添加一下内容\n\n```java\n...\n\ninclude ':react-native-splash-screen'   \nproject(':react-native-splash-screen').projectDir = new File(rootProject.projectDir, '../node_modules/react-native-splash-screen/android')\n\n...\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125809.png) \n\n2. 在项目目录`{prject}/android/app/`下找到`build.gradle`文件添加`compile project(':react-native-splash-screen')`\n\n\n```java\n...\n  \ndependencies {\n    ...\n    compile project(':react-native-splash-screen')\n}\n\n...\n```\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125817.png) \n\n3. 找到项目目录`{project}/android/app/src/main/java/com/app/`下`MainApplication.java`文件，引入`import org.devio.rn.splashscreen.SplashScreenReactPackage;`并添加`new SplashScreenReactPackage()`\n\n\n```java\n...\n    \nimport org.devio.rn.splashscreen.SplashScreenReactPackage;\n\npublic class MainApplication extends Application implements ReactApplication {\n    private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {\n        ...\n        @Override\n        protected List<ReactPackage> getPackages() {\n            return Arrays.<ReactPackage>asList(\n                new SplashScreenReactPackage()  //here\n            );\n        }\n        ...\n    };\n}\n\n...\n```\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125823.png) \n\n\n\n### 启动图相关配置\n\n#### 配置Ios启动图\n\n1. 找到项目目录`{project}/ios/{project}/`下`AppDelegate.m`文件，引入`#import  \"SplashScreen.h\"`添加内容如下\n\n```c++\n...\n\n#import  \"SplashScreen.h\"    // here\n\n...\n\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions\n{\n    ...\n    [SplashScreen show];    // here\n    ...\n    return YES;\n}\n\n@end\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125830.png) \n\n2. 在XCode中, 点击`App/Images.xcassrts`通过`LaunchImage`添加启动图片\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125835.png) \n\n3. 在XCode中，选择你的项目， 选择`General`找到`App Icons and Launch Images`下的`Launch Images Sourc`选择你设置好的`LaunchImage`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125840.png) \n\n4. 如出现错误`# unknown receiver 'SplashScreen'; did you mean 'RNSplashScreen'`, 则改动源码以及`AppDelegate.m`文件如下\n\n5. 源码改动: 找到`{project}/node_modules/react-native-splash-screen/ios`文件夹下的`RNSplashScreen.m`文件，将其`[SplashScreen show];`修改为`[RNSplashScreen show];`,如下图\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125846.png) \n\n6. `AppDelegate.m`文件改动: 找到项目目录`{project}/ios/{project}/`下`AppDelegate.m`文件，将所有`SplashScreen`改为`RNSplashScreen`即可，如下图\n\n​\t\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/130203.png) \n\n\n\n7. 重启尝试是否有其他问题，修改源码地址可查看我的[Github](https://github.com/AaronBank/react-native-splash-screen)项目地址，更多问题请查看官方[issues](https://github.com/crazycodeboy/react-native-splash-screen/issues)\n\n\n\n#### 配置Android启动图\n\n1. 在项目目录`{prject}/android/app/src/main/res/`下创建`layout`文件夹\n\n2. 在`layout`文件夹下创建`launch_screen.xml`添加一下内容\n\n```XML\n<xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"@drawable/launch_screen\"\n>\n</LinearLayout>\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125849.png) \n\n3. 将你的启动图改名为`launch_screen.png`并添加到`{prject}/android/app/src/main/res/`文件夹下相应的`drawable`文件夹中（根据需求配置相应大小的文件夹）\n\n- `drawable-ldpi`\n- `drawable-mdpi`\n- `drawable-hdpi`\n- `drawable-xhdpi`\n- `drawable-xxhdpi`\n- `drawable-xxxhdpi`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125851.png) \n\n4. 在`{prject}/android/app/src/main/res/values/`文件夹下修改名为添加一个名为`primary_dark`的属性并设置其颜，添加内容如下\n\n```xml\n...\n<color name=\"primary_dark\">#000000</color>\n...\n```\n\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125857.png) \n\n5. 如果您希望启动屏幕透明，打开`{prject}/android/app/src/main/res/values/styles.xml`并添加`<item name=\"android:windowIsTranslucent\">trueitem>`到文件中\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125900.png) \n\n\n\n### 在项目中关闭启动图\n\n\n> 配置完毕之后重启你的app发现启动图已经展现出来了但是迟迟没有关闭\n> 我们需要在项目中进行控制，将他在合适的时候进行关闭，方法如下：\n\n1. 首先引入进行模块`import SplashScreen from 'react-native-splash-screen'`\n\n2. 使用`SplashScreen.hide()`方法将其关闭\n\n```javascript\nimport SplashScreen from 'react-native-splash-screen'\n\nexport default class App extends Component {\n    componentDidMount() {\n        // do stuff while splash screen is shown\n        // After having done stuff (such as async tasks) hide the splash screen\n        SplashScreen.hide();\n    }\n}\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125904.png) \n\n\n\n**如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)**","slug":"react-native-配置启动图（闪屏图）支持ios和android","published":1,"updated":"2019-07-30T14:23:10.349Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjysbhuc7000oqbt50pysz879","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/120857.jpg\" alt></p>\n<p>配置启动图我使用的是第三方模块<code>react-native-splash-screen</code>,更加详细的请到 <a href=\"https://github.com/crazycodeboy/react-native-splash-screen\" target=\"_blank\" rel=\"noopener\">github地址</a>进一步查看，我们这里提供基本的配置以及个别问题的解决方案</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-splash-screen: 3.1.0 =&gt; 3.1.0</li>\n</ul>\n<h3 id=\"安装第三方模块\"><a href=\"#安装第三方模块\" class=\"headerlink\" title=\"安装第三方模块\"></a>安装第三方模块</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add react-native-splash-screen</span><br><span class=\"line\"><span class=\"meta\">#</span> or</span><br><span class=\"line\">npm install react-native-splash-screen -S</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"自动配置\"><a href=\"#自动配置\" class=\"headerlink\" title=\"自动配置\"></a>自动配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">react-native link react-native-splash-screen</span><br><span class=\"line\"># or</span><br><span class=\"line\">rnpm link react-native-splash-screen</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"手动配置\"><a href=\"#手动配置\" class=\"headerlink\" title=\"手动配置\"></a>手动配置</h3><p><code>如果自动配置不成功，则需要手动一步步配置，配置不难，其实也是很快捷方便的</code></p>\n<h4 id=\"Ios配置\"><a href=\"#Ios配置\" class=\"headerlink\" title=\"Ios配置\"></a>Ios配置</h4><ol>\n<li>用Xcode打开项目, 找到<code>Libraries</code>目录，右键选择 <code>Add Files to [your project&#39;s name]</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125749.png\" alt> </p>\n<ol start=\"2\">\n<li>在<code>{project}/node_modules/react-native-splash-screen/ios</code>找到<code>SplashScreen.xcodeproj</code>文件，并添加</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125755.png\" alt> </p>\n<ol start=\"3\">\n<li>在XCode中，选择你的项目， 选择<code>bilid Phases</code>并将<code>SplashScreen.xcodeproj/Products/libSplashScreen.a</code>文件添加到<code>Link Binary With Libraries</code>中,拖过去即可</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125758.png\" alt> </p>\n<ol start=\"4\">\n<li>添加搜索路径：在项目 → Build Settings → Search Paths → Header Search Paths处添加一项为<code>$(SRCROOT)/../node_modules/react-native-splash-screen/ios</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125804.png\" alt> </p>\n<h4 id=\"Android配置\"><a href=\"#Android配置\" class=\"headerlink\" title=\"Android配置\"></a>Android配置</h4><ol>\n<li>在项目目录<code>{prject}/android/</code>下找到<code>settings.gradle</code>文件添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">include <span class=\"string\">':react-native-splash-screen'</span>   </span><br><span class=\"line\">project(<span class=\"string\">':react-native-splash-screen'</span>).projectDir = <span class=\"keyword\">new</span> File(rootProject.projectDir, <span class=\"string\">'../node_modules/react-native-splash-screen/android'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125809.png\" alt> </p>\n<ol start=\"2\">\n<li>在项目目录<code>{prject}/android/app/</code>下找到<code>build.gradle</code>文件添加<code>compile project(&#39;:react-native-splash-screen&#39;)</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"function\">compile <span class=\"title\">project</span><span class=\"params\">(<span class=\"string\">':react-native-splash-screen'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">&#125;</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">...</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125817.png\" alt> </p>\n<ol start=\"3\">\n<li>找到项目目录<code>{project}/android/app/src/main/java/com/app/</code>下<code>MainApplication.java</code>文件，引入<code>import org.devio.rn.splashscreen.SplashScreenReactPackage;</code>并添加<code>new SplashScreenReactPackage()</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">import</span> org.devio.rn.splashscreen.SplashScreenReactPackage;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainApplication</span> <span class=\"keyword\">extends</span> <span class=\"title\">Application</span> <span class=\"keyword\">implements</span> <span class=\"title\">ReactApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReactNativeHost mReactNativeHost = <span class=\"keyword\">new</span> ReactNativeHost(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> List&lt;ReactPackage&gt; <span class=\"title\">getPackages</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> SplashScreenReactPackage()  <span class=\"comment\">//here</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125823.png\" alt> </p>\n<h3 id=\"启动图相关配置\"><a href=\"#启动图相关配置\" class=\"headerlink\" title=\"启动图相关配置\"></a>启动图相关配置</h3><h4 id=\"配置Ios启动图\"><a href=\"#配置Ios启动图\" class=\"headerlink\" title=\"配置Ios启动图\"></a>配置Ios启动图</h4><ol>\n<li>找到项目目录<code>{project}/ios/{project}/</code>下<code>AppDelegate.m</code>文件，引入<code>#import  &quot;SplashScreen.h&quot;</code>添加内容如下</li>\n</ol>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#import  <span class=\"meta-string\">\"SplashScreen.h\"</span>    <span class=\"comment\">// here</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    [SplashScreen show];    <span class=\"comment\">// here</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> YES;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@end</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125830.png\" alt> </p>\n<ol start=\"2\">\n<li>在XCode中, 点击<code>App/Images.xcassrts</code>通过<code>LaunchImage</code>添加启动图片</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125835.png\" alt> </p>\n<ol start=\"3\">\n<li>在XCode中，选择你的项目， 选择<code>General</code>找到<code>App Icons and Launch Images</code>下的<code>Launch Images Sourc</code>选择你设置好的<code>LaunchImage</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125840.png\" alt> </p>\n<ol start=\"4\">\n<li><p>如出现错误<code># unknown receiver &#39;SplashScreen&#39;; did you mean &#39;RNSplashScreen&#39;</code>, 则改动源码以及<code>AppDelegate.m</code>文件如下</p>\n</li>\n<li><p>源码改动: 找到<code>{project}/node_modules/react-native-splash-screen/ios</code>文件夹下的<code>RNSplashScreen.m</code>文件，将其<code>[SplashScreen show];</code>修改为<code>[RNSplashScreen show];</code>,如下图</p>\n</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125846.png\" alt> </p>\n<ol start=\"6\">\n<li><code>AppDelegate.m</code>文件改动: 找到项目目录<code>{project}/ios/{project}/</code>下<code>AppDelegate.m</code>文件，将所有<code>SplashScreen</code>改为<code>RNSplashScreen</code>即可，如下图</li>\n</ol>\n<p>​    </p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/130203.png\" alt> </p>\n<ol start=\"7\">\n<li>重启尝试是否有其他问题，修改源码地址可查看我的<a href=\"https://github.com/AaronBank/react-native-splash-screen\" target=\"_blank\" rel=\"noopener\">Github</a>项目地址，更多问题请查看官方<a href=\"https://github.com/crazycodeboy/react-native-splash-screen/issues\" target=\"_blank\" rel=\"noopener\">issues</a></li>\n</ol>\n<h4 id=\"配置Android启动图\"><a href=\"#配置Android启动图\" class=\"headerlink\" title=\"配置Android启动图\"></a>配置Android启动图</h4><ol>\n<li><p>在项目目录<code>{prject}/android/app/src/main/res/</code>下创建<code>layout</code>文件夹</p>\n</li>\n<li><p>在<code>layout</code>文件夹下创建<code>launch_screen.xml</code>添加一下内容</p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">xml</span> <span class=\"attr\">version</span>=<span class=\"string\">\"1.0\"</span> <span class=\"attr\">encoding</span>=<span class=\"string\">\"utf-8\"</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:background</span>=<span class=\"string\">\"@drawable/launch_screen\"</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125849.png\" alt> </p>\n<ol start=\"3\">\n<li>将你的启动图改名为<code>launch_screen.png</code>并添加到<code>{prject}/android/app/src/main/res/</code>文件夹下相应的<code>drawable</code>文件夹中（根据需求配置相应大小的文件夹）</li>\n</ol>\n<ul>\n<li><code>drawable-ldpi</code></li>\n<li><code>drawable-mdpi</code></li>\n<li><code>drawable-hdpi</code></li>\n<li><code>drawable-xhdpi</code></li>\n<li><code>drawable-xxhdpi</code></li>\n<li><code>drawable-xxxhdpi</code></li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125851.png\" alt> </p>\n<ol start=\"4\">\n<li>在<code>{prject}/android/app/src/main/res/values/</code>文件夹下修改名为添加一个名为<code>primary_dark</code>的属性并设置其颜，添加内容如下</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">color</span> <span class=\"attr\">name</span>=<span class=\"string\">\"primary_dark\"</span>&gt;</span>#000000<span class=\"tag\">&lt;/<span class=\"name\">color</span>&gt;</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125857.png\" alt> </p>\n<ol start=\"5\">\n<li>如果您希望启动屏幕透明，打开<code>{prject}/android/app/src/main/res/values/styles.xml</code>并添加<code>&lt;item name=&quot;android:windowIsTranslucent&quot;&gt;trueitem&gt;</code>到文件中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125900.png\" alt> </p>\n<h3 id=\"在项目中关闭启动图\"><a href=\"#在项目中关闭启动图\" class=\"headerlink\" title=\"在项目中关闭启动图\"></a>在项目中关闭启动图</h3><blockquote>\n<p>配置完毕之后重启你的app发现启动图已经展现出来了但是迟迟没有关闭<br>我们需要在项目中进行控制，将他在合适的时候进行关闭，方法如下：</p>\n</blockquote>\n<ol>\n<li><p>首先引入进行模块<code>import SplashScreen from &#39;react-native-splash-screen&#39;</code></p>\n</li>\n<li><p>使用<code>SplashScreen.hide()</code>方法将其关闭</p>\n</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> SplashScreen <span class=\"keyword\">from</span> <span class=\"string\">'react-native-splash-screen'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    componentDidMount() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// do stuff while splash screen is shown</span></span><br><span class=\"line\">        <span class=\"comment\">// After having done stuff (such as async tasks) hide the splash screen</span></span><br><span class=\"line\">        SplashScreen.hide();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125904.png\" alt> </p>\n<p><strong>如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/120857.jpg\" alt></p>\n<p>配置启动图我使用的是第三方模块<code>react-native-splash-screen</code>,更加详细的请到 <a href=\"https://github.com/crazycodeboy/react-native-splash-screen\" target=\"_blank\" rel=\"noopener\">github地址</a>进一步查看，我们这里提供基本的配置以及个别问题的解决方案</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n<li>react-native-splash-screen: 3.1.0 =&gt; 3.1.0</li>\n</ul>\n<h3 id=\"安装第三方模块\"><a href=\"#安装第三方模块\" class=\"headerlink\" title=\"安装第三方模块\"></a>安装第三方模块</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add react-native-splash-screen</span><br><span class=\"line\"><span class=\"meta\">#</span> or</span><br><span class=\"line\">npm install react-native-splash-screen -S</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"自动配置\"><a href=\"#自动配置\" class=\"headerlink\" title=\"自动配置\"></a>自动配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">react-native link react-native-splash-screen</span><br><span class=\"line\"># or</span><br><span class=\"line\">rnpm link react-native-splash-screen</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"手动配置\"><a href=\"#手动配置\" class=\"headerlink\" title=\"手动配置\"></a>手动配置</h3><p><code>如果自动配置不成功，则需要手动一步步配置，配置不难，其实也是很快捷方便的</code></p>\n<h4 id=\"Ios配置\"><a href=\"#Ios配置\" class=\"headerlink\" title=\"Ios配置\"></a>Ios配置</h4><ol>\n<li>用Xcode打开项目, 找到<code>Libraries</code>目录，右键选择 <code>Add Files to [your project&#39;s name]</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125749.png\" alt> </p>\n<ol start=\"2\">\n<li>在<code>{project}/node_modules/react-native-splash-screen/ios</code>找到<code>SplashScreen.xcodeproj</code>文件，并添加</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125755.png\" alt> </p>\n<ol start=\"3\">\n<li>在XCode中，选择你的项目， 选择<code>bilid Phases</code>并将<code>SplashScreen.xcodeproj/Products/libSplashScreen.a</code>文件添加到<code>Link Binary With Libraries</code>中,拖过去即可</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125758.png\" alt> </p>\n<ol start=\"4\">\n<li>添加搜索路径：在项目 → Build Settings → Search Paths → Header Search Paths处添加一项为<code>$(SRCROOT)/../node_modules/react-native-splash-screen/ios</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125804.png\" alt> </p>\n<h4 id=\"Android配置\"><a href=\"#Android配置\" class=\"headerlink\" title=\"Android配置\"></a>Android配置</h4><ol>\n<li>在项目目录<code>{prject}/android/</code>下找到<code>settings.gradle</code>文件添加一下内容</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">include <span class=\"string\">':react-native-splash-screen'</span>   </span><br><span class=\"line\">project(<span class=\"string\">':react-native-splash-screen'</span>).projectDir = <span class=\"keyword\">new</span> File(rootProject.projectDir, <span class=\"string\">'../node_modules/react-native-splash-screen/android'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125809.png\" alt> </p>\n<ol start=\"2\">\n<li>在项目目录<code>{prject}/android/app/</code>下找到<code>build.gradle</code>文件添加<code>compile project(&#39;:react-native-splash-screen&#39;)</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"function\">compile <span class=\"title\">project</span><span class=\"params\">(<span class=\"string\">':react-native-splash-screen'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">&#125;</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">...</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125817.png\" alt> </p>\n<ol start=\"3\">\n<li>找到项目目录<code>{project}/android/app/src/main/java/com/app/</code>下<code>MainApplication.java</code>文件，引入<code>import org.devio.rn.splashscreen.SplashScreenReactPackage;</code>并添加<code>new SplashScreenReactPackage()</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">import</span> org.devio.rn.splashscreen.SplashScreenReactPackage;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainApplication</span> <span class=\"keyword\">extends</span> <span class=\"title\">Application</span> <span class=\"keyword\">implements</span> <span class=\"title\">ReactApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReactNativeHost mReactNativeHost = <span class=\"keyword\">new</span> ReactNativeHost(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> List&lt;ReactPackage&gt; <span class=\"title\">getPackages</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> SplashScreenReactPackage()  <span class=\"comment\">//here</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125823.png\" alt> </p>\n<h3 id=\"启动图相关配置\"><a href=\"#启动图相关配置\" class=\"headerlink\" title=\"启动图相关配置\"></a>启动图相关配置</h3><h4 id=\"配置Ios启动图\"><a href=\"#配置Ios启动图\" class=\"headerlink\" title=\"配置Ios启动图\"></a>配置Ios启动图</h4><ol>\n<li>找到项目目录<code>{project}/ios/{project}/</code>下<code>AppDelegate.m</code>文件，引入<code>#import  &quot;SplashScreen.h&quot;</code>添加内容如下</li>\n</ol>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#import  <span class=\"meta-string\">\"SplashScreen.h\"</span>    <span class=\"comment\">// here</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    [SplashScreen show];    <span class=\"comment\">// here</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> YES;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@end</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125830.png\" alt> </p>\n<ol start=\"2\">\n<li>在XCode中, 点击<code>App/Images.xcassrts</code>通过<code>LaunchImage</code>添加启动图片</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125835.png\" alt> </p>\n<ol start=\"3\">\n<li>在XCode中，选择你的项目， 选择<code>General</code>找到<code>App Icons and Launch Images</code>下的<code>Launch Images Sourc</code>选择你设置好的<code>LaunchImage</code></li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125840.png\" alt> </p>\n<ol start=\"4\">\n<li><p>如出现错误<code># unknown receiver &#39;SplashScreen&#39;; did you mean &#39;RNSplashScreen&#39;</code>, 则改动源码以及<code>AppDelegate.m</code>文件如下</p>\n</li>\n<li><p>源码改动: 找到<code>{project}/node_modules/react-native-splash-screen/ios</code>文件夹下的<code>RNSplashScreen.m</code>文件，将其<code>[SplashScreen show];</code>修改为<code>[RNSplashScreen show];</code>,如下图</p>\n</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125846.png\" alt> </p>\n<ol start=\"6\">\n<li><code>AppDelegate.m</code>文件改动: 找到项目目录<code>{project}/ios/{project}/</code>下<code>AppDelegate.m</code>文件，将所有<code>SplashScreen</code>改为<code>RNSplashScreen</code>即可，如下图</li>\n</ol>\n<p>​    </p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/130203.png\" alt> </p>\n<ol start=\"7\">\n<li>重启尝试是否有其他问题，修改源码地址可查看我的<a href=\"https://github.com/AaronBank/react-native-splash-screen\" target=\"_blank\" rel=\"noopener\">Github</a>项目地址，更多问题请查看官方<a href=\"https://github.com/crazycodeboy/react-native-splash-screen/issues\" target=\"_blank\" rel=\"noopener\">issues</a></li>\n</ol>\n<h4 id=\"配置Android启动图\"><a href=\"#配置Android启动图\" class=\"headerlink\" title=\"配置Android启动图\"></a>配置Android启动图</h4><ol>\n<li><p>在项目目录<code>{prject}/android/app/src/main/res/</code>下创建<code>layout</code>文件夹</p>\n</li>\n<li><p>在<code>layout</code>文件夹下创建<code>launch_screen.xml</code>添加一下内容</p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">xml</span> <span class=\"attr\">version</span>=<span class=\"string\">\"1.0\"</span> <span class=\"attr\">encoding</span>=<span class=\"string\">\"utf-8\"</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:background</span>=<span class=\"string\">\"@drawable/launch_screen\"</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125849.png\" alt> </p>\n<ol start=\"3\">\n<li>将你的启动图改名为<code>launch_screen.png</code>并添加到<code>{prject}/android/app/src/main/res/</code>文件夹下相应的<code>drawable</code>文件夹中（根据需求配置相应大小的文件夹）</li>\n</ol>\n<ul>\n<li><code>drawable-ldpi</code></li>\n<li><code>drawable-mdpi</code></li>\n<li><code>drawable-hdpi</code></li>\n<li><code>drawable-xhdpi</code></li>\n<li><code>drawable-xxhdpi</code></li>\n<li><code>drawable-xxxhdpi</code></li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125851.png\" alt> </p>\n<ol start=\"4\">\n<li>在<code>{prject}/android/app/src/main/res/values/</code>文件夹下修改名为添加一个名为<code>primary_dark</code>的属性并设置其颜，添加内容如下</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">color</span> <span class=\"attr\">name</span>=<span class=\"string\">\"primary_dark\"</span>&gt;</span>#000000<span class=\"tag\">&lt;/<span class=\"name\">color</span>&gt;</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125857.png\" alt> </p>\n<ol start=\"5\">\n<li>如果您希望启动屏幕透明，打开<code>{prject}/android/app/src/main/res/values/styles.xml</code>并添加<code>&lt;item name=&quot;android:windowIsTranslucent&quot;&gt;trueitem&gt;</code>到文件中</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125900.png\" alt> </p>\n<h3 id=\"在项目中关闭启动图\"><a href=\"#在项目中关闭启动图\" class=\"headerlink\" title=\"在项目中关闭启动图\"></a>在项目中关闭启动图</h3><blockquote>\n<p>配置完毕之后重启你的app发现启动图已经展现出来了但是迟迟没有关闭<br>我们需要在项目中进行控制，将他在合适的时候进行关闭，方法如下：</p>\n</blockquote>\n<ol>\n<li><p>首先引入进行模块<code>import SplashScreen from &#39;react-native-splash-screen&#39;</code></p>\n</li>\n<li><p>使用<code>SplashScreen.hide()</code>方法将其关闭</p>\n</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> SplashScreen <span class=\"keyword\">from</span> <span class=\"string\">'react-native-splash-screen'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    componentDidMount() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// do stuff while splash screen is shown</span></span><br><span class=\"line\">        <span class=\"comment\">// After having done stuff (such as async tasks) hide the splash screen</span></span><br><span class=\"line\">        SplashScreen.hide();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125904.png\" alt> </p>\n<p><strong>如果配置出现问题或者文章哪里写的不清楚，欢迎下方留言ヾ(￣▽￣)</strong></p>\n"},{"title":"react 常用项目配置","date":"2019-07-31T05:44:32.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064604.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064604.jpg)\n\n\n\n## 开发环境配置热更新\n\n### 安装插件\n\n```\nyarn add react-hot-loader -D\n```\n\n\n\n### 修改package.json\n\n```json\n\"babel\":  {\n    \"plugins\":  [\n        \"react-hot-loader/babel\"\n    ],\n    \"presets\":  [\n        \"react-app\"\n    ]\n}\n```\n\n\n\n### 修改webpack.config.dev.js\n\n```javascript\n// 打包入口文件处添加\nentry: [\n    'react-hot-loader/patch',\n    ...\n]\n```\n\n\n\n###  配置App.js项目入口\n\n```javascript\nimport React, { Component } from  'react'\nimport { hot } from  'react-hot-loader'\n\nclass App extends Component{\n    render () {\n        return (\n            <div className=\"App\"></div>\n        );\n    }\n}\n\nexport default hot(module)(App)\n```\n\n\n\n参考链接： [https://www.jianshu.com/p/45ebcea63057](https://www.jianshu.com/p/45ebcea63057)\n\n\n\n## 配置ES7修饰器\n\n\n\n### 下载babel插件\n\n```shell\nyarn add babel-plugin-transform-decorators-legacy @babel/plugin-proposal-decorators -D\n```\n\n\n\n### 修改package.json\n\n```json\n\"babel\": {\n    \"plugins\": [\n        [\n            \"@babel/plugin-proposal-decorators\",\n            {\n                \"legacy\": true\n            }\n        ],\n        [\n            \"@babel/plugin-proposal-class-properties\",\n            {\n                \"loose\": true\n            }\n        ],\n    ],\n    \"presets\": [\n        \"react-app\"\n    ]\n}\n```\n\n\n\n参考链接： [https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844](https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844)\n\n\n\n## 配置less\n\n### 下载less及相关loader\n\n```shell\nyarn add less-loader less -D\n```\n\n\n\n\n\n### 修改`webpack.config.dev.js`\n\n```javascript\n// 1. 添加 less 正则等变量\n// style files regexes\n\nconst cssRegex = /\\.css$/;\nconst cssModuleRegex = /\\.module\\.css$/;\nconst lessRegex = /\\.less$/;\nconst lessModuleRegex = /\\.module\\.less$/;\n\n// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项\nconst getStyleLoaders = (cssOptions, preProcessor, processorOptions={}) => {\n    const loaders = [\n        require.resolve('style-loader'),\n        {\n            loader: require.resolve('css-loader'),\n            options: cssOptions,\n        },\n        {\n            loader: require.resolve('postcss-loader'),\n            options: {\n                ident: 'postcss',\n                plugins: () => [\n                    require('postcss-flexbugs-fixes'),\n                    require('postcss-preset-env')({\n                        autoprefixer: {\n                            flexbox: 'no-2009',\n                        },\n                        stage: 3,\n                    }),\n                ],\n            },\n        },\n    ];\n\n    if (preProcessor) {\n        loaders.push({\n            loader: require.resolve(preProcessor),\n            options: Object.assign(processorOptions)\n        });\n    }\n    return loaders;\n};\n\n// 3. 修改module部分 将之前所有采用use配置loader部分全部替换成loader\nmodule: {\n    rules: [{\n        ...\n        oneOf: [\n            ...\n            {\n                test: cssRegex,\n                exclude: cssModuleRegex,\n                loader: getStyleLoaders({\n                    importLoaders: 1,\n                }),\n            },\n            {\n                test: cssModuleRegex,\n                loader: getStyleLoaders({\n                importLoaders: 1,\n                modules: true,\n                    getLocalIdent: getCSSModuleLocalIdent,\n                }),\n            },\n            {\n                test: sassRegex,\n                exclude: sassModuleRegex,\n                loader: getStyleLoaders({ importLoaders: 2 }, 'sass-loader'),\n            },\n            {\n                test: sassModuleRegex,\n                loader: getStyleLoaders({\n                    importLoaders: 2,\n                    modules: true,\n                    getLocalIdent: getCSSModuleLocalIdent,\n                }, 'sass-loader'),\n            },\n            // less\n            {\n                test: lessRegex,\n                exclude: lessModuleRegex,\n                loader: getStyleLoaders({importLoaders: 2},'less-loader',{\n                    javascriptEnabled: true\n                }),\n            },\n            ...\n        ],\n    }],\n},\n```\n\n\n\n### 修改`webpack.config-prod.js`\n\n```javascript\n// 1. 添加less正则等变量\n// style files regexes\nconst cssRegex = /\\.css$/;\nconst cssModuleRegex = /\\.module\\.css$/;\nconst lessRegex = /\\.less$/;\nconst lessModuleRegex = /\\.module\\.less$/;\n\n\n// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项\nconst getStyleLoaders = (cssOptions, preProcessor, processorOptions = {}) => {\n    const loaders = [\n        {\n            loader: MiniCssExtractPlugin.loader,\n            options: Object.assign(\n                {},\n                shouldUseRelativeAssetPaths ? { publicPath: '../../' } : undefined\n            ),\n        },\n        {\n            loader: require.resolve('css-loader'),\n            options: cssOptions,\n        },\n        {\n            loader: require.resolve('postcss-loader'),\n            options: {\n                ident: 'postcss',\n                plugins: () => [\n                    require('postcss-flexbugs-fixes'),\n                    require('postcss-preset-env')({\n                        autoprefixer: {\n                            flexbox: 'no-2009',\n                        },\n                        stage: 3,\n                    }),\n                ],\n                sourceMap: shouldUseSourceMap,\n            },\n        },\n    ];\n\n    if (preProcessor) {\n        loaders.push({\n            loader: require.resolve(preProcessor),\n            options: Object.assign({\n                sourceMap: shouldUseSourceMap,\n            }, processorOptions)\n        });\n    }\n\n    return loaders;\n};\n\n\n// 3. 修改module部分  将之前所有采用use配置loader部分全部替换成loader\nmodule: {\n    rules: [\n        {\n            ...\n            oneOf: [\n                ...\n                // less\n                {\n                    test: lessRegex,\n                    exclude: lessModuleRegex,\n                    loader: getStyleLoaders({ importLoaders: 2, sourceMap: shouldUseSourceMap }, 'less-loader', {\n                        javascriptEnabled: true\n                    }),\n                },\n                ...\n            ],\n        },\n    ],\n},\n```\n\n\n\n\n\n参考链接： [https://segmentfault.com/a/1190000010162614](https://segmentfault.com/a/1190000010162614)\n\n\n\n## 配置antd按需加载\n\n\n\n###  安装插件\n\n```shell\nyarn add babel-plugin-import -D\n```\n\n\n\n\n\n### 修改package.json\n\n```json\n\"babel\": {\n    \"plugins\": [\n         [\"import\",{\"libraryName\":  \"antd\",\"style\":  \"css\"}]\n    ],\n    \"presets\": [\n        \"react-app\"\n    ]\n}\n```\n\n\n\n**或者配置**`webpack.config.dev.js`和`webpack.config.prod.js`文件\n\n\n\n```javascript\n...\n{\n    test: /\\.(js|mjs|jsx|ts|tsx)$/,\n    include: paths.appSrc,\n    loader: require.resolve('babel-loader'),\n    options: {\n        customize: require.resolve(\n            'babel-preset-react-app/webpack-overrides'\n        ),\n        plugins: [\n            [\n                require.resolve('babel-plugin-named-asset-import'),\n                {\n                    loaderMap: {\n                        svg: {\n                            ReactComponent: '@svgr/webpack?-prettier,-svgo![path]',\n                        },\n                    },\n                },\n                ['import', [{ libraryName: \"antd\", style: 'css' }]]\n            ],\n        ],\n        cacheDirectory: true,\n        cacheCompression: false,\n    },\n},\n...\n```\n\n以上两种方法任何一种都可以实现，个人感觉上面方法比较简单一些😺。\n\n\n\n参考链接： [https://blog.csdn.net/well2049/article/details/78801228](https://blog.csdn.net/well2049/article/details/78801228)","source":"_posts/react-常用项目配置.md","raw":"---\ntitle: react 常用项目配置\ndate: 2019-07-31 13:44:32\ntags: React\ncategories: 工程化\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064604.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064604.jpg)\n\n\n\n## 开发环境配置热更新\n\n### 安装插件\n\n```\nyarn add react-hot-loader -D\n```\n\n\n\n### 修改package.json\n\n```json\n\"babel\":  {\n    \"plugins\":  [\n        \"react-hot-loader/babel\"\n    ],\n    \"presets\":  [\n        \"react-app\"\n    ]\n}\n```\n\n\n\n### 修改webpack.config.dev.js\n\n```javascript\n// 打包入口文件处添加\nentry: [\n    'react-hot-loader/patch',\n    ...\n]\n```\n\n\n\n###  配置App.js项目入口\n\n```javascript\nimport React, { Component } from  'react'\nimport { hot } from  'react-hot-loader'\n\nclass App extends Component{\n    render () {\n        return (\n            <div className=\"App\"></div>\n        );\n    }\n}\n\nexport default hot(module)(App)\n```\n\n\n\n参考链接： [https://www.jianshu.com/p/45ebcea63057](https://www.jianshu.com/p/45ebcea63057)\n\n\n\n## 配置ES7修饰器\n\n\n\n### 下载babel插件\n\n```shell\nyarn add babel-plugin-transform-decorators-legacy @babel/plugin-proposal-decorators -D\n```\n\n\n\n### 修改package.json\n\n```json\n\"babel\": {\n    \"plugins\": [\n        [\n            \"@babel/plugin-proposal-decorators\",\n            {\n                \"legacy\": true\n            }\n        ],\n        [\n            \"@babel/plugin-proposal-class-properties\",\n            {\n                \"loose\": true\n            }\n        ],\n    ],\n    \"presets\": [\n        \"react-app\"\n    ]\n}\n```\n\n\n\n参考链接： [https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844](https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844)\n\n\n\n## 配置less\n\n### 下载less及相关loader\n\n```shell\nyarn add less-loader less -D\n```\n\n\n\n\n\n### 修改`webpack.config.dev.js`\n\n```javascript\n// 1. 添加 less 正则等变量\n// style files regexes\n\nconst cssRegex = /\\.css$/;\nconst cssModuleRegex = /\\.module\\.css$/;\nconst lessRegex = /\\.less$/;\nconst lessModuleRegex = /\\.module\\.less$/;\n\n// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项\nconst getStyleLoaders = (cssOptions, preProcessor, processorOptions={}) => {\n    const loaders = [\n        require.resolve('style-loader'),\n        {\n            loader: require.resolve('css-loader'),\n            options: cssOptions,\n        },\n        {\n            loader: require.resolve('postcss-loader'),\n            options: {\n                ident: 'postcss',\n                plugins: () => [\n                    require('postcss-flexbugs-fixes'),\n                    require('postcss-preset-env')({\n                        autoprefixer: {\n                            flexbox: 'no-2009',\n                        },\n                        stage: 3,\n                    }),\n                ],\n            },\n        },\n    ];\n\n    if (preProcessor) {\n        loaders.push({\n            loader: require.resolve(preProcessor),\n            options: Object.assign(processorOptions)\n        });\n    }\n    return loaders;\n};\n\n// 3. 修改module部分 将之前所有采用use配置loader部分全部替换成loader\nmodule: {\n    rules: [{\n        ...\n        oneOf: [\n            ...\n            {\n                test: cssRegex,\n                exclude: cssModuleRegex,\n                loader: getStyleLoaders({\n                    importLoaders: 1,\n                }),\n            },\n            {\n                test: cssModuleRegex,\n                loader: getStyleLoaders({\n                importLoaders: 1,\n                modules: true,\n                    getLocalIdent: getCSSModuleLocalIdent,\n                }),\n            },\n            {\n                test: sassRegex,\n                exclude: sassModuleRegex,\n                loader: getStyleLoaders({ importLoaders: 2 }, 'sass-loader'),\n            },\n            {\n                test: sassModuleRegex,\n                loader: getStyleLoaders({\n                    importLoaders: 2,\n                    modules: true,\n                    getLocalIdent: getCSSModuleLocalIdent,\n                }, 'sass-loader'),\n            },\n            // less\n            {\n                test: lessRegex,\n                exclude: lessModuleRegex,\n                loader: getStyleLoaders({importLoaders: 2},'less-loader',{\n                    javascriptEnabled: true\n                }),\n            },\n            ...\n        ],\n    }],\n},\n```\n\n\n\n### 修改`webpack.config-prod.js`\n\n```javascript\n// 1. 添加less正则等变量\n// style files regexes\nconst cssRegex = /\\.css$/;\nconst cssModuleRegex = /\\.module\\.css$/;\nconst lessRegex = /\\.less$/;\nconst lessModuleRegex = /\\.module\\.less$/;\n\n\n// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项\nconst getStyleLoaders = (cssOptions, preProcessor, processorOptions = {}) => {\n    const loaders = [\n        {\n            loader: MiniCssExtractPlugin.loader,\n            options: Object.assign(\n                {},\n                shouldUseRelativeAssetPaths ? { publicPath: '../../' } : undefined\n            ),\n        },\n        {\n            loader: require.resolve('css-loader'),\n            options: cssOptions,\n        },\n        {\n            loader: require.resolve('postcss-loader'),\n            options: {\n                ident: 'postcss',\n                plugins: () => [\n                    require('postcss-flexbugs-fixes'),\n                    require('postcss-preset-env')({\n                        autoprefixer: {\n                            flexbox: 'no-2009',\n                        },\n                        stage: 3,\n                    }),\n                ],\n                sourceMap: shouldUseSourceMap,\n            },\n        },\n    ];\n\n    if (preProcessor) {\n        loaders.push({\n            loader: require.resolve(preProcessor),\n            options: Object.assign({\n                sourceMap: shouldUseSourceMap,\n            }, processorOptions)\n        });\n    }\n\n    return loaders;\n};\n\n\n// 3. 修改module部分  将之前所有采用use配置loader部分全部替换成loader\nmodule: {\n    rules: [\n        {\n            ...\n            oneOf: [\n                ...\n                // less\n                {\n                    test: lessRegex,\n                    exclude: lessModuleRegex,\n                    loader: getStyleLoaders({ importLoaders: 2, sourceMap: shouldUseSourceMap }, 'less-loader', {\n                        javascriptEnabled: true\n                    }),\n                },\n                ...\n            ],\n        },\n    ],\n},\n```\n\n\n\n\n\n参考链接： [https://segmentfault.com/a/1190000010162614](https://segmentfault.com/a/1190000010162614)\n\n\n\n## 配置antd按需加载\n\n\n\n###  安装插件\n\n```shell\nyarn add babel-plugin-import -D\n```\n\n\n\n\n\n### 修改package.json\n\n```json\n\"babel\": {\n    \"plugins\": [\n         [\"import\",{\"libraryName\":  \"antd\",\"style\":  \"css\"}]\n    ],\n    \"presets\": [\n        \"react-app\"\n    ]\n}\n```\n\n\n\n**或者配置**`webpack.config.dev.js`和`webpack.config.prod.js`文件\n\n\n\n```javascript\n...\n{\n    test: /\\.(js|mjs|jsx|ts|tsx)$/,\n    include: paths.appSrc,\n    loader: require.resolve('babel-loader'),\n    options: {\n        customize: require.resolve(\n            'babel-preset-react-app/webpack-overrides'\n        ),\n        plugins: [\n            [\n                require.resolve('babel-plugin-named-asset-import'),\n                {\n                    loaderMap: {\n                        svg: {\n                            ReactComponent: '@svgr/webpack?-prettier,-svgo![path]',\n                        },\n                    },\n                },\n                ['import', [{ libraryName: \"antd\", style: 'css' }]]\n            ],\n        ],\n        cacheDirectory: true,\n        cacheCompression: false,\n    },\n},\n...\n```\n\n以上两种方法任何一种都可以实现，个人感觉上面方法比较简单一些😺。\n\n\n\n参考链接： [https://blog.csdn.net/well2049/article/details/78801228](https://blog.csdn.net/well2049/article/details/78801228)","slug":"react-常用项目配置","published":1,"updated":"2019-08-01T06:51:24.689Z","_id":"cjysbhuc9000rqbt5rud4616o","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064604.jpg\" alt></p>\n<h2 id=\"开发环境配置热更新\"><a href=\"#开发环境配置热更新\" class=\"headerlink\" title=\"开发环境配置热更新\"></a>开发环境配置热更新</h2><h3 id=\"安装插件\"><a href=\"#安装插件\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add react-hot-loader -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改package-json\"><a href=\"#修改package-json\" class=\"headerlink\" title=\"修改package.json\"></a>修改package.json</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"babel\":  &#123;</span><br><span class=\"line\">    \"plugins\":  [</span><br><span class=\"line\">        <span class=\"string\">\"react-hot-loader/babel\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"presets\":  [</span><br><span class=\"line\">        <span class=\"string\">\"react-app\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改webpack-config-dev-js\"><a href=\"#修改webpack-config-dev-js\" class=\"headerlink\" title=\"修改webpack.config.dev.js\"></a>修改webpack.config.dev.js</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 打包入口文件处添加</span></span><br><span class=\"line\">entry: [</span><br><span class=\"line\">    <span class=\"string\">'react-hot-loader/patch'</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置App-js项目入口\"><a href=\"#配置App-js项目入口\" class=\"headerlink\" title=\"配置App.js项目入口\"></a>配置App.js项目入口</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span>  <span class=\"string\">'react'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; hot &#125; <span class=\"keyword\">from</span>  <span class=\"string\">'react-hot-loader'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span></span>&#123;</span><br><span class=\"line\">    render () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            &lt;div className=<span class=\"string\">\"App\"</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> hot(<span class=\"built_in\">module</span>)(App)</span><br></pre></td></tr></table></figure>\n\n<p>参考链接： <a href=\"https://www.jianshu.com/p/45ebcea63057\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/45ebcea63057</a></p>\n<h2 id=\"配置ES7修饰器\"><a href=\"#配置ES7修饰器\" class=\"headerlink\" title=\"配置ES7修饰器\"></a>配置ES7修饰器</h2><h3 id=\"下载babel插件\"><a href=\"#下载babel插件\" class=\"headerlink\" title=\"下载babel插件\"></a>下载babel插件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add babel-plugin-transform-decorators-legacy @babel/plugin-proposal-decorators -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改package-json-1\"><a href=\"#修改package-json-1\" class=\"headerlink\" title=\"修改package.json\"></a>修改package.json</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"babel\": &#123;</span><br><span class=\"line\">    \"plugins\": [</span><br><span class=\"line\">        [</span><br><span class=\"line\">            <span class=\"string\">\"@babel/plugin-proposal-decorators\"</span>,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"legacy\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        [</span><br><span class=\"line\">            <span class=\"string\">\"@babel/plugin-proposal-class-properties\"</span>,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"loose\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"presets\": [</span><br><span class=\"line\">        <span class=\"string\">\"react-app\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>参考链接： <a href=\"https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844</a></p>\n<h2 id=\"配置less\"><a href=\"#配置less\" class=\"headerlink\" title=\"配置less\"></a>配置less</h2><h3 id=\"下载less及相关loader\"><a href=\"#下载less及相关loader\" class=\"headerlink\" title=\"下载less及相关loader\"></a>下载less及相关loader</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add less-loader less -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改webpack-config-dev-js-1\"><a href=\"#修改webpack-config-dev-js-1\" class=\"headerlink\" title=\"修改webpack.config.dev.js\"></a>修改<code>webpack.config.dev.js</code></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. 添加 less 正则等变量</span></span><br><span class=\"line\"><span class=\"comment\">// style files regexes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> cssRegex = <span class=\"regexp\">/\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> cssModuleRegex = <span class=\"regexp\">/\\.module\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessRegex = <span class=\"regexp\">/\\.less$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessModuleRegex = <span class=\"regexp\">/\\.module\\.less$/</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getStyleLoaders = <span class=\"function\">(<span class=\"params\">cssOptions, preProcessor, processorOptions=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> loaders = [</span><br><span class=\"line\">        <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'style-loader'</span>),</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'css-loader'</span>),</span><br><span class=\"line\">            options: cssOptions,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'postcss-loader'</span>),</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">                ident: <span class=\"string\">'postcss'</span>,</span><br><span class=\"line\">                plugins: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> [</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-flexbugs-fixes'</span>),</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-preset-env'</span>)(&#123;</span><br><span class=\"line\">                        autoprefixer: &#123;</span><br><span class=\"line\">                            flexbox: <span class=\"string\">'no-2009'</span>,</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        stage: <span class=\"number\">3</span>,</span><br><span class=\"line\">                    &#125;),</span><br><span class=\"line\">                ],</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (preProcessor) &#123;</span><br><span class=\"line\">        loaders.push(&#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(preProcessor),</span><br><span class=\"line\">            options: <span class=\"built_in\">Object</span>.assign(processorOptions)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> loaders;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. 修改module部分 将之前所有采用use配置loader部分全部替换成loader</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        oneOf: [</span><br><span class=\"line\">            ...</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: cssRegex,</span><br><span class=\"line\">                exclude: cssModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;</span><br><span class=\"line\">                    importLoaders: <span class=\"number\">1</span>,</span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: cssModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;</span><br><span class=\"line\">                importLoaders: <span class=\"number\">1</span>,</span><br><span class=\"line\">                modules: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    getLocalIdent: getCSSModuleLocalIdent,</span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: sassRegex,</span><br><span class=\"line\">                exclude: sassModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123; <span class=\"attr\">importLoaders</span>: <span class=\"number\">2</span> &#125;, <span class=\"string\">'sass-loader'</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: sassModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;</span><br><span class=\"line\">                    importLoaders: <span class=\"number\">2</span>,</span><br><span class=\"line\">                    modules: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    getLocalIdent: getCSSModuleLocalIdent,</span><br><span class=\"line\">                &#125;, <span class=\"string\">'sass-loader'</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"comment\">// less</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: lessRegex,</span><br><span class=\"line\">                exclude: lessModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;<span class=\"attr\">importLoaders</span>: <span class=\"number\">2</span>&#125;,<span class=\"string\">'less-loader'</span>,&#123;</span><br><span class=\"line\">                    javascriptEnabled: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        ],</span><br><span class=\"line\">    &#125;],</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改webpack-config-prod-js\"><a href=\"#修改webpack-config-prod-js\" class=\"headerlink\" title=\"修改webpack.config-prod.js\"></a>修改<code>webpack.config-prod.js</code></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. 添加less正则等变量</span></span><br><span class=\"line\"><span class=\"comment\">// style files regexes</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> cssRegex = <span class=\"regexp\">/\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> cssModuleRegex = <span class=\"regexp\">/\\.module\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessRegex = <span class=\"regexp\">/\\.less$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessModuleRegex = <span class=\"regexp\">/\\.module\\.less$/</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getStyleLoaders = <span class=\"function\">(<span class=\"params\">cssOptions, preProcessor, processorOptions = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> loaders = [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: MiniCssExtractPlugin.loader,</span><br><span class=\"line\">            options: <span class=\"built_in\">Object</span>.assign(</span><br><span class=\"line\">                &#123;&#125;,</span><br><span class=\"line\">                shouldUseRelativeAssetPaths ? &#123; <span class=\"attr\">publicPath</span>: <span class=\"string\">'../../'</span> &#125; : <span class=\"literal\">undefined</span></span><br><span class=\"line\">            ),</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'css-loader'</span>),</span><br><span class=\"line\">            options: cssOptions,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'postcss-loader'</span>),</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">                ident: <span class=\"string\">'postcss'</span>,</span><br><span class=\"line\">                plugins: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> [</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-flexbugs-fixes'</span>),</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-preset-env'</span>)(&#123;</span><br><span class=\"line\">                        autoprefixer: &#123;</span><br><span class=\"line\">                            flexbox: <span class=\"string\">'no-2009'</span>,</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        stage: <span class=\"number\">3</span>,</span><br><span class=\"line\">                    &#125;),</span><br><span class=\"line\">                ],</span><br><span class=\"line\">                sourceMap: shouldUseSourceMap,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (preProcessor) &#123;</span><br><span class=\"line\">        loaders.push(&#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(preProcessor),</span><br><span class=\"line\">            options: <span class=\"built_in\">Object</span>.assign(&#123;</span><br><span class=\"line\">                sourceMap: shouldUseSourceMap,</span><br><span class=\"line\">            &#125;, processorOptions)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> loaders;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. 修改module部分  将之前所有采用use配置loader部分全部替换成loader</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">            oneOf: [</span><br><span class=\"line\">                ...</span><br><span class=\"line\">                <span class=\"comment\">// less</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    test: lessRegex,</span><br><span class=\"line\">                    exclude: lessModuleRegex,</span><br><span class=\"line\">                    loader: getStyleLoaders(&#123; <span class=\"attr\">importLoaders</span>: <span class=\"number\">2</span>, <span class=\"attr\">sourceMap</span>: shouldUseSourceMap &#125;, <span class=\"string\">'less-loader'</span>, &#123;</span><br><span class=\"line\">                        javascriptEnabled: <span class=\"literal\">true</span></span><br><span class=\"line\">                    &#125;),</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                ...</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>参考链接： <a href=\"https://segmentfault.com/a/1190000010162614\" target=\"_blank\" rel=\"noopener\">https://segmentfault.com/a/1190000010162614</a></p>\n<h2 id=\"配置antd按需加载\"><a href=\"#配置antd按需加载\" class=\"headerlink\" title=\"配置antd按需加载\"></a>配置antd按需加载</h2><h3 id=\"安装插件-1\"><a href=\"#安装插件-1\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add babel-plugin-import -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改package-json-2\"><a href=\"#修改package-json-2\" class=\"headerlink\" title=\"修改package.json\"></a>修改package.json</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"babel\": &#123;</span><br><span class=\"line\">    \"plugins\": [</span><br><span class=\"line\">         [<span class=\"string\">\"import\"</span>,&#123;<span class=\"attr\">\"libraryName\"</span>:  <span class=\"string\">\"antd\"</span>,<span class=\"attr\">\"style\"</span>:  <span class=\"string\">\"css\"</span>&#125;]</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"presets\": [</span><br><span class=\"line\">        <span class=\"string\">\"react-app\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>或者配置</strong><code>webpack.config.dev.js</code>和<code>webpack.config.prod.js</code>文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    test: <span class=\"regexp\">/\\.(js|mjs|jsx|ts|tsx)$/</span>,</span><br><span class=\"line\">    include: paths.appSrc,</span><br><span class=\"line\">    loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'babel-loader'</span>),</span><br><span class=\"line\">    options: &#123;</span><br><span class=\"line\">        customize: <span class=\"built_in\">require</span>.resolve(</span><br><span class=\"line\">            <span class=\"string\">'babel-preset-react-app/webpack-overrides'</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        plugins: [</span><br><span class=\"line\">            [</span><br><span class=\"line\">                <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'babel-plugin-named-asset-import'</span>),</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    loaderMap: &#123;</span><br><span class=\"line\">                        svg: &#123;</span><br><span class=\"line\">                            ReactComponent: <span class=\"string\">'@svgr/webpack?-prettier,-svgo![path]'</span>,</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                [<span class=\"string\">'import'</span>, [&#123; <span class=\"attr\">libraryName</span>: <span class=\"string\">\"antd\"</span>, <span class=\"attr\">style</span>: <span class=\"string\">'css'</span> &#125;]]</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        cacheDirectory: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        cacheCompression: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>以上两种方法任何一种都可以实现，个人感觉上面方法比较简单一些😺。</p>\n<p>参考链接： <a href=\"https://blog.csdn.net/well2049/article/details/78801228\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/well2049/article/details/78801228</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/064604.jpg\" alt></p>\n<h2 id=\"开发环境配置热更新\"><a href=\"#开发环境配置热更新\" class=\"headerlink\" title=\"开发环境配置热更新\"></a>开发环境配置热更新</h2><h3 id=\"安装插件\"><a href=\"#安装插件\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add react-hot-loader -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改package-json\"><a href=\"#修改package-json\" class=\"headerlink\" title=\"修改package.json\"></a>修改package.json</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"babel\":  &#123;</span><br><span class=\"line\">    \"plugins\":  [</span><br><span class=\"line\">        <span class=\"string\">\"react-hot-loader/babel\"</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"presets\":  [</span><br><span class=\"line\">        <span class=\"string\">\"react-app\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改webpack-config-dev-js\"><a href=\"#修改webpack-config-dev-js\" class=\"headerlink\" title=\"修改webpack.config.dev.js\"></a>修改webpack.config.dev.js</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 打包入口文件处添加</span></span><br><span class=\"line\">entry: [</span><br><span class=\"line\">    <span class=\"string\">'react-hot-loader/patch'</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置App-js项目入口\"><a href=\"#配置App-js项目入口\" class=\"headerlink\" title=\"配置App.js项目入口\"></a>配置App.js项目入口</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span>  <span class=\"string\">'react'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; hot &#125; <span class=\"keyword\">from</span>  <span class=\"string\">'react-hot-loader'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span></span>&#123;</span><br><span class=\"line\">    render () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            &lt;div className=<span class=\"string\">\"App\"</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> hot(<span class=\"built_in\">module</span>)(App)</span><br></pre></td></tr></table></figure>\n\n<p>参考链接： <a href=\"https://www.jianshu.com/p/45ebcea63057\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/45ebcea63057</a></p>\n<h2 id=\"配置ES7修饰器\"><a href=\"#配置ES7修饰器\" class=\"headerlink\" title=\"配置ES7修饰器\"></a>配置ES7修饰器</h2><h3 id=\"下载babel插件\"><a href=\"#下载babel插件\" class=\"headerlink\" title=\"下载babel插件\"></a>下载babel插件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add babel-plugin-transform-decorators-legacy @babel/plugin-proposal-decorators -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改package-json-1\"><a href=\"#修改package-json-1\" class=\"headerlink\" title=\"修改package.json\"></a>修改package.json</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"babel\": &#123;</span><br><span class=\"line\">    \"plugins\": [</span><br><span class=\"line\">        [</span><br><span class=\"line\">            <span class=\"string\">\"@babel/plugin-proposal-decorators\"</span>,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"legacy\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        [</span><br><span class=\"line\">            <span class=\"string\">\"@babel/plugin-proposal-class-properties\"</span>,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"loose\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"presets\": [</span><br><span class=\"line\">        <span class=\"string\">\"react-app\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>参考链接： <a href=\"https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/ZhangYaBo_Code/article/details/83066844</a></p>\n<h2 id=\"配置less\"><a href=\"#配置less\" class=\"headerlink\" title=\"配置less\"></a>配置less</h2><h3 id=\"下载less及相关loader\"><a href=\"#下载less及相关loader\" class=\"headerlink\" title=\"下载less及相关loader\"></a>下载less及相关loader</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add less-loader less -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改webpack-config-dev-js-1\"><a href=\"#修改webpack-config-dev-js-1\" class=\"headerlink\" title=\"修改webpack.config.dev.js\"></a>修改<code>webpack.config.dev.js</code></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. 添加 less 正则等变量</span></span><br><span class=\"line\"><span class=\"comment\">// style files regexes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> cssRegex = <span class=\"regexp\">/\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> cssModuleRegex = <span class=\"regexp\">/\\.module\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessRegex = <span class=\"regexp\">/\\.less$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessModuleRegex = <span class=\"regexp\">/\\.module\\.less$/</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getStyleLoaders = <span class=\"function\">(<span class=\"params\">cssOptions, preProcessor, processorOptions=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> loaders = [</span><br><span class=\"line\">        <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'style-loader'</span>),</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'css-loader'</span>),</span><br><span class=\"line\">            options: cssOptions,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'postcss-loader'</span>),</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">                ident: <span class=\"string\">'postcss'</span>,</span><br><span class=\"line\">                plugins: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> [</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-flexbugs-fixes'</span>),</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-preset-env'</span>)(&#123;</span><br><span class=\"line\">                        autoprefixer: &#123;</span><br><span class=\"line\">                            flexbox: <span class=\"string\">'no-2009'</span>,</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        stage: <span class=\"number\">3</span>,</span><br><span class=\"line\">                    &#125;),</span><br><span class=\"line\">                ],</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (preProcessor) &#123;</span><br><span class=\"line\">        loaders.push(&#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(preProcessor),</span><br><span class=\"line\">            options: <span class=\"built_in\">Object</span>.assign(processorOptions)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> loaders;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. 修改module部分 将之前所有采用use配置loader部分全部替换成loader</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        oneOf: [</span><br><span class=\"line\">            ...</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: cssRegex,</span><br><span class=\"line\">                exclude: cssModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;</span><br><span class=\"line\">                    importLoaders: <span class=\"number\">1</span>,</span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: cssModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;</span><br><span class=\"line\">                importLoaders: <span class=\"number\">1</span>,</span><br><span class=\"line\">                modules: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    getLocalIdent: getCSSModuleLocalIdent,</span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: sassRegex,</span><br><span class=\"line\">                exclude: sassModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123; <span class=\"attr\">importLoaders</span>: <span class=\"number\">2</span> &#125;, <span class=\"string\">'sass-loader'</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: sassModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;</span><br><span class=\"line\">                    importLoaders: <span class=\"number\">2</span>,</span><br><span class=\"line\">                    modules: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    getLocalIdent: getCSSModuleLocalIdent,</span><br><span class=\"line\">                &#125;, <span class=\"string\">'sass-loader'</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"comment\">// less</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                test: lessRegex,</span><br><span class=\"line\">                exclude: lessModuleRegex,</span><br><span class=\"line\">                loader: getStyleLoaders(&#123;<span class=\"attr\">importLoaders</span>: <span class=\"number\">2</span>&#125;,<span class=\"string\">'less-loader'</span>,&#123;</span><br><span class=\"line\">                    javascriptEnabled: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        ],</span><br><span class=\"line\">    &#125;],</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改webpack-config-prod-js\"><a href=\"#修改webpack-config-prod-js\" class=\"headerlink\" title=\"修改webpack.config-prod.js\"></a>修改<code>webpack.config-prod.js</code></h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. 添加less正则等变量</span></span><br><span class=\"line\"><span class=\"comment\">// style files regexes</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> cssRegex = <span class=\"regexp\">/\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> cssModuleRegex = <span class=\"regexp\">/\\.module\\.css$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessRegex = <span class=\"regexp\">/\\.less$/</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lessModuleRegex = <span class=\"regexp\">/\\.module\\.less$/</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2. 修改getStyleLoaders方法，添加一个processorOptions选项用来设置新添加loader的options选项</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getStyleLoaders = <span class=\"function\">(<span class=\"params\">cssOptions, preProcessor, processorOptions = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> loaders = [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: MiniCssExtractPlugin.loader,</span><br><span class=\"line\">            options: <span class=\"built_in\">Object</span>.assign(</span><br><span class=\"line\">                &#123;&#125;,</span><br><span class=\"line\">                shouldUseRelativeAssetPaths ? &#123; <span class=\"attr\">publicPath</span>: <span class=\"string\">'../../'</span> &#125; : <span class=\"literal\">undefined</span></span><br><span class=\"line\">            ),</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'css-loader'</span>),</span><br><span class=\"line\">            options: cssOptions,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'postcss-loader'</span>),</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">                ident: <span class=\"string\">'postcss'</span>,</span><br><span class=\"line\">                plugins: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> [</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-flexbugs-fixes'</span>),</span><br><span class=\"line\">                    <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-preset-env'</span>)(&#123;</span><br><span class=\"line\">                        autoprefixer: &#123;</span><br><span class=\"line\">                            flexbox: <span class=\"string\">'no-2009'</span>,</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        stage: <span class=\"number\">3</span>,</span><br><span class=\"line\">                    &#125;),</span><br><span class=\"line\">                ],</span><br><span class=\"line\">                sourceMap: shouldUseSourceMap,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (preProcessor) &#123;</span><br><span class=\"line\">        loaders.push(&#123;</span><br><span class=\"line\">            loader: <span class=\"built_in\">require</span>.resolve(preProcessor),</span><br><span class=\"line\">            options: <span class=\"built_in\">Object</span>.assign(&#123;</span><br><span class=\"line\">                sourceMap: shouldUseSourceMap,</span><br><span class=\"line\">            &#125;, processorOptions)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> loaders;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3. 修改module部分  将之前所有采用use配置loader部分全部替换成loader</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">            oneOf: [</span><br><span class=\"line\">                ...</span><br><span class=\"line\">                <span class=\"comment\">// less</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    test: lessRegex,</span><br><span class=\"line\">                    exclude: lessModuleRegex,</span><br><span class=\"line\">                    loader: getStyleLoaders(&#123; <span class=\"attr\">importLoaders</span>: <span class=\"number\">2</span>, <span class=\"attr\">sourceMap</span>: shouldUseSourceMap &#125;, <span class=\"string\">'less-loader'</span>, &#123;</span><br><span class=\"line\">                        javascriptEnabled: <span class=\"literal\">true</span></span><br><span class=\"line\">                    &#125;),</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                ...</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>参考链接： <a href=\"https://segmentfault.com/a/1190000010162614\" target=\"_blank\" rel=\"noopener\">https://segmentfault.com/a/1190000010162614</a></p>\n<h2 id=\"配置antd按需加载\"><a href=\"#配置antd按需加载\" class=\"headerlink\" title=\"配置antd按需加载\"></a>配置antd按需加载</h2><h3 id=\"安装插件-1\"><a href=\"#安装插件-1\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add babel-plugin-import -D</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改package-json-2\"><a href=\"#修改package-json-2\" class=\"headerlink\" title=\"修改package.json\"></a>修改package.json</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"babel\": &#123;</span><br><span class=\"line\">    \"plugins\": [</span><br><span class=\"line\">         [<span class=\"string\">\"import\"</span>,&#123;<span class=\"attr\">\"libraryName\"</span>:  <span class=\"string\">\"antd\"</span>,<span class=\"attr\">\"style\"</span>:  <span class=\"string\">\"css\"</span>&#125;]</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    \"presets\": [</span><br><span class=\"line\">        <span class=\"string\">\"react-app\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>或者配置</strong><code>webpack.config.dev.js</code>和<code>webpack.config.prod.js</code>文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    test: <span class=\"regexp\">/\\.(js|mjs|jsx|ts|tsx)$/</span>,</span><br><span class=\"line\">    include: paths.appSrc,</span><br><span class=\"line\">    loader: <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'babel-loader'</span>),</span><br><span class=\"line\">    options: &#123;</span><br><span class=\"line\">        customize: <span class=\"built_in\">require</span>.resolve(</span><br><span class=\"line\">            <span class=\"string\">'babel-preset-react-app/webpack-overrides'</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        plugins: [</span><br><span class=\"line\">            [</span><br><span class=\"line\">                <span class=\"built_in\">require</span>.resolve(<span class=\"string\">'babel-plugin-named-asset-import'</span>),</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    loaderMap: &#123;</span><br><span class=\"line\">                        svg: &#123;</span><br><span class=\"line\">                            ReactComponent: <span class=\"string\">'@svgr/webpack?-prettier,-svgo![path]'</span>,</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                [<span class=\"string\">'import'</span>, [&#123; <span class=\"attr\">libraryName</span>: <span class=\"string\">\"antd\"</span>, <span class=\"attr\">style</span>: <span class=\"string\">'css'</span> &#125;]]</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        cacheDirectory: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        cacheCompression: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>以上两种方法任何一种都可以实现，个人感觉上面方法比较简单一些😺。</p>\n<p>参考链接： <a href=\"https://blog.csdn.net/well2049/article/details/78801228\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/well2049/article/details/78801228</a></p>\n"},{"title":"vue调试神器vue-devtools安装","date":"2019-07-29T07:27:48.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095601.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095601.jpg) \n\n\n\n欲先攻其事必先利其器，就先来弄弄这个工具`vue-devtools`。\n\n\n\n### vue-devtools是什么\n\n`vue-devtools`是一款用来调试`Vue`应用的`Chrome`插件,可极大提高开发者调试项目效率,接着我们说一下如何下载安装这个插件。\n\n### 直接下载插件\n\n国内无法访问(你懂得)，有条件的可以访问这个下载 : [国外Chrome插件下载](https://chrome.google.com/webstore/category/extensions)\n\n访问不了外网的也没事，可以访问国内的地址：[国内Chrome插件下载](http://www.cnplugins.com/)\n\n\n\n### 自己编译安装\n\n上面两种你都下载不了，那只能本地编译安装了🤣🤣🤣\n\n1. 第一步 : 克隆项目到本地\n\n- 找到github上vue-devtools项目\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608-1.png)\n\n- 使用git讲代码克隆到本地 : `git clone https://github.com/vuejs/vue-devtools.git`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095602.png)\n\n2. 第二步 :下载相关依赖 : \n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095603.png)\n\n3. 第三步 : 项目打包  （yarn build 或 npm run build）\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095604.png)\n\n4. 第四步：\n\n- 打开chrome 更多工具 -> 扩展程序 -> 加载已解压的扩展程序\n\n  ![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095607.png)\n\n- 选择打包好的文件\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608.png)\n\n- 添加插件\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095605.png)\n\n5. 第五步：F12打开控制台点击最右侧vue选项卡\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095606.png)\n\n自此搞定O(∩_∩)O哈哈~","source":"_posts/vue调试神器vue-devtools安装.md","raw":"---\ntitle: vue调试神器vue-devtools安装\ndate: 2019-07-29 15:27:48\ntags: Vue\ncategories: 实用工具\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095601.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095601.jpg) \n\n\n\n欲先攻其事必先利其器，就先来弄弄这个工具`vue-devtools`。\n\n\n\n### vue-devtools是什么\n\n`vue-devtools`是一款用来调试`Vue`应用的`Chrome`插件,可极大提高开发者调试项目效率,接着我们说一下如何下载安装这个插件。\n\n### 直接下载插件\n\n国内无法访问(你懂得)，有条件的可以访问这个下载 : [国外Chrome插件下载](https://chrome.google.com/webstore/category/extensions)\n\n访问不了外网的也没事，可以访问国内的地址：[国内Chrome插件下载](http://www.cnplugins.com/)\n\n\n\n### 自己编译安装\n\n上面两种你都下载不了，那只能本地编译安装了🤣🤣🤣\n\n1. 第一步 : 克隆项目到本地\n\n- 找到github上vue-devtools项目\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608-1.png)\n\n- 使用git讲代码克隆到本地 : `git clone https://github.com/vuejs/vue-devtools.git`\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095602.png)\n\n2. 第二步 :下载相关依赖 : \n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095603.png)\n\n3. 第三步 : 项目打包  （yarn build 或 npm run build）\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095604.png)\n\n4. 第四步：\n\n- 打开chrome 更多工具 -> 扩展程序 -> 加载已解压的扩展程序\n\n  ![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095607.png)\n\n- 选择打包好的文件\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608.png)\n\n- 添加插件\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095605.png)\n\n5. 第五步：F12打开控制台点击最右侧vue选项卡\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095606.png)\n\n自此搞定O(∩_∩)O哈哈~","slug":"vue调试神器vue-devtools安装","published":1,"updated":"2019-07-29T12:40:05.755Z","_id":"cjysbhucb000vqbt5df9k4lca","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095601.jpg\" alt> </p>\n<p>欲先攻其事必先利其器，就先来弄弄这个工具<code>vue-devtools</code>。</p>\n<h3 id=\"vue-devtools是什么\"><a href=\"#vue-devtools是什么\" class=\"headerlink\" title=\"vue-devtools是什么\"></a>vue-devtools是什么</h3><p><code>vue-devtools</code>是一款用来调试<code>Vue</code>应用的<code>Chrome</code>插件,可极大提高开发者调试项目效率,接着我们说一下如何下载安装这个插件。</p>\n<h3 id=\"直接下载插件\"><a href=\"#直接下载插件\" class=\"headerlink\" title=\"直接下载插件\"></a>直接下载插件</h3><p>国内无法访问(你懂得)，有条件的可以访问这个下载 : <a href=\"https://chrome.google.com/webstore/category/extensions\" target=\"_blank\" rel=\"noopener\">国外Chrome插件下载</a></p>\n<p>访问不了外网的也没事，可以访问国内的地址：<a href=\"http://www.cnplugins.com/\" target=\"_blank\" rel=\"noopener\">国内Chrome插件下载</a></p>\n<h3 id=\"自己编译安装\"><a href=\"#自己编译安装\" class=\"headerlink\" title=\"自己编译安装\"></a>自己编译安装</h3><p>上面两种你都下载不了，那只能本地编译安装了🤣🤣🤣</p>\n<ol>\n<li>第一步 : 克隆项目到本地</li>\n</ol>\n<ul>\n<li>找到github上vue-devtools项目</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608-1.png\" alt></p>\n<ul>\n<li>使用git讲代码克隆到本地 : <code>git clone https://github.com/vuejs/vue-devtools.git</code></li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095602.png\" alt></p>\n<ol start=\"2\">\n<li>第二步 :下载相关依赖 : </li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095603.png\" alt></p>\n<ol start=\"3\">\n<li>第三步 : 项目打包  （yarn build 或 npm run build）</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095604.png\" alt></p>\n<ol start=\"4\">\n<li>第四步：</li>\n</ol>\n<ul>\n<li><p>打开chrome 更多工具 -&gt; 扩展程序 -&gt; 加载已解压的扩展程序</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095607.png\" alt></p>\n</li>\n<li><p>选择打包好的文件</p>\n</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608.png\" alt></p>\n<ul>\n<li>添加插件</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095605.png\" alt></p>\n<ol start=\"5\">\n<li>第五步：F12打开控制台点击最右侧vue选项卡</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095606.png\" alt></p>\n<p>自此搞定O(∩_∩)O哈哈~</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095601.jpg\" alt> </p>\n<p>欲先攻其事必先利其器，就先来弄弄这个工具<code>vue-devtools</code>。</p>\n<h3 id=\"vue-devtools是什么\"><a href=\"#vue-devtools是什么\" class=\"headerlink\" title=\"vue-devtools是什么\"></a>vue-devtools是什么</h3><p><code>vue-devtools</code>是一款用来调试<code>Vue</code>应用的<code>Chrome</code>插件,可极大提高开发者调试项目效率,接着我们说一下如何下载安装这个插件。</p>\n<h3 id=\"直接下载插件\"><a href=\"#直接下载插件\" class=\"headerlink\" title=\"直接下载插件\"></a>直接下载插件</h3><p>国内无法访问(你懂得)，有条件的可以访问这个下载 : <a href=\"https://chrome.google.com/webstore/category/extensions\" target=\"_blank\" rel=\"noopener\">国外Chrome插件下载</a></p>\n<p>访问不了外网的也没事，可以访问国内的地址：<a href=\"http://www.cnplugins.com/\" target=\"_blank\" rel=\"noopener\">国内Chrome插件下载</a></p>\n<h3 id=\"自己编译安装\"><a href=\"#自己编译安装\" class=\"headerlink\" title=\"自己编译安装\"></a>自己编译安装</h3><p>上面两种你都下载不了，那只能本地编译安装了🤣🤣🤣</p>\n<ol>\n<li>第一步 : 克隆项目到本地</li>\n</ol>\n<ul>\n<li>找到github上vue-devtools项目</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608-1.png\" alt></p>\n<ul>\n<li>使用git讲代码克隆到本地 : <code>git clone https://github.com/vuejs/vue-devtools.git</code></li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095602.png\" alt></p>\n<ol start=\"2\">\n<li>第二步 :下载相关依赖 : </li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095603.png\" alt></p>\n<ol start=\"3\">\n<li>第三步 : 项目打包  （yarn build 或 npm run build）</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095604.png\" alt></p>\n<ol start=\"4\">\n<li>第四步：</li>\n</ol>\n<ul>\n<li><p>打开chrome 更多工具 -&gt; 扩展程序 -&gt; 加载已解压的扩展程序</p>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095607.png\" alt></p>\n</li>\n<li><p>选择打包好的文件</p>\n</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095608.png\" alt></p>\n<ul>\n<li>添加插件</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095605.png\" alt></p>\n<ol start=\"5\">\n<li>第五步：F12打开控制台点击最右侧vue选项卡</li>\n</ol>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/095606.png\" alt></p>\n<p>自此搞定O(∩_∩)O哈哈~</p>\n"},{"title":"面向对象从ES3到ES6+的继承方法总结以及对比","date":"2019-07-29T12:47:23.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/081804.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/081804.jpg)\n\n继承是面向对象中一个非常重要的概念，`Javascript`中可以实现继承，但不支持接口的继承。并且我们js中主要是`依赖原型链实现继承`的，下面说说从**es3**到**es5**中常见的几种继承方式。\n\n**首先**我们**假设**我们有两个类一个`Television`(电视)和`Computer`(电脑)\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nfunction Computer() {\n    this.name = '电脑'\n}\n```\n\n`Television`(电视)有个功能叫`play`(播放)，`Computer`(电脑)有个`compute`(计算)的功能。\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n  \nTelevision.prototype.play = function() {\n    alert('播放')\n}\n  \nfunction Computer() {\n    this.name = '电脑'\n}\n  \nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n然而我们知道`Computer`(电脑)也有`play`(播放)这个功能功能。那你会想到再给`Computer`(电脑)也添加一个`play`(播放)的功能不就好了，但是这样无形中浪费内存的资源，而且写起来也不比较繁琐，这不是我们想要的。这时候继承就出场了，而且实现继承的方式有很多种各有优缺点，接下来我们将每一种拿出来并对比一下他们的优缺点：\n\n\n\n### 原型链继承\n\n先上代码\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    this.name = '电脑'\n}\n\n//必须将这句写到上面否则下面的方法会被覆盖掉\nComputer.prototype = new Television()\n\n//因为new Television()实例没有constructor方法 所以我们要讲constructor指向Computer\nComputer.prototype.constructor = Computer\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n`[ 注意 ]` \n\n> 1. `Computer.prototype =  new Television()`必须写在子类定义原型方法(如现在的`compute`方法)之前,否则子类定义的原型方法会丢失（因为`Computer.prototype`指向堆内存地址变了嘛）。\n> 2. 因为父类`Television`生成的对象是没有constructor属性，所以给他加上（为啥没有？我就不用再详细说了吧 (〃'▽'〃)）\n\n\n`[ 优点 ]`\n\n-  实例是子类的实例，实际上也是父类的一个实例\n-  父类新增原型方法/原型属性，子类都能访问到\n\n`[ 缺点 ]`\n\n- 子类的实例的原型都共享同一个父类实例的属性和方法\n- 无法继承父类构造函数的属性及方法( new Computer().telecontroller //=> undefined )\n\n\n\n### 构造继承\n\n这个就比较简单啦，上代码\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    //在这里直接调用父类的方法修改父类的this上下文\n    Television.call(this)\n    this.name =  '电脑'\n}\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n`[ 优点 ]`\n\n-  简单明了，直接继承父类构造函数的属性及方法\n\n`[ 缺点 ]`\n\n- 无法继承父类原型链上的方法（new Computer().play //=> undefined）\n\n\n\n### 组合继承\n\n原型链继承与构造继承相结合各取所长，看下实现\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    Television.call(this)\n    this.name = '电脑'\n}\n\nComputer.prototype = new Television()\n\nComputer.prototype.constructor = Computer\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n\n`[ 优点 ]`\n\n-  子类既能继承父类构造函数中的属性和方法，又能继承父类原型链上的方法\n\n`[ 缺点 ]`\n\n- 子类会拥有父类的两份属性，只是子类属性将其覆盖了而已\n\n    \n\n### 原型式继承\n\n原型式继承其实就是定义一个方法，传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，实现以下\n\n首先我们创建一个`objectExtends`方法\n\n```javascript\nvar obj = {\n    name: '电视',\n    telecontroller: '遥控器'\n}\n\nfunction objectExtends(obj) {\n    function F(){}\n    F.prototype = obj\n    return new F()\n}\n```\n\n`[ 优点 ]`\n\n-  简单易懂，直接通过对象生成一个继承该对象的新对象\n\n`[ 缺点 ]`\n\n- 不是类式继承，缺少类的概念\n\n    \n\n### 寄生式继承\n\n\n这个名词很厉害，说白了就是原型式继承的加强版，同样传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，然后在另一方法中以其他方式增强这个obj对象，返回最终的对象， 实现以下\n\n首先我们创建一个`objectExtends`和`objectEnhance`方法\n\n`objectExtends`方法作用依旧是实现原型式继承\n`objectEnhance`方法就是在`objectExtends`方法的基础上对新的obj对象扩展他的原型方法而已\n\n```javascript\nvar obj = {\n    name: '电视',\n    telecontroller: '遥控器'\n}\n\nfunction  objectExtends(oldObj) {\n    function F(){}\n    F.prototype = obj\n\n    return new F()\n}\n\nfunction objectEnhance(obj) {\n    var newObj = objectCreate(obj)\n\n    newObj.property = function() {\n        alert('扩展一个方法出来')\n    }\n\n    return newObj\n}\n```\n\n`[ 优点 ]`\n\n-  相比原型式继承更加强悍，增强了原型式继承的能力\n\n`[ 缺点 ]`\n\n- 和原型式继一样，缺少类的概念\n\n\n\n### 寄生组合式继承\n\n看名字就知道`寄生组合式继承`就是结合了`寄生式继承`和`组合式继承`，也是继承的终极解决方案\n\n```javascript\nfunction  Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    Television.call(this)\n    this.name = '电脑'\n}\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n\nfunction inheritPrototype(Father,Son){\n    var newPrototype = Object.create(Father.prototype)\n\n    newPrototype.constructor = Son\n    Son.prototype = newPrototype\n}\n\ninheritPrototype(Television, Computer)\n```\n\n`[ 优点 ]`\n\n-  很完美\n\n`[ 缺点 ]`\n\n- 太繁琐\n\n    \n\n### ES6中的继承\n\nES6的话就比较简单了，如果有不了解的可以去看看[阮一峰的ECMAScript 6入门](http://es6.ruanyifeng.com/)\n\n\n```javascript\nclass Television {\n    constructor() {\n        this.name =  '电视'\n        this.telecontroller =  '遥控器'\n    }\n\n    play() {\n        alert('播放')\n    }\n}\n\nclass Computer extends Television{\n    constructor() {\n        super()\n        this.name = '电脑'\n    }\n\n    compute() {\n        alert('计算')\n    }\n}\n```\n\n**`[ 注意 ]`**\n\n- 如果你的子类重写了`constructor`方法，记得调用`super`,以确保父类构造逻辑运行\n\n`[ 优点 ]`\n\n-  和寄生组合式继承实现的效果一致\n\n\n\n---\n\n### 关于ES5和ES6中继承的图片\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125157.jpg)\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125209.jpg) \n\n\n\n**更多参考链接：**\n\n[JS继承实现的几种方式及其优缺点](https://segmentfault.com/a/1190000011151188)\n\n[两图看懂ES5和ES6中的继承](https://www.jianshu.com/p/d1bd2218b1f2)\n\n[关于 ES6 中的 Class 的几个特性和玩法](https://www.jianshu.com/p/6c18968c317b)\n\n\n\n**好了，有问题的可以再下方留言 (๑•ω•๑)**","source":"_posts/面向对象从ES3到ES6-的继承方法总结以及对比.md","raw":"---\ntitle: 面向对象从ES3到ES6+的继承方法总结以及对比\ndate: 2019-07-29 20:47:23\ntags: Javascript\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/081804.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/081804.jpg)\n\n继承是面向对象中一个非常重要的概念，`Javascript`中可以实现继承，但不支持接口的继承。并且我们js中主要是`依赖原型链实现继承`的，下面说说从**es3**到**es5**中常见的几种继承方式。\n\n**首先**我们**假设**我们有两个类一个`Television`(电视)和`Computer`(电脑)\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nfunction Computer() {\n    this.name = '电脑'\n}\n```\n\n`Television`(电视)有个功能叫`play`(播放)，`Computer`(电脑)有个`compute`(计算)的功能。\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n  \nTelevision.prototype.play = function() {\n    alert('播放')\n}\n  \nfunction Computer() {\n    this.name = '电脑'\n}\n  \nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n然而我们知道`Computer`(电脑)也有`play`(播放)这个功能功能。那你会想到再给`Computer`(电脑)也添加一个`play`(播放)的功能不就好了，但是这样无形中浪费内存的资源，而且写起来也不比较繁琐，这不是我们想要的。这时候继承就出场了，而且实现继承的方式有很多种各有优缺点，接下来我们将每一种拿出来并对比一下他们的优缺点：\n\n\n\n### 原型链继承\n\n先上代码\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    this.name = '电脑'\n}\n\n//必须将这句写到上面否则下面的方法会被覆盖掉\nComputer.prototype = new Television()\n\n//因为new Television()实例没有constructor方法 所以我们要讲constructor指向Computer\nComputer.prototype.constructor = Computer\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n`[ 注意 ]` \n\n> 1. `Computer.prototype =  new Television()`必须写在子类定义原型方法(如现在的`compute`方法)之前,否则子类定义的原型方法会丢失（因为`Computer.prototype`指向堆内存地址变了嘛）。\n> 2. 因为父类`Television`生成的对象是没有constructor属性，所以给他加上（为啥没有？我就不用再详细说了吧 (〃'▽'〃)）\n\n\n`[ 优点 ]`\n\n-  实例是子类的实例，实际上也是父类的一个实例\n-  父类新增原型方法/原型属性，子类都能访问到\n\n`[ 缺点 ]`\n\n- 子类的实例的原型都共享同一个父类实例的属性和方法\n- 无法继承父类构造函数的属性及方法( new Computer().telecontroller //=> undefined )\n\n\n\n### 构造继承\n\n这个就比较简单啦，上代码\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    //在这里直接调用父类的方法修改父类的this上下文\n    Television.call(this)\n    this.name =  '电脑'\n}\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n`[ 优点 ]`\n\n-  简单明了，直接继承父类构造函数的属性及方法\n\n`[ 缺点 ]`\n\n- 无法继承父类原型链上的方法（new Computer().play //=> undefined）\n\n\n\n### 组合继承\n\n原型链继承与构造继承相结合各取所长，看下实现\n\n```javascript\nfunction Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    Television.call(this)\n    this.name = '电脑'\n}\n\nComputer.prototype = new Television()\n\nComputer.prototype.constructor = Computer\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n```\n\n\n`[ 优点 ]`\n\n-  子类既能继承父类构造函数中的属性和方法，又能继承父类原型链上的方法\n\n`[ 缺点 ]`\n\n- 子类会拥有父类的两份属性，只是子类属性将其覆盖了而已\n\n    \n\n### 原型式继承\n\n原型式继承其实就是定义一个方法，传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，实现以下\n\n首先我们创建一个`objectExtends`方法\n\n```javascript\nvar obj = {\n    name: '电视',\n    telecontroller: '遥控器'\n}\n\nfunction objectExtends(obj) {\n    function F(){}\n    F.prototype = obj\n    return new F()\n}\n```\n\n`[ 优点 ]`\n\n-  简单易懂，直接通过对象生成一个继承该对象的新对象\n\n`[ 缺点 ]`\n\n- 不是类式继承，缺少类的概念\n\n    \n\n### 寄生式继承\n\n\n这个名词很厉害，说白了就是原型式继承的加强版，同样传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，然后在另一方法中以其他方式增强这个obj对象，返回最终的对象， 实现以下\n\n首先我们创建一个`objectExtends`和`objectEnhance`方法\n\n`objectExtends`方法作用依旧是实现原型式继承\n`objectEnhance`方法就是在`objectExtends`方法的基础上对新的obj对象扩展他的原型方法而已\n\n```javascript\nvar obj = {\n    name: '电视',\n    telecontroller: '遥控器'\n}\n\nfunction  objectExtends(oldObj) {\n    function F(){}\n    F.prototype = obj\n\n    return new F()\n}\n\nfunction objectEnhance(obj) {\n    var newObj = objectCreate(obj)\n\n    newObj.property = function() {\n        alert('扩展一个方法出来')\n    }\n\n    return newObj\n}\n```\n\n`[ 优点 ]`\n\n-  相比原型式继承更加强悍，增强了原型式继承的能力\n\n`[ 缺点 ]`\n\n- 和原型式继一样，缺少类的概念\n\n\n\n### 寄生组合式继承\n\n看名字就知道`寄生组合式继承`就是结合了`寄生式继承`和`组合式继承`，也是继承的终极解决方案\n\n```javascript\nfunction  Television() {\n    this.name = '电视'\n    this.telecontroller = '遥控器'\n}\n\nTelevision.prototype.play = function() {\n    alert('播放')\n}\n\nfunction Computer() {\n    Television.call(this)\n    this.name = '电脑'\n}\n\nComputer.prototype.compute = function() {\n    alert('计算')\n}\n\nfunction inheritPrototype(Father,Son){\n    var newPrototype = Object.create(Father.prototype)\n\n    newPrototype.constructor = Son\n    Son.prototype = newPrototype\n}\n\ninheritPrototype(Television, Computer)\n```\n\n`[ 优点 ]`\n\n-  很完美\n\n`[ 缺点 ]`\n\n- 太繁琐\n\n    \n\n### ES6中的继承\n\nES6的话就比较简单了，如果有不了解的可以去看看[阮一峰的ECMAScript 6入门](http://es6.ruanyifeng.com/)\n\n\n```javascript\nclass Television {\n    constructor() {\n        this.name =  '电视'\n        this.telecontroller =  '遥控器'\n    }\n\n    play() {\n        alert('播放')\n    }\n}\n\nclass Computer extends Television{\n    constructor() {\n        super()\n        this.name = '电脑'\n    }\n\n    compute() {\n        alert('计算')\n    }\n}\n```\n\n**`[ 注意 ]`**\n\n- 如果你的子类重写了`constructor`方法，记得调用`super`,以确保父类构造逻辑运行\n\n`[ 优点 ]`\n\n-  和寄生组合式继承实现的效果一致\n\n\n\n---\n\n### 关于ES5和ES6中继承的图片\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125157.jpg)\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125209.jpg) \n\n\n\n**更多参考链接：**\n\n[JS继承实现的几种方式及其优缺点](https://segmentfault.com/a/1190000011151188)\n\n[两图看懂ES5和ES6中的继承](https://www.jianshu.com/p/d1bd2218b1f2)\n\n[关于 ES6 中的 Class 的几个特性和玩法](https://www.jianshu.com/p/6c18968c317b)\n\n\n\n**好了，有问题的可以再下方留言 (๑•ω•๑)**","slug":"面向对象从ES3到ES6-的继承方法总结以及对比","published":1,"updated":"2019-07-30T08:18:15.715Z","_id":"cjysbhucc000yqbt5b6o0vet5","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/081804.jpg\" alt></p>\n<p>继承是面向对象中一个非常重要的概念，<code>Javascript</code>中可以实现继承，但不支持接口的继承。并且我们js中主要是<code>依赖原型链实现继承</code>的，下面说说从<strong>es3</strong>到<strong>es5</strong>中常见的几种继承方式。</p>\n<p><strong>首先</strong>我们<strong>假设</strong>我们有两个类一个<code>Television</code>(电视)和<code>Computer</code>(电脑)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Television</code>(电视)有个功能叫<code>play</code>(播放)，<code>Computer</code>(电脑)有个<code>compute</code>(计算)的功能。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然而我们知道<code>Computer</code>(电脑)也有<code>play</code>(播放)这个功能功能。那你会想到再给<code>Computer</code>(电脑)也添加一个<code>play</code>(播放)的功能不就好了，但是这样无形中浪费内存的资源，而且写起来也不比较繁琐，这不是我们想要的。这时候继承就出场了，而且实现继承的方式有很多种各有优缺点，接下来我们将每一种拿出来并对比一下他们的优缺点：</p>\n<h3 id=\"原型链继承\"><a href=\"#原型链继承\" class=\"headerlink\" title=\"原型链继承\"></a>原型链继承</h3><p>先上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//必须将这句写到上面否则下面的方法会被覆盖掉</span></span><br><span class=\"line\">Computer.prototype = <span class=\"keyword\">new</span> Television()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//因为new Television()实例没有constructor方法 所以我们要讲constructor指向Computer</span></span><br><span class=\"line\">Computer.prototype.constructor = Computer</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 注意 ]</code> </p>\n<blockquote>\n<ol>\n<li><code>Computer.prototype =  new Television()</code>必须写在子类定义原型方法(如现在的<code>compute</code>方法)之前,否则子类定义的原型方法会丢失（因为<code>Computer.prototype</code>指向堆内存地址变了嘛）。</li>\n<li>因为父类<code>Television</code>生成的对象是没有constructor属性，所以给他加上（为啥没有？我就不用再详细说了吧 (〃’▽’〃)）</li>\n</ol>\n</blockquote>\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>实例是子类的实例，实际上也是父类的一个实例</li>\n<li>父类新增原型方法/原型属性，子类都能访问到</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>子类的实例的原型都共享同一个父类实例的属性和方法</li>\n<li>无法继承父类构造函数的属性及方法( new Computer().telecontroller //=&gt; undefined )</li>\n</ul>\n<h3 id=\"构造继承\"><a href=\"#构造继承\" class=\"headerlink\" title=\"构造继承\"></a>构造继承</h3><p>这个就比较简单啦，上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//在这里直接调用父类的方法修改父类的this上下文</span></span><br><span class=\"line\">    Television.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name =  <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>简单明了，直接继承父类构造函数的属性及方法</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>无法继承父类原型链上的方法（new Computer().play //=&gt; undefined）</li>\n</ul>\n<h3 id=\"组合继承\"><a href=\"#组合继承\" class=\"headerlink\" title=\"组合继承\"></a>组合继承</h3><p>原型链继承与构造继承相结合各取所长，看下实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Television.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype = <span class=\"keyword\">new</span> Television()</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.constructor = Computer</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>子类既能继承父类构造函数中的属性和方法，又能继承父类原型链上的方法</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>子类会拥有父类的两份属性，只是子类属性将其覆盖了而已</li>\n</ul>\n<h3 id=\"原型式继承\"><a href=\"#原型式继承\" class=\"headerlink\" title=\"原型式继承\"></a>原型式继承</h3><p>原型式继承其实就是定义一个方法，传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，实现以下</p>\n<p>首先我们创建一个<code>objectExtends</code>方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'电视'</span>,</span><br><span class=\"line\">    telecontroller: <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">objectExtends</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">    F.prototype = obj</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>简单易懂，直接通过对象生成一个继承该对象的新对象</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>不是类式继承，缺少类的概念</li>\n</ul>\n<h3 id=\"寄生式继承\"><a href=\"#寄生式继承\" class=\"headerlink\" title=\"寄生式继承\"></a>寄生式继承</h3><p>这个名词很厉害，说白了就是原型式继承的加强版，同样传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，然后在另一方法中以其他方式增强这个obj对象，返回最终的对象， 实现以下</p>\n<p>首先我们创建一个<code>objectExtends</code>和<code>objectEnhance</code>方法</p>\n<p><code>objectExtends</code>方法作用依旧是实现原型式继承<br><code>objectEnhance</code>方法就是在<code>objectExtends</code>方法的基础上对新的obj对象扩展他的原型方法而已</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'电视'</span>,</span><br><span class=\"line\">    telecontroller: <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">objectExtends</span>(<span class=\"params\">oldObj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">    F.prototype = obj</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">objectEnhance</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> newObj = objectCreate(obj)</span><br><span class=\"line\"></span><br><span class=\"line\">    newObj.property = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'扩展一个方法出来'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> newObj</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>相比原型式继承更加强悍，增强了原型式继承的能力</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>和原型式继一样，缺少类的概念</li>\n</ul>\n<h3 id=\"寄生组合式继承\"><a href=\"#寄生组合式继承\" class=\"headerlink\" title=\"寄生组合式继承\"></a>寄生组合式继承</h3><p>看名字就知道<code>寄生组合式继承</code>就是结合了<code>寄生式继承</code>和<code>组合式继承</code>，也是继承的终极解决方案</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Television.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inheritPrototype</span>(<span class=\"params\">Father,Son</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> newPrototype = <span class=\"built_in\">Object</span>.create(Father.prototype)</span><br><span class=\"line\"></span><br><span class=\"line\">    newPrototype.constructor = Son</span><br><span class=\"line\">    Son.prototype = newPrototype</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">inheritPrototype(Television, Computer)</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>很完美</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>太繁琐</li>\n</ul>\n<h3 id=\"ES6中的继承\"><a href=\"#ES6中的继承\" class=\"headerlink\" title=\"ES6中的继承\"></a>ES6中的继承</h3><p>ES6的话就比较简单了，如果有不了解的可以去看看<a href=\"http://es6.ruanyifeng.com/\" target=\"_blank\" rel=\"noopener\">阮一峰的ECMAScript 6入门</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Television</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name =  <span class=\"string\">'电视'</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.telecontroller =  <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    play() &#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span> <span class=\"keyword\">extends</span> <span class=\"title\">Television</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>()</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    compute() &#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong><code>[ 注意 ]</code></strong></p>\n<ul>\n<li>如果你的子类重写了<code>constructor</code>方法，记得调用<code>super</code>,以确保父类构造逻辑运行</li>\n</ul>\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>和寄生组合式继承实现的效果一致</li>\n</ul>\n<hr>\n<h3 id=\"关于ES5和ES6中继承的图片\"><a href=\"#关于ES5和ES6中继承的图片\" class=\"headerlink\" title=\"关于ES5和ES6中继承的图片\"></a>关于ES5和ES6中继承的图片</h3><p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125157.jpg\" alt><br><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125209.jpg\" alt> </p>\n<p><strong>更多参考链接：</strong></p>\n<p><a href=\"https://segmentfault.com/a/1190000011151188\" target=\"_blank\" rel=\"noopener\">JS继承实现的几种方式及其优缺点</a></p>\n<p><a href=\"https://www.jianshu.com/p/d1bd2218b1f2\" target=\"_blank\" rel=\"noopener\">两图看懂ES5和ES6中的继承</a></p>\n<p><a href=\"https://www.jianshu.com/p/6c18968c317b\" target=\"_blank\" rel=\"noopener\">关于 ES6 中的 Class 的几个特性和玩法</a></p>\n<p><strong>好了，有问题的可以再下方留言 (๑•ω•๑)</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/081804.jpg\" alt></p>\n<p>继承是面向对象中一个非常重要的概念，<code>Javascript</code>中可以实现继承，但不支持接口的继承。并且我们js中主要是<code>依赖原型链实现继承</code>的，下面说说从<strong>es3</strong>到<strong>es5</strong>中常见的几种继承方式。</p>\n<p><strong>首先</strong>我们<strong>假设</strong>我们有两个类一个<code>Television</code>(电视)和<code>Computer</code>(电脑)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Television</code>(电视)有个功能叫<code>play</code>(播放)，<code>Computer</code>(电脑)有个<code>compute</code>(计算)的功能。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然而我们知道<code>Computer</code>(电脑)也有<code>play</code>(播放)这个功能功能。那你会想到再给<code>Computer</code>(电脑)也添加一个<code>play</code>(播放)的功能不就好了，但是这样无形中浪费内存的资源，而且写起来也不比较繁琐，这不是我们想要的。这时候继承就出场了，而且实现继承的方式有很多种各有优缺点，接下来我们将每一种拿出来并对比一下他们的优缺点：</p>\n<h3 id=\"原型链继承\"><a href=\"#原型链继承\" class=\"headerlink\" title=\"原型链继承\"></a>原型链继承</h3><p>先上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//必须将这句写到上面否则下面的方法会被覆盖掉</span></span><br><span class=\"line\">Computer.prototype = <span class=\"keyword\">new</span> Television()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//因为new Television()实例没有constructor方法 所以我们要讲constructor指向Computer</span></span><br><span class=\"line\">Computer.prototype.constructor = Computer</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 注意 ]</code> </p>\n<blockquote>\n<ol>\n<li><code>Computer.prototype =  new Television()</code>必须写在子类定义原型方法(如现在的<code>compute</code>方法)之前,否则子类定义的原型方法会丢失（因为<code>Computer.prototype</code>指向堆内存地址变了嘛）。</li>\n<li>因为父类<code>Television</code>生成的对象是没有constructor属性，所以给他加上（为啥没有？我就不用再详细说了吧 (〃’▽’〃)）</li>\n</ol>\n</blockquote>\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>实例是子类的实例，实际上也是父类的一个实例</li>\n<li>父类新增原型方法/原型属性，子类都能访问到</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>子类的实例的原型都共享同一个父类实例的属性和方法</li>\n<li>无法继承父类构造函数的属性及方法( new Computer().telecontroller //=&gt; undefined )</li>\n</ul>\n<h3 id=\"构造继承\"><a href=\"#构造继承\" class=\"headerlink\" title=\"构造继承\"></a>构造继承</h3><p>这个就比较简单啦，上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//在这里直接调用父类的方法修改父类的this上下文</span></span><br><span class=\"line\">    Television.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name =  <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>简单明了，直接继承父类构造函数的属性及方法</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>无法继承父类原型链上的方法（new Computer().play //=&gt; undefined）</li>\n</ul>\n<h3 id=\"组合继承\"><a href=\"#组合继承\" class=\"headerlink\" title=\"组合继承\"></a>组合继承</h3><p>原型链继承与构造继承相结合各取所长，看下实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Television.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype = <span class=\"keyword\">new</span> Television()</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.constructor = Computer</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>子类既能继承父类构造函数中的属性和方法，又能继承父类原型链上的方法</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>子类会拥有父类的两份属性，只是子类属性将其覆盖了而已</li>\n</ul>\n<h3 id=\"原型式继承\"><a href=\"#原型式继承\" class=\"headerlink\" title=\"原型式继承\"></a>原型式继承</h3><p>原型式继承其实就是定义一个方法，传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，实现以下</p>\n<p>首先我们创建一个<code>objectExtends</code>方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'电视'</span>,</span><br><span class=\"line\">    telecontroller: <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">objectExtends</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">    F.prototype = obj</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>简单易懂，直接通过对象生成一个继承该对象的新对象</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>不是类式继承，缺少类的概念</li>\n</ul>\n<h3 id=\"寄生式继承\"><a href=\"#寄生式继承\" class=\"headerlink\" title=\"寄生式继承\"></a>寄生式继承</h3><p>这个名词很厉害，说白了就是原型式继承的加强版，同样传入Object，并不需要定义一个类，传入参数obj返回一个继承obj对象的新对象，然后在另一方法中以其他方式增强这个obj对象，返回最终的对象， 实现以下</p>\n<p>首先我们创建一个<code>objectExtends</code>和<code>objectEnhance</code>方法</p>\n<p><code>objectExtends</code>方法作用依旧是实现原型式继承<br><code>objectEnhance</code>方法就是在<code>objectExtends</code>方法的基础上对新的obj对象扩展他的原型方法而已</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'电视'</span>,</span><br><span class=\"line\">    telecontroller: <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">objectExtends</span>(<span class=\"params\">oldObj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">    F.prototype = obj</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">objectEnhance</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> newObj = objectCreate(obj)</span><br><span class=\"line\"></span><br><span class=\"line\">    newObj.property = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'扩展一个方法出来'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> newObj</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>相比原型式继承更加强悍，增强了原型式继承的能力</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>和原型式继一样，缺少类的概念</li>\n</ul>\n<h3 id=\"寄生组合式继承\"><a href=\"#寄生组合式继承\" class=\"headerlink\" title=\"寄生组合式继承\"></a>寄生组合式继承</h3><p>看名字就知道<code>寄生组合式继承</code>就是结合了<code>寄生式继承</code>和<code>组合式继承</code>，也是继承的终极解决方案</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">Television</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电视'</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.telecontroller = <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Television.prototype.play = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Computer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Television.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.prototype.compute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inheritPrototype</span>(<span class=\"params\">Father,Son</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> newPrototype = <span class=\"built_in\">Object</span>.create(Father.prototype)</span><br><span class=\"line\"></span><br><span class=\"line\">    newPrototype.constructor = Son</span><br><span class=\"line\">    Son.prototype = newPrototype</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">inheritPrototype(Television, Computer)</span><br></pre></td></tr></table></figure>\n\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>很完美</li>\n</ul>\n<p><code>[ 缺点 ]</code></p>\n<ul>\n<li>太繁琐</li>\n</ul>\n<h3 id=\"ES6中的继承\"><a href=\"#ES6中的继承\" class=\"headerlink\" title=\"ES6中的继承\"></a>ES6中的继承</h3><p>ES6的话就比较简单了，如果有不了解的可以去看看<a href=\"http://es6.ruanyifeng.com/\" target=\"_blank\" rel=\"noopener\">阮一峰的ECMAScript 6入门</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Television</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name =  <span class=\"string\">'电视'</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.telecontroller =  <span class=\"string\">'遥控器'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    play() &#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'播放'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span> <span class=\"keyword\">extends</span> <span class=\"title\">Television</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>()</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = <span class=\"string\">'电脑'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    compute() &#123;</span><br><span class=\"line\">        alert(<span class=\"string\">'计算'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong><code>[ 注意 ]</code></strong></p>\n<ul>\n<li>如果你的子类重写了<code>constructor</code>方法，记得调用<code>super</code>,以确保父类构造逻辑运行</li>\n</ul>\n<p><code>[ 优点 ]</code></p>\n<ul>\n<li>和寄生组合式继承实现的效果一致</li>\n</ul>\n<hr>\n<h3 id=\"关于ES5和ES6中继承的图片\"><a href=\"#关于ES5和ES6中继承的图片\" class=\"headerlink\" title=\"关于ES5和ES6中继承的图片\"></a>关于ES5和ES6中继承的图片</h3><p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125157.jpg\" alt><br><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/125209.jpg\" alt> </p>\n<p><strong>更多参考链接：</strong></p>\n<p><a href=\"https://segmentfault.com/a/1190000011151188\" target=\"_blank\" rel=\"noopener\">JS继承实现的几种方式及其优缺点</a></p>\n<p><a href=\"https://www.jianshu.com/p/d1bd2218b1f2\" target=\"_blank\" rel=\"noopener\">两图看懂ES5和ES6中的继承</a></p>\n<p><a href=\"https://www.jianshu.com/p/6c18968c317b\" target=\"_blank\" rel=\"noopener\">关于 ES6 中的 Class 的几个特性和玩法</a></p>\n<p><strong>好了，有问题的可以再下方留言 (๑•ω•๑)</strong></p>\n"},{"title":"react-native中使用fetch发送https或http相关问题总结","date":"2019-07-30T08:37:19.000Z","cover":"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/150542.jpg","_content":"\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/150542.jpg) \n\n\n\n`react-native`再请求方面有点坑，`Ios`端默认支持`https`，而安卓默认支持的事`http`，如果你需要的是其中的某一种方式，那这篇文章可能能帮到你😍😍\n\n\n\n### 当前环境\n\n- OS: macOS High Sierra 10.13.5\n- Node: 8.11.3\n- Yarn: 1.7.0\n- npm: 5.6.0\n- Watchman: 4.9.0\n- Xcode: Xcode 9.4.1\n- react: 16.3.1 => 16.3.1\n- react-native: 0.55.4 => 0.55.4\n\n\n\n### 前置说明\n\n1. 在ios平台ios9.0以上默认支持https而不支持http\n2. 对于https，如果你的服务器端是CA签发的证书，那你ios平台不需要改动任何代码\n3. 对于自签证书，那你需要对源代码进行改动，下面会详细说明方式\n4. 对于http，有两个方式可以做到，下面会详细说明方式\n    1. 直接使用ip地址\n    2. 使用域名，对源代码进行配置\n\n  \n\n### 关于ios支持https自签证书\n\n\n- 服务器端使用自签证书，免证书方法\n- 打开XCode在当前项目路径为`Libraries/RCTNetwork.xcodeproj`找到`RCTHTTPRequestHandler.mm`\n- 或者在`{project}/node_modules/react-native/Libraries/Network`目录下同样可以找到该文件\n- 在文件中搜索`#pragma mark - NSURLSession delegate`并在其后面添加如下代码即可\n\n\n```c++\n- (void)URLSession:(NSURLSession *)session  didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge  completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential * __nullable credential))completionHandler{\n    if (RCT_DEBUG) {\n        completionHandler(NSURLSessionAuthChallengeUseCredential,[NSURLCredential  credentialForTrust:challenge.protectionSpace.serverTrust]);\n    }\n}\n```\n\n- 配置如图所示\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902-1.png) \n\n\n\n### 关于ios支持http请求\n\n- 关于http方式我们只介绍第二种因为直接使用ip地址真的是太。。简单，直接把域名换成ip就好了\n- 对于第二种你需要改动`{project}/ios/App`下面的`Info.plist`文件\n\n\n```xml\n<key>NSAppTransportSecuritykey>\n<dict>\n    <key>NSAllowsArbitraryLoadskey></key>\n    <true/>\n<dict>\n```\n\n- 配置如图所示\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902.png) \n\n到此为止`Ios`相关问题就解决了，`Ios`部分还是比较好弄得O(∩_∩)O不是很麻烦，`Android`得话就麻烦些，下面我们说下`Android`相关的解决方案\n\n\n\n### 关于Android端http和https你需要知道\n\n1. 安卓默认是支持http请求儿不支持https\n2. 想做到支持https那就需要改动react-native的源代码，进而重新编译才能成功\n\n\n### 关于Android支持https\n- 下载ndk（下载r10e版本的，其他的版本会有问题）\n\t1.  Mac OS (64-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip](http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip)\n\t2.  Linux (64-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip](http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip)\n\t3.  Windows (64-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip](http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip)\n\t4.  Windows (32-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip](http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip)\n\n- 在项目`{project}/android`文件夹先创建`local.properties`文件（如果已经存在哪直接修改就好了）\n\n\n```properties\nsdk.dir=你自己的sdk路径\nndk.dir=你自己的ndk路径\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140900-1.jpg)\n\n- 在`{project}/android/build.gradle`中添加`gradle-download-task`依赖\n\n```java\n...\ndependencies {\n    classpath 'com.android.tools.build:gradle:2.2.3'\n    classpath 'de.undercouch:gradle-download-task:3.1.2'\n\t\n    // NOTE: Do not place your application dependencies here; they belong\n    // in the individual module build.gradle files\n}\n...\n```\n\n\n- 在`{project}/android/settings.gradle`中添加`:ReactAndroid`项目\n\n\n```java\n...\n    include ':ReactAndroid'\n  \n    project(':ReactAndroid').projectDir = new File(rootProject.projectDir, '../node_modules/react-native/ReactAndroid')\n...\n```\n\n- 修改`{project}/android/app/build.gradle`文件，使用:ReactAndroid替换预编译库\n\n\n```java\n...\n  \ncompile fileTree(dir: \"libs\", include: [\"*.jar\"])\ncompile \"com.android.support:appcompat-v7:23.0.1\"\ncompile project(':ReactAndroid')\n  \n...\n```\n\n- 重写第三方模块的依赖，否则会报错`-Error: more than one library with package name 'com.facebook.react'`\n- 修改`{project}/android/app/build.gradle`文件，添加以下代码\n\n\n```java\n...\n  \nconfigurations.all {\n    exclude group: 'com.facebook.react', module: 'react-native'\n}\n  \n...\n```\n\n\n\n- 重写`okHttp`类\n\n```java\npackage com.facebook.react.modules.network;\n\nimport android.net.Uri;\nimport android.util.Base64;\nimport com.facebook.react.bridge.Arguments;\nimport com.facebook.react.bridge.GuardedAsyncTask;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\nimport com.facebook.react.bridge.ReactMethod;\nimport com.facebook.react.bridge.ReadableArray;\nimport com.facebook.react.bridge.ReadableMap;\nimport com.facebook.react.bridge.WritableMap;\nimport com.facebook.react.common.StandardCharsets;\nimport com.facebook.react.common.network.OkHttpCallUtil;\nimport com.facebook.react.module.annotations.ReactModule;\nimport com.facebook.react.modules.core.DeviceEventManagerModule.RCTDeviceEventEmitter;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.nio.charset.Charset;\nimport java.security.KeyManagementException;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.SecureRandom;\nimport java.security.cert.CertificateException;\nimport java.security.cert.X509Certificate;\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;\nimport javax.annotation.Nullable;\nimport javax.net.ssl.HostnameVerifier;\nimport javax.net.ssl.SSLContext;\nimport javax.net.ssl.SSLSession;\nimport javax.net.ssl.TrustManager;\nimport javax.net.ssl.X509TrustManager;\nimport okhttp3.Call;\nimport okhttp3.Callback;\nimport okhttp3.CookieJar;\nimport okhttp3.Headers;\nimport okhttp3.Interceptor;\nimport okhttp3.JavaNetCookieJar;\nimport okhttp3.MediaType;\nimport okhttp3.MultipartBody;\nimport okhttp3.OkHttpClient;\nimport okhttp3.Request;\nimport okhttp3.RequestBody;\nimport okhttp3.Response;\nimport okhttp3.ResponseBody;\nimport okio.ByteString;\n\n/**\n* Implements the XMLHttpRequest JavaScript interface.\n*/\n@ReactModule(name = NetworkingModule.NAME)\n\npublic final class NetworkingModule extends ReactContextBaseJavaModule {\n\tprivate SSLContext getSLLContext () {\n\t\tX509TrustManager xtm = new X509TrustManager() {\n\n\t\t\t@Override\n\t\t\tpublic void checkClientTrusted(X509Certificate[] chain, String authType) {}\n\n\t\t\t@Override\n\t\t\tpublic void checkServerTrusted(X509Certificate[] chain, String authType) {}\n\n\t\t\t@Override\n\t\t\tpublic X509Certificate[] getAcceptedIssuers() {\n\t\t\t\tX509Certificate[] x509Certificates = new X509Certificate[0];\n\t\t\t\t\n\t\t\t\treturn x509Certificates;\n\t\t\t}\n\t\t};\n\n\t\tSSLContext sslContext = null;\n\n\t\ttry {\n\n\t\t\tsslContext = SSLContext.getInstance(\"SSL\");\n\t\t\tsslContext.init(null, new TrustManager[]{xtm}, new SecureRandom());\n\n\t\t} catch (NoSuchAlgorithmException e) {\n\n\t\t\te.printStackTrace();\n\t\t} catch (KeyManagementException e) {\n\n\t\t\te.printStackTrace();\n\t\t}\n\n\t\treturn sslContext;\n\t}\n\n\t/**\n\t* Allows to implement a custom fetching process for specific URIs. It is the handler's job\n\t* to fetch the URI and return the JS body payload.\n\t*/\n\tpublic interface UriHandler {\n\n\t\t/**\n\t\t* Returns if the handler should be used for an URI.\n\t\t*/\n\t\tboolean supports(Uri uri, String responseType);\n\t\t\n\t\t/**\n\t\t* Fetch the URI and return the JS body payload.\n\t\t*/\n\t\tWritableMap fetch(Uri uri) throws IOException;\n\t}\n\n\t/**\n\t* Allows adding custom handling to build the {@link RequestBody} from the JS body payload.\n\t*/\n\tpublic interface RequestBodyHandler {\n\n\t\t/**\n\t\t* Returns if the handler should be used for a JS body payload.\n\t\t*/\n\t\tboolean supports(ReadableMap map);\n\n\t\t/**\n\t\t* Returns the {@link RequestBody} for the JS body payload.\n\t\t*/\n\t\tRequestBody toRequestBody(ReadableMap map, String contentType);\n\t}\n\n\t/**\n\t* Allows adding custom handling to build the JS body payload from the {@link ResponseBody}.\n\t*/\n\n\tpublic interface ResponseHandler {\n\t\t/**\n\t\t* Returns if the handler should be used for a response type.\n\t\t*/\n\t\tboolean supports(String responseType);\n\n\t\t/**\n\t\t* Returns the JS body payload for the {@link ResponseBody}.\n\t\t*/\n\t\tWritableMap toResponseData(ResponseBody body) throws IOException;\n\t}\n\n\tprotected static final String NAME = \"Networking\";\n\n\tprivate static final String CONTENT_ENCODING_HEADER_NAME = \"content-encoding\";\n\n\tprivate static final String CONTENT_TYPE_HEADER_NAME = \"content-type\";\n\n\tprivate static final String REQUEST_BODY_KEY_STRING = \"string\";\n\n\tprivate static final String REQUEST_BODY_KEY_URI = \"uri\";\n\n\tprivate static final String REQUEST_BODY_KEY_FORMDATA = \"formData\";\n\n\tprivate static final String REQUEST_BODY_KEY_BASE64 = \"base64\";\n\n\tprivate static final String USER_AGENT_HEADER_NAME = \"user-agent\";\n\n\tprivate static final int CHUNK_TIMEOUT_NS = 100 * 1000000; // 100ms\n\n\tprivate static final int MAX_CHUNK_SIZE_BETWEEN_FLUSHES = 8 * 1024; // 8K\n\n\tprivate final OkHttpClient mClient;\n\n\tprivate final ForwardingCookieHandler mCookieHandler;\n\n\tprivate final @Nullable String mDefaultUserAgent;\n\n\tprivate final CookieJarContainer mCookieJarContainer;\n\n\tprivate final Set<Integer> mRequestIds;\n\n\tprivate final List<RequestBodyHandler> mRequestBodyHandlers = new ArrayList<>();\n\n\tprivate final List<UriHandler> mUriHandlers = new ArrayList<>();\n\n\tprivate final List<ResponseHandler> mResponseHandlers = new ArrayList<>();\n\n\tprivate boolean mShuttingDown;\n\n\t/* package */\n\n\tNetworkingModule(\n\t\tReactApplicationContext reactContext,\n\t\t@Nullable String defaultUserAgent,\n\t\tOkHttpClient client,\n\t\t@Nullable List networkInterceptorCreators\n\t) {\n\t\tsuper(reactContext);\n\t\tif (networkInterceptorCreators != null) {\n\t\t\tOkHttpClient.Builder clientBuilder = client.newBuilder();\n\n\t\t\tfor (NetworkInterceptorCreator networkInterceptorCreator : networkInterceptorCreators) {\n\t\t\t\tclientBuilder.addNetworkInterceptor(networkInterceptorCreator.create());\n\t\t\t}\n\n\t\t\tclient = clientBuilder.build();\n\t\t}\n\n\t\tclient = client.newBuilder().hostnameVerifier(new HostnameVerifier() {\n\t\t\t@Override\n\t\t\tpublic boolean verify(String s, SSLSession sslSession) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}).sslSocketFactory(getSLLContext().getSocketFactory()).build();\n\n\t\tmClient = client;\n\t\tmCookieHandler = new ForwardingCookieHandler(reactContext);\n\t\tmCookieJarContainer = (CookieJarContainer) mClient.cookieJar();\n\t\tmShuttingDown = false;\n\t\tmDefaultUserAgent = defaultUserAgent;\n\t\tmRequestIds = new HashSet<>();\n\t}\n\n\t/**\n\t* @param context the ReactContext of the application\n\t* @param defaultUserAgent the User-Agent header that will be set for all requests where the\n\t* caller does not provide one explicitly\n\t* @param client the {@link OkHttpClient} to be used for networking\n\t*/\n\n\t/* package */\n\tNetworkingModule(\n\t\tReactApplicationContext context,\n\t\t@Nullable String defaultUserAgent,\n\t\tOkHttpClient client\n\t) {\n\t\tthis(context, defaultUserAgent, client, null);\n\t}\n\n\t/**\n\t* @param context the ReactContext of the application\n\t*/\n\tpublic NetworkingModule(final ReactApplicationContext context) {\n\t\tthis(context, null, OkHttpClientProvider.createClient(), null);\n\t}\n\n\t/**\n\t* @param context the ReactContext of the application\n\t* @param networkInterceptorCreators list of {@link NetworkInterceptorCreator}'s whose create()\n\t* methods would be called to attach the interceptors to the client.\n\t*/\n\tpublic NetworkingModule(\n\t\tReactApplicationContext context,\n\t\tList networkInterceptorCreators) {\n\t\t\tthis(context, null, OkHttpClientProvider.createClient(), networkInterceptorCreators);\n\t\t}\n\t/**\n\t* @param context the ReactContext of the application\n\t* @param defaultUserAgent the User-Agent header that will be set for all requests where the\n\t* caller does not provide one explicitly\n\t*/\n\n\tpublic NetworkingModule(ReactApplicationContext context, String defaultUserAgent) {\n\t\tthis(context, defaultUserAgent, OkHttpClientProvider.createClient(), null);\n\t}\n\n\t@Override\n\tpublic void initialize() {\n\t\tmCookieJarContainer.setCookieJar(new JavaNetCookieJar(mCookieHandler));\n\t}\n\n\t@Override\n\tpublic String getName() {\n\t\treturn NAME;\n\t}\n\n\t@Override\n\tpublic void onCatalystInstanceDestroy() {\n\t\tmShuttingDown = true;\n\t\tcancelAllRequests();\n\t\tmCookieHandler.destroy();\n\t\tmCookieJarContainer.removeCookieJar();\n\t\tmRequestBodyHandlers.clear();\n\t\tmResponseHandlers.clear();\n\t\tmUriHandlers.clear();\n\t}\n\n\tpublic void addUriHandler(UriHandler handler) {\n\t\tmUriHandlers.add(handler);\n\t}\n\n\tpublic void addRequestBodyHandler(RequestBodyHandler handler) {\n\t\tmRequestBodyHandlers.add(handler);\n\t}\n\n\tpublic void addResponseHandler(ResponseHandler handler) {\n\t\tmResponseHandlers.add(handler);\n\t}\n\n\tpublic void removeUriHandler(UriHandler handler) {\n\t\tmUriHandlers.remove(handler);\n\t}\n\n\tpublic void removeRequestBodyHandler(RequestBodyHandler handler) {\n\t\tmRequestBodyHandlers.remove(handler);\n\t}\n\n\tpublic void removeResponseHandler(ResponseHandler handler) {\n\t\tmResponseHandlers.remove(handler);\n\t}\n\n\t@ReactMethod\n\t/**\n\t* @param timeout value of 0 results in no timeout\n\t*/\n\tpublic void sendRequest(\n\t\tString method,\n\t\tString url,\n\t\tfinal int requestId,\n\t\tReadableArray headers,\n\t\tReadableMap data,\n\t\tfinal String responseType,\n\t\tfinal boolean useIncrementalUpdates,\n\t\tint timeout,\n\t\tboolean withCredentials\n\t) {\n\t\tfinal RCTDeviceEventEmitter eventEmitter = getEventEmitter();\n\n\t\ttry {\n\t\t\tUri uri = Uri.parse(url);\n\t\t\t// Check if a handler is registered\n\t\t\tfor (UriHandler handler : mUriHandlers) {\n\t\t\t\tif (handler.supports(uri, responseType)) {\n\t\t\t\t\tWritableMap res = handler.fetch(uri);\n\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);\n\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (IOException e) {\n\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);\n\t\t\treturn;\n\t\t}\n\n\t\tRequest.Builder requestBuilder;\n\n\t\ttry {\n\t\t\trequestBuilder = new Request.Builder().url(url);\n\t\t} catch (Exception e) {\n\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), null);\n\t\t\treturn;\n\t\t}\n\n\t\tif (requestId != 0) {\n\t\t\trequestBuilder.tag(requestId);\n\t\t}\n\n\t\tOkHttpClient.Builder clientBuilder = mClient.newBuilder();\n\n\t\tif (!withCredentials) {\n\t\t\tclientBuilder.cookieJar(CookieJar.NO_COOKIES);\n\t\t}\n\n\t\t// If JS is listening for progress updates, install a ProgressResponseBody that intercepts the\n\t\t// response and counts bytes received.\n\t\tif (useIncrementalUpdates) {\n\n\t\t\tclientBuilder.addNetworkInterceptor(new Interceptor() {\n\t\t\t\t@Override\n\t\t\t\tpublic Response intercept(Interceptor.Chain chain) throws IOException {\n\t\t\t\t\tResponse originalResponse = chain.proceed(chain.request());\n\t\t\t\t\tProgressResponseBody responseBody = new ProgressResponseBody(\n\t\t\t\t\toriginalResponse.body(),\n\t\t\t\t\tnew ProgressListener() {\n\t\t\t\t\t\tlong last = System.nanoTime();\n\n\t\t\t\t\t\t@Override\n\t\t\t\t\t\tpublic void onProgress(long bytesWritten, long contentLength, boolean done) {\n\t\t\t\t\t\t\tlong now = System.nanoTime();\n\t\t\t\t\t\t\tif (!done && !shouldDispatch(now, last)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (responseType.equals(\"text\")) {\n\t\t\t\t\t\t\t\t// For 'text' responses we continuously send response data with progress info to\n\t\t\t\t\t\t\t\t// JS below, so no need to do anything here.\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tResponseUtil.onDataReceivedProgress(\n\t\t\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\t\tbytesWritten,\n\t\t\t\t\t\t\t\tcontentLength\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tlast = now;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn originalResponse.newBuilder().body(responseBody).build();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// If the current timeout does not equal the passed in timeout, we need to clone the existing\n\t\t// client and set the timeout explicitly on the clone. This is cheap as everything else is\n\t\t// shared under the hood.\n\t\t// See https://github.com/square/okhttp/wiki/Recipes#per-call-configuration for more information\n\n\t\tif (timeout != mClient.connectTimeoutMillis()) {\n\t\t\tclientBuilder.readTimeout(timeout, TimeUnit.MILLISECONDS);\n\t\t}\n\n\t\tOkHttpClient client = clientBuilder.build();\n\t\tHeaders requestHeaders = extractHeaders(headers, data);\n\t\tif (requestHeaders == null) {\n\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, \"Unrecognized headers format\", null);\n\t\t\treturn;\n\t\t}\n\n\t\tString contentType = requestHeaders.get(CONTENT_TYPE_HEADER_NAME);\n\t\tString contentEncoding = requestHeaders.get(CONTENT_ENCODING_HEADER_NAME);\n\t\trequestBuilder.headers(requestHeaders);\n\n\t\t// Check if a handler is registered\n\t\tRequestBodyHandler handler = null;\n\n\t\tif (data != null) {\n\n\t\t\tfor (RequestBodyHandler curHandler : mRequestBodyHandlers) {\n\t\t\t\tif (curHandler.supports(data)) {\n\t\t\t\t\thandler = curHandler;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tRequestBody requestBody;\n\t\tif (data == null || method.toLowerCase().equals(\"get\") || method.toLowerCase().equals(\"head\")) {\n\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);\n\t\t} else if (handler != null) {\n\t\t\trequestBody = handler.toRequestBody(data, contentType);\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_STRING)) {\n\t\t\tif (contentType == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Payload is set but no content-type header specified\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tString body = data.getString(REQUEST_BODY_KEY_STRING);\n\t\t\tMediaType contentMediaType = MediaType.parse(contentType);\n\n\t\t\tif (RequestBodyUtil.isGzipEncoding(contentEncoding)) {\n\t\t\t\trequestBody = RequestBodyUtil.createGzip(contentMediaType, body);\n\t\t\t\tif (requestBody == null) {\n\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, \"Failed to gzip request body\", null);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trequestBody = RequestBody.create(contentMediaType, body);\n\t\t\t}\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_BASE64)) {\n\n\t\t\tif (contentType == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Payload is set but no content-type header specified\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tString base64String = data.getString(REQUEST_BODY_KEY_BASE64);\n\t\t\tMediaType contentMediaType = MediaType.parse(contentType);\n\t\t\trequestBody = RequestBody.create(contentMediaType, ByteString.decodeBase64(base64String));\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_URI)) {\n\t\t\tif (contentType == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Payload is set but no content-type header specified\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tString uri = data.getString(REQUEST_BODY_KEY_URI);\n\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), uri);\n\n\t\t\tif (fileInputStream == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Could not retrieve file for uri \" + uri,\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestBody = RequestBodyUtil.create(MediaType.parse(contentType), fileInputStream);\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_FORMDATA)) {\n\t\t\tif (contentType == null) {\n\t\t\t\tcontentType = \"multipart/form-data\";\n\t\t\t}\n\n\t\t\tReadableArray parts = data.getArray(REQUEST_BODY_KEY_FORMDATA);\n\t\t\tMultipartBody.Builder multipartBuilder =\n\t\t\tconstructMultipartBody(parts, contentType, requestId);\n\n\t\t\tif (multipartBuilder == null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestBody = multipartBuilder.build();\n\n\t\t} else {\n\t\t\t// Nothing in data payload, at least nothing we could understand anyway.\n\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);\n\t\t}\n\n\t\trequestBuilder.method(\n\t\t\tmethod,\n\t\t\twrapRequestBodyWithProgressEmitter(requestBody, eventEmitter, requestId)\n\t\t);\n\t\taddRequest(requestId);\n\t\tclient.newCall(requestBuilder.build()).enqueue(\n\t\t\tnew Callback() {\n\t\t\t\t@Override\n\t\t\t\tpublic void onFailure(Call call, IOException e) {\n\t\t\t\t\tif (mShuttingDown) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tremoveRequest(requestId);\n\n\t\t\t\t\tString errorMessage = e.getMessage() != null\n\t\t\t\t\t? e.getMessage()\n\t\t\t\t\t: \"Error while executing request: \" + e.getClass().getSimpleName();\n\n\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, errorMessage, e);\n\t\t\t\t}\n\n\t\t\t\t@Override\n\t\t\t\tpublic void onResponse(Call call, Response response) throws IOException {\n\t\t\t\t\tif (mShuttingDown) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tremoveRequest(requestId);\n\n\t\t\t\t\t// Before we touch the body send headers to JS\n\t\t\t\t\tResponseUtil.onResponseReceived(\n\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\tresponse.code(),\n\t\t\t\t\t\ttranslateHeaders(response.headers()),\n\t\t\t\t\t\tresponse.request().url().toString()\n\t\t\t\t\t);\n\n\t\t\t\t\tResponseBody responseBody = response.body();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Check if a handler is registered\n\t\t\t\t\t\tfor (ResponseHandler handler : mResponseHandlers) {\n\n\t\t\t\t\t\t\tif (handler.supports(responseType)) {\n\t\t\t\t\t\t\t\tWritableMap res = handler.toResponseData(responseBody);\n\t\t\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);\n\t\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If JS wants progress updates during the download, and it requested a text response,\n\t\t\t\t\t\t// periodically send response data updates to JS.\n\t\t\t\t\t\tif (useIncrementalUpdates && responseType.equals(\"text\")) {\n\t\t\t\t\t\t\treadWithProgress(eventEmitter, requestId, responseBody);\n\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Otherwise send the data in one big chunk, in the format that JS requested.\n\t\t\t\t\t\tString responseString = \"\";\n\n\t\t\t\t\t\tif (responseType.equals(\"text\")) {\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tresponseString = responseBody.string();\n\t\t\t\t\t\t\t} catch (IOException e) {\n\t\t\t\t\t\t\t\tif (response.request().method().equalsIgnoreCase(\"HEAD\")) {\n\t\t\t\t\t\t\t\t\t// The request is an `HEAD` and the body is empty,\n\t\t\t\t\t\t\t\t\t// the OkHttp will produce an exception.\n\t\t\t\t\t\t\t\t\t// Ignore the exception to not invalidate the request in the\n\t\t\t\t\t\t\t\t\t// Javascript layer.\n\t\t\t\t\t\t\t\t\t// Introduced to fix issue #7463.\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (responseType.equals(\"base64\")) {\n\t\t\t\t\t\t\tresponseString = Base64.encodeToString(responseBody.bytes(), Base64.NO_WRAP);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, responseString);\n\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\t} catch (IOException e) {\n\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tprivate RequestBody wrapRequestBodyWithProgressEmitter(\n\t\tfinal RequestBody requestBody,\n\t\tfinal RCTDeviceEventEmitter eventEmitter,\n\t\tfinal int requestId\n\t) {\n\t\tif(requestBody == null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn RequestBodyUtil.createProgressRequest(\n\t\t\trequestBody,\n\t\t\tnew ProgressListener() {\n\t\t\t\tlong last = System.nanoTime();\n\n\t\t\t\t@Override\n\t\t\t\tpublic void onProgress(long bytesWritten, long contentLength, boolean done) {\n\n\t\t\t\t\tlong now = System.nanoTime();\n\n\t\t\t\t\tif (done || shouldDispatch(now, last)) {\n\t\t\t\t\t\tResponseUtil.onDataSend(eventEmitter, requestId, bytesWritten, contentLength);\n\t\t\t\t\t\tlast = now;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tprivate void readWithProgress(\n\t\tRCTDeviceEventEmitter eventEmitter,\n\t\tint requestId,\n\t\tResponseBody responseBody\n\t) throws IOException {\n\t\tlong totalBytesRead = -1;\n\t\tlong contentLength = -1;\n\n\t\ttry {\n\t\t\tProgressResponseBody progressResponseBody = (ProgressResponseBody) responseBody;\n\t\t\ttotalBytesRead = progressResponseBody.totalBytesRead();\n\t\t\tcontentLength = progressResponseBody.contentLength();\n\t\t} catch (ClassCastException e) {\n\t\t\t// Ignore\n\t\t}\n\n\t\tCharset charset = responseBody.contentType() == null ? StandardCharsets.UTF_8 :\n\t\tresponseBody.contentType().charset(StandardCharsets.UTF_8);\n\t\tProgressiveStringDecoder streamDecoder = new ProgressiveStringDecoder(charset);\n\t\tInputStream inputStream = responseBody.byteStream();\n\n\t\ttry {\n\t\t\tbyte[] buffer = new byte[MAX_CHUNK_SIZE_BETWEEN_FLUSHES];\n\t\t\tint read;\n\n\t\t\twhile ((read = inputStream.read(buffer)) != -1) {\n\t\t\t\tResponseUtil.onIncrementalDataReceived(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\tstreamDecoder.decodeNext(buffer, read),\n\t\t\t\t\ttotalBytesRead,\n\t\t\t\t\tcontentLength\n\t\t\t\t);\n\t\t\t}\n\t\t} finally {\n\t\t\tinputStream.close();\n\t\t}\n\n\t}\n\n\tprivate static boolean shouldDispatch(long now, long last) {\n\t\treturn last + CHUNK_TIMEOUT_NS < now;\n\t}\n\n\tprivate synchronized void addRequest(int requestId) {\n\t\tmRequestIds.add(requestId);\n\t}\n\n\tprivate synchronized void removeRequest(int requestId) {\n\t\tmRequestIds.remove(requestId);\n\t}\n\n\tprivate synchronized void cancelAllRequests() {\n\t\tfor (Integer requestId : mRequestIds) {\n\t\t\tcancelRequest(requestId);\n\t\t}\n\n\t\tmRequestIds.clear();\n\t}\n\n\tprivate static WritableMap translateHeaders(Headers headers) {\n\t\tWritableMap responseHeaders = Arguments.createMap();\n\n\t\tfor (int i = 0; i < headers.size(); i++) {\n\t\t\tString headerName = headers.name(i);\n\t\t\t\n\t\t\t// multiple values for the same header\n\t\t\tif (responseHeaders.hasKey(headerName)) {\n\t\t\t\tresponseHeaders.putString(\n\t\t\t\theaderName,\n\t\t\t\tresponseHeaders.getString(headerName) + \", \" + headers.value(i));\n\t\t\t} else {\n\t\t\t\tresponseHeaders.putString(headerName, headers.value(i));\n\t\t\t}\n\t\t}\n\n\t\treturn responseHeaders;\n\t}\n\n\t@ReactMethod\n\tpublic void abortRequest(final int requestId) {\n\t\tcancelRequest(requestId);\n\t\tremoveRequest(requestId);\n\t}\n\n\tprivate void cancelRequest(final int requestId) {\n\t\t// We have to use AsyncTask since this might trigger a NetworkOnMainThreadException, this is an\n\t\t// open issue on OkHttp: https://github.com/square/okhttp/issues/869\n\t\tnew GuardedAsyncTask(getReactApplicationContext()) {\n\t\t\t@Override\n\t\t\tprotected void doInBackgroundGuarded(Void... params) {\n\t\t\t\tOkHttpCallUtil.cancelTag(mClient, Integer.valueOf(requestId));\n\t\t\t}\n\t\t}.execute();\n\t}\n\n\t@ReactMethod\n\tpublic void clearCookies(com.facebook.react.bridge.Callback callback) {\n\t\tmCookieHandler.clearCookies(callback);\n\t}\n\n\tprivate @Nullable MultipartBody.Builder constructMultipartBody(\n\t\tReadableArray body,\n\t\tString contentType,\n\t\tint requestId\n\t) {\n\t\tRCTDeviceEventEmitter eventEmitter = getEventEmitter();\n\t\tMultipartBody.Builder multipartBuilder = new MultipartBody.Builder();\n\t\tmultipartBuilder.setType(MediaType.parse(contentType));\n\t\tfor (int i = 0, size = body.size(); i < size; i++) {\n\t\t\tReadableMap bodyPart = body.getMap(i);\n\n\t\t\t// Determine part's content type.\n\t\t\tReadableArray headersArray = bodyPart.getArray(\"headers\");\n\t\t\tHeaders headers = extractHeaders(headersArray, null);\n\t\t\tif (headers == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Missing or invalid header format for FormData part.\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tMediaType partContentType = null;\n\t\t\tString partContentTypeStr = headers.get(CONTENT_TYPE_HEADER_NAME);\n\n\t\t\tif (partContentTypeStr != null) {\n\t\t\t\tpartContentType = MediaType.parse(partContentTypeStr);\n\t\t\t\t// Remove the content-type header because MultipartBuilder gets it explicitly as an\n\t\t\t\t// argument and doesn't expect it in the headers array.\n\t\t\t\theaders = headers.newBuilder().removeAll(CONTENT_TYPE_HEADER_NAME).build();\n\t\t\t}\n\n\t\t\tif (bodyPart.hasKey(REQUEST_BODY_KEY_STRING)) {\n\t\t\t\tString bodyValue = bodyPart.getString(REQUEST_BODY_KEY_STRING);\n\t\t\t\tmultipartBuilder.addPart(headers, RequestBody.create(partContentType, bodyValue));\n\t\t\t} else if (bodyPart.hasKey(REQUEST_BODY_KEY_URI)) {\n\t\t\t\tif (partContentType == null) {\n\t\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\"Binary FormData part needs a content-type header.\",\n\t\t\t\t\t\tnull\n\t\t\t\t\t);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tString fileContentUriStr = bodyPart.getString(REQUEST_BODY_KEY_URI);\n\t\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), fileContentUriStr);\n\n\t\t\t\tif (fileInputStream == null) {\n\t\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\"Could not retrieve file for uri \" + fileContentUriStr,\n\t\t\t\t\t\tnull\n\t\t\t\t\t);\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tmultipartBuilder.addPart(headers, RequestBodyUtil.create(partContentType, fileInputStream));\n\t\t\t} else {\n\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, \"Unrecognized FormData part.\", null);\n\t\t\t}\n\t\t}\n\t\treturn multipartBuilder;\n\t}\n\n\t/**\n\t* Extracts the headers from the Array. If the format is invalid, this method will return null.\n\t*/\n\tprivate @Nullable Headers extractHeaders(\n\t\t@Nullable ReadableArray headersArray,\n\t\t@Nullable ReadableMap requestData\n\t) {\n\t\tif (headersArray == null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tHeaders.Builder headersBuilder = new Headers.Builder();\n\n\t\tfor (int headersIdx = 0, size = headersArray.size(); headersIdx < size; headersIdx++) {\n\t\t\tReadableArray header = headersArray.getArray(headersIdx);\n\n\t\t\tif (header == null || header.size() != 2) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tString headerName = header.getString(0);\n\t\t\tString headerValue = header.getString(1);\n\n\t\t\tif (headerName == null || headerValue == null) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\theadersBuilder.add(headerName, headerValue);\n\t\t}\n\n\t\tif (headersBuilder.get(USER_AGENT_HEADER_NAME) == null && mDefaultUserAgent != null) {\n\t\t\theadersBuilder.add(USER_AGENT_HEADER_NAME, mDefaultUserAgent);\n\t\t}\n\n\t\t// Sanitize content encoding header, supported only when request specify payload as string\n\t\tboolean isGzipSupported = requestData != null && requestData.hasKey(REQUEST_BODY_KEY_STRING);\n\n\t\tif (!isGzipSupported) {\n\t\t\theadersBuilder.removeAll(CONTENT_ENCODING_HEADER_NAME);\n\t\t}\n\t\treturn headersBuilder.build();\n\t}\n\n\tprivate RCTDeviceEventEmitter getEventEmitter() {\n\t\treturn getReactApplicationContext().getJSModule(RCTDeviceEventEmitter.class);\n\t}\n}\n```\n\n\n- 在终端代开项目`cd {project}`执行\n- `react-native run-android`开始编译，编译的过程很漫长，大概需要10到20分钟\n- 如果中途失败记得删除`/node_modules/react-native/ReactAndroid/bulid`里面的所有内容，然后重新编译\n\n- 关于源代码编译可以参考官方文档[中文](https://reactnative.cn/docs/building-from-source.html)或者[英文](https://facebook.github.io/react-native/docs/building-from-source)官网详细查看\n\n\n\n- 关于详细代码可进入我的[Github](https://github.com/AaronBank/react-native.git)查看\n\n*感谢支持*","source":"_posts/react-native中fetch发送https或http相关问题总结.md","raw":"---\ntitle: react-native中使用fetch发送https或http相关问题总结\ndate: 2019-07-30 16:37:19\ntags: ReactNative\ncategories: 前端\ncover: http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/150542.jpg\n---\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/150542.jpg) \n\n\n\n`react-native`再请求方面有点坑，`Ios`端默认支持`https`，而安卓默认支持的事`http`，如果你需要的是其中的某一种方式，那这篇文章可能能帮到你😍😍\n\n\n\n### 当前环境\n\n- OS: macOS High Sierra 10.13.5\n- Node: 8.11.3\n- Yarn: 1.7.0\n- npm: 5.6.0\n- Watchman: 4.9.0\n- Xcode: Xcode 9.4.1\n- react: 16.3.1 => 16.3.1\n- react-native: 0.55.4 => 0.55.4\n\n\n\n### 前置说明\n\n1. 在ios平台ios9.0以上默认支持https而不支持http\n2. 对于https，如果你的服务器端是CA签发的证书，那你ios平台不需要改动任何代码\n3. 对于自签证书，那你需要对源代码进行改动，下面会详细说明方式\n4. 对于http，有两个方式可以做到，下面会详细说明方式\n    1. 直接使用ip地址\n    2. 使用域名，对源代码进行配置\n\n  \n\n### 关于ios支持https自签证书\n\n\n- 服务器端使用自签证书，免证书方法\n- 打开XCode在当前项目路径为`Libraries/RCTNetwork.xcodeproj`找到`RCTHTTPRequestHandler.mm`\n- 或者在`{project}/node_modules/react-native/Libraries/Network`目录下同样可以找到该文件\n- 在文件中搜索`#pragma mark - NSURLSession delegate`并在其后面添加如下代码即可\n\n\n```c++\n- (void)URLSession:(NSURLSession *)session  didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge  completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential * __nullable credential))completionHandler{\n    if (RCT_DEBUG) {\n        completionHandler(NSURLSessionAuthChallengeUseCredential,[NSURLCredential  credentialForTrust:challenge.protectionSpace.serverTrust]);\n    }\n}\n```\n\n- 配置如图所示\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902-1.png) \n\n\n\n### 关于ios支持http请求\n\n- 关于http方式我们只介绍第二种因为直接使用ip地址真的是太。。简单，直接把域名换成ip就好了\n- 对于第二种你需要改动`{project}/ios/App`下面的`Info.plist`文件\n\n\n```xml\n<key>NSAppTransportSecuritykey>\n<dict>\n    <key>NSAllowsArbitraryLoadskey></key>\n    <true/>\n<dict>\n```\n\n- 配置如图所示\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902.png) \n\n到此为止`Ios`相关问题就解决了，`Ios`部分还是比较好弄得O(∩_∩)O不是很麻烦，`Android`得话就麻烦些，下面我们说下`Android`相关的解决方案\n\n\n\n### 关于Android端http和https你需要知道\n\n1. 安卓默认是支持http请求儿不支持https\n2. 想做到支持https那就需要改动react-native的源代码，进而重新编译才能成功\n\n\n### 关于Android支持https\n- 下载ndk（下载r10e版本的，其他的版本会有问题）\n\t1.  Mac OS (64-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip](http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip)\n\t2.  Linux (64-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip](http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip)\n\t3.  Windows (64-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip](http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip)\n\t4.  Windows (32-bit) - [http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip](http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip)\n\n- 在项目`{project}/android`文件夹先创建`local.properties`文件（如果已经存在哪直接修改就好了）\n\n\n```properties\nsdk.dir=你自己的sdk路径\nndk.dir=你自己的ndk路径\n```\n\n![](http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140900-1.jpg)\n\n- 在`{project}/android/build.gradle`中添加`gradle-download-task`依赖\n\n```java\n...\ndependencies {\n    classpath 'com.android.tools.build:gradle:2.2.3'\n    classpath 'de.undercouch:gradle-download-task:3.1.2'\n\t\n    // NOTE: Do not place your application dependencies here; they belong\n    // in the individual module build.gradle files\n}\n...\n```\n\n\n- 在`{project}/android/settings.gradle`中添加`:ReactAndroid`项目\n\n\n```java\n...\n    include ':ReactAndroid'\n  \n    project(':ReactAndroid').projectDir = new File(rootProject.projectDir, '../node_modules/react-native/ReactAndroid')\n...\n```\n\n- 修改`{project}/android/app/build.gradle`文件，使用:ReactAndroid替换预编译库\n\n\n```java\n...\n  \ncompile fileTree(dir: \"libs\", include: [\"*.jar\"])\ncompile \"com.android.support:appcompat-v7:23.0.1\"\ncompile project(':ReactAndroid')\n  \n...\n```\n\n- 重写第三方模块的依赖，否则会报错`-Error: more than one library with package name 'com.facebook.react'`\n- 修改`{project}/android/app/build.gradle`文件，添加以下代码\n\n\n```java\n...\n  \nconfigurations.all {\n    exclude group: 'com.facebook.react', module: 'react-native'\n}\n  \n...\n```\n\n\n\n- 重写`okHttp`类\n\n```java\npackage com.facebook.react.modules.network;\n\nimport android.net.Uri;\nimport android.util.Base64;\nimport com.facebook.react.bridge.Arguments;\nimport com.facebook.react.bridge.GuardedAsyncTask;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\nimport com.facebook.react.bridge.ReactMethod;\nimport com.facebook.react.bridge.ReadableArray;\nimport com.facebook.react.bridge.ReadableMap;\nimport com.facebook.react.bridge.WritableMap;\nimport com.facebook.react.common.StandardCharsets;\nimport com.facebook.react.common.network.OkHttpCallUtil;\nimport com.facebook.react.module.annotations.ReactModule;\nimport com.facebook.react.modules.core.DeviceEventManagerModule.RCTDeviceEventEmitter;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.nio.charset.Charset;\nimport java.security.KeyManagementException;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.SecureRandom;\nimport java.security.cert.CertificateException;\nimport java.security.cert.X509Certificate;\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;\nimport javax.annotation.Nullable;\nimport javax.net.ssl.HostnameVerifier;\nimport javax.net.ssl.SSLContext;\nimport javax.net.ssl.SSLSession;\nimport javax.net.ssl.TrustManager;\nimport javax.net.ssl.X509TrustManager;\nimport okhttp3.Call;\nimport okhttp3.Callback;\nimport okhttp3.CookieJar;\nimport okhttp3.Headers;\nimport okhttp3.Interceptor;\nimport okhttp3.JavaNetCookieJar;\nimport okhttp3.MediaType;\nimport okhttp3.MultipartBody;\nimport okhttp3.OkHttpClient;\nimport okhttp3.Request;\nimport okhttp3.RequestBody;\nimport okhttp3.Response;\nimport okhttp3.ResponseBody;\nimport okio.ByteString;\n\n/**\n* Implements the XMLHttpRequest JavaScript interface.\n*/\n@ReactModule(name = NetworkingModule.NAME)\n\npublic final class NetworkingModule extends ReactContextBaseJavaModule {\n\tprivate SSLContext getSLLContext () {\n\t\tX509TrustManager xtm = new X509TrustManager() {\n\n\t\t\t@Override\n\t\t\tpublic void checkClientTrusted(X509Certificate[] chain, String authType) {}\n\n\t\t\t@Override\n\t\t\tpublic void checkServerTrusted(X509Certificate[] chain, String authType) {}\n\n\t\t\t@Override\n\t\t\tpublic X509Certificate[] getAcceptedIssuers() {\n\t\t\t\tX509Certificate[] x509Certificates = new X509Certificate[0];\n\t\t\t\t\n\t\t\t\treturn x509Certificates;\n\t\t\t}\n\t\t};\n\n\t\tSSLContext sslContext = null;\n\n\t\ttry {\n\n\t\t\tsslContext = SSLContext.getInstance(\"SSL\");\n\t\t\tsslContext.init(null, new TrustManager[]{xtm}, new SecureRandom());\n\n\t\t} catch (NoSuchAlgorithmException e) {\n\n\t\t\te.printStackTrace();\n\t\t} catch (KeyManagementException e) {\n\n\t\t\te.printStackTrace();\n\t\t}\n\n\t\treturn sslContext;\n\t}\n\n\t/**\n\t* Allows to implement a custom fetching process for specific URIs. It is the handler's job\n\t* to fetch the URI and return the JS body payload.\n\t*/\n\tpublic interface UriHandler {\n\n\t\t/**\n\t\t* Returns if the handler should be used for an URI.\n\t\t*/\n\t\tboolean supports(Uri uri, String responseType);\n\t\t\n\t\t/**\n\t\t* Fetch the URI and return the JS body payload.\n\t\t*/\n\t\tWritableMap fetch(Uri uri) throws IOException;\n\t}\n\n\t/**\n\t* Allows adding custom handling to build the {@link RequestBody} from the JS body payload.\n\t*/\n\tpublic interface RequestBodyHandler {\n\n\t\t/**\n\t\t* Returns if the handler should be used for a JS body payload.\n\t\t*/\n\t\tboolean supports(ReadableMap map);\n\n\t\t/**\n\t\t* Returns the {@link RequestBody} for the JS body payload.\n\t\t*/\n\t\tRequestBody toRequestBody(ReadableMap map, String contentType);\n\t}\n\n\t/**\n\t* Allows adding custom handling to build the JS body payload from the {@link ResponseBody}.\n\t*/\n\n\tpublic interface ResponseHandler {\n\t\t/**\n\t\t* Returns if the handler should be used for a response type.\n\t\t*/\n\t\tboolean supports(String responseType);\n\n\t\t/**\n\t\t* Returns the JS body payload for the {@link ResponseBody}.\n\t\t*/\n\t\tWritableMap toResponseData(ResponseBody body) throws IOException;\n\t}\n\n\tprotected static final String NAME = \"Networking\";\n\n\tprivate static final String CONTENT_ENCODING_HEADER_NAME = \"content-encoding\";\n\n\tprivate static final String CONTENT_TYPE_HEADER_NAME = \"content-type\";\n\n\tprivate static final String REQUEST_BODY_KEY_STRING = \"string\";\n\n\tprivate static final String REQUEST_BODY_KEY_URI = \"uri\";\n\n\tprivate static final String REQUEST_BODY_KEY_FORMDATA = \"formData\";\n\n\tprivate static final String REQUEST_BODY_KEY_BASE64 = \"base64\";\n\n\tprivate static final String USER_AGENT_HEADER_NAME = \"user-agent\";\n\n\tprivate static final int CHUNK_TIMEOUT_NS = 100 * 1000000; // 100ms\n\n\tprivate static final int MAX_CHUNK_SIZE_BETWEEN_FLUSHES = 8 * 1024; // 8K\n\n\tprivate final OkHttpClient mClient;\n\n\tprivate final ForwardingCookieHandler mCookieHandler;\n\n\tprivate final @Nullable String mDefaultUserAgent;\n\n\tprivate final CookieJarContainer mCookieJarContainer;\n\n\tprivate final Set<Integer> mRequestIds;\n\n\tprivate final List<RequestBodyHandler> mRequestBodyHandlers = new ArrayList<>();\n\n\tprivate final List<UriHandler> mUriHandlers = new ArrayList<>();\n\n\tprivate final List<ResponseHandler> mResponseHandlers = new ArrayList<>();\n\n\tprivate boolean mShuttingDown;\n\n\t/* package */\n\n\tNetworkingModule(\n\t\tReactApplicationContext reactContext,\n\t\t@Nullable String defaultUserAgent,\n\t\tOkHttpClient client,\n\t\t@Nullable List networkInterceptorCreators\n\t) {\n\t\tsuper(reactContext);\n\t\tif (networkInterceptorCreators != null) {\n\t\t\tOkHttpClient.Builder clientBuilder = client.newBuilder();\n\n\t\t\tfor (NetworkInterceptorCreator networkInterceptorCreator : networkInterceptorCreators) {\n\t\t\t\tclientBuilder.addNetworkInterceptor(networkInterceptorCreator.create());\n\t\t\t}\n\n\t\t\tclient = clientBuilder.build();\n\t\t}\n\n\t\tclient = client.newBuilder().hostnameVerifier(new HostnameVerifier() {\n\t\t\t@Override\n\t\t\tpublic boolean verify(String s, SSLSession sslSession) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}).sslSocketFactory(getSLLContext().getSocketFactory()).build();\n\n\t\tmClient = client;\n\t\tmCookieHandler = new ForwardingCookieHandler(reactContext);\n\t\tmCookieJarContainer = (CookieJarContainer) mClient.cookieJar();\n\t\tmShuttingDown = false;\n\t\tmDefaultUserAgent = defaultUserAgent;\n\t\tmRequestIds = new HashSet<>();\n\t}\n\n\t/**\n\t* @param context the ReactContext of the application\n\t* @param defaultUserAgent the User-Agent header that will be set for all requests where the\n\t* caller does not provide one explicitly\n\t* @param client the {@link OkHttpClient} to be used for networking\n\t*/\n\n\t/* package */\n\tNetworkingModule(\n\t\tReactApplicationContext context,\n\t\t@Nullable String defaultUserAgent,\n\t\tOkHttpClient client\n\t) {\n\t\tthis(context, defaultUserAgent, client, null);\n\t}\n\n\t/**\n\t* @param context the ReactContext of the application\n\t*/\n\tpublic NetworkingModule(final ReactApplicationContext context) {\n\t\tthis(context, null, OkHttpClientProvider.createClient(), null);\n\t}\n\n\t/**\n\t* @param context the ReactContext of the application\n\t* @param networkInterceptorCreators list of {@link NetworkInterceptorCreator}'s whose create()\n\t* methods would be called to attach the interceptors to the client.\n\t*/\n\tpublic NetworkingModule(\n\t\tReactApplicationContext context,\n\t\tList networkInterceptorCreators) {\n\t\t\tthis(context, null, OkHttpClientProvider.createClient(), networkInterceptorCreators);\n\t\t}\n\t/**\n\t* @param context the ReactContext of the application\n\t* @param defaultUserAgent the User-Agent header that will be set for all requests where the\n\t* caller does not provide one explicitly\n\t*/\n\n\tpublic NetworkingModule(ReactApplicationContext context, String defaultUserAgent) {\n\t\tthis(context, defaultUserAgent, OkHttpClientProvider.createClient(), null);\n\t}\n\n\t@Override\n\tpublic void initialize() {\n\t\tmCookieJarContainer.setCookieJar(new JavaNetCookieJar(mCookieHandler));\n\t}\n\n\t@Override\n\tpublic String getName() {\n\t\treturn NAME;\n\t}\n\n\t@Override\n\tpublic void onCatalystInstanceDestroy() {\n\t\tmShuttingDown = true;\n\t\tcancelAllRequests();\n\t\tmCookieHandler.destroy();\n\t\tmCookieJarContainer.removeCookieJar();\n\t\tmRequestBodyHandlers.clear();\n\t\tmResponseHandlers.clear();\n\t\tmUriHandlers.clear();\n\t}\n\n\tpublic void addUriHandler(UriHandler handler) {\n\t\tmUriHandlers.add(handler);\n\t}\n\n\tpublic void addRequestBodyHandler(RequestBodyHandler handler) {\n\t\tmRequestBodyHandlers.add(handler);\n\t}\n\n\tpublic void addResponseHandler(ResponseHandler handler) {\n\t\tmResponseHandlers.add(handler);\n\t}\n\n\tpublic void removeUriHandler(UriHandler handler) {\n\t\tmUriHandlers.remove(handler);\n\t}\n\n\tpublic void removeRequestBodyHandler(RequestBodyHandler handler) {\n\t\tmRequestBodyHandlers.remove(handler);\n\t}\n\n\tpublic void removeResponseHandler(ResponseHandler handler) {\n\t\tmResponseHandlers.remove(handler);\n\t}\n\n\t@ReactMethod\n\t/**\n\t* @param timeout value of 0 results in no timeout\n\t*/\n\tpublic void sendRequest(\n\t\tString method,\n\t\tString url,\n\t\tfinal int requestId,\n\t\tReadableArray headers,\n\t\tReadableMap data,\n\t\tfinal String responseType,\n\t\tfinal boolean useIncrementalUpdates,\n\t\tint timeout,\n\t\tboolean withCredentials\n\t) {\n\t\tfinal RCTDeviceEventEmitter eventEmitter = getEventEmitter();\n\n\t\ttry {\n\t\t\tUri uri = Uri.parse(url);\n\t\t\t// Check if a handler is registered\n\t\t\tfor (UriHandler handler : mUriHandlers) {\n\t\t\t\tif (handler.supports(uri, responseType)) {\n\t\t\t\t\tWritableMap res = handler.fetch(uri);\n\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);\n\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (IOException e) {\n\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);\n\t\t\treturn;\n\t\t}\n\n\t\tRequest.Builder requestBuilder;\n\n\t\ttry {\n\t\t\trequestBuilder = new Request.Builder().url(url);\n\t\t} catch (Exception e) {\n\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), null);\n\t\t\treturn;\n\t\t}\n\n\t\tif (requestId != 0) {\n\t\t\trequestBuilder.tag(requestId);\n\t\t}\n\n\t\tOkHttpClient.Builder clientBuilder = mClient.newBuilder();\n\n\t\tif (!withCredentials) {\n\t\t\tclientBuilder.cookieJar(CookieJar.NO_COOKIES);\n\t\t}\n\n\t\t// If JS is listening for progress updates, install a ProgressResponseBody that intercepts the\n\t\t// response and counts bytes received.\n\t\tif (useIncrementalUpdates) {\n\n\t\t\tclientBuilder.addNetworkInterceptor(new Interceptor() {\n\t\t\t\t@Override\n\t\t\t\tpublic Response intercept(Interceptor.Chain chain) throws IOException {\n\t\t\t\t\tResponse originalResponse = chain.proceed(chain.request());\n\t\t\t\t\tProgressResponseBody responseBody = new ProgressResponseBody(\n\t\t\t\t\toriginalResponse.body(),\n\t\t\t\t\tnew ProgressListener() {\n\t\t\t\t\t\tlong last = System.nanoTime();\n\n\t\t\t\t\t\t@Override\n\t\t\t\t\t\tpublic void onProgress(long bytesWritten, long contentLength, boolean done) {\n\t\t\t\t\t\t\tlong now = System.nanoTime();\n\t\t\t\t\t\t\tif (!done && !shouldDispatch(now, last)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (responseType.equals(\"text\")) {\n\t\t\t\t\t\t\t\t// For 'text' responses we continuously send response data with progress info to\n\t\t\t\t\t\t\t\t// JS below, so no need to do anything here.\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tResponseUtil.onDataReceivedProgress(\n\t\t\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\t\tbytesWritten,\n\t\t\t\t\t\t\t\tcontentLength\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tlast = now;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn originalResponse.newBuilder().body(responseBody).build();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// If the current timeout does not equal the passed in timeout, we need to clone the existing\n\t\t// client and set the timeout explicitly on the clone. This is cheap as everything else is\n\t\t// shared under the hood.\n\t\t// See https://github.com/square/okhttp/wiki/Recipes#per-call-configuration for more information\n\n\t\tif (timeout != mClient.connectTimeoutMillis()) {\n\t\t\tclientBuilder.readTimeout(timeout, TimeUnit.MILLISECONDS);\n\t\t}\n\n\t\tOkHttpClient client = clientBuilder.build();\n\t\tHeaders requestHeaders = extractHeaders(headers, data);\n\t\tif (requestHeaders == null) {\n\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, \"Unrecognized headers format\", null);\n\t\t\treturn;\n\t\t}\n\n\t\tString contentType = requestHeaders.get(CONTENT_TYPE_HEADER_NAME);\n\t\tString contentEncoding = requestHeaders.get(CONTENT_ENCODING_HEADER_NAME);\n\t\trequestBuilder.headers(requestHeaders);\n\n\t\t// Check if a handler is registered\n\t\tRequestBodyHandler handler = null;\n\n\t\tif (data != null) {\n\n\t\t\tfor (RequestBodyHandler curHandler : mRequestBodyHandlers) {\n\t\t\t\tif (curHandler.supports(data)) {\n\t\t\t\t\thandler = curHandler;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tRequestBody requestBody;\n\t\tif (data == null || method.toLowerCase().equals(\"get\") || method.toLowerCase().equals(\"head\")) {\n\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);\n\t\t} else if (handler != null) {\n\t\t\trequestBody = handler.toRequestBody(data, contentType);\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_STRING)) {\n\t\t\tif (contentType == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Payload is set but no content-type header specified\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tString body = data.getString(REQUEST_BODY_KEY_STRING);\n\t\t\tMediaType contentMediaType = MediaType.parse(contentType);\n\n\t\t\tif (RequestBodyUtil.isGzipEncoding(contentEncoding)) {\n\t\t\t\trequestBody = RequestBodyUtil.createGzip(contentMediaType, body);\n\t\t\t\tif (requestBody == null) {\n\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, \"Failed to gzip request body\", null);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trequestBody = RequestBody.create(contentMediaType, body);\n\t\t\t}\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_BASE64)) {\n\n\t\t\tif (contentType == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Payload is set but no content-type header specified\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tString base64String = data.getString(REQUEST_BODY_KEY_BASE64);\n\t\t\tMediaType contentMediaType = MediaType.parse(contentType);\n\t\t\trequestBody = RequestBody.create(contentMediaType, ByteString.decodeBase64(base64String));\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_URI)) {\n\t\t\tif (contentType == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Payload is set but no content-type header specified\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tString uri = data.getString(REQUEST_BODY_KEY_URI);\n\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), uri);\n\n\t\t\tif (fileInputStream == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Could not retrieve file for uri \" + uri,\n\t\t\t\t\tnull\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestBody = RequestBodyUtil.create(MediaType.parse(contentType), fileInputStream);\n\t\t} else if (data.hasKey(REQUEST_BODY_KEY_FORMDATA)) {\n\t\t\tif (contentType == null) {\n\t\t\t\tcontentType = \"multipart/form-data\";\n\t\t\t}\n\n\t\t\tReadableArray parts = data.getArray(REQUEST_BODY_KEY_FORMDATA);\n\t\t\tMultipartBody.Builder multipartBuilder =\n\t\t\tconstructMultipartBody(parts, contentType, requestId);\n\n\t\t\tif (multipartBuilder == null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestBody = multipartBuilder.build();\n\n\t\t} else {\n\t\t\t// Nothing in data payload, at least nothing we could understand anyway.\n\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);\n\t\t}\n\n\t\trequestBuilder.method(\n\t\t\tmethod,\n\t\t\twrapRequestBodyWithProgressEmitter(requestBody, eventEmitter, requestId)\n\t\t);\n\t\taddRequest(requestId);\n\t\tclient.newCall(requestBuilder.build()).enqueue(\n\t\t\tnew Callback() {\n\t\t\t\t@Override\n\t\t\t\tpublic void onFailure(Call call, IOException e) {\n\t\t\t\t\tif (mShuttingDown) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tremoveRequest(requestId);\n\n\t\t\t\t\tString errorMessage = e.getMessage() != null\n\t\t\t\t\t? e.getMessage()\n\t\t\t\t\t: \"Error while executing request: \" + e.getClass().getSimpleName();\n\n\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, errorMessage, e);\n\t\t\t\t}\n\n\t\t\t\t@Override\n\t\t\t\tpublic void onResponse(Call call, Response response) throws IOException {\n\t\t\t\t\tif (mShuttingDown) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tremoveRequest(requestId);\n\n\t\t\t\t\t// Before we touch the body send headers to JS\n\t\t\t\t\tResponseUtil.onResponseReceived(\n\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\tresponse.code(),\n\t\t\t\t\t\ttranslateHeaders(response.headers()),\n\t\t\t\t\t\tresponse.request().url().toString()\n\t\t\t\t\t);\n\n\t\t\t\t\tResponseBody responseBody = response.body();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Check if a handler is registered\n\t\t\t\t\t\tfor (ResponseHandler handler : mResponseHandlers) {\n\n\t\t\t\t\t\t\tif (handler.supports(responseType)) {\n\t\t\t\t\t\t\t\tWritableMap res = handler.toResponseData(responseBody);\n\t\t\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);\n\t\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If JS wants progress updates during the download, and it requested a text response,\n\t\t\t\t\t\t// periodically send response data updates to JS.\n\t\t\t\t\t\tif (useIncrementalUpdates && responseType.equals(\"text\")) {\n\t\t\t\t\t\t\treadWithProgress(eventEmitter, requestId, responseBody);\n\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Otherwise send the data in one big chunk, in the format that JS requested.\n\t\t\t\t\t\tString responseString = \"\";\n\n\t\t\t\t\t\tif (responseType.equals(\"text\")) {\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tresponseString = responseBody.string();\n\t\t\t\t\t\t\t} catch (IOException e) {\n\t\t\t\t\t\t\t\tif (response.request().method().equalsIgnoreCase(\"HEAD\")) {\n\t\t\t\t\t\t\t\t\t// The request is an `HEAD` and the body is empty,\n\t\t\t\t\t\t\t\t\t// the OkHttp will produce an exception.\n\t\t\t\t\t\t\t\t\t// Ignore the exception to not invalidate the request in the\n\t\t\t\t\t\t\t\t\t// Javascript layer.\n\t\t\t\t\t\t\t\t\t// Introduced to fix issue #7463.\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (responseType.equals(\"base64\")) {\n\t\t\t\t\t\t\tresponseString = Base64.encodeToString(responseBody.bytes(), Base64.NO_WRAP);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, responseString);\n\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);\n\t\t\t\t\t} catch (IOException e) {\n\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tprivate RequestBody wrapRequestBodyWithProgressEmitter(\n\t\tfinal RequestBody requestBody,\n\t\tfinal RCTDeviceEventEmitter eventEmitter,\n\t\tfinal int requestId\n\t) {\n\t\tif(requestBody == null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn RequestBodyUtil.createProgressRequest(\n\t\t\trequestBody,\n\t\t\tnew ProgressListener() {\n\t\t\t\tlong last = System.nanoTime();\n\n\t\t\t\t@Override\n\t\t\t\tpublic void onProgress(long bytesWritten, long contentLength, boolean done) {\n\n\t\t\t\t\tlong now = System.nanoTime();\n\n\t\t\t\t\tif (done || shouldDispatch(now, last)) {\n\t\t\t\t\t\tResponseUtil.onDataSend(eventEmitter, requestId, bytesWritten, contentLength);\n\t\t\t\t\t\tlast = now;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tprivate void readWithProgress(\n\t\tRCTDeviceEventEmitter eventEmitter,\n\t\tint requestId,\n\t\tResponseBody responseBody\n\t) throws IOException {\n\t\tlong totalBytesRead = -1;\n\t\tlong contentLength = -1;\n\n\t\ttry {\n\t\t\tProgressResponseBody progressResponseBody = (ProgressResponseBody) responseBody;\n\t\t\ttotalBytesRead = progressResponseBody.totalBytesRead();\n\t\t\tcontentLength = progressResponseBody.contentLength();\n\t\t} catch (ClassCastException e) {\n\t\t\t// Ignore\n\t\t}\n\n\t\tCharset charset = responseBody.contentType() == null ? StandardCharsets.UTF_8 :\n\t\tresponseBody.contentType().charset(StandardCharsets.UTF_8);\n\t\tProgressiveStringDecoder streamDecoder = new ProgressiveStringDecoder(charset);\n\t\tInputStream inputStream = responseBody.byteStream();\n\n\t\ttry {\n\t\t\tbyte[] buffer = new byte[MAX_CHUNK_SIZE_BETWEEN_FLUSHES];\n\t\t\tint read;\n\n\t\t\twhile ((read = inputStream.read(buffer)) != -1) {\n\t\t\t\tResponseUtil.onIncrementalDataReceived(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\tstreamDecoder.decodeNext(buffer, read),\n\t\t\t\t\ttotalBytesRead,\n\t\t\t\t\tcontentLength\n\t\t\t\t);\n\t\t\t}\n\t\t} finally {\n\t\t\tinputStream.close();\n\t\t}\n\n\t}\n\n\tprivate static boolean shouldDispatch(long now, long last) {\n\t\treturn last + CHUNK_TIMEOUT_NS < now;\n\t}\n\n\tprivate synchronized void addRequest(int requestId) {\n\t\tmRequestIds.add(requestId);\n\t}\n\n\tprivate synchronized void removeRequest(int requestId) {\n\t\tmRequestIds.remove(requestId);\n\t}\n\n\tprivate synchronized void cancelAllRequests() {\n\t\tfor (Integer requestId : mRequestIds) {\n\t\t\tcancelRequest(requestId);\n\t\t}\n\n\t\tmRequestIds.clear();\n\t}\n\n\tprivate static WritableMap translateHeaders(Headers headers) {\n\t\tWritableMap responseHeaders = Arguments.createMap();\n\n\t\tfor (int i = 0; i < headers.size(); i++) {\n\t\t\tString headerName = headers.name(i);\n\t\t\t\n\t\t\t// multiple values for the same header\n\t\t\tif (responseHeaders.hasKey(headerName)) {\n\t\t\t\tresponseHeaders.putString(\n\t\t\t\theaderName,\n\t\t\t\tresponseHeaders.getString(headerName) + \", \" + headers.value(i));\n\t\t\t} else {\n\t\t\t\tresponseHeaders.putString(headerName, headers.value(i));\n\t\t\t}\n\t\t}\n\n\t\treturn responseHeaders;\n\t}\n\n\t@ReactMethod\n\tpublic void abortRequest(final int requestId) {\n\t\tcancelRequest(requestId);\n\t\tremoveRequest(requestId);\n\t}\n\n\tprivate void cancelRequest(final int requestId) {\n\t\t// We have to use AsyncTask since this might trigger a NetworkOnMainThreadException, this is an\n\t\t// open issue on OkHttp: https://github.com/square/okhttp/issues/869\n\t\tnew GuardedAsyncTask(getReactApplicationContext()) {\n\t\t\t@Override\n\t\t\tprotected void doInBackgroundGuarded(Void... params) {\n\t\t\t\tOkHttpCallUtil.cancelTag(mClient, Integer.valueOf(requestId));\n\t\t\t}\n\t\t}.execute();\n\t}\n\n\t@ReactMethod\n\tpublic void clearCookies(com.facebook.react.bridge.Callback callback) {\n\t\tmCookieHandler.clearCookies(callback);\n\t}\n\n\tprivate @Nullable MultipartBody.Builder constructMultipartBody(\n\t\tReadableArray body,\n\t\tString contentType,\n\t\tint requestId\n\t) {\n\t\tRCTDeviceEventEmitter eventEmitter = getEventEmitter();\n\t\tMultipartBody.Builder multipartBuilder = new MultipartBody.Builder();\n\t\tmultipartBuilder.setType(MediaType.parse(contentType));\n\t\tfor (int i = 0, size = body.size(); i < size; i++) {\n\t\t\tReadableMap bodyPart = body.getMap(i);\n\n\t\t\t// Determine part's content type.\n\t\t\tReadableArray headersArray = bodyPart.getArray(\"headers\");\n\t\t\tHeaders headers = extractHeaders(headersArray, null);\n\t\t\tif (headers == null) {\n\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\teventEmitter,\n\t\t\t\t\trequestId,\n\t\t\t\t\t\"Missing or invalid header format for FormData part.\",\n\t\t\t\t\tnull\n\t\t\t\t);\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tMediaType partContentType = null;\n\t\t\tString partContentTypeStr = headers.get(CONTENT_TYPE_HEADER_NAME);\n\n\t\t\tif (partContentTypeStr != null) {\n\t\t\t\tpartContentType = MediaType.parse(partContentTypeStr);\n\t\t\t\t// Remove the content-type header because MultipartBuilder gets it explicitly as an\n\t\t\t\t// argument and doesn't expect it in the headers array.\n\t\t\t\theaders = headers.newBuilder().removeAll(CONTENT_TYPE_HEADER_NAME).build();\n\t\t\t}\n\n\t\t\tif (bodyPart.hasKey(REQUEST_BODY_KEY_STRING)) {\n\t\t\t\tString bodyValue = bodyPart.getString(REQUEST_BODY_KEY_STRING);\n\t\t\t\tmultipartBuilder.addPart(headers, RequestBody.create(partContentType, bodyValue));\n\t\t\t} else if (bodyPart.hasKey(REQUEST_BODY_KEY_URI)) {\n\t\t\t\tif (partContentType == null) {\n\t\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\"Binary FormData part needs a content-type header.\",\n\t\t\t\t\t\tnull\n\t\t\t\t\t);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tString fileContentUriStr = bodyPart.getString(REQUEST_BODY_KEY_URI);\n\t\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), fileContentUriStr);\n\n\t\t\t\tif (fileInputStream == null) {\n\t\t\t\t\tResponseUtil.onRequestError(\n\t\t\t\t\t\teventEmitter,\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\"Could not retrieve file for uri \" + fileContentUriStr,\n\t\t\t\t\t\tnull\n\t\t\t\t\t);\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tmultipartBuilder.addPart(headers, RequestBodyUtil.create(partContentType, fileInputStream));\n\t\t\t} else {\n\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, \"Unrecognized FormData part.\", null);\n\t\t\t}\n\t\t}\n\t\treturn multipartBuilder;\n\t}\n\n\t/**\n\t* Extracts the headers from the Array. If the format is invalid, this method will return null.\n\t*/\n\tprivate @Nullable Headers extractHeaders(\n\t\t@Nullable ReadableArray headersArray,\n\t\t@Nullable ReadableMap requestData\n\t) {\n\t\tif (headersArray == null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tHeaders.Builder headersBuilder = new Headers.Builder();\n\n\t\tfor (int headersIdx = 0, size = headersArray.size(); headersIdx < size; headersIdx++) {\n\t\t\tReadableArray header = headersArray.getArray(headersIdx);\n\n\t\t\tif (header == null || header.size() != 2) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tString headerName = header.getString(0);\n\t\t\tString headerValue = header.getString(1);\n\n\t\t\tif (headerName == null || headerValue == null) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\theadersBuilder.add(headerName, headerValue);\n\t\t}\n\n\t\tif (headersBuilder.get(USER_AGENT_HEADER_NAME) == null && mDefaultUserAgent != null) {\n\t\t\theadersBuilder.add(USER_AGENT_HEADER_NAME, mDefaultUserAgent);\n\t\t}\n\n\t\t// Sanitize content encoding header, supported only when request specify payload as string\n\t\tboolean isGzipSupported = requestData != null && requestData.hasKey(REQUEST_BODY_KEY_STRING);\n\n\t\tif (!isGzipSupported) {\n\t\t\theadersBuilder.removeAll(CONTENT_ENCODING_HEADER_NAME);\n\t\t}\n\t\treturn headersBuilder.build();\n\t}\n\n\tprivate RCTDeviceEventEmitter getEventEmitter() {\n\t\treturn getReactApplicationContext().getJSModule(RCTDeviceEventEmitter.class);\n\t}\n}\n```\n\n\n- 在终端代开项目`cd {project}`执行\n- `react-native run-android`开始编译，编译的过程很漫长，大概需要10到20分钟\n- 如果中途失败记得删除`/node_modules/react-native/ReactAndroid/bulid`里面的所有内容，然后重新编译\n\n- 关于源代码编译可以参考官方文档[中文](https://reactnative.cn/docs/building-from-source.html)或者[英文](https://facebook.github.io/react-native/docs/building-from-source)官网详细查看\n\n\n\n- 关于详细代码可进入我的[Github](https://github.com/AaronBank/react-native.git)查看\n\n*感谢支持*","slug":"react-native中fetch发送https或http相关问题总结","published":1,"updated":"2019-07-30T16:10:22.985Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjysbhucr001jqbt52mmnuoww","content":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/150542.jpg\" alt> </p>\n<p><code>react-native</code>再请求方面有点坑，<code>Ios</code>端默认支持<code>https</code>，而安卓默认支持的事<code>http</code>，如果你需要的是其中的某一种方式，那这篇文章可能能帮到你😍😍</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n</ul>\n<h3 id=\"前置说明\"><a href=\"#前置说明\" class=\"headerlink\" title=\"前置说明\"></a>前置说明</h3><ol>\n<li>在ios平台ios9.0以上默认支持https而不支持http</li>\n<li>对于https，如果你的服务器端是CA签发的证书，那你ios平台不需要改动任何代码</li>\n<li>对于自签证书，那你需要对源代码进行改动，下面会详细说明方式</li>\n<li>对于http，有两个方式可以做到，下面会详细说明方式<ol>\n<li>直接使用ip地址</li>\n<li>使用域名，对源代码进行配置</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"关于ios支持https自签证书\"><a href=\"#关于ios支持https自签证书\" class=\"headerlink\" title=\"关于ios支持https自签证书\"></a>关于ios支持https自签证书</h3><ul>\n<li>服务器端使用自签证书，免证书方法</li>\n<li>打开XCode在当前项目路径为<code>Libraries/RCTNetwork.xcodeproj</code>找到<code>RCTHTTPRequestHandler.mm</code></li>\n<li>或者在<code>{project}/node_modules/react-native/Libraries/Network</code>目录下同样可以找到该文件</li>\n<li>在文件中搜索<code>#pragma mark - NSURLSession delegate</code>并在其后面添加如下代码即可</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)URLSession:(NSURLSession *)session  didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge  completionHandler:(<span class=\"keyword\">void</span> (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential * __nullable credential))completionHandler&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (RCT_DEBUG) &#123;</span><br><span class=\"line\">        completionHandler(NSURLSessionAuthChallengeUseCredential,[NSURLCredential  credentialForTrust:challenge.protectionSpace.serverTrust]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置如图所示</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902-1.png\" alt> </p>\n<h3 id=\"关于ios支持http请求\"><a href=\"#关于ios支持http请求\" class=\"headerlink\" title=\"关于ios支持http请求\"></a>关于ios支持http请求</h3><ul>\n<li>关于http方式我们只介绍第二种因为直接使用ip地址真的是太。。简单，直接把域名换成ip就好了</li>\n<li>对于第二种你需要改动<code>{project}/ios/App</code>下面的<code>Info.plist</code>文件</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSAppTransportSecuritykey&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSAllowsArbitraryLoadskey&gt;<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置如图所示</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902.png\" alt> </p>\n<p>到此为止<code>Ios</code>相关问题就解决了，<code>Ios</code>部分还是比较好弄得O(∩_∩)O不是很麻烦，<code>Android</code>得话就麻烦些，下面我们说下<code>Android</code>相关的解决方案</p>\n<h3 id=\"关于Android端http和https你需要知道\"><a href=\"#关于Android端http和https你需要知道\" class=\"headerlink\" title=\"关于Android端http和https你需要知道\"></a>关于Android端http和https你需要知道</h3><ol>\n<li>安卓默认是支持http请求儿不支持https</li>\n<li>想做到支持https那就需要改动react-native的源代码，进而重新编译才能成功</li>\n</ol>\n<h3 id=\"关于Android支持https\"><a href=\"#关于Android支持https\" class=\"headerlink\" title=\"关于Android支持https\"></a>关于Android支持https</h3><ul>\n<li><p>下载ndk（下载r10e版本的，其他的版本会有问题）</p>\n<ol>\n<li>Mac OS (64-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip</a></li>\n<li>Linux (64-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip</a></li>\n<li>Windows (64-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip</a></li>\n<li>Windows (32-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip</a></li>\n</ol>\n</li>\n<li><p>在项目<code>{project}/android</code>文件夹先创建<code>local.properties</code>文件（如果已经存在哪直接修改就好了）</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sdk.dir=你自己的sdk路径</span><br><span class=\"line\">ndk.dir=你自己的ndk路径</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140900-1.jpg\" alt></p>\n<ul>\n<li>在<code>{project}/android/build.gradle</code>中添加<code>gradle-download-task</code>依赖</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    classpath <span class=\"string\">'com.android.tools.build:gradle:2.2.3'</span></span><br><span class=\"line\">    classpath <span class=\"string\">'de.undercouch:gradle-download-task:3.1.2'</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class=\"line\">    <span class=\"comment\">// in the individual module build.gradle files</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>在<code>{project}/android/settings.gradle</code>中添加<code>:ReactAndroid</code>项目</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    include <span class=\"string\">':ReactAndroid'</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    project(<span class=\"string\">':ReactAndroid'</span>).projectDir = <span class=\"keyword\">new</span> File(rootProject.projectDir, <span class=\"string\">'../node_modules/react-native/ReactAndroid'</span>)</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改<code>{project}/android/app/build.gradle</code>文件，使用:ReactAndroid替换预编译库</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\">compile <span class=\"title\">fileTree</span><span class=\"params\">(dir: <span class=\"string\">\"libs\"</span>, include: [<span class=\"string\">\"*.jar\"</span>])</span></span></span><br><span class=\"line\"><span class=\"function\">compile \"com.android.support:appcompat-v7:23.0.1\"</span></span><br><span class=\"line\"><span class=\"function\">compile <span class=\"title\">project</span><span class=\"params\">(<span class=\"string\">':ReactAndroid'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">  </span></span><br><span class=\"line\"><span class=\"function\">...</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重写第三方模块的依赖，否则会报错<code>-Error: more than one library with package name &#39;com.facebook.react&#39;</code></li>\n<li>修改<code>{project}/android/app/build.gradle</code>文件，添加以下代码</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">configurations.all &#123;</span><br><span class=\"line\">    exclude group: <span class=\"string\">'com.facebook.react'</span>, <span class=\"keyword\">module</span>: <span class=\"string\">'react-native'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重写<code>okHttp</code>类</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.facebook.react.modules.network;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.net.Uri;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.Base64;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.Arguments;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.GuardedAsyncTask;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReactApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReactContextBaseJavaModule;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReactMethod;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReadableArray;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReadableMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.WritableMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.common.StandardCharsets;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.common.network.OkHttpCallUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.<span class=\"keyword\">module</span>.annotations.ReactModule;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.modules.core.DeviceEventManagerModule.RCTDeviceEventEmitter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.Charset;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.KeyManagementException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.NoSuchAlgorithmException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.SecureRandom;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.cert.CertificateException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.cert.X509Certificate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashSet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Nullable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.HostnameVerifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.SSLContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.SSLSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.TrustManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.X509TrustManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Call;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Callback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.CookieJar;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Headers;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Interceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.JavaNetCookieJar;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.MediaType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.MultipartBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.OkHttpClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Request;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.RequestBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.ResponseBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okio.ByteString;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* Implements the XMLHttpRequest JavaScript interface.</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">@ReactModule</span>(name = NetworkingModule.NAME)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NetworkingModule</span> <span class=\"keyword\">extends</span> <span class=\"title\">ReactContextBaseJavaModule</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> SSLContext <span class=\"title\">getSLLContext</span> <span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tX509TrustManager xtm = <span class=\"keyword\">new</span> X509TrustManager() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">checkClientTrusted</span><span class=\"params\">(X509Certificate[] chain, String authType)</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">checkServerTrusted</span><span class=\"params\">(X509Certificate[] chain, String authType)</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class=\"line\">\t\t\t\tX509Certificate[] x509Certificates = <span class=\"keyword\">new</span> X509Certificate[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> x509Certificates;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSSLContext sslContext = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tsslContext = SSLContext.getInstance(<span class=\"string\">\"SSL\"</span>);</span><br><span class=\"line\">\t\t\tsslContext.init(<span class=\"keyword\">null</span>, <span class=\"keyword\">new</span> TrustManager[]&#123;xtm&#125;, <span class=\"keyword\">new</span> SecureRandom());</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (KeyManagementException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> sslContext;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Allows to implement a custom fetching process for specific URIs. It is the handler's job</span></span><br><span class=\"line\"><span class=\"comment\">\t* to fetch the URI and return the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UriHandler</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns if the handler should be used for an URI.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Uri uri, String responseType)</span></span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Fetch the URI and return the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\">WritableMap <span class=\"title\">fetch</span><span class=\"params\">(Uri uri)</span> <span class=\"keyword\">throws</span> IOException</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Allows adding custom handling to build the &#123;<span class=\"doctag\">@link</span> RequestBody&#125; from the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">RequestBodyHandler</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns if the handler should be used for a JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(ReadableMap map)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns the &#123;<span class=\"doctag\">@link</span> RequestBody&#125; for the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\">RequestBody <span class=\"title\">toRequestBody</span><span class=\"params\">(ReadableMap map, String contentType)</span></span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Allows adding custom handling to build the JS body payload from the &#123;<span class=\"doctag\">@link</span> ResponseBody&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ResponseHandler</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns if the handler should be used for a response type.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(String responseType)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns the JS body payload for the &#123;<span class=\"doctag\">@link</span> ResponseBody&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\">WritableMap <span class=\"title\">toResponseData</span><span class=\"params\">(ResponseBody body)</span> <span class=\"keyword\">throws</span> IOException</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String NAME = <span class=\"string\">\"Networking\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String CONTENT_ENCODING_HEADER_NAME = <span class=\"string\">\"content-encoding\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String CONTENT_TYPE_HEADER_NAME = <span class=\"string\">\"content-type\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_STRING = <span class=\"string\">\"string\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_URI = <span class=\"string\">\"uri\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_FORMDATA = <span class=\"string\">\"formData\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_BASE64 = <span class=\"string\">\"base64\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String USER_AGENT_HEADER_NAME = <span class=\"string\">\"user-agent\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CHUNK_TIMEOUT_NS = <span class=\"number\">100</span> * <span class=\"number\">1000000</span>; <span class=\"comment\">// 100ms</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAX_CHUNK_SIZE_BETWEEN_FLUSHES = <span class=\"number\">8</span> * <span class=\"number\">1024</span>; <span class=\"comment\">// 8K</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> OkHttpClient mClient;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ForwardingCookieHandler mCookieHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"meta\">@Nullable</span> String mDefaultUserAgent;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> CookieJarContainer mCookieJarContainer;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Set&lt;Integer&gt; mRequestIds;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;RequestBodyHandler&gt; mRequestBodyHandlers = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;UriHandler&gt; mUriHandlers = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;ResponseHandler&gt; mResponseHandlers = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> mShuttingDown;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/* package */</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tNetworkingModule(</span><br><span class=\"line\">\t\tReactApplicationContext reactContext,</span><br><span class=\"line\">\t\t<span class=\"meta\">@Nullable</span> String defaultUserAgent,</span><br><span class=\"line\">\t\tOkHttpClient client,</span><br><span class=\"line\">\t\t<span class=\"meta\">@Nullable</span> List networkInterceptorCreators</span><br><span class=\"line\">\t) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>(reactContext);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (networkInterceptorCreators != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tOkHttpClient.Builder clientBuilder = client.newBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (NetworkInterceptorCreator networkInterceptorCreator : networkInterceptorCreators) &#123;</span><br><span class=\"line\">\t\t\t\tclientBuilder.addNetworkInterceptor(networkInterceptorCreator.create());</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tclient = clientBuilder.build();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tclient = client.newBuilder().hostnameVerifier(<span class=\"keyword\">new</span> HostnameVerifier() &#123;</span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">verify</span><span class=\"params\">(String s, SSLSession sslSession)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;).sslSocketFactory(getSLLContext().getSocketFactory()).build();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmClient = client;</span><br><span class=\"line\">\t\tmCookieHandler = <span class=\"keyword\">new</span> ForwardingCookieHandler(reactContext);</span><br><span class=\"line\">\t\tmCookieJarContainer = (CookieJarContainer) mClient.cookieJar();</span><br><span class=\"line\">\t\tmShuttingDown = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\tmDefaultUserAgent = defaultUserAgent;</span><br><span class=\"line\">\t\tmRequestIds = <span class=\"keyword\">new</span> HashSet&lt;&gt;();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> defaultUserAgent the User-Agent header that will be set for all requests where the</span></span><br><span class=\"line\"><span class=\"comment\">\t* caller does not provide one explicitly</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> client the &#123;<span class=\"doctag\">@link</span> OkHttpClient&#125; to be used for networking</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/* package */</span></span><br><span class=\"line\">\tNetworkingModule(</span><br><span class=\"line\">\t\tReactApplicationContext context,</span><br><span class=\"line\">\t\t<span class=\"meta\">@Nullable</span> String defaultUserAgent,</span><br><span class=\"line\">\t\tOkHttpClient client</span><br><span class=\"line\">\t) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>(context, defaultUserAgent, client, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetworkingModule</span><span class=\"params\">(<span class=\"keyword\">final</span> ReactApplicationContext context)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>(context, <span class=\"keyword\">null</span>, OkHttpClientProvider.createClient(), <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> networkInterceptorCreators list of &#123;<span class=\"doctag\">@link</span> NetworkInterceptorCreator&#125;'s whose create()</span></span><br><span class=\"line\"><span class=\"comment\">\t* methods would be called to attach the interceptors to the client.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetworkingModule</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReactApplicationContext context,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tList networkInterceptorCreators)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">this</span>(context, <span class=\"keyword\">null</span>, OkHttpClientProvider.createClient(), networkInterceptorCreators);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> defaultUserAgent the User-Agent header that will be set for all requests where the</span></span><br><span class=\"line\"><span class=\"comment\">\t* caller does not provide one explicitly</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetworkingModule</span><span class=\"params\">(ReactApplicationContext context, String defaultUserAgent)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>(context, defaultUserAgent, OkHttpClientProvider.createClient(), <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initialize</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmCookieJarContainer.setCookieJar(<span class=\"keyword\">new</span> JavaNetCookieJar(mCookieHandler));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> NAME;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCatalystInstanceDestroy</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmShuttingDown = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\tcancelAllRequests();</span><br><span class=\"line\">\t\tmCookieHandler.destroy();</span><br><span class=\"line\">\t\tmCookieJarContainer.removeCookieJar();</span><br><span class=\"line\">\t\tmRequestBodyHandlers.clear();</span><br><span class=\"line\">\t\tmResponseHandlers.clear();</span><br><span class=\"line\">\t\tmUriHandlers.clear();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addUriHandler</span><span class=\"params\">(UriHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmUriHandlers.add(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addRequestBodyHandler</span><span class=\"params\">(RequestBodyHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestBodyHandlers.add(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addResponseHandler</span><span class=\"params\">(ResponseHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmResponseHandlers.add(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeUriHandler</span><span class=\"params\">(UriHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmUriHandlers.remove(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeRequestBodyHandler</span><span class=\"params\">(RequestBodyHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestBodyHandlers.remove(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeResponseHandler</span><span class=\"params\">(ResponseHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmResponseHandlers.remove(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ReactMethod</span></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> timeout value of 0 results in no timeout</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sendRequest</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tString method,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tString url,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReadableArray headers,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReadableMap data,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> String responseType,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> useIncrementalUpdates,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">int</span> timeout,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">boolean</span> withCredentials</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">final</span> RCTDeviceEventEmitter eventEmitter = getEventEmitter();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tUri uri = Uri.parse(url);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Check if a handler is registered</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (UriHandler handler : mUriHandlers) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (handler.supports(uri, responseType)) &#123;</span><br><span class=\"line\">\t\t\t\t\tWritableMap res = handler.fetch(uri);</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tRequest.Builder requestBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\trequestBuilder = <span class=\"keyword\">new</span> Request.Builder().url(url);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (requestId != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\trequestBuilder.tag(requestId);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tOkHttpClient.Builder clientBuilder = mClient.newBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!withCredentials) &#123;</span><br><span class=\"line\">\t\t\tclientBuilder.cookieJar(CookieJar.NO_COOKIES);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// If JS is listening for progress updates, install a ProgressResponseBody that intercepts the</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// response and counts bytes received.</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (useIncrementalUpdates) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tclientBuilder.addNetworkInterceptor(<span class=\"keyword\">new</span> Interceptor() &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">intercept</span><span class=\"params\">(Interceptor.Chain chain)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t\t\t\tResponse originalResponse = chain.proceed(chain.request());</span><br><span class=\"line\">\t\t\t\t\tProgressResponseBody responseBody = <span class=\"keyword\">new</span> ProgressResponseBody(</span><br><span class=\"line\">\t\t\t\t\toriginalResponse.body(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">new</span> ProgressListener() &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">long</span> last = System.nanoTime();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onProgress</span><span class=\"params\">(<span class=\"keyword\">long</span> bytesWritten, <span class=\"keyword\">long</span> contentLength, <span class=\"keyword\">boolean</span> done)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (!done &amp;&amp; !shouldDispatch(now, last)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (responseType.equals(<span class=\"string\">\"text\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"comment\">// For 'text' responses we continuously send response data with progress info to</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"comment\">// JS below, so no need to do anything here.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\tResponseUtil.onDataReceivedProgress(</span><br><span class=\"line\">\t\t\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\t\t\tbytesWritten,</span><br><span class=\"line\">\t\t\t\t\t\t\t\tcontentLength</span><br><span class=\"line\">\t\t\t\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\tlast = now;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> originalResponse.newBuilder().body(responseBody).build();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// If the current timeout does not equal the passed in timeout, we need to clone the existing</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// client and set the timeout explicitly on the clone. This is cheap as everything else is</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// shared under the hood.</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// See https://github.com/square/okhttp/wiki/Recipes#per-call-configuration for more information</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (timeout != mClient.connectTimeoutMillis()) &#123;</span><br><span class=\"line\">\t\t\tclientBuilder.readTimeout(timeout, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tOkHttpClient client = clientBuilder.build();</span><br><span class=\"line\">\t\tHeaders requestHeaders = extractHeaders(headers, data);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (requestHeaders == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, <span class=\"string\">\"Unrecognized headers format\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tString contentType = requestHeaders.get(CONTENT_TYPE_HEADER_NAME);</span><br><span class=\"line\">\t\tString contentEncoding = requestHeaders.get(CONTENT_ENCODING_HEADER_NAME);</span><br><span class=\"line\">\t\trequestBuilder.headers(requestHeaders);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Check if a handler is registered</span></span><br><span class=\"line\">\t\tRequestBodyHandler handler = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (data != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (RequestBodyHandler curHandler : mRequestBodyHandlers) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (curHandler.supports(data)) &#123;</span><br><span class=\"line\">\t\t\t\t\thandler = curHandler;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tRequestBody requestBody;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (data == <span class=\"keyword\">null</span> || method.toLowerCase().equals(<span class=\"string\">\"get\"</span>) || method.toLowerCase().equals(<span class=\"string\">\"head\"</span>)) &#123;</span><br><span class=\"line\">\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (handler != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\trequestBody = handler.toRequestBody(data, contentType);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_STRING)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Payload is set but no content-type header specified\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString body = data.getString(REQUEST_BODY_KEY_STRING);</span><br><span class=\"line\">\t\t\tMediaType contentMediaType = MediaType.parse(contentType);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (RequestBodyUtil.isGzipEncoding(contentEncoding)) &#123;</span><br><span class=\"line\">\t\t\t\trequestBody = RequestBodyUtil.createGzip(contentMediaType, body);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (requestBody == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, <span class=\"string\">\"Failed to gzip request body\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\trequestBody = RequestBody.create(contentMediaType, body);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_BASE64)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Payload is set but no content-type header specified\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString base64String = data.getString(REQUEST_BODY_KEY_BASE64);</span><br><span class=\"line\">\t\t\tMediaType contentMediaType = MediaType.parse(contentType);</span><br><span class=\"line\">\t\t\trequestBody = RequestBody.create(contentMediaType, ByteString.decodeBase64(base64String));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_URI)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Payload is set but no content-type header specified\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString uri = data.getString(REQUEST_BODY_KEY_URI);</span><br><span class=\"line\">\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), uri);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (fileInputStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Could not retrieve file for uri \"</span> + uri,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\trequestBody = RequestBodyUtil.create(MediaType.parse(contentType), fileInputStream);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_FORMDATA)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tcontentType = <span class=\"string\">\"multipart/form-data\"</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tReadableArray parts = data.getArray(REQUEST_BODY_KEY_FORMDATA);</span><br><span class=\"line\">\t\t\tMultipartBody.Builder multipartBuilder =</span><br><span class=\"line\">\t\t\tconstructMultipartBody(parts, contentType, requestId);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (multipartBuilder == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\trequestBody = multipartBuilder.build();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Nothing in data payload, at least nothing we could understand anyway.</span></span><br><span class=\"line\">\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\trequestBuilder.method(</span><br><span class=\"line\">\t\t\tmethod,</span><br><span class=\"line\">\t\t\twrapRequestBodyWithProgressEmitter(requestBody, eventEmitter, requestId)</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t\taddRequest(requestId);</span><br><span class=\"line\">\t\tclient.newCall(requestBuilder.build()).enqueue(</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">new</span> Callback() &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onFailure</span><span class=\"params\">(Call call, IOException e)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (mShuttingDown) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tremoveRequest(requestId);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tString errorMessage = e.getMessage() != <span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t\t? e.getMessage()</span><br><span class=\"line\">\t\t\t\t\t: <span class=\"string\">\"Error while executing request: \"</span> + e.getClass().getSimpleName();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, errorMessage, e);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResponse</span><span class=\"params\">(Call call, Response response)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (mShuttingDown) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tremoveRequest(requestId);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// Before we touch the body send headers to JS</span></span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onResponseReceived(</span><br><span class=\"line\">\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\tresponse.code(),</span><br><span class=\"line\">\t\t\t\t\t\ttranslateHeaders(response.headers()),</span><br><span class=\"line\">\t\t\t\t\t\tresponse.request().url().toString()</span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tResponseBody responseBody = response.body();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// Check if a handler is registered</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">for</span> (ResponseHandler handler : mResponseHandlers) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (handler.supports(responseType)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tWritableMap res = handler.toResponseData(responseBody);</span><br><span class=\"line\">\t\t\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);</span><br><span class=\"line\">\t\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// If JS wants progress updates during the download, and it requested a text response,</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// periodically send response data updates to JS.</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (useIncrementalUpdates &amp;&amp; responseType.equals(<span class=\"string\">\"text\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\treadWithProgress(eventEmitter, requestId, responseBody);</span><br><span class=\"line\">\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// Otherwise send the data in one big chunk, in the format that JS requested.</span></span><br><span class=\"line\">\t\t\t\t\t\tString responseString = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (responseType.equals(<span class=\"string\">\"text\"</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tresponseString = responseBody.string();</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (response.request().method().equalsIgnoreCase(<span class=\"string\">\"HEAD\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// The request is an `HEAD` and the body is empty,</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// the OkHttp will produce an exception.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// Ignore the exception to not invalidate the request in the</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// Javascript layer.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// Introduced to fix issue #7463.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (responseType.equals(<span class=\"string\">\"base64\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tresponseString = Base64.encodeToString(responseBody.bytes(), Base64.NO_WRAP);</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, responseString);</span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> RequestBody <span class=\"title\">wrapRequestBodyWithProgressEmitter</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> RequestBody requestBody,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> RCTDeviceEventEmitter eventEmitter,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(requestBody == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> RequestBodyUtil.createProgressRequest(</span><br><span class=\"line\">\t\t\trequestBody,</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">new</span> ProgressListener() &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">long</span> last = System.nanoTime();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onProgress</span><span class=\"params\">(<span class=\"keyword\">long</span> bytesWritten, <span class=\"keyword\">long</span> contentLength, <span class=\"keyword\">boolean</span> done)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (done || shouldDispatch(now, last)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onDataSend(eventEmitter, requestId, bytesWritten, contentLength);</span><br><span class=\"line\">\t\t\t\t\t\tlast = now;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">readWithProgress</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tRCTDeviceEventEmitter eventEmitter,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">int</span> requestId,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tResponseBody responseBody</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> totalBytesRead = -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> contentLength = -<span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tProgressResponseBody progressResponseBody = (ProgressResponseBody) responseBody;</span><br><span class=\"line\">\t\t\ttotalBytesRead = progressResponseBody.totalBytesRead();</span><br><span class=\"line\">\t\t\tcontentLength = progressResponseBody.contentLength();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ClassCastException e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Ignore</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tCharset charset = responseBody.contentType() == <span class=\"keyword\">null</span> ? StandardCharsets.UTF_8 :</span><br><span class=\"line\">\t\tresponseBody.contentType().charset(StandardCharsets.UTF_8);</span><br><span class=\"line\">\t\tProgressiveStringDecoder streamDecoder = <span class=\"keyword\">new</span> ProgressiveStringDecoder(charset);</span><br><span class=\"line\">\t\tInputStream inputStream = responseBody.byteStream();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">byte</span>[] buffer = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[MAX_CHUNK_SIZE_BETWEEN_FLUSHES];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> read;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> ((read = inputStream.read(buffer)) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onIncrementalDataReceived(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\tstreamDecoder.decodeNext(buffer, read),</span><br><span class=\"line\">\t\t\t\t\ttotalBytesRead,</span><br><span class=\"line\">\t\t\t\t\tcontentLength</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\tinputStream.close();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">shouldDispatch</span><span class=\"params\">(<span class=\"keyword\">long</span> now, <span class=\"keyword\">long</span> last)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> last + CHUNK_TIMEOUT_NS &lt; now;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">addRequest</span><span class=\"params\">(<span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestIds.add(requestId);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">removeRequest</span><span class=\"params\">(<span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestIds.remove(requestId);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">cancelAllRequests</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Integer requestId : mRequestIds) &#123;</span><br><span class=\"line\">\t\t\tcancelRequest(requestId);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmRequestIds.clear();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> WritableMap <span class=\"title\">translateHeaders</span><span class=\"params\">(Headers headers)</span> </span>&#123;</span><br><span class=\"line\">\t\tWritableMap responseHeaders = Arguments.createMap();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; headers.size(); i++) &#123;</span><br><span class=\"line\">\t\t\tString headerName = headers.name(i);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// multiple values for the same header</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (responseHeaders.hasKey(headerName)) &#123;</span><br><span class=\"line\">\t\t\t\tresponseHeaders.putString(</span><br><span class=\"line\">\t\t\t\theaderName,</span><br><span class=\"line\">\t\t\t\tresponseHeaders.getString(headerName) + <span class=\"string\">\", \"</span> + headers.value(i));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tresponseHeaders.putString(headerName, headers.value(i));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> responseHeaders;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ReactMethod</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">abortRequest</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\tcancelRequest(requestId);</span><br><span class=\"line\">\t\tremoveRequest(requestId);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">cancelRequest</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// We have to use AsyncTask since this might trigger a NetworkOnMainThreadException, this is an</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// open issue on OkHttp: https://github.com/square/okhttp/issues/869</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> GuardedAsyncTask(getReactApplicationContext()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doInBackgroundGuarded</span><span class=\"params\">(Void... params)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\tOkHttpCallUtil.cancelTag(mClient, Integer.valueOf(requestId));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;.execute();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ReactMethod</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">clearCookies</span><span class=\"params\">(com.facebook.react.bridge.Callback callback)</span> </span>&#123;</span><br><span class=\"line\">\t\tmCookieHandler.clearCookies(callback);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"meta\">@Nullable</span> MultipartBody.<span class=\"function\">Builder <span class=\"title\">constructMultipartBody</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReadableArray body,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tString contentType,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">int</span> requestId</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\tRCTDeviceEventEmitter eventEmitter = getEventEmitter();</span><br><span class=\"line\">\t\tMultipartBody.Builder multipartBuilder = <span class=\"keyword\">new</span> MultipartBody.Builder();</span><br><span class=\"line\">\t\tmultipartBuilder.setType(MediaType.parse(contentType));</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>, size = body.size(); i &lt; size; i++) &#123;</span><br><span class=\"line\">\t\t\tReadableMap bodyPart = body.getMap(i);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Determine part's content type.</span></span><br><span class=\"line\">\t\t\tReadableArray headersArray = bodyPart.getArray(<span class=\"string\">\"headers\"</span>);</span><br><span class=\"line\">\t\t\tHeaders headers = extractHeaders(headersArray, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (headers == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Missing or invalid header format for FormData part.\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tMediaType partContentType = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString partContentTypeStr = headers.get(CONTENT_TYPE_HEADER_NAME);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (partContentTypeStr != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tpartContentType = MediaType.parse(partContentTypeStr);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Remove the content-type header because MultipartBuilder gets it explicitly as an</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// argument and doesn't expect it in the headers array.</span></span><br><span class=\"line\">\t\t\t\theaders = headers.newBuilder().removeAll(CONTENT_TYPE_HEADER_NAME).build();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (bodyPart.hasKey(REQUEST_BODY_KEY_STRING)) &#123;</span><br><span class=\"line\">\t\t\t\tString bodyValue = bodyPart.getString(REQUEST_BODY_KEY_STRING);</span><br><span class=\"line\">\t\t\t\tmultipartBuilder.addPart(headers, RequestBody.create(partContentType, bodyValue));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (bodyPart.hasKey(REQUEST_BODY_KEY_URI)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (partContentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">\"Binary FormData part needs a content-type header.\"</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tString fileContentUriStr = bodyPart.getString(REQUEST_BODY_KEY_URI);</span><br><span class=\"line\">\t\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), fileContentUriStr);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (fileInputStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">\"Could not retrieve file for uri \"</span> + fileContentUriStr,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tmultipartBuilder.addPart(headers, RequestBodyUtil.create(partContentType, fileInputStream));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, <span class=\"string\">\"Unrecognized FormData part.\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> multipartBuilder;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Extracts the headers from the Array. If the format is invalid, this method will return null.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"meta\">@Nullable</span> <span class=\"function\">Headers <span class=\"title\">extractHeaders</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t@Nullable ReadableArray headersArray,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t@Nullable ReadableMap requestData</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (headersArray == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tHeaders.Builder headersBuilder = <span class=\"keyword\">new</span> Headers.Builder();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> headersIdx = <span class=\"number\">0</span>, size = headersArray.size(); headersIdx &lt; size; headersIdx++) &#123;</span><br><span class=\"line\">\t\t\tReadableArray header = headersArray.getArray(headersIdx);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (header == <span class=\"keyword\">null</span> || header.size() != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString headerName = header.getString(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t\tString headerValue = header.getString(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (headerName == <span class=\"keyword\">null</span> || headerValue == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\theadersBuilder.add(headerName, headerValue);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (headersBuilder.get(USER_AGENT_HEADER_NAME) == <span class=\"keyword\">null</span> &amp;&amp; mDefaultUserAgent != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\theadersBuilder.add(USER_AGENT_HEADER_NAME, mDefaultUserAgent);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Sanitize content encoding header, supported only when request specify payload as string</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">boolean</span> isGzipSupported = requestData != <span class=\"keyword\">null</span> &amp;&amp; requestData.hasKey(REQUEST_BODY_KEY_STRING);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!isGzipSupported) &#123;</span><br><span class=\"line\">\t\t\theadersBuilder.removeAll(CONTENT_ENCODING_HEADER_NAME);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> headersBuilder.build();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> RCTDeviceEventEmitter <span class=\"title\">getEventEmitter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> getReactApplicationContext().getJSModule(RCTDeviceEventEmitter.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在终端代开项目<code>cd {project}</code>执行</p>\n</li>\n<li><p><code>react-native run-android</code>开始编译，编译的过程很漫长，大概需要10到20分钟</p>\n</li>\n<li><p>如果中途失败记得删除<code>/node_modules/react-native/ReactAndroid/bulid</code>里面的所有内容，然后重新编译</p>\n</li>\n<li><p>关于源代码编译可以参考官方文档<a href=\"https://reactnative.cn/docs/building-from-source.html\" target=\"_blank\" rel=\"noopener\">中文</a>或者<a href=\"https://facebook.github.io/react-native/docs/building-from-source\" target=\"_blank\" rel=\"noopener\">英文</a>官网详细查看</p>\n</li>\n</ul>\n<ul>\n<li>关于详细代码可进入我的<a href=\"https://github.com/AaronBank/react-native.git\" target=\"_blank\" rel=\"noopener\">Github</a>查看</li>\n</ul>\n<p><em>感谢支持</em></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/150542.jpg\" alt> </p>\n<p><code>react-native</code>再请求方面有点坑，<code>Ios</code>端默认支持<code>https</code>，而安卓默认支持的事<code>http</code>，如果你需要的是其中的某一种方式，那这篇文章可能能帮到你😍😍</p>\n<h3 id=\"当前环境\"><a href=\"#当前环境\" class=\"headerlink\" title=\"当前环境\"></a>当前环境</h3><ul>\n<li>OS: macOS High Sierra 10.13.5</li>\n<li>Node: 8.11.3</li>\n<li>Yarn: 1.7.0</li>\n<li>npm: 5.6.0</li>\n<li>Watchman: 4.9.0</li>\n<li>Xcode: Xcode 9.4.1</li>\n<li>react: 16.3.1 =&gt; 16.3.1</li>\n<li>react-native: 0.55.4 =&gt; 0.55.4</li>\n</ul>\n<h3 id=\"前置说明\"><a href=\"#前置说明\" class=\"headerlink\" title=\"前置说明\"></a>前置说明</h3><ol>\n<li>在ios平台ios9.0以上默认支持https而不支持http</li>\n<li>对于https，如果你的服务器端是CA签发的证书，那你ios平台不需要改动任何代码</li>\n<li>对于自签证书，那你需要对源代码进行改动，下面会详细说明方式</li>\n<li>对于http，有两个方式可以做到，下面会详细说明方式<ol>\n<li>直接使用ip地址</li>\n<li>使用域名，对源代码进行配置</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"关于ios支持https自签证书\"><a href=\"#关于ios支持https自签证书\" class=\"headerlink\" title=\"关于ios支持https自签证书\"></a>关于ios支持https自签证书</h3><ul>\n<li>服务器端使用自签证书，免证书方法</li>\n<li>打开XCode在当前项目路径为<code>Libraries/RCTNetwork.xcodeproj</code>找到<code>RCTHTTPRequestHandler.mm</code></li>\n<li>或者在<code>{project}/node_modules/react-native/Libraries/Network</code>目录下同样可以找到该文件</li>\n<li>在文件中搜索<code>#pragma mark - NSURLSession delegate</code>并在其后面添加如下代码即可</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)URLSession:(NSURLSession *)session  didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge  completionHandler:(<span class=\"keyword\">void</span> (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential * __nullable credential))completionHandler&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (RCT_DEBUG) &#123;</span><br><span class=\"line\">        completionHandler(NSURLSessionAuthChallengeUseCredential,[NSURLCredential  credentialForTrust:challenge.protectionSpace.serverTrust]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置如图所示</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902-1.png\" alt> </p>\n<h3 id=\"关于ios支持http请求\"><a href=\"#关于ios支持http请求\" class=\"headerlink\" title=\"关于ios支持http请求\"></a>关于ios支持http请求</h3><ul>\n<li>关于http方式我们只介绍第二种因为直接使用ip地址真的是太。。简单，直接把域名换成ip就好了</li>\n<li>对于第二种你需要改动<code>{project}/ios/App</code>下面的<code>Info.plist</code>文件</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSAppTransportSecuritykey&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSAllowsArbitraryLoadskey&gt;<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置如图所示</li>\n</ul>\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140902.png\" alt> </p>\n<p>到此为止<code>Ios</code>相关问题就解决了，<code>Ios</code>部分还是比较好弄得O(∩_∩)O不是很麻烦，<code>Android</code>得话就麻烦些，下面我们说下<code>Android</code>相关的解决方案</p>\n<h3 id=\"关于Android端http和https你需要知道\"><a href=\"#关于Android端http和https你需要知道\" class=\"headerlink\" title=\"关于Android端http和https你需要知道\"></a>关于Android端http和https你需要知道</h3><ol>\n<li>安卓默认是支持http请求儿不支持https</li>\n<li>想做到支持https那就需要改动react-native的源代码，进而重新编译才能成功</li>\n</ol>\n<h3 id=\"关于Android支持https\"><a href=\"#关于Android支持https\" class=\"headerlink\" title=\"关于Android支持https\"></a>关于Android支持https</h3><ul>\n<li><p>下载ndk（下载r10e版本的，其他的版本会有问题）</p>\n<ol>\n<li>Mac OS (64-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-darwin-x86_64.zip</a></li>\n<li>Linux (64-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip</a></li>\n<li>Windows (64-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-windows-x86_64.zip</a></li>\n<li>Windows (32-bit) - <a href=\"http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip\" target=\"_blank\" rel=\"noopener\">http://dl.google.com/android/repository/android-ndk-r10e-windows-x86.zip</a></li>\n</ol>\n</li>\n<li><p>在项目<code>{project}/android</code>文件夹先创建<code>local.properties</code>文件（如果已经存在哪直接修改就好了）</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sdk.dir=你自己的sdk路径</span><br><span class=\"line\">ndk.dir=你自己的ndk路径</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/140900-1.jpg\" alt></p>\n<ul>\n<li>在<code>{project}/android/build.gradle</code>中添加<code>gradle-download-task</code>依赖</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    classpath <span class=\"string\">'com.android.tools.build:gradle:2.2.3'</span></span><br><span class=\"line\">    classpath <span class=\"string\">'de.undercouch:gradle-download-task:3.1.2'</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class=\"line\">    <span class=\"comment\">// in the individual module build.gradle files</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>在<code>{project}/android/settings.gradle</code>中添加<code>:ReactAndroid</code>项目</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    include <span class=\"string\">':ReactAndroid'</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    project(<span class=\"string\">':ReactAndroid'</span>).projectDir = <span class=\"keyword\">new</span> File(rootProject.projectDir, <span class=\"string\">'../node_modules/react-native/ReactAndroid'</span>)</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改<code>{project}/android/app/build.gradle</code>文件，使用:ReactAndroid替换预编译库</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\">compile <span class=\"title\">fileTree</span><span class=\"params\">(dir: <span class=\"string\">\"libs\"</span>, include: [<span class=\"string\">\"*.jar\"</span>])</span></span></span><br><span class=\"line\"><span class=\"function\">compile \"com.android.support:appcompat-v7:23.0.1\"</span></span><br><span class=\"line\"><span class=\"function\">compile <span class=\"title\">project</span><span class=\"params\">(<span class=\"string\">':ReactAndroid'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">  </span></span><br><span class=\"line\"><span class=\"function\">...</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重写第三方模块的依赖，否则会报错<code>-Error: more than one library with package name &#39;com.facebook.react&#39;</code></li>\n<li>修改<code>{project}/android/app/build.gradle</code>文件，添加以下代码</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">configurations.all &#123;</span><br><span class=\"line\">    exclude group: <span class=\"string\">'com.facebook.react'</span>, <span class=\"keyword\">module</span>: <span class=\"string\">'react-native'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重写<code>okHttp</code>类</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.facebook.react.modules.network;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.net.Uri;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.Base64;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.Arguments;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.GuardedAsyncTask;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReactApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReactContextBaseJavaModule;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReactMethod;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReadableArray;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.ReadableMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.bridge.WritableMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.common.StandardCharsets;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.common.network.OkHttpCallUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.<span class=\"keyword\">module</span>.annotations.ReactModule;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.facebook.react.modules.core.DeviceEventManagerModule.RCTDeviceEventEmitter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.Charset;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.KeyManagementException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.NoSuchAlgorithmException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.SecureRandom;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.cert.CertificateException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.cert.X509Certificate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashSet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Nullable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.HostnameVerifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.SSLContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.SSLSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.TrustManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.net.ssl.X509TrustManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Call;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Callback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.CookieJar;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Headers;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Interceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.JavaNetCookieJar;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.MediaType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.MultipartBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.OkHttpClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Request;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.RequestBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.Response;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okhttp3.ResponseBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> okio.ByteString;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* Implements the XMLHttpRequest JavaScript interface.</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">@ReactModule</span>(name = NetworkingModule.NAME)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NetworkingModule</span> <span class=\"keyword\">extends</span> <span class=\"title\">ReactContextBaseJavaModule</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> SSLContext <span class=\"title\">getSLLContext</span> <span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tX509TrustManager xtm = <span class=\"keyword\">new</span> X509TrustManager() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">checkClientTrusted</span><span class=\"params\">(X509Certificate[] chain, String authType)</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">checkServerTrusted</span><span class=\"params\">(X509Certificate[] chain, String authType)</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class=\"line\">\t\t\t\tX509Certificate[] x509Certificates = <span class=\"keyword\">new</span> X509Certificate[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> x509Certificates;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSSLContext sslContext = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tsslContext = SSLContext.getInstance(<span class=\"string\">\"SSL\"</span>);</span><br><span class=\"line\">\t\t\tsslContext.init(<span class=\"keyword\">null</span>, <span class=\"keyword\">new</span> TrustManager[]&#123;xtm&#125;, <span class=\"keyword\">new</span> SecureRandom());</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (KeyManagementException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> sslContext;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Allows to implement a custom fetching process for specific URIs. It is the handler's job</span></span><br><span class=\"line\"><span class=\"comment\">\t* to fetch the URI and return the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UriHandler</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns if the handler should be used for an URI.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Uri uri, String responseType)</span></span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Fetch the URI and return the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\">WritableMap <span class=\"title\">fetch</span><span class=\"params\">(Uri uri)</span> <span class=\"keyword\">throws</span> IOException</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Allows adding custom handling to build the &#123;<span class=\"doctag\">@link</span> RequestBody&#125; from the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">RequestBodyHandler</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns if the handler should be used for a JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(ReadableMap map)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns the &#123;<span class=\"doctag\">@link</span> RequestBody&#125; for the JS body payload.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\">RequestBody <span class=\"title\">toRequestBody</span><span class=\"params\">(ReadableMap map, String contentType)</span></span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Allows adding custom handling to build the JS body payload from the &#123;<span class=\"doctag\">@link</span> ResponseBody&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ResponseHandler</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns if the handler should be used for a response type.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(String responseType)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t* Returns the JS body payload for the &#123;<span class=\"doctag\">@link</span> ResponseBody&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*/</span></span><br><span class=\"line\">\t\t<span class=\"function\">WritableMap <span class=\"title\">toResponseData</span><span class=\"params\">(ResponseBody body)</span> <span class=\"keyword\">throws</span> IOException</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String NAME = <span class=\"string\">\"Networking\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String CONTENT_ENCODING_HEADER_NAME = <span class=\"string\">\"content-encoding\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String CONTENT_TYPE_HEADER_NAME = <span class=\"string\">\"content-type\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_STRING = <span class=\"string\">\"string\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_URI = <span class=\"string\">\"uri\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_FORMDATA = <span class=\"string\">\"formData\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REQUEST_BODY_KEY_BASE64 = <span class=\"string\">\"base64\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String USER_AGENT_HEADER_NAME = <span class=\"string\">\"user-agent\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CHUNK_TIMEOUT_NS = <span class=\"number\">100</span> * <span class=\"number\">1000000</span>; <span class=\"comment\">// 100ms</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAX_CHUNK_SIZE_BETWEEN_FLUSHES = <span class=\"number\">8</span> * <span class=\"number\">1024</span>; <span class=\"comment\">// 8K</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> OkHttpClient mClient;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ForwardingCookieHandler mCookieHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"meta\">@Nullable</span> String mDefaultUserAgent;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> CookieJarContainer mCookieJarContainer;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Set&lt;Integer&gt; mRequestIds;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;RequestBodyHandler&gt; mRequestBodyHandlers = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;UriHandler&gt; mUriHandlers = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;ResponseHandler&gt; mResponseHandlers = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> mShuttingDown;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/* package */</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tNetworkingModule(</span><br><span class=\"line\">\t\tReactApplicationContext reactContext,</span><br><span class=\"line\">\t\t<span class=\"meta\">@Nullable</span> String defaultUserAgent,</span><br><span class=\"line\">\t\tOkHttpClient client,</span><br><span class=\"line\">\t\t<span class=\"meta\">@Nullable</span> List networkInterceptorCreators</span><br><span class=\"line\">\t) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>(reactContext);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (networkInterceptorCreators != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tOkHttpClient.Builder clientBuilder = client.newBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (NetworkInterceptorCreator networkInterceptorCreator : networkInterceptorCreators) &#123;</span><br><span class=\"line\">\t\t\t\tclientBuilder.addNetworkInterceptor(networkInterceptorCreator.create());</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tclient = clientBuilder.build();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tclient = client.newBuilder().hostnameVerifier(<span class=\"keyword\">new</span> HostnameVerifier() &#123;</span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">verify</span><span class=\"params\">(String s, SSLSession sslSession)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;).sslSocketFactory(getSLLContext().getSocketFactory()).build();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmClient = client;</span><br><span class=\"line\">\t\tmCookieHandler = <span class=\"keyword\">new</span> ForwardingCookieHandler(reactContext);</span><br><span class=\"line\">\t\tmCookieJarContainer = (CookieJarContainer) mClient.cookieJar();</span><br><span class=\"line\">\t\tmShuttingDown = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\tmDefaultUserAgent = defaultUserAgent;</span><br><span class=\"line\">\t\tmRequestIds = <span class=\"keyword\">new</span> HashSet&lt;&gt;();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> defaultUserAgent the User-Agent header that will be set for all requests where the</span></span><br><span class=\"line\"><span class=\"comment\">\t* caller does not provide one explicitly</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> client the &#123;<span class=\"doctag\">@link</span> OkHttpClient&#125; to be used for networking</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/* package */</span></span><br><span class=\"line\">\tNetworkingModule(</span><br><span class=\"line\">\t\tReactApplicationContext context,</span><br><span class=\"line\">\t\t<span class=\"meta\">@Nullable</span> String defaultUserAgent,</span><br><span class=\"line\">\t\tOkHttpClient client</span><br><span class=\"line\">\t) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>(context, defaultUserAgent, client, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetworkingModule</span><span class=\"params\">(<span class=\"keyword\">final</span> ReactApplicationContext context)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>(context, <span class=\"keyword\">null</span>, OkHttpClientProvider.createClient(), <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> networkInterceptorCreators list of &#123;<span class=\"doctag\">@link</span> NetworkInterceptorCreator&#125;'s whose create()</span></span><br><span class=\"line\"><span class=\"comment\">\t* methods would be called to attach the interceptors to the client.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetworkingModule</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReactApplicationContext context,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tList networkInterceptorCreators)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">this</span>(context, <span class=\"keyword\">null</span>, OkHttpClientProvider.createClient(), networkInterceptorCreators);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> context the ReactContext of the application</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> defaultUserAgent the User-Agent header that will be set for all requests where the</span></span><br><span class=\"line\"><span class=\"comment\">\t* caller does not provide one explicitly</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">NetworkingModule</span><span class=\"params\">(ReactApplicationContext context, String defaultUserAgent)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>(context, defaultUserAgent, OkHttpClientProvider.createClient(), <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initialize</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmCookieJarContainer.setCookieJar(<span class=\"keyword\">new</span> JavaNetCookieJar(mCookieHandler));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> NAME;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCatalystInstanceDestroy</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmShuttingDown = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\tcancelAllRequests();</span><br><span class=\"line\">\t\tmCookieHandler.destroy();</span><br><span class=\"line\">\t\tmCookieJarContainer.removeCookieJar();</span><br><span class=\"line\">\t\tmRequestBodyHandlers.clear();</span><br><span class=\"line\">\t\tmResponseHandlers.clear();</span><br><span class=\"line\">\t\tmUriHandlers.clear();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addUriHandler</span><span class=\"params\">(UriHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmUriHandlers.add(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addRequestBodyHandler</span><span class=\"params\">(RequestBodyHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestBodyHandlers.add(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addResponseHandler</span><span class=\"params\">(ResponseHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmResponseHandlers.add(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeUriHandler</span><span class=\"params\">(UriHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmUriHandlers.remove(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeRequestBodyHandler</span><span class=\"params\">(RequestBodyHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestBodyHandlers.remove(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removeResponseHandler</span><span class=\"params\">(ResponseHandler handler)</span> </span>&#123;</span><br><span class=\"line\">\t\tmResponseHandlers.remove(handler);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ReactMethod</span></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* <span class=\"doctag\">@param</span> timeout value of 0 results in no timeout</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sendRequest</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tString method,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tString url,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReadableArray headers,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReadableMap data,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> String responseType,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> useIncrementalUpdates,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">int</span> timeout,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">boolean</span> withCredentials</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">final</span> RCTDeviceEventEmitter eventEmitter = getEventEmitter();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tUri uri = Uri.parse(url);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Check if a handler is registered</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (UriHandler handler : mUriHandlers) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (handler.supports(uri, responseType)) &#123;</span><br><span class=\"line\">\t\t\t\t\tWritableMap res = handler.fetch(uri);</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tRequest.Builder requestBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\trequestBuilder = <span class=\"keyword\">new</span> Request.Builder().url(url);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (requestId != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\trequestBuilder.tag(requestId);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tOkHttpClient.Builder clientBuilder = mClient.newBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!withCredentials) &#123;</span><br><span class=\"line\">\t\t\tclientBuilder.cookieJar(CookieJar.NO_COOKIES);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// If JS is listening for progress updates, install a ProgressResponseBody that intercepts the</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// response and counts bytes received.</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (useIncrementalUpdates) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tclientBuilder.addNetworkInterceptor(<span class=\"keyword\">new</span> Interceptor() &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">intercept</span><span class=\"params\">(Interceptor.Chain chain)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t\t\t\tResponse originalResponse = chain.proceed(chain.request());</span><br><span class=\"line\">\t\t\t\t\tProgressResponseBody responseBody = <span class=\"keyword\">new</span> ProgressResponseBody(</span><br><span class=\"line\">\t\t\t\t\toriginalResponse.body(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">new</span> ProgressListener() &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">long</span> last = System.nanoTime();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onProgress</span><span class=\"params\">(<span class=\"keyword\">long</span> bytesWritten, <span class=\"keyword\">long</span> contentLength, <span class=\"keyword\">boolean</span> done)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (!done &amp;&amp; !shouldDispatch(now, last)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (responseType.equals(<span class=\"string\">\"text\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"comment\">// For 'text' responses we continuously send response data with progress info to</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"comment\">// JS below, so no need to do anything here.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\tResponseUtil.onDataReceivedProgress(</span><br><span class=\"line\">\t\t\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\t\t\tbytesWritten,</span><br><span class=\"line\">\t\t\t\t\t\t\t\tcontentLength</span><br><span class=\"line\">\t\t\t\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\tlast = now;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> originalResponse.newBuilder().body(responseBody).build();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// If the current timeout does not equal the passed in timeout, we need to clone the existing</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// client and set the timeout explicitly on the clone. This is cheap as everything else is</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// shared under the hood.</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// See https://github.com/square/okhttp/wiki/Recipes#per-call-configuration for more information</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (timeout != mClient.connectTimeoutMillis()) &#123;</span><br><span class=\"line\">\t\t\tclientBuilder.readTimeout(timeout, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tOkHttpClient client = clientBuilder.build();</span><br><span class=\"line\">\t\tHeaders requestHeaders = extractHeaders(headers, data);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (requestHeaders == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, <span class=\"string\">\"Unrecognized headers format\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tString contentType = requestHeaders.get(CONTENT_TYPE_HEADER_NAME);</span><br><span class=\"line\">\t\tString contentEncoding = requestHeaders.get(CONTENT_ENCODING_HEADER_NAME);</span><br><span class=\"line\">\t\trequestBuilder.headers(requestHeaders);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Check if a handler is registered</span></span><br><span class=\"line\">\t\tRequestBodyHandler handler = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (data != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (RequestBodyHandler curHandler : mRequestBodyHandlers) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (curHandler.supports(data)) &#123;</span><br><span class=\"line\">\t\t\t\t\thandler = curHandler;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tRequestBody requestBody;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (data == <span class=\"keyword\">null</span> || method.toLowerCase().equals(<span class=\"string\">\"get\"</span>) || method.toLowerCase().equals(<span class=\"string\">\"head\"</span>)) &#123;</span><br><span class=\"line\">\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (handler != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\trequestBody = handler.toRequestBody(data, contentType);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_STRING)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Payload is set but no content-type header specified\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString body = data.getString(REQUEST_BODY_KEY_STRING);</span><br><span class=\"line\">\t\t\tMediaType contentMediaType = MediaType.parse(contentType);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (RequestBodyUtil.isGzipEncoding(contentEncoding)) &#123;</span><br><span class=\"line\">\t\t\t\trequestBody = RequestBodyUtil.createGzip(contentMediaType, body);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (requestBody == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, <span class=\"string\">\"Failed to gzip request body\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\trequestBody = RequestBody.create(contentMediaType, body);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_BASE64)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Payload is set but no content-type header specified\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString base64String = data.getString(REQUEST_BODY_KEY_BASE64);</span><br><span class=\"line\">\t\t\tMediaType contentMediaType = MediaType.parse(contentType);</span><br><span class=\"line\">\t\t\trequestBody = RequestBody.create(contentMediaType, ByteString.decodeBase64(base64String));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_URI)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Payload is set but no content-type header specified\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString uri = data.getString(REQUEST_BODY_KEY_URI);</span><br><span class=\"line\">\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), uri);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (fileInputStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Could not retrieve file for uri \"</span> + uri,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\trequestBody = RequestBodyUtil.create(MediaType.parse(contentType), fileInputStream);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.hasKey(REQUEST_BODY_KEY_FORMDATA)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (contentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tcontentType = <span class=\"string\">\"multipart/form-data\"</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tReadableArray parts = data.getArray(REQUEST_BODY_KEY_FORMDATA);</span><br><span class=\"line\">\t\t\tMultipartBody.Builder multipartBuilder =</span><br><span class=\"line\">\t\t\tconstructMultipartBody(parts, contentType, requestId);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (multipartBuilder == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\trequestBody = multipartBuilder.build();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Nothing in data payload, at least nothing we could understand anyway.</span></span><br><span class=\"line\">\t\t\trequestBody = RequestBodyUtil.getEmptyBody(method);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\trequestBuilder.method(</span><br><span class=\"line\">\t\t\tmethod,</span><br><span class=\"line\">\t\t\twrapRequestBodyWithProgressEmitter(requestBody, eventEmitter, requestId)</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t\taddRequest(requestId);</span><br><span class=\"line\">\t\tclient.newCall(requestBuilder.build()).enqueue(</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">new</span> Callback() &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onFailure</span><span class=\"params\">(Call call, IOException e)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (mShuttingDown) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tremoveRequest(requestId);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tString errorMessage = e.getMessage() != <span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t\t? e.getMessage()</span><br><span class=\"line\">\t\t\t\t\t: <span class=\"string\">\"Error while executing request: \"</span> + e.getClass().getSimpleName();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, errorMessage, e);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResponse</span><span class=\"params\">(Call call, Response response)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (mShuttingDown) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tremoveRequest(requestId);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// Before we touch the body send headers to JS</span></span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onResponseReceived(</span><br><span class=\"line\">\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\tresponse.code(),</span><br><span class=\"line\">\t\t\t\t\t\ttranslateHeaders(response.headers()),</span><br><span class=\"line\">\t\t\t\t\t\tresponse.request().url().toString()</span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tResponseBody responseBody = response.body();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// Check if a handler is registered</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">for</span> (ResponseHandler handler : mResponseHandlers) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (handler.supports(responseType)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tWritableMap res = handler.toResponseData(responseBody);</span><br><span class=\"line\">\t\t\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, res);</span><br><span class=\"line\">\t\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// If JS wants progress updates during the download, and it requested a text response,</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// periodically send response data updates to JS.</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (useIncrementalUpdates &amp;&amp; responseType.equals(<span class=\"string\">\"text\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\treadWithProgress(eventEmitter, requestId, responseBody);</span><br><span class=\"line\">\t\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// Otherwise send the data in one big chunk, in the format that JS requested.</span></span><br><span class=\"line\">\t\t\t\t\t\tString responseString = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (responseType.equals(<span class=\"string\">\"text\"</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tresponseString = responseBody.string();</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (response.request().method().equalsIgnoreCase(<span class=\"string\">\"HEAD\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// The request is an `HEAD` and the body is empty,</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// the OkHttp will produce an exception.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// Ignore the exception to not invalidate the request in the</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// Javascript layer.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"comment\">// Introduced to fix issue #7463.</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (responseType.equals(<span class=\"string\">\"base64\"</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tresponseString = Base64.encodeToString(responseBody.bytes(), Base64.NO_WRAP);</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onDataReceived(eventEmitter, requestId, responseString);</span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onRequestSuccess(eventEmitter, requestId);</span><br><span class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, e.getMessage(), e);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> RequestBody <span class=\"title\">wrapRequestBodyWithProgressEmitter</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> RequestBody requestBody,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> RCTDeviceEventEmitter eventEmitter,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(requestBody == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> RequestBodyUtil.createProgressRequest(</span><br><span class=\"line\">\t\t\trequestBody,</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">new</span> ProgressListener() &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">long</span> last = System.nanoTime();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onProgress</span><span class=\"params\">(<span class=\"keyword\">long</span> bytesWritten, <span class=\"keyword\">long</span> contentLength, <span class=\"keyword\">boolean</span> done)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (done || shouldDispatch(now, last)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tResponseUtil.onDataSend(eventEmitter, requestId, bytesWritten, contentLength);</span><br><span class=\"line\">\t\t\t\t\t\tlast = now;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">readWithProgress</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tRCTDeviceEventEmitter eventEmitter,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">int</span> requestId,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tResponseBody responseBody</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> totalBytesRead = -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> contentLength = -<span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tProgressResponseBody progressResponseBody = (ProgressResponseBody) responseBody;</span><br><span class=\"line\">\t\t\ttotalBytesRead = progressResponseBody.totalBytesRead();</span><br><span class=\"line\">\t\t\tcontentLength = progressResponseBody.contentLength();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ClassCastException e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Ignore</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tCharset charset = responseBody.contentType() == <span class=\"keyword\">null</span> ? StandardCharsets.UTF_8 :</span><br><span class=\"line\">\t\tresponseBody.contentType().charset(StandardCharsets.UTF_8);</span><br><span class=\"line\">\t\tProgressiveStringDecoder streamDecoder = <span class=\"keyword\">new</span> ProgressiveStringDecoder(charset);</span><br><span class=\"line\">\t\tInputStream inputStream = responseBody.byteStream();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">byte</span>[] buffer = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[MAX_CHUNK_SIZE_BETWEEN_FLUSHES];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> read;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> ((read = inputStream.read(buffer)) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onIncrementalDataReceived(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\tstreamDecoder.decodeNext(buffer, read),</span><br><span class=\"line\">\t\t\t\t\ttotalBytesRead,</span><br><span class=\"line\">\t\t\t\t\tcontentLength</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\tinputStream.close();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">shouldDispatch</span><span class=\"params\">(<span class=\"keyword\">long</span> now, <span class=\"keyword\">long</span> last)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> last + CHUNK_TIMEOUT_NS &lt; now;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">addRequest</span><span class=\"params\">(<span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestIds.add(requestId);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">removeRequest</span><span class=\"params\">(<span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\tmRequestIds.remove(requestId);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">cancelAllRequests</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Integer requestId : mRequestIds) &#123;</span><br><span class=\"line\">\t\t\tcancelRequest(requestId);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmRequestIds.clear();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> WritableMap <span class=\"title\">translateHeaders</span><span class=\"params\">(Headers headers)</span> </span>&#123;</span><br><span class=\"line\">\t\tWritableMap responseHeaders = Arguments.createMap();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; headers.size(); i++) &#123;</span><br><span class=\"line\">\t\t\tString headerName = headers.name(i);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// multiple values for the same header</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (responseHeaders.hasKey(headerName)) &#123;</span><br><span class=\"line\">\t\t\t\tresponseHeaders.putString(</span><br><span class=\"line\">\t\t\t\theaderName,</span><br><span class=\"line\">\t\t\t\tresponseHeaders.getString(headerName) + <span class=\"string\">\", \"</span> + headers.value(i));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tresponseHeaders.putString(headerName, headers.value(i));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> responseHeaders;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ReactMethod</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">abortRequest</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\tcancelRequest(requestId);</span><br><span class=\"line\">\t\tremoveRequest(requestId);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">cancelRequest</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> requestId)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// We have to use AsyncTask since this might trigger a NetworkOnMainThreadException, this is an</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// open issue on OkHttp: https://github.com/square/okhttp/issues/869</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> GuardedAsyncTask(getReactApplicationContext()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doInBackgroundGuarded</span><span class=\"params\">(Void... params)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t\tOkHttpCallUtil.cancelTag(mClient, Integer.valueOf(requestId));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;.execute();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ReactMethod</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">clearCookies</span><span class=\"params\">(com.facebook.react.bridge.Callback callback)</span> </span>&#123;</span><br><span class=\"line\">\t\tmCookieHandler.clearCookies(callback);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"meta\">@Nullable</span> MultipartBody.<span class=\"function\">Builder <span class=\"title\">constructMultipartBody</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tReadableArray body,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tString contentType,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t<span class=\"keyword\">int</span> requestId</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\tRCTDeviceEventEmitter eventEmitter = getEventEmitter();</span><br><span class=\"line\">\t\tMultipartBody.Builder multipartBuilder = <span class=\"keyword\">new</span> MultipartBody.Builder();</span><br><span class=\"line\">\t\tmultipartBuilder.setType(MediaType.parse(contentType));</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>, size = body.size(); i &lt; size; i++) &#123;</span><br><span class=\"line\">\t\t\tReadableMap bodyPart = body.getMap(i);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Determine part's content type.</span></span><br><span class=\"line\">\t\t\tReadableArray headersArray = bodyPart.getArray(<span class=\"string\">\"headers\"</span>);</span><br><span class=\"line\">\t\t\tHeaders headers = extractHeaders(headersArray, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (headers == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">\"Missing or invalid header format for FormData part.\"</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tMediaType partContentType = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString partContentTypeStr = headers.get(CONTENT_TYPE_HEADER_NAME);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (partContentTypeStr != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tpartContentType = MediaType.parse(partContentTypeStr);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Remove the content-type header because MultipartBuilder gets it explicitly as an</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// argument and doesn't expect it in the headers array.</span></span><br><span class=\"line\">\t\t\t\theaders = headers.newBuilder().removeAll(CONTENT_TYPE_HEADER_NAME).build();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (bodyPart.hasKey(REQUEST_BODY_KEY_STRING)) &#123;</span><br><span class=\"line\">\t\t\t\tString bodyValue = bodyPart.getString(REQUEST_BODY_KEY_STRING);</span><br><span class=\"line\">\t\t\t\tmultipartBuilder.addPart(headers, RequestBody.create(partContentType, bodyValue));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (bodyPart.hasKey(REQUEST_BODY_KEY_URI)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (partContentType == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">\"Binary FormData part needs a content-type header.\"</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tString fileContentUriStr = bodyPart.getString(REQUEST_BODY_KEY_URI);</span><br><span class=\"line\">\t\t\t\tInputStream fileInputStream = RequestBodyUtil.getFileInputStream(getReactApplicationContext(), fileContentUriStr);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (fileInputStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tResponseUtil.onRequestError(</span><br><span class=\"line\">\t\t\t\t\t\teventEmitter,</span><br><span class=\"line\">\t\t\t\t\t\trequestId,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">\"Could not retrieve file for uri \"</span> + fileContentUriStr,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">null</span></span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tmultipartBuilder.addPart(headers, RequestBodyUtil.create(partContentType, fileInputStream));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tResponseUtil.onRequestError(eventEmitter, requestId, <span class=\"string\">\"Unrecognized FormData part.\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> multipartBuilder;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t* Extracts the headers from the Array. If the format is invalid, this method will return null.</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"meta\">@Nullable</span> <span class=\"function\">Headers <span class=\"title\">extractHeaders</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t@Nullable ReadableArray headersArray,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t@Nullable ReadableMap requestData</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (headersArray == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tHeaders.Builder headersBuilder = <span class=\"keyword\">new</span> Headers.Builder();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> headersIdx = <span class=\"number\">0</span>, size = headersArray.size(); headersIdx &lt; size; headersIdx++) &#123;</span><br><span class=\"line\">\t\t\tReadableArray header = headersArray.getArray(headersIdx);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (header == <span class=\"keyword\">null</span> || header.size() != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tString headerName = header.getString(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t\tString headerValue = header.getString(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (headerName == <span class=\"keyword\">null</span> || headerValue == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\theadersBuilder.add(headerName, headerValue);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (headersBuilder.get(USER_AGENT_HEADER_NAME) == <span class=\"keyword\">null</span> &amp;&amp; mDefaultUserAgent != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\theadersBuilder.add(USER_AGENT_HEADER_NAME, mDefaultUserAgent);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Sanitize content encoding header, supported only when request specify payload as string</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">boolean</span> isGzipSupported = requestData != <span class=\"keyword\">null</span> &amp;&amp; requestData.hasKey(REQUEST_BODY_KEY_STRING);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!isGzipSupported) &#123;</span><br><span class=\"line\">\t\t\theadersBuilder.removeAll(CONTENT_ENCODING_HEADER_NAME);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> headersBuilder.build();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> RCTDeviceEventEmitter <span class=\"title\">getEventEmitter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> getReactApplicationContext().getJSModule(RCTDeviceEventEmitter.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在终端代开项目<code>cd {project}</code>执行</p>\n</li>\n<li><p><code>react-native run-android</code>开始编译，编译的过程很漫长，大概需要10到20分钟</p>\n</li>\n<li><p>如果中途失败记得删除<code>/node_modules/react-native/ReactAndroid/bulid</code>里面的所有内容，然后重新编译</p>\n</li>\n<li><p>关于源代码编译可以参考官方文档<a href=\"https://reactnative.cn/docs/building-from-source.html\" target=\"_blank\" rel=\"noopener\">中文</a>或者<a href=\"https://facebook.github.io/react-native/docs/building-from-source\" target=\"_blank\" rel=\"noopener\">英文</a>官网详细查看</p>\n</li>\n</ul>\n<ul>\n<li>关于详细代码可进入我的<a href=\"https://github.com/AaronBank/react-native.git\" target=\"_blank\" rel=\"noopener\">Github</a>查看</li>\n</ul>\n<p><em>感谢支持</em></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjysbhubf0000qbt5rus5120x","category_id":"cjysbhubo0004qbt5cvec31c5","_id":"cjysbhuby000eqbt5s7pmgpak"},{"post_id":"cjysbhubv000cqbt5dyzzy1om","category_id":"cjysbhubu0009qbt50j4fgstk","_id":"cjysbhuc4000lqbt5cdqk1kn2"},{"post_id":"cjysbhubk0002qbt5wkz00hvp","category_id":"cjysbhubu0009qbt50j4fgstk","_id":"cjysbhuc8000pqbt5otua13ll"},{"post_id":"cjysbhubz000iqbt5efukinnv","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhuca000sqbt5ohs0pua3"},{"post_id":"cjysbhubq0006qbt5sspmyzji","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhucc000wqbt5r0iopf1y"},{"post_id":"cjysbhuc3000kqbt5sskpmkdo","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhucd000zqbt5wkgbn48p"},{"post_id":"cjysbhuc7000oqbt50pysz879","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhuce0013qbt59rp0a951"},{"post_id":"cjysbhubr0007qbt5tp75otdv","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhucf0015qbt5ezquw2dy"},{"post_id":"cjysbhubt0008qbt51bgc9ids","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhucg0019qbt5mpj00syh"},{"post_id":"cjysbhucc000yqbt5b6o0vet5","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhucg001bqbt5sa59nm4b"},{"post_id":"cjysbhuc9000rqbt5rud4616o","category_id":"cjysbhucd0011qbt5ma4a5duh","_id":"cjysbhuch001dqbt5tx35rzzo"},{"post_id":"cjysbhucb000vqbt5df9k4lca","category_id":"cjysbhucf0017qbt5p1j1oyy9","_id":"cjysbhuci001gqbt51y86k1ek"},{"post_id":"cjysbhucr001jqbt52mmnuoww","category_id":"cjysbhubz000fqbt5q12u0u9y","_id":"cjysbhucs001lqbt5rtgln44m"},{"post_id":"cjysbhubx000dqbt5ze407o7b","category_id":"cjysbhucd0011qbt5ma4a5duh","_id":"cjysbmg63001uqbt5o81i5x0i"}],"PostTag":[{"post_id":"cjysbhubf0000qbt5rus5120x","tag_id":"cjysbhubp0005qbt5oog8z54l","_id":"cjysbhubv000bqbt5a9ppqx51"},{"post_id":"cjysbhubv000cqbt5dyzzy1om","tag_id":"cjysbhubu000aqbt51hyfmqrs","_id":"cjysbhubz000hqbt5mxd79r24"},{"post_id":"cjysbhubk0002qbt5wkz00hvp","tag_id":"cjysbhubu000aqbt51hyfmqrs","_id":"cjysbhuc3000jqbt5k66vp35l"},{"post_id":"cjysbhubq0006qbt5sspmyzji","tag_id":"cjysbhubz000gqbt5h6ech2j2","_id":"cjysbhuc8000qqbt5glmiaqud"},{"post_id":"cjysbhubr0007qbt5tp75otdv","tag_id":"cjysbhubz000gqbt5h6ech2j2","_id":"cjysbhucc000xqbt58a2k6a8t"},{"post_id":"cjysbhubt0008qbt51bgc9ids","tag_id":"cjysbhucb000uqbt5klrb4gfo","_id":"cjysbhuce0014qbt553x2aiys"},{"post_id":"cjysbhucc000yqbt5b6o0vet5","tag_id":"cjysbhubz000gqbt5h6ech2j2","_id":"cjysbhucf0016qbt5qe9ef48a"},{"post_id":"cjysbhubz000iqbt5efukinnv","tag_id":"cjysbhucb000uqbt5klrb4gfo","_id":"cjysbhucg001aqbt5vd5hqcog"},{"post_id":"cjysbhuc3000kqbt5sskpmkdo","tag_id":"cjysbhucb000uqbt5klrb4gfo","_id":"cjysbhuch001eqbt53zxhs2ew"},{"post_id":"cjysbhuc7000oqbt50pysz879","tag_id":"cjysbhucb000uqbt5klrb4gfo","_id":"cjysbhuci001hqbt5g2tqt5nu"},{"post_id":"cjysbhucb000vqbt5df9k4lca","tag_id":"cjysbhuch001fqbt50rwuoci7","_id":"cjysbhuci001iqbt55sxmqn2h"},{"post_id":"cjysbhucr001jqbt52mmnuoww","tag_id":"cjysbhucb000uqbt5klrb4gfo","_id":"cjysbhucs001kqbt5bbinpjq4"},{"post_id":"cjysbhuc9000rqbt5rud4616o","tag_id":"cjysbm9kz001rqbt5995lh9fw","_id":"cjysbm9kz001sqbt59alit0li"},{"post_id":"cjysbhubx000dqbt5ze407o7b","tag_id":"cjysbhuch001fqbt50rwuoci7","_id":"cjysbmg62001tqbt59hzq3l9k"}],"Tag":[{"name":"ubuntu","_id":"cjysbhubp0005qbt5oog8z54l"},{"name":"Git","_id":"cjysbhubu000aqbt51hyfmqrs"},{"name":"Javascript","_id":"cjysbhubz000gqbt5h6ech2j2"},{"name":"ReactNative","_id":"cjysbhucb000uqbt5klrb4gfo"},{"name":"Vue","_id":"cjysbhuch001fqbt50rwuoci7"},{"name":"react","_id":"cjysblr7m001mqbt5cmbd58np"},{"name":"React","_id":"cjysbm9kz001rqbt5995lh9fw"}]}}