
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>vue-cli2 é…ç½®Dllæ‰“åŒ… - æ¼«æ­¥è€…</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="æ¼«æ­¥è€…åšå®¢,"> 
    <meta name="description" content="
vue-cliåœ¨é¡¹ç›®æ‰“åŒ…æ—¶ï¼Œå¯¹äºä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚vueã€vuexã€vue-router...ç­‰è¿™äº›ä¸ä¼šä¿®æ”¹çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›ä¾èµ–å•ç‹¬è¿›è¡Œæ‰“ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ¯æ¬¡æ›´æ”¹æˆ‘æœ¬åœ°ä»£ç çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œwe,"> 
    <meta name="author" content="Aaron"> 
    <link rel="alternative" href="atom.xml" title="æ¼«æ­¥è€…" type="application/atom+xml"> 
    <link rel="icon" href="/img/logo.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">æ¼«æ­¥è€…</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="http://windteam.cn"></a>
    <div title="æ’­æ”¾/æš‚åœ" class="icon-play"></div>
    <h3 class="subtitle">vue-cli2 é…ç½®Dllæ‰“åŒ…</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="è·å–äºŒç»´ç " class="icon-scan"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">vue-cli2 é…ç½®Dllæ‰“åŒ…</h1>
        <div class="stuff">
            <span>å…«æœˆ 01, 2019</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Vue/">Vue</a></li></ul>


        </div>
        <div class="content markdown">
            <p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/073932.jpg" alt></p>
<p><code>vue-cli</code>åœ¨é¡¹ç›®æ‰“åŒ…æ—¶ï¼Œå¯¹äºä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚<code>vueã€vuexã€vue-router...</code>ç­‰è¿™äº›ä¸ä¼šä¿®æ”¹çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›ä¾èµ–å•ç‹¬è¿›è¡Œæ‰“ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ¯æ¬¡æ›´æ”¹æˆ‘æœ¬åœ°ä»£ç çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œ<code>webpack</code>åªéœ€è¦æ‰“åŒ…æˆ‘é¡¹ç›®æœ¬èº«çš„æ–‡ä»¶ä»£ç ï¼Œè€Œä¸ä¼šå†å»ç¼–è¯‘ç¬¬ä¸‰æ–¹åº“ï¼Œæ‰“åŒ…é€Ÿåº¦ä¼šæœ‰è´¨çš„æå‡ã€‚å¹¶ä¸”ä¹Ÿæœ‰åˆ©äºå¯¹è¿™äº›éä¸šåŠ¡ç›¸å…³ä»£ç åœ¨å®¢æˆ·ç«¯ç¼“å­˜çš„åˆ©ç”¨ã€‚</p>
<p>å› æ­¤ä¸ºäº†å®ç°è¿™ä¸ªé—®é¢˜ï¼Œ<code>DllPlugin</code> å’Œ <code>DllReferencePlugin</code>æ’ä»¶ä¹Ÿå°±è¯ç”Ÿäº†ğŸ˜¬ã€‚</p>
<p>ä¸å¤šå“”å“”ï¼Œè¿˜æ˜¯è¯´è¯´æ€ä¹ˆç”¨å§ (â™¥Ï‰â™¥)~â™ª </p>
<h3 id="é¡¹ç›®åˆ†æ"><a href="#é¡¹ç›®åˆ†æ" class="headerlink" title="é¡¹ç›®åˆ†æ"></a>é¡¹ç›®åˆ†æ</h3><p>æœ¬æ–‡åªé˜è¿°å…³äº<code>vue-cli 2.x</code>ç‰ˆæœ¬ï¼Œ<code>3.x</code>å¯¹ä¸€äº›ç¬¬ä¸‰æ–¹åº“æœ‰ç›¸å¯¹è·¯å¾„å¼•å…¥ï¼Œå¦‚æœä½ ä¾æ—§æƒ³ä½¿ç”¨<code>DLL</code>å»åˆ‡åˆ†åŒ…å¯ä»¥å°è¯•ä¸€ä¸‹<a href="https://github.com/fingerpan/vue-cli-plugin-dll" target="_blank" rel="noopener">vue-cli-plugin-dll</a>è¿™ä¸ªå·¥å…·ã€‚å¥½äº†è¯´ä¸‹æˆ‘ä»¬å½“å‰é¡¹ç›®ç›®å½•ï¼š</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/082923.png" alt="image-20190801162922915"></p>
<p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„<code>cli 2</code>åˆ›å»ºçš„å·¥ç¨‹ï¼Œä¸‹é¢æˆ‘åšä¸ªæ‰“åŒ…åˆ†æï¼ˆå› ä¸ºæˆ‘è¿™ä¸ªé¡¹ç›®æ˜¯çœŸå®é¡¹ç›®å¯èƒ½æ¯”è¾ƒå¤§ï¼‰ã€‚</p>
<h4 id="æ·»åŠ analyzer"><a href="#æ·»åŠ analyzer" class="headerlink" title="æ·»åŠ analyzer"></a>æ·»åŠ analyzer</h4><p>ä¿®æ”¹package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"DLLä¾‹å­"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"npm run dev"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"cross-env NODE_ENV=production node build/build.js"</span>,</span><br><span class="line">    <span class="attr">"analyzer"</span>: <span class="string">"npm run build --report"</span> //=&gt; here</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œæ‰“åŒ…åˆ†æå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn analyzer</span><br><span class="line"># or</span><br><span class="line">npm run analyzer</span><br></pre></td></tr></table></figure>

<p>æ‰“å®ŒåŒ…ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰“åŒ…åæ¯ä¸€å—åŒ…å«ç€ä»€ä¹ˆï¼Œå æ¯”å¤šå°‘ã€‚ä¸‹é¢çœ‹ä¸€ä¸‹æˆ‘æ‰“åŒ…åçš„åˆ†æå›¾</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/084952.png" alt="image-20190801164951855"></p>
<p>å¯ä»¥çœ‹å‡º<code>vendor.js</code>æ‰“åŒ…ååŸå§‹å¤§å°è¾¾åˆ°<code>2.17MB</code>ï¼Œè€Œè¿™ä¸ªåŒ…ä½ æ¯æ¬¡è¿­ä»£å‘å¸ƒæ—¶åé¢çš„<code>chunkhash</code>éƒ½ä¼šå˜åŒ–ã€‚æ„å‘³ç€å®¢æˆ·ç«¯çš„ç¼“å­˜å°±æ²¡äº†ï¼Œå½“å†æ¬¡æ‰“å¼€æˆ‘ä»¬çš„ç½‘ç«™æ—¶è¿™ä¸ª<code>vendor.js</code>åˆä¼šé‡æ–°åŠ è½½ã€‚</p>
<p>è¯´åˆ°è¿™æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹è¿™ä¸ª<code>vendor.js</code>åˆ°åº•åŒ…å«äº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå¤§ï¼Ÿ</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/085512.png" alt="image-20190801165511594"></p>
<p>æ”¾å¤§åæˆ‘è§‰å¾—ä¸éœ€è¦å¤šè§£é‡Šäº†ï¼Œ<code>element-ui</code>ã€<code>vue</code>ã€<code>core</code>ã€<code>router</code>ç­‰ç­‰ã€‚ã€‚ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åˆ©ç”¨<code>DLL</code>å¯¹ä»–ä»¬å•ç‹¬è¿›è¡Œæ‰“åŒ…ï¼š</p>
<h3 id="é…ç½®DLL"><a href="#é…ç½®DLL" class="headerlink" title="é…ç½®DLL"></a>é…ç½®DLL</h3><h4 id="åœ¨é…ç½®ä¸­æ·»åŠ dllç‰ˆå—"><a href="#åœ¨é…ç½®ä¸­æ·»åŠ dllç‰ˆå—" class="headerlink" title="åœ¨é…ç½®ä¸­æ·»åŠ dllç‰ˆå—"></a>åœ¨é…ç½®ä¸­æ·»åŠ dllç‰ˆå—</h4><p>ä¿®æ”¹<code>/config/index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    dev: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    dll: &#123;</span><br><span class="line">        entry: &#123;</span><br><span class="line">            <span class="string">'vueVendor'</span>: [</span><br><span class="line">                <span class="string">'babel-polyfill'</span>,</span><br><span class="line">                <span class="string">'vue/dist/vue.esm.js'</span>,</span><br><span class="line">                <span class="string">'vue-router'</span>,</span><br><span class="line">                <span class="string">'vuex'</span>,</span><br><span class="line">                <span class="string">'axios'</span></span><br><span class="line">            ],</span><br><span class="line">            vendor: [</span><br><span class="line">                <span class="string">'@dal/element-ui'</span>,</span><br><span class="line">                <span class="string">'nprogress'</span>,</span><br><span class="line">                <span class="string">'viewerjs'</span>,</span><br><span class="line">                <span class="string">'v-viewer'</span>,</span><br><span class="line">                <span class="string">'vuex-persistedstate'</span>,</span><br><span class="line">                <span class="string">'qs'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        outputPath: <span class="string">'cdn'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    build: &#123;</span><br><span class="line">    	...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šä¸€ä¸‹ï¼š</p>
<ul>
<li>é¦–å…ˆå¯¹äºæˆ‘ï¼Œæˆ‘è§‰å¾—æœ‰ä¸€éƒ¨åˆ†ç¬¬ä¸‰æ–¹åº“æ˜¯å¾ˆä¹…éƒ½ä¸ä¼šå˜çš„ï¼Œæ‰€ä»¥æˆ‘å°†ä»–ä»¬æ‰“åŒ…åˆ°<code>vueVendor</code></li>
<li>å¯¹äºä¸€äº›å¯èƒ½å‘ç”Ÿå˜åŒ–çš„ï¼ˆè¿™é‡Œçš„<code>element-ui</code>é‡‡ç”¨çš„äº‹å†…éƒ¨æºï¼Œæ‰€ä»¥å˜åŒ–å¯èƒ½ä¹Ÿå¾ˆå¤§ï¼‰å°†ä»–ä»¬æ‰“åŒ…åˆ°<code>vendor</code>ï¼Œå½“ç„¶è¿™ä¸¤ä¸ªåå­—ä½ å¯ä»¥éšä¾¿èµ·ï¼Œä½†æ˜¯å¤šæ–‡ä»¶æœ‰ä¸ªå‘æœ€åè¯´ã€‚</li>
<li><code>outputPath</code>ç”¨ä½œæˆ‘ä»¬å°†æ¥<code>DLL</code>åŒ…æ‰“åŒ…åˆ°å“ªé‡Œï¼Œæˆ‘è¿™é‡Œèµ·åå«<code>cdn</code></li>
<li>æŠŠé…ç½®å†™åœ¨è¿™é‡Œæ˜¯ä¸ºäº†åç»­æ–¹ä¾¿ç»´æŠ¤</li>
</ul>
<h4 id="åˆ›å»ºDllæ‰“åŒ…é…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºDllæ‰“åŒ…é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºDllæ‰“åŒ…é…ç½®æ–‡ä»¶"></a>åˆ›å»ºDllæ‰“åŒ…é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>build</code>æ–‡ä»¶å¤¹ä¸‹æ·»åŠ åä¸º<code>webpack.dll.conf.js</code>çš„æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config/index'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: config.dll.entry, <span class="comment">// é…ç½®æ‰“åŒ…å…¥å£</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'..'</span>, config.dll.outputPath), <span class="comment">// é…ç½®æ‰“åŒ…è¾“å‡ºç›®å½•</span></span><br><span class="line">        filename: <span class="string">'[name].[chunkhash].dll.js'</span>, <span class="comment">// chunkhashæ˜¯ä¸ºäº†æ—¥åæ¸…ç†ç¼“å­˜</span></span><br><span class="line">        library: <span class="string">'[name]_library'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">            path: path.join(__dirname, <span class="string">'./[name]-manifest.json'</span>),</span><br><span class="line">            name: <span class="string">'[name]_library'</span>,</span><br><span class="line">            context: __dirname <span class="comment">// è¿™é‡Œçš„ä¸Šä¸‹æ–‡è¦å’Œæˆ‘ä»¬åé¢ç”¨çš„DllReferencePluginçš„ä¸Šä¸‹æ–‡ä¸€è‡´ã€‚ </span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123; <span class="comment">// ä¸‘åŒ–Js</span></span><br><span class="line">            compress: &#123;</span><br><span class="line">              warnings: <span class="literal">false</span>,</span><br><span class="line">              drop_console:<span class="literal">true</span>,</span><br><span class="line">              drop_debugger:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            output:&#123;</span><br><span class="line">              comments: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            sourceMap: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»ºDLLæ‰“åŒ…è„šæœ¬"><a href="#åˆ›å»ºDLLæ‰“åŒ…è„šæœ¬" class="headerlink" title="åˆ›å»ºDLLæ‰“åŒ…è„šæœ¬"></a>åˆ›å»ºDLLæ‰“åŒ…è„šæœ¬</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">'ora'</span>) <span class="comment">// ä¸€ä¸ªæ‰§è¡ŒåŠ¨ç”»ï¼Œä¸ºäº†ç¾è§‚æ²¡å•¥</span></span><br><span class="line"><span class="keyword">const</span> rm = <span class="built_in">require</span>(<span class="string">'rimraf'</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config/index'</span>)</span><br><span class="line"><span class="keyword">const</span> dllConfig = <span class="built_in">require</span>(<span class="string">'./webpack.dll.conf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> spinner = ora(<span class="string">'Start pre-operation...'</span>)</span><br><span class="line">spinner.start()</span><br><span class="line"></span><br><span class="line">rm(path.join(__dirname, <span class="string">'..'</span>, config.dll.outputPath), err =&gt; &#123; <span class="comment">// æ‰“åŒ…å‰æ¸…ç©ºcdnæ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    webpack(dllConfig, (err, stats) =&gt; &#123; <span class="comment">// æ‰§è¡Œæ‰“åŒ…</span></span><br><span class="line">        spinner.stop()</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">        process.stdout.write(stats.toString(&#123; <span class="comment">// ä¸€äº›æ—¥å¿—</span></span><br><span class="line">            colors: <span class="literal">true</span>,</span><br><span class="line">            modules: <span class="literal">false</span>,</span><br><span class="line">            children: <span class="literal">false</span>,</span><br><span class="line">            chunks: <span class="literal">false</span>,</span><br><span class="line">            chunkModules: <span class="literal">false</span></span><br><span class="line">        &#125;) + <span class="string">'\n\n'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (stats.hasErrors()) &#123; <span class="comment">// å¦‚æœå¤±è´¥è¾“å‡ºé”™è¯¯æ—¥å¿—å¹¶é€€å‡ºè¿›ç¨‹</span></span><br><span class="line">            <span class="built_in">console</span>.log(chalk.red(<span class="string">'  Build failed with errors.\n'</span>))</span><br><span class="line">            process.exit(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(chalk.cyan(<span class="string">'  Build complete.\n'</span>))</span><br><span class="line">        <span class="built_in">console</span>.log(chalk.yellow(<span class="string">' Project decomposition is successful, enter startup status ...'</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å°±èƒ½ä¸ºè¿™äº›ç¬¬ä¸‰æ–¹åº“åšæ‰“åŒ…äº†<code>DLL</code>ï¼ˆdllæ‰“åŒ…å’Œé¡¹ç›®æ‰“åŒ…æ˜¯åˆ†å¼€çš„ï¼‰</p>
<h4 id="é…ç½®è„šæœ¬ï¼Œå¼€å§‹æ‰“åŒ…"><a href="#é…ç½®è„šæœ¬ï¼Œå¼€å§‹æ‰“åŒ…" class="headerlink" title="é…ç½®è„šæœ¬ï¼Œå¼€å§‹æ‰“åŒ…"></a>é…ç½®è„šæœ¬ï¼Œå¼€å§‹æ‰“åŒ…</h4><p>æˆ‘ä»¬ä¿®æ”¹<code>package.json</code>ä¸­çš„<code>scripts</code>æ·»åŠ ä¸€æ¡<code>DLL</code>æ‰“åŒ…çš„å‘½ä»¤ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"DLLä¾‹å­"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"npm run dev"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"cross-env NODE_ENV=development webpack-dev-server --inline --progress --config build/webpack.dev.conf.js"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"cross-env NODE_ENV=production node build/build.js"</span>,</span><br><span class="line">    <span class="attr">"analyzer"</span>: <span class="string">"npm run build --report"</span>,</span><br><span class="line">    <span class="attr">"dll"</span>: <span class="string">"node build/dll.js"</span> //=&gt; here</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œåæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn dll</span><br><span class="line"><span class="meta">#</span> or</span><br><span class="line">npm run dll</span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä½ çš„æ ¹ç›®å½•ä¼šå‡ºç°ä¸€ä¸ªå«åš<code>cdn</code>çš„æ–‡ä»¶å¤¹ï¼ˆæˆ–è€…æ˜¯ä½ è‡ªå·±é…ç½®çš„æ–‡ä»¶å¤¹åï¼‰ï¼ŒåŒæ—¶<code>build</code>æ–‡ä»¶å¤¹ä¸‹ä¹Ÿä¼šå¤šå‡ºä¸¤ä¸ª<code>***-manifest.json</code>æ–‡ä»¶ã€‚ä¸Šå›¾çœ‹ä¸€ä¸‹</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/031926.png" alt="image-20190802111926063"></p>
<p>æ‰“åŒ…åçš„æ–‡ä»¶ç›®å½•ï¼š</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032708.png" alt="image-20190802112708091"></p>
<p>å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åªè¦å‘Šè¯‰<code>webpack</code>é‡åˆ°è¿™äº›å…¬å…±åŒ…çš„æ—¶å€™ä¸è¿›è¡Œæ‰“åŒ…ï¼Œè¿™ä¹Ÿå°±æ˜¯<code>***-manifest.json</code>æ–‡ä»¶çš„ä½œç”¨ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¦é…ç½®<code>webpack.dev.conf.js</code>ä»¥åŠ<code>webpack.prod.conf.js</code>æ–‡ä»¶</p>
<h4 id="ä¿®æ”¹å¼€å‘æ‰“åŒ…é…ç½®"><a href="#ä¿®æ”¹å¼€å‘æ‰“åŒ…é…ç½®" class="headerlink" title="ä¿®æ”¹å¼€å‘æ‰“åŒ…é…ç½®"></a>ä¿®æ”¹å¼€å‘æ‰“åŒ…é…ç½®</h4><p>å†æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ª<code>webpack</code>æ’ä»¶ï¼Œä½œç”¨å°±æ˜¯è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠ<code>Dll</code>è¿™å—é™æ€<code>js</code>æ–‡ä»¶è‡ªåŠ¨å¼•å…¥åˆ°é¡¹ç›®ä¸­ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œç”¨åˆ°çš„æ˜¯<a href="https://github.com/SimenB/add-asset-html-webpack-plugin" target="_blank" rel="noopener">add-asset-html-webpack-plugin</a></p>
<p>æ‰“å¼€<code>/build/webpack.dev.conf.js</code>æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> FriendlyErrorsPlugin = <span class="built_in">require</span>(<span class="string">'friendly-errors-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> portfinder = <span class="built_in">require</span>(<span class="string">'portfinder'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æ’ä»¶</span></span><br><span class="line"><span class="keyword">const</span> AddAssetHtmlPlugin = <span class="built_in">require</span>(<span class="string">'add-asset-html-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            template: <span class="string">'index.html'</span>,</span><br><span class="line">            inject: <span class="literal">true</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// åœ¨HtmlWebpackPluginåé¢è¿›è¡Œæ·»åŠ </span></span><br><span class="line">        <span class="comment">// å› ä¸ºæˆ‘ä»¬æ˜¯å¤šä¸ªdllæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å¤„ç†ä¸€ä¸‹</span></span><br><span class="line">        ...Object.keys(config.dll.entry).map(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">                context: __dirname,</span><br><span class="line">                manifest: <span class="built_in">require</span>(<span class="string">`./<span class="subst">$&#123;name&#125;</span>-manifest.json`</span>),</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// ä½¿ç”¨AddAssetHtmlPluginæ’ä»¶å°†æˆ‘ä»¬çš„dllæ–‡ä»¶è‡ªåŠ¨å¼•å…¥åˆ°htmlæ¨¡æ¿ä¸­</span></span><br><span class="line">        <span class="keyword">new</span> AddAssetHtmlPlugin([&#123;</span><br><span class="line">            <span class="comment">// æŒ‡å®šdllå­˜æ”¾ä½ç½®</span></span><br><span class="line">            filepath: path.resolve(__dirname, <span class="string">'..'</span>, <span class="string">`<span class="subst">$&#123;config.dll.outputPath&#125;</span>/*.dll.js`</span>),</span><br><span class="line">            <span class="comment">// å¼•å…¥åå¹¶å°†dllæ–‡ä»¶è‡ªåŠ¨ç§»åŠ¨åˆ°distæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">            outputPath: utils.assetsPath(config.dll.outputPath),</span><br><span class="line">            <span class="comment">// æŒ‡å®šå¼•å…¥é™æ€è·¯å¾„å‰ç¼€</span></span><br><span class="line">            publicPath: path.posix.join(config.dev.assetsPublicPath, config.dev.assetsSubDirectory, config.dll.outputPath),</span><br><span class="line">            includeSourcemap: <span class="literal">false</span></span><br><span class="line">        &#125;])</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œè‡ªæ­¤æˆ‘ä»¬å¼€å‘ç¯å¢ƒä¸‹å°±é…ç½®å®Œæˆäº†ã€‚æˆªä¸‹æ¥æˆ‘ä»¬è¯´ä¸€ä¸‹ç”Ÿäº§ç¯å¢ƒçš„æ‰“åŒ…ä¿®æ”¹ï¼š</p>
<h4 id="ä¿®æ”¹ç”Ÿäº§æ‰“åŒ…é…ç½®"><a href="#ä¿®æ”¹ç”Ÿäº§æ‰“åŒ…é…ç½®" class="headerlink" title="ä¿®æ”¹ç”Ÿäº§æ‰“åŒ…é…ç½®"></a>ä¿®æ”¹ç”Ÿäº§æ‰“åŒ…é…ç½®</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æ’ä»¶</span></span><br><span class="line"><span class="keyword">const</span> AddAssetHtmlPlugin = <span class="built_in">require</span>(<span class="string">'add-asset-html-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// åœ¨HtmlWebpackPluginåé¢è¿›è¡Œæ·»åŠ </span></span><br><span class="line">        <span class="comment">// å› ä¸ºæˆ‘ä»¬æ˜¯å¤šä¸ªdllæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å¤„ç†ä¸€ä¸‹</span></span><br><span class="line">        ...Object.keys(config.dll.entry).map(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">                context: __dirname,</span><br><span class="line">                manifest: <span class="built_in">require</span>(<span class="string">`./<span class="subst">$&#123;name&#125;</span>-manifest.json`</span>),</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// ä½¿ç”¨AddAssetHtmlPluginæ’ä»¶å°†æˆ‘ä»¬çš„dllæ–‡ä»¶è‡ªåŠ¨å¼•å…¥åˆ°htmlæ¨¡æ¿ä¸­</span></span><br><span class="line">        <span class="keyword">new</span> AddAssetHtmlPlugin([&#123;</span><br><span class="line">            <span class="comment">// æŒ‡å®šdllå­˜æ”¾ä½ç½®</span></span><br><span class="line">            filepath: path.resolve(__dirname, <span class="string">'..'</span>, <span class="string">`<span class="subst">$&#123;config.dll.outputPath&#125;</span>/*.dll.js`</span>),</span><br><span class="line">            <span class="comment">// å¼•å…¥åå¹¶å°†dllæ–‡ä»¶è‡ªåŠ¨ç§»åŠ¨åˆ°distæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">            outputPath: utils.assetsPath(config.dll.outputPath),</span><br><span class="line">            <span class="comment">// æŒ‡å®šå¼•å…¥é™æ€è·¯å¾„å‰ç¼€(è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†cdnæœåŠ¡å™¨)</span></span><br><span class="line">            publicPath: <span class="string">`<span class="subst">$&#123;config.build.assetsPublicPath&#125;</span><span class="subst">$&#123;config.build.assetsSubDirectory&#125;</span>/<span class="subst">$&#123;config.dll.outputPath&#125;</span>`</span>,</span><br><span class="line">            includeSourcemap: <span class="literal">false</span></span><br><span class="line">        &#125;]),</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = webpackConfig</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç”¨<code>DLL</code>è¿›è¡Œæ‰“åŒ…åˆ†å‰²å·²ç»åšå®Œäº†ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æ•ˆæœã€‚</p>
<h4 id="å†æ¬¡è¿›è¡Œæ‰“åŒ…åˆ†æ"><a href="#å†æ¬¡è¿›è¡Œæ‰“åŒ…åˆ†æ" class="headerlink" title="å†æ¬¡è¿›è¡Œæ‰“åŒ…åˆ†æ"></a>å†æ¬¡è¿›è¡Œæ‰“åŒ…åˆ†æ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn analyzer</span><br><span class="line"># or</span><br><span class="line">npm run analyzer</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>DLL</code>åŒ…æ‹†åˆ†åæˆ‘ä»¬çš„<code>vendor.js</code>ä»…å‰©ä¸åˆ°<code>80kb</code></p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111405.png" alt="image-20190801191405068"></p>
<p>æˆ‘ä»¬å•ç‹¬æ”¾å¤§è¿™å—è¿›è¡ŒæŸ¥çœ‹ï¼š</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/111511.png" alt></p>
<p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„çš„åŒ…å·²ç»å®Œç¾çš„åˆ†å‰²å¼€äº†ï¼Œæœ€åå†æŸ¥çœ‹ä¸‹æ‰“åŒ…åçš„ç›®å½•ï¼š</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032222.png" alt="image-20190802112222035"></p>
<p>å¯ä»¥çœ‹åˆ°<code>cdn</code>è¿™ä¸ªç›®å½•å·²ç»è‡ªåŠ¨è¿ç§»åˆ°<code>/dist</code>ç›®å½•ä¸‹äº†ï¼Œé‚£è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå…¶å®è¿™ä¸ªæ˜¯<code>AddAssetHtmlPlugin</code>å¸®æˆ‘ä»¬åšäº†ï¼Œä¹Ÿå°±æ˜¯è¿™å¥èµ·ä½œç”¨äº†</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/025003.png" alt="image-20190802105002776"></p>
<p>è¿½åæˆ‘ä»¬çœ‹ä¸‹æœ€ç»ˆç”Ÿæˆçš„<code>html</code>æ¨¡æ¿æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/032503.png" alt="image-20190802112503021"></p>
<p>æœ€åè¯´æ˜ä¸€ä¸ª<strong>å®¹æ˜“å¿½ç•¥</strong>çš„ç‚¹ï¼š<code>DLL</code>å¤šå…¥å£ç”Ÿæˆæ²¡æœ‰é—®é¢˜ï¼Œä½†<code>AddAssetHtmlPlugin</code>å¼•å…¥ä½ æ–‡ä»¶çš„é¡ºåºæ˜¯æŒ‰ä½ æ‰“åŒ…åæ–‡ä»¶å¤¹æ–‡ä»¶çš„å€’å™æ–¹å¼å¼•å…¥çš„ã€‚å½“ç„¶åªæœ‰åœ¨ä½ æ‰“åŒ…çš„æ˜¯å¤šæ–‡ä»¶æ‰ä¼šæœ‰è¿™ç§é—®é¢˜ã€‚å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æŠŠä½¿ç”¨ä¸­å…¶ä»–ç»†èŠ‚é—®é¢˜æ‹¿å‡ºæ¥èŠä¸€ä¸‹</p>
<h3 id="æ£€æµ‹cdnç›®å½•å®Œæ•´"><a href="#æ£€æµ‹cdnç›®å½•å®Œæ•´" class="headerlink" title="æ£€æµ‹cdnç›®å½•å®Œæ•´"></a>æ£€æµ‹<code>cdn</code>ç›®å½•å®Œæ•´</h3><p>å¦‚æœæˆ‘ä»¬åæœŸå˜åŠ¨äº†<code>DLL</code>åŒ…ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œè¿›è¡Œäº†é‡æ–°<code>Dll</code>æ‰“åŒ…ï¼Œé‚£ä¹ˆå¯æƒ³è€ŒçŸ¥<code>cdn</code>æ–‡ä»¶å¤¹ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶çš„<code>chunkhash</code>ä¼šå˜åŒ–ï¼Œé‚£ä¹ˆä¸Šä¼ åˆ°ä»“åº“åï¼Œåˆ«çš„åŒäº‹åˆå¹¶ä½ çš„ä»£ç å¦‚æœä¸æ³¨æ„å¯èƒ½<code>cdn</code>ä¼šå­˜åœ¨æ–°æ—§ä¸¤ä¸ªç‰ˆæœ¬çš„æ–‡ä»¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´é¡¹ç›®å­˜åœ¨é£é™©ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªå·¥å…·ï¼Œæ‰“åŒ…ä¹‹å‰æå‰æ£€æµ‹<code>cdn</code>ç›®å½•ä¸‹æ–‡ä»¶æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå¦‚ä¸ç¬¦åˆæˆ‘ä»¬åº”è¯¥å‰ç½®è¿›è¡Œ<code>DLL</code>æ‰“åŒ…ã€‚åŒç†æˆ‘ä»¬è¿˜å¯ä»¥å¯¹<code>build</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>***-manifest.json</code>æ˜ å°„æ–‡ä»¶è¿›è¡Œç®€å•çš„æŸ¥éªŒï¼Œä¸é€šè¿‡åŒæ ·è¿›è¡Œå‰ç½®æ‰“åŒ…å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹å…·ä½“å¦‚ä½•å®ç°ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å†<code>build</code>ä¸‹åˆ›å»ºåä¸º<code>detection.js</code>çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>)</span><br><span class="line"><span class="keyword">const</span> process = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config/index'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºdll</span></span><br><span class="line"><span class="keyword">const</span> execScript = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(chalk.yellow(<span class="string">' DLL incomplete will be repackaged...'</span>))</span><br><span class="line">        process.execSync(<span class="string">'npm run dll'</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(chalk.red(<span class="string">'  Build failed with errors.\n'</span>))</span><br><span class="line">        process.exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.blue(<span class="string">' Check DLL package integrity...'</span>));</span><br><span class="line">    <span class="comment">// ä¸ºäº†ä¿è¯çº¿ä¸Šç¯å¢ƒåŒ…å®Œæ•´æ€§ï¼Œæ¯æ¬¡å‘å¸ƒbuildä¹‹å‰å…ˆè¿›è¡Œdllæ‰“åŒ…æ“ä½œï¼Œå¼€å‘ç¯å¢ƒåˆ™åšåŠ¨æ€ç›‘æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> (env === <span class="string">'production'</span>) <span class="keyword">return</span> execScript()</span><br><span class="line">    <span class="comment">// è·å–dllé…ç½®å…¥å£é…ç½®å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> dlls = <span class="built_in">Object</span>.keys(config.dll.entry)</span><br><span class="line">    <span class="comment">// è·å–dllå…¥å£æ–‡ä»¶ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">const</span> dllLength = dlls.length</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¯»å–cdnç›®å½•æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> files = fs.readdirSync(path.join(__dirname, <span class="string">'..'</span>, <span class="string">'cdn'</span>))</span><br><span class="line">        <span class="comment">// è¯»å–å½“å‰ç›®å½•æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> manifests = fs.readdirSync(__dirname)</span><br><span class="line">        <span class="comment">// åˆ¤æ–­manifestæ˜ å°„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">const</span> isManifests = manifests.filter(<span class="function"><span class="params">manifest</span> =&gt;</span> <span class="regexp">/.json$/</span>.test(manifest)).every(<span class="function"><span class="params">manifest</span> =&gt;</span> dlls.some(<span class="function"><span class="params">dll</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;dll&#125;</span>-manifest.json`</span> === manifest))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æ˜ å°„æ–‡ä»¶æˆ–æ–‡ä»¶æ•°é‡ä¸ç¬¦åˆ™é‡æ–°æ„å»ºdllåŒ…</span></span><br><span class="line">        <span class="keyword">if</span> (isManifests &amp;&amp; files.length === dllLength) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(chalk.green(<span class="string">' Congratulations DLL package available'</span>))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            execScript()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        execScript()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œåæˆ‘ä»¬åœ¨<code>build/webpack.base.conf.js</code>æ–‡ä»¶ä¸­å¼•å…¥å¹¶æ‰§è¡Œä»–ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"><span class="keyword">const</span> vueLoaderConfig = <span class="built_in">require</span>(<span class="string">'./vue-loader.conf'</span>)</span><br><span class="line"><span class="comment">// å¼•å…¥æˆ‘ä»¬ç¼–å†™çš„è„šæœ¬</span></span><br><span class="line"><span class="keyword">const</span> detection = <span class="built_in">require</span>(<span class="string">'./detection'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æµ‹dllåŒ…å¯ç”¨æ€§</span></span><br><span class="line">detection(process.env.NODE_ENV)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">dir</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createLintingRule = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œåæˆ‘ä»¬å§<code>cdn</code>ä¸‹çš„æ–‡ä»¶åˆ é™¤ä¸€ä¸ª</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034407.png" alt="image-20190802114406691"></p>
<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¼šé‡æ–°ç”Ÿæˆæˆ‘ä»¬çš„é™æ€æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn build</span><br><span class="line"># or</span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034736.png" alt="image-20190802114735617"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ£€æµ‹è„šæœ¬æ­£å¸¸æ‰§è¡Œäº† ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿›è¡Œäº†<code>DLL</code>æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œæœ€åæˆ‘ä»¬å†æŸ¥çœ‹ä¸‹<code>dist</code>ç›®å½•å’Œ<code>cdn</code>ç›®å½•çš„æƒ…å†µï¼š</p>
<p><img src="http://hexo-shen.oss-cn-beijing.aliyuncs.com/hexo/034923.png" alt="image-20190802114922878"></p>
<p>å¥½äº†ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜è®°å¾—çš„ç•™è¨€ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='https://hexo-shen.oss-cn-beijing.aliyuncs.com/lip/BEYOND%20-%20%E6%8A%A5%E7%AD%94%E4%B8%80%E7%94%9F.mp3'></li>
                    
                        <li title='1' data-url='https://hexo-shen.oss-cn-beijing.aliyuncs.com/lip/BEYOND%20-%20%E5%8F%AF%E5%90%A6%E5%86%B2%E7%A0%B4.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='ee3640920c5ec2f34694'
        data-cs='31ca17ca1df0813e0513ab2b0868b94cdeec4ced'
        data-r='aaronbank.github.io'
        data-o='aaronbank'
        data-a='aaronbank'
        data-d='true'
    >æŸ¥çœ‹è¯„è®º</div>


    </div>
    
        <div class='side'>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#é¡¹ç›®åˆ†æ"><span class="toc-number">1.</span> <span class="toc-text">é¡¹ç›®åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ·»åŠ analyzer"><span class="toc-number">1.1.</span> <span class="toc-text">æ·»åŠ analyzer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é…ç½®DLL"><span class="toc-number">2.</span> <span class="toc-text">é…ç½®DLL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#åœ¨é…ç½®ä¸­æ·»åŠ dllç‰ˆå—"><span class="toc-number">2.1.</span> <span class="toc-text">åœ¨é…ç½®ä¸­æ·»åŠ dllç‰ˆå—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åˆ›å»ºDllæ‰“åŒ…é…ç½®æ–‡ä»¶"><span class="toc-number">2.2.</span> <span class="toc-text">åˆ›å»ºDllæ‰“åŒ…é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åˆ›å»ºDLLæ‰“åŒ…è„šæœ¬"><span class="toc-number">2.3.</span> <span class="toc-text">åˆ›å»ºDLLæ‰“åŒ…è„šæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é…ç½®è„šæœ¬ï¼Œå¼€å§‹æ‰“åŒ…"><span class="toc-number">2.4.</span> <span class="toc-text">é…ç½®è„šæœ¬ï¼Œå¼€å§‹æ‰“åŒ…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¿®æ”¹å¼€å‘æ‰“åŒ…é…ç½®"><span class="toc-number">2.5.</span> <span class="toc-text">ä¿®æ”¹å¼€å‘æ‰“åŒ…é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¿®æ”¹ç”Ÿäº§æ‰“åŒ…é…ç½®"><span class="toc-number">2.6.</span> <span class="toc-text">ä¿®æ”¹ç”Ÿäº§æ‰“åŒ…é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å†æ¬¡è¿›è¡Œæ‰“åŒ…åˆ†æ"><span class="toc-number">2.7.</span> <span class="toc-text">å†æ¬¡è¿›è¡Œæ‰“åŒ…åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ£€æµ‹cdnç›®å½•å®Œæ•´"><span class="toc-number">3.</span> <span class="toc-text">æ£€æµ‹cdnç›®å½•å®Œæ•´</span></a></li></ol>
        </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
